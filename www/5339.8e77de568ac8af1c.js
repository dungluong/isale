"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5339],{8257:(F,O,l)=>{l.d(O,{r:()=>c});var p=l(6900);class c{constructor(I=0,U="",M="",D="",N=!1){this.id=0,this.code="",this.staffId=0,this.businessTypeId=0,this.salesLineId=0,this.avatarUrl="",this.fullName="",this.mobile="",this.isImportant=!1,this.gender="",this.email="",this.address="",this.dateOfBirth="",this.lastActive="",this.lastAction="",this.onlineId=0,this.staff=new p.O,this.businessType=null,this.salesLine=null,this.point=0,this.levelId=0,this.level=null,this.buyCount=0,this.fbUserId=null,this.source=null,this.id=I,this.avatarUrl=U,this.fullName=M,this.mobile=D,this.isImportant=N}}},6900:(F,O,l)=>{l.d(O,{O:()=>p});class p{constructor(o=0,I="",U="",M=""){this.hourLimit=1,this.storeId=0,this.store=null,this.isCollaborator=!1,this.shiftId=0,this.shift=null,this.blockViewingQuantity=!1,this.id=0,this.avatarUrl="",this.name="",this.userName="",this.shopName="",this.createdAt="",this.hasFullAccess=!1,this.canCreateOrder=!1,this.canUpdateDeleteOrder=!1,this.canCreateNewTransaction=!1,this.canUpdateDeleteTransaction=!1,this.canCreateUpdateNote=!1,this.canCreateUpdateDebt=!1,this.canUpdateDeleteProduct=!1,this.canViewProductCostPrice=!1,this.canUpdateProductCostPrice=!1,this.canViewAllContacts=!1,this.canManageContacts=!1,this.updateStatusExceptDone=!1,this.blockEditingOrderPrice=!1,this.id=o,this.avatarUrl=I,this.name=U,this.userName=M}}},6026:(F,O,l)=>{l.d(O,{k:()=>D});var p=l(6738),c=l(191),o=l(6961),I=l(4006),U=l(3306);const M=["barcodeInput"];let D=(()=>{class N{constructor(b,Z){this.viewCtrl=b,this.productService=Z}ngOnInit(){this.barcodeFocus()}ionViewLoaded(){this.barcodeFocus()}barcodeFocus(){setTimeout(()=>{this.barcodeInput.setFocus()},600)}barcodeChanged(){!this.barcode||this.barcode.length<5||this.productService.searchByBarcode(this.barcode).then(b=>{!b||this.ok()})}dismiss(){this.viewCtrl.dismiss()}ok(){this.viewCtrl.dismiss({barcode:this.barcode})}}return N.\u0275fac=function(b){return new(b||N)(p.Y36(c.IN),p.Y36(o.M))},N.\u0275cmp=p.Xpm({type:N,selectors:[["barcode-input"]],viewQuery:function(b,Z){if(1&b&&p.Gf(M,7),2&b){let y;p.iGM(y=p.CRH())&&(Z.barcodeInput=y.first)}},decls:22,vars:13,consts:[["slot","start"],[3,"click"],["name","close"],[1,"ion-padding"],["clearInput","","autofocus","true","type","text",3,"placeholder","ngModel","ngModelChange"],["barcodeInput",""],["color","primary","expand","block",3,"click"],["color","secondary","expand","block",3,"click"]],template:function(b,Z){1&b&&(p.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),p.NdJ("click",function(){return Z.dismiss()}),p._UZ(4,"ion-icon",2),p.qZA()(),p.TgZ(5,"ion-title"),p._uU(6),p.ALo(7,"translate"),p.qZA()()(),p.TgZ(8,"ion-content",3)(9,"ion-input",4,5),p.NdJ("ngModelChange",function(e){return Z.barcode=e})("ngModelChange",function(){return Z.barcodeChanged()}),p.ALo(11,"translate"),p.qZA(),p.TgZ(12,"ion-grid")(13,"ion-row")(14,"ion-col")(15,"ion-button",6),p.NdJ("click",function(){return Z.ok()}),p._uU(16),p.ALo(17,"translate"),p.qZA()(),p.TgZ(18,"ion-col")(19,"ion-button",7),p.NdJ("click",function(){return Z.dismiss()}),p._uU(20),p.ALo(21,"translate"),p.qZA()()()()()),2&b&&(p.xp6(6),p.hij(" ",p.lcZ(7,5,"order-add.enter-barcode")," "),p.xp6(3),p.s9C("placeholder",p.lcZ(11,7,"order-add.enter-barcode-placeholder")),p.Q6J("ngModel",Z.barcode),p.xp6(7),p.Oqu(p.lcZ(17,9,"common.agree")),p.xp6(4),p.hij("",p.lcZ(21,11,"common.cancel")," "))},dependencies:[I.JJ,I.On,c.YG,c.Sm,c.wI,c.W2,c.jY,c.Gu,c.gu,c.pK,c.Nd,c.wd,c.sr,c.j9,U.X$],encapsulation:2}),N})()},7613:(F,O,l)=>{l.d(O,{F:()=>y});var p=l(5861),c=l(6738),o=l(6895),I=l(4006),U=l(191);const M=["template"],D=["input1"],N=["input2"];function v(e,P){if(1&e){const d=c.EpF();c.TgZ(0,"ion-input",4,5),c.NdJ("ngModelChange",function(g){c.CHM(d);const m=c.oxw(2);return c.KtG(m.moneyValueString=g)})("ionBlur",function(){c.CHM(d);const g=c.oxw(2);return c.KtG(g.ionBlur())})("ionFocus",function(){c.CHM(d);const g=c.oxw(2);return c.KtG(g.ionFocus())})("keyup.enter",function(){c.CHM(d);const g=c.oxw(2);return c.KtG(g.onEnter())}),c.qZA()}if(2&e){const d=c.oxw(2);c.Q6J("placeholder",d.placeholder)("disabled",d.disabled)("ngModel",d.moneyValueString)}}function b(e,P){if(1&e){const d=c.EpF();c.TgZ(0,"ion-input",6,7),c.NdJ("ngModelChange",function(g){c.CHM(d);const m=c.oxw(2);return c.KtG(m.moneyValueString=g)})("ionBlur",function(){c.CHM(d);const g=c.oxw(2);return c.KtG(g.ionBlur())})("ionFocus",function(){c.CHM(d);const g=c.oxw(2);return c.KtG(g.ionFocus())})("keyup.enter",function(){c.CHM(d);const g=c.oxw(2);return c.KtG(g.onEnter())}),c.qZA()}if(2&e){const d=c.oxw(2);c.Q6J("disabled",d.disabled)("placeholder",d.placeholder)("ngModel",d.moneyValueString)}}function Z(e,P){if(1&e){const d=c.EpF();c.YNc(0,v,2,3,"ion-input",1),c.YNc(1,b,2,3,"ion-input",2),c.TgZ(2,"ion-input",3),c.NdJ("ngModelChange",function(g){c.CHM(d);const m=c.oxw();return c.KtG(m.moneyValue=g)})("ngModelChange",function(g){c.CHM(d);const m=c.oxw();return c.KtG(m.change(g))})("ionChange",function(){c.CHM(d);const g=c.oxw();return c.KtG(g.change(g.moneyValue))}),c.qZA()}if(2&e){const d=c.oxw();c.Q6J("ngIf",d.clear),c.xp6(1),c.Q6J("ngIf",!d.clear),c.xp6(1),c.Q6J("hidden",!0)("ngModel",d.moneyValue)}}let y=(()=>{class e{constructor(d){this.viewContainerRef=d,this.moneyValueChange=new c.vpe,this.clear=!1,this.decimal=".",this.thousands=",",this.decimalCount=2,this.changing=!1}ngOnInit(){var d=this;return(0,p.Z)(function*(){d.thousands=d.thousandsSeparator(),d.decimal="."===d.thousands?",":".",setTimeout(()=>{d.moneyValueString=d.moneyValue?d.formatMoney(d.moneyValue):d.moneyValue},1e3),d.viewContainerRef.createEmbeddedView(d.template)})()}getMoneyValueStringToNumber(d){if(d){let h=d.split(this.decimal).join("");return h=h.split(this.thousands).join(this.thousandsSeparator()),+h}return d}change(d){this.moneyValue=d,d?(this.moneyValueString=this.formatMoney(d),this.oldValue=this.moneyValueString):(this.moneyValueString=d,this.oldValue=d)}ionFocus(){return(0,p.Z)(function*(){})()}ionBlur(){if(this.moneyValueString){let d=this.moneyValueString.split(this.decimal).join("");d=d.split(this.thousands).join(this.thousandsSeparator()),this.moneyValue=+d,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(+d),this.oldValue=this.moneyValueString)}else this.moneyValue=this.moneyValueString,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(this.moneyValueString),this.oldValue=this.moneyValueString);this.moneyValueString=this.formatMoney(this.moneyValue),setTimeout(()=>{this.changing=!1},300)}formatMoney(d){if(!d)return d;const h=this.decimalCount,m=this.decimal,_=this.thousands;try{const k="\\d(?=(\\d{3})+"+(h>0?"\\D":"$")+")",q=d.toFixed(Math.max(0,~~h));let w=(_?q.replace(".",_):q).replace(new RegExp(k,"g"),"$&"+(m||","));return w&&(w.indexOf(this.thousands+"00")&&(w=w.split(this.thousands+"00").join("")),w)}catch(k){console.error(k)}}thousandsSeparator(){return parseFloat(.55.toString()).toLocaleString().indexOf(",55")>=0?",":"."}select(d){this.moneyValueString=d,this.ionBlur()}onEnter(){var d=this;return(0,p.Z)(function*(){const h=d.input1?d.input1:d.input2;if(!h)return;const g=yield h.getInputElement();!g||g.blur()})()}}return e.\u0275fac=function(d){return new(d||e)(c.Y36(c.s_b))},e.\u0275cmp=c.Xpm({type:e,selectors:[["money-input"]],viewQuery:function(d,h){if(1&d&&(c.Gf(M,7),c.Gf(D,5),c.Gf(N,5)),2&d){let g;c.iGM(g=c.CRH())&&(h.template=g.first),c.iGM(g=c.CRH())&&(h.input1=g.first),c.iGM(g=c.CRH())&&(h.input2=g.first)}},inputs:{moneyValue:"moneyValue",placeholder:"placeholder",disabled:"disabled",clear:"clear"},outputs:{moneyValueChange:"moneyValueChange"},decls:2,vars:0,consts:[["template",""],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],["inputmode","numeric","style","background-color: #efefef; border-radius: 5px; color: #000; margin-bottom: 5px;","type","text",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],[3,"hidden","ngModel","ngModelChange","ionChange"],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input1",""],["inputmode","numeric","type","text",2,"background-color","#efefef","border-radius","5px","color","#000","margin-bottom","5px",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input2",""]],template:function(d,h){1&d&&c.YNc(0,Z,3,4,"ng-template",null,0,c.W1O)},dependencies:[o.O5,I.JJ,I.On,U.pK,U.j9],encapsulation:2}),e})()},3604:(F,O,l)=>{l.d(O,{_:()=>d});var p=l(6723),c=l(1914),o=l(6738),I=l(3306),U=l(6895),M=l(191);function D(h,g){if(1&h&&(o.TgZ(0,"p"),o._uU(1),o.qZA()),2&h){const m=o.oxw();o.xp6(1),o.Oqu(m.trade.contact.fullName)}}function N(h,g){if(1&h&&(o.TgZ(0,"p",3)(1,"b"),o._uU(2),o.qZA()()),2&h){const m=o.oxw();o.xp6(2),o.Oqu(m.productName(m.trade.product.code,m.trade.product.title))}}function v(h,g){if(1&h&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&h){const m=o.oxw();o.xp6(1),o.lnq(" ",o.lcZ(2,3,"trade.buy")," ",m.trade.productCount," ",m.trade.product.unit?"("+m.trade.product.unit+")":""," ")}}function b(h,g){if(1&h&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&h){const m=o.oxw();o.xp6(1),o.lnq(" ",o.lcZ(2,3,"trade.sale")," ",m.trade.productCount," ",m.trade.product.unit?"("+m.trade.product.unit+")":""," ")}}function Z(h,g){if(1&h&&(o.TgZ(0,"p")(1,"i",7),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&h){const m=o.oxw();o.xp6(2),o.AsE("",o.lcZ(3,2,"trade.staff")," ",m.trade.staff.name,"")}}function y(h,g){if(1&h&&(o.TgZ(0,"ion-avatar",8),o._UZ(1,"img",9),o.qZA()),2&h){const m=o.oxw();o.xp6(1),o.Q6J("src",m.contactImageOrPlaceholder(m.trade.contact),o.LSH)}}function e(h,g){if(1&h&&(o.TgZ(0,"ion-avatar",8),o._UZ(1,"img",9),o.qZA()),2&h){const m=o.oxw();o.xp6(1),o.Q6J("src",m.trade.product.avatarUrl,o.LSH)}}const P=function(h,g,m){return[h,g,"symbol","1.0-2",m]};let d=(()=>{class h{constructor(m){this.translateService=m,this.isStaff=!1,this.showProduct=!0,this.onPress=new o.vpe,this.onClick=new o.vpe}dateFormat(m){return c.C.toUiDateString(m)}contactImageOrPlaceholder(m){return p.W.contactImageOrPlaceholder(m.avatarUrl)}productName(m,_){return p.W.productName(m,_)}limitText(m,_=200){return p.W.limitText(m,_)}press(){this.onPress.emit()}click(){this.onClick.emit()}}return h.\u0275fac=function(m){return new(m||h)(o.Y36(I.sK))},h.\u0275cmp=o.Xpm({type:h,selectors:[["trade-item"]],inputs:{currency:"currency",showContact:"showContact",isStaff:"isStaff",showProduct:"showProduct",trade:"trade"},outputs:{onPress:"onPress",onClick:"onClick"},decls:17,vars:22,consts:[[3,"press","click"],[1,"ion-text-wrap"],[3,"color"],[2,"white-space","pre-wrap"],[4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["slot","end",4,"ngIf"],[2,"font-size","11px"],["slot","end"],[3,"src"]],template:function(m,_){1&m&&(o.TgZ(0,"ion-item",0),o.NdJ("press",function(){return _.press()})("click",function(){return _.click()}),o.TgZ(1,"ion-label",1)(2,"ion-text",2),o._uU(3),o.ALo(4,"currency"),o.qZA(),o._UZ(5,"br"),o.TgZ(6,"ion-text",3),o._uU(7),o.qZA(),o.YNc(8,D,2,1,"p",4),o.YNc(9,N,3,1,"p",5),o.YNc(10,v,3,5,"p",4),o.YNc(11,b,3,5,"p",4),o.TgZ(12,"p"),o._uU(13),o.qZA(),o.YNc(14,Z,4,4,"p",4),o.qZA(),o.YNc(15,y,2,1,"ion-avatar",6),o.YNc(16,e,2,1,"ion-avatar",6),o.qZA()),2&m&&(o.xp6(2),o.s9C("color",(_.trade.isReceived?1:-1)*_.trade.value>=0?"secondary":"danger"),o.xp6(1),o.AsE("",_.trade.isReceived&&_.trade.value>0?"+":_.trade.isReceived?"":"-","",o.G7q(4,12,o.kEZ(18,P,_.trade.value,_.currency,_.translateService.currentLang)),""),o.xp6(4),o.Oqu(_.limitText(_.trade.note)),o.xp6(1),o.Q6J("ngIf",_.trade.contactId&&0!=_.trade.contactId&&_.trade.contact&&_.showContact),o.xp6(1),o.Q6J("ngIf",_.trade.productId&&0!=_.trade.productId&&_.trade.product&&_.showProduct),o.xp6(1),o.Q6J("ngIf",_.trade.productId&&0!=_.trade.productId&&_.trade.product&&_.trade.isPurchase&&!_.trade.isReceived),o.xp6(1),o.Q6J("ngIf",_.trade.productId&&0!=_.trade.productId&&_.trade.product&&_.trade.isPurchase&&_.trade.isReceived),o.xp6(2),o.hij(" ",_.dateFormat(_.trade.createdAt)," "),o.xp6(1),o.Q6J("ngIf",_.trade.staffId&&0!=_.trade.staffId&&_.trade.staff&&!_.isStaff),o.xp6(1),o.Q6J("ngIf",_.trade.contactId&&0!=_.trade.contactId&&_.trade.contact&&_.showContact),o.xp6(1),o.Q6J("ngIf",_.trade.productId&&0!=_.trade.productId&&_.trade.product&&_.trade.product.avatarUrl&&_.showProduct))},dependencies:[U.O5,M.BJ,M.Ie,M.Q$,M.yW,U.H9,I.X$],encapsulation:2}),h})()},1576:(F,O,l)=>{l.r(O),l.d(O,{TradeModule:()=>je});var p=l(6895),c=l(4006),o=l(191),I=l(3306),U=l(529),M=l(3093),D=l(2216),N=l(3196),v=l(5861),b=l(4220),Z=l(6723),y=l(1914),e=l(6738),P=l(5851),d=l(2126),h=l(7696),g=l(7488),m=l(323);function _(a,f){if(1&a&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.Oqu(t.trade.contact.address)}}function k(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-avatar",0),e._UZ(3,"img",10),e.qZA(),e.TgZ(4,"ion-label")(5,"h2")(6,"b"),e._uU(7),e.qZA()(),e.TgZ(8,"p"),e._uU(9),e.qZA(),e.YNc(10,_,2,1,"p",6),e.qZA()(),e.TgZ(11,"ion-item-options",11)(12,"ion-item-option",3),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.text())}),e._UZ(13,"ion-icon",12),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"ion-item-option",13),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.call())}),e._UZ(17,"ion-icon",14),e._uU(18),e.ALo(19,"translate"),e.qZA()()()}if(2&a){const t=e.oxw();e.xp6(3),e.Q6J("src",t.contactImageOrPlaceholder(),e.LSH),e.xp6(4),e.Oqu(t.trade.contact.fullName),e.xp6(2),e.Oqu(t.trade.contact.mobile),e.xp6(1),e.Q6J("ngIf",t.trade.contact.address),e.xp6(4),e.hij(" ",e.lcZ(15,6,"action.text")," "),e.xp6(4),e.hij(" ",e.lcZ(19,8,"action.call")," ")}}function q(a,f){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.lnq("",e.lcZ(2,3,"trade.sale")," ",t.trade.productCount," ",t.trade.product.unit,"")}}function w(a,f){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.lnq("",e.lcZ(2,3,"trade.buy")," ",t.trade.productCount," ",t.trade.product.unit,"")}}function ee(a,f){if(1&a&&(e.TgZ(0,"ion-avatar",2),e._UZ(1,"img",10),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.Q6J("src",t.trade.product.avatarUrl,e.LSH)}}const j=function(a,f,t){return[a,f,"symbol","1.0-2",t]};function te(a,f){if(1&a&&(e.TgZ(0,"ion-item",15)(1,"ion-label",16)(2,"span",17)(3,"b"),e._uU(4),e.qZA()(),e._UZ(5,"br"),e.TgZ(6,"ion-text",18),e._UZ(7,"ion-icon",19),e._uU(8),e.ALo(9,"currency"),e.qZA(),e._UZ(10,"br"),e.YNc(11,q,3,5,"span",6),e.YNc(12,w,3,5,"span",6),e.qZA(),e.YNc(13,ee,2,1,"ion-avatar",20),e.qZA()),2&a){const t=e.oxw();e.xp6(4),e.Oqu(t.productName(t.trade.product.code,t.trade.product.title)),e.xp6(4),e.hij("\xa0",e.G7q(9,5,e.kEZ(11,j,t.trade.product.price,t.currency,t.translateService.currentLang))," "),e.xp6(3),e.Q6J("ngIf",t.trade.isReceived),e.xp6(1),e.Q6J("ngIf",!t.trade.isReceived),e.xp6(1),e.Q6J("ngIf",t.trade.product.avatarUrl)}}function ne(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-button",22),e.NdJ("click",function(){const i=e.CHM(t).$implicit,u=e.oxw(2);return e.KtG(u.moveToCategory(i))}),e._uU(1),e.qZA()}if(2&a){const t=f.$implicit;e.xp6(1),e.hij(" ",t.tradeCategory.title," ")}}function oe(a,f){if(1&a&&(e.TgZ(0,"ion-item"),e._uU(1),e.ALo(2,"translate"),e.TgZ(3,"ion-buttons",2),e.YNc(4,ne,2,1,"ion-button",21),e.qZA()()),2&a){const t=e.oxw();e.xp6(1),e.hij(" ",e.lcZ(2,2,"trade-detail.categories"),": "),e.xp6(3),e.Q6J("ngForOf",t.categories)}}function re(a,f){if(1&a&&(e.TgZ(0,"ion-item")(1,"ion-label",16),e._uU(2),e.qZA()()),2&a){const t=e.oxw();e.xp6(2),e.hij(" ",t.trade.note," ")}}let ae=(()=>{class a{constructor(t,n,r,i,u,T,S,s,C){this.navCtrl=t,this.translateService=n,this.tradeService=r,this.contactService=i,this.currencyPipe=u,this.userService=T,this.actionSheetCtrl=S,this.alertCtrl=s,this.analyticsService=C,this.params=null,this.trade=new b.h,this.categories=[],this.tab="note",this.pictures=[],this.arr=[];const x=E=>{this.trade&&E.detail.id===this.trade.id&&this.reload()};this.navCtrl.unsubscribe("reloadTrade",x),this.navCtrl.subscribe("reloadTrade",x)}ionViewWillEnter(){var t=this;return(0,v.Z)(function*(){yield t.analyticsService.setCurrentScreen("trade-detail")})()}ngOnInit(){this.reload()}reload(){var t=this;return(0,v.Z)(function*(){t.userService.getAttr("current-currency").then(r=>{t.currency=r});const n=t.params?t.params:t.navCtrl.getParams();if(t.params=n,t.trade=new b.h,n&&n.id&&n.id>0){const r=n.id,i=yield t.navCtrl.loading();t.tradeService.get(r).then(function(){var u=(0,v.Z)(function*(T){yield i.dismiss(),t.trade=T,t.pictures=T&&T.imageUrlsJson?JSON.parse(T.imageUrlsJson):[];const S=[];let s=[];for(const C of t.pictures)s.push(C),3==s.length&&(S.push(s),s=[]);s.length>0&&S.push(s),t.arr=S,""==t.trade.note&&t.arr.length>0&&(t.tab="photo"),t.tradeService.getCategoriesToTrade(r).then(C=>{t.categories=C})});return function(T){return u.apply(this,arguments)}}())}})()}isNotCordova(){return this.navCtrl.isNotCordova()}call(){this.saveLastActive("call"),Z.W.callPhone(this.trade.contact.mobile)}text(){this.saveLastActive("text"),Z.W.sendSms(this.trade.contact.mobile)}saveLastActive(t){return this.trade.contact.lastActive=y.C.toDbString(),this.trade.contact.lastAction=t,this.contactService.saveContact(this.trade.contact).then(n=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.trade.contact),n))}contactImageOrPlaceholder(){return null!==this.trade.contact.avatarUrl&&""!==this.trade.contact.avatarUrl?this.trade.contact.avatarUrl:"assets/person-placeholder.jpg"}dateFormat(t){return y.C.toUiDateString(t)}actionIcon(t){return Z.W.actionIcon(t)}dateTimeFormat(t){return y.C.toUiString(t)}edit(){this.navCtrl.push("/trade/add",{id:this.trade.id})}presentActionSheet(){var t=this;return(0,v.Z)(function*(){yield(yield t.actionSheetCtrl.create({header:t.translateService.instant("action.action"),buttons:[{text:t.translateService.instant("trade.delete-trade"),role:"destructive",handler:()=>{t.deleteTrade()}},{text:t.translateService.instant("trade-detail.share"),handler:()=>{t.shareTrade()}},{text:t.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}deleteTrade(){var t=this;return(0,v.Z)(function*(){const n=t.trade;t.trade.id&&n&&(n.orderId||n.debtId||n.receivedNoteId||n.transferNoteId)?alert(t.translateService.instant("trade.trade-related-update-alert")):yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("trade.delete-alert"),buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{t.tradeService.deleteTrade(t.trade).then((0,v.Z)(function*(){t.analyticsService.logEvent("trade-detail-delete-success"),t.navCtrl.publish("reloadTradeList"),t.navCtrl.publish("reloadContact",t.trade.contact),t.navCtrl.pop()}))}},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}moveToCategory(t){this.navCtrl.push("/trade-category/detail",{id:t.categoryId})}productName(t,n){return Z.W.productName(t,n)}shareTrade(){let t=this.trade.isReceived?"+":"-";t+=" "+this.currencyPipe.transform(this.trade.value,this.currency,!0,"1.0-2");const n=0!==this.trade.contactId&&this.trade.contact?this.trade.contact.fullName:"",r=0!==this.trade.productId&&this.trade.product?Z.W.productName(this.trade.product.code,this.trade.product.title):"",i=[t];n&&i.push(n),r&&i.push(r),this.trade.note&&i.push(this.trade.note);const u=i.join(" - ");this.userService.shareScreenshot(u)}showImage(t){const n=JSON.parse(JSON.stringify(this.pictures));this.navCtrl.push("/gallery",{images:n,id:t})}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(P.G),e.Y36(I.sK),e.Y36(d.X),e.Y36(h.y),e.Y36(p.H9),e.Y36(g.K),e.Y36(o.BX),e.Y36(o.Br),e.Y36(m.y))},a.\u0275cmp=e.Xpm({type:a,selectors:[["trade-detail"]],decls:26,vars:23,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","ellipsis-vertical"],[4,"ngIf"],["text-wrap","",4,"ngIf"],["name","cash","slot","start"],[3,"color"],[3,"src"],["side","end"],["slot","start","name","send"],["color","secondary",3,"click"],["slot","start","name","call"],["text-wrap",""],[1,"ion-text-wrap"],[2,"white-space","pre-wrap"],["color","secondary"],["name","pricetag"],["slot","end",4,"ngIf"],["fill","outline",3,"click",4,"ngFor","ngForOf"],["fill","outline",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"ion-buttons",2)(8,"ion-button",3),e.NdJ("click",function(){return n.edit()}),e._UZ(9,"ion-icon",4),e.qZA(),e.TgZ(10,"ion-button",3),e.NdJ("click",function(){return n.presentActionSheet()}),e._UZ(11,"ion-icon",5),e.qZA()()()(),e.TgZ(12,"ion-content")(13,"ion-list"),e.YNc(14,k,20,10,"ion-item-sliding",6),e.YNc(15,te,14,15,"ion-item",7),e.TgZ(16,"ion-item"),e._UZ(17,"ion-icon",8),e.TgZ(18,"ion-label")(19,"ion-text",9),e._uU(20),e.ALo(21,"currency"),e.qZA(),e.TgZ(22,"p"),e._uU(23),e.qZA()()(),e.YNc(24,oe,5,4,"ion-item",6),e.YNc(25,re,3,1,"ion-item",6),e.qZA()()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,11,"trade-detail.title")),e.xp6(7),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(2),e.Q6J("ngIf",0!==n.trade.contactId),e.xp6(1),e.Q6J("ngIf",0!==n.trade.productId&&n.trade.product),e.xp6(4),e.s9C("color",n.trade.isReceived?"secondary":"danger"),e.xp6(1),e.AsE("",n.trade.isReceived?"+":"-"," ",e.G7q(21,13,e.kEZ(19,j,n.trade.value,n.currency,n.translateService.currentLang)),""),e.xp6(3),e.hij(" ",n.dateTimeFormat(n.trade.createdAt)," "),e.xp6(1),e.Q6J("ngIf",n.categories.length>0),e.xp6(1),e.Q6J("ngIf",n.trade.note))},dependencies:[p.sg,p.O5,o.BJ,o.oU,o.YG,o.Sm,o.W2,o.Gu,o.gu,o.Ie,o.u8,o.IK,o.td,o.Q$,o.q_,o.yW,o.wd,o.sr,o.cs,p.H9,I.X$],encapsulation:2}),a})();var L=l(7489),Q=l(5439),ie=l(3285),ce=l(2694),de=l(4372),se=l(6026),W=l(9645),$=l(4433),le=l(1582),ue=l(5129),pe=l(7833),X=l(667),z=l(6961),he=l(212),_e=l(7604),me=l(3876),fe=l(5583),ge=l(7613),ve=l(8851);function Te(a,f){if(1&a&&(e.TgZ(0,"ion-item",30)(1,"ion-label",31),e._uU(2),e.qZA()()),2&a){const t=e.oxw();e.xp6(2),e.Oqu(t.checkStore)}}function Ce(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-text",32),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.showSearchContact())}),e._uU(1),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.hij(" ",t.contactSelected.fullName," ")}}function ye(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-text",33),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.showSearchContact())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"trade-add.select-contact")," "))}function Se(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-button",34),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeContact())}),e._UZ(1,"ion-icon",35),e.qZA()}}function Ae(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-text",32),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.showSearchProduct())}),e._uU(1),e.qZA()}if(2&a){const t=e.oxw();e.xp6(1),e.hij(" ",t.productName(t.productSelected.code,t.productSelected.title)," ")}}function Ze(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-text",33),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.showSearchProduct())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&a&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"trade-add.select-product")," "))}function xe(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-button",15),e.NdJ("click",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.removeProduct())}),e._UZ(1,"ion-icon",35),e.qZA()}}function Ie(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label",8),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-toggle",36),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.trade.isPurchase=r)})("ngModelChange",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.changeIsPurchase())}),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,2,"trade-add.is-purchase")),e.xp6(2),e.Q6J("ngModel",t.trade.isPurchase)}}const be=function(a,f,t){return[a,f,!0,"1.0-2",t]};function Me(a,f){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&a){const t=e.oxw(2);e.xp6(1),e.AsE("(",e.G7q(2,2,e.kEZ(8,be,t.productSelected.price,t.currency.code,t.translateService.currentLang)),"/",t.productSelected.unit,")")}}function Ne(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label",21),e._uU(2),e.ALo(3,"translate"),e.YNc(4,Me,3,12,"span",19),e.qZA(),e.TgZ(5,"ion-input",37),e.NdJ("ngModelChange",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.trade.productCount=r)})("ngModelChange",function(){e.CHM(t);const r=e.oxw();return e.KtG(r.changeProductCount())})("focus",function(r){e.CHM(t);const i=e.oxw();return e.KtG(i.selectAll(r))}),e.ALo(6,"translate"),e.qZA()()}if(2&a){const t=e.oxw();e.xp6(2),e.hij("",e.lcZ(3,4,"trade-add.product-count")," "),e.xp6(2),e.Q6J("ngIf",t.productSelected.unit&&t.productSelected.price&&t.currency),e.xp6(1),e.s9C("placeholder",e.lcZ(6,6,"trade-add.enter-product-count")),e.Q6J("ngModel",t.trade.productCount)}}function Ue(a,f){if(1&a&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&a){const t=e.oxw();e.xp6(1),e.AsE("(",t.currency.symbol_native," - ",t.currency.code,")")}}function Je(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-text"),e._uU(2),e.qZA(),e.TgZ(3,"ion-button",34),e.NdJ("click",function(){const i=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.removeCategory(i))}),e._UZ(4,"ion-icon",38),e._uU(5),e.ALo(6,"translate"),e.qZA()()}if(2&a){const t=f.$implicit;e.xp6(2),e.Oqu(t.tradeCategory.title),e.xp6(3),e.hij(" ",e.lcZ(6,2,"trade-add.remove")," ")}}function Oe(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-text",43),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.showSearchMoneyAccount())}),e._uU(1),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("hidden",t.isDisableMoneyAccount()),e.xp6(1),e.hij(" ",t.moneyAccountSelected.accountName," ")}}function Pe(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-text",44),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.showSearchMoneyAccount())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("hidden",t.isDisableMoneyAccount()),e.xp6(1),e.hij(" ",e.lcZ(2,2,"trade-add.select-money-account")," ")}}function De(a,f){if(1&a&&(e.TgZ(0,"span",45),e._uU(1),e.qZA()),2&a){const t=e.oxw(2);e.Q6J("hidden",!t.isDisableMoneyAccount()),e.xp6(1),e.hij(" ",t.moneyAccountSelected.accountName," ")}}function we(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"ion-button",46),e.NdJ("click",function(){e.CHM(t);const r=e.oxw(2);return e.KtG(r.removeMoneyAccount())}),e._UZ(1,"ion-icon",35),e.qZA()}if(2&a){const t=e.oxw(2);e.Q6J("disabled",t.isDisableMoneyAccount())}}function ke(a,f){if(1&a&&(e.TgZ(0,"ion-item")(1,"ion-text",8),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Oe,2,2,"ion-text",39),e.YNc(5,Pe,3,4,"ion-text",40),e.YNc(6,De,2,2,"span",41),e.YNc(7,we,2,1,"ion-button",42),e.qZA()),2&a){const t=e.oxw();e.xp6(2),e.Oqu(e.lcZ(3,5,"trade-add.money-account")),e.xp6(2),e.Q6J("ngIf",t.moneyAccountSelected&&t.moneyAccountSelected.id>0),e.xp6(1),e.Q6J("ngIf",!t.moneyAccountSelected||0==t.moneyAccountSelected.id),e.xp6(1),e.Q6J("ngIf",t.moneyAccountSelected&&t.moneyAccountSelected.id>0),e.xp6(1),e.Q6J("ngIf",t.moneyAccountSelected&&t.moneyAccountSelected.id>0)}}function Le(a,f){if(1&a&&(e.TgZ(0,"ion-item",6)(1,"p")(2,"i"),e._uU(3),e.ALo(4,"translate"),e.qZA()()()),2&a){const t=e.oxw();e.Q6J("hidden",!t.isDisableMoneyAccount()),e.xp6(3),e.Oqu(e.lcZ(4,2,"trade-detail.having-order-note"))}}let Ee=(()=>{class a{constructor(t,n,r,i,u,T,S,s,C,x,E,J,K,G,A,V,H,Y,R,We){this.navCtrl=t,this.barcodeScanner=n,this.file=r,this.translateService=i,this.transfer=u,this.camera=T,this.platform=S,this.modalCtrl=s,this.tradeService=C,this.debtService=x,this.staffService=E,this.contactService=J,this.productService=K,this.moneyAccountService=G,this.moneyAccountTransactionService=A,this.alertCtrl=V,this.storeService=H,this.analyticsService=Y,this.userService=R,this.orderService=We,this.params=null,this.trade=new b.h,this.oldTrade=null,this.noteSegment="content",this.categories=[],this.categoriesToRemove=[],this.pictures=[],this.storageDirectory="",this.arr=[],this.lastSamplePictureId=0,this.tab="note",this.isNew=!0,this.saveDisabled=!1,this.onKeyPress=B=>{!B.target||"body"!==B.target.localName||("s"===B.key||"S"===B.key)&&this.save()},this.platform.ready().then(()=>{if(!this.platform.is("capacitor")&&!this.platform.is("cordova"))return!1;if(this.platform.is("ios"))this.storageDirectory=this.file.documentsDirectory;else{if(!this.platform.is("android"))return!1;this.storageDirectory=this.file.dataDirectory}})}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var t=this;return(0,v.Z)(function*(){yield t.analyticsService.setCurrentScreen("trade-add")})()}ngOnInit(){var t=this;return(0,v.Z)(function*(){t.userService.getAttr("current-currency").then(s=>{t.currency=Z.W.getCurrencyByCode(s)}),t.selectedStaff=t.staffService.selectedStaff,t.store=yield t.storeService.getCurrentStore(),t.checkStore=t.store?t.translateService.instant("store.check-store",{shop:t.store.name}):null,t.trade=new b.h,t.trade.createdAt=Q(new Date).format(y.C.getDateDbFormat());const n=t.params?t.params:t.navCtrl.getParams();t.params=n;let r=0,i=0,u=0,T=0,S=0;if(n&&(n&&n.id?(r=n.id,t.isNew=!1):n&&n.contact?i=+n.contact:n&&n.product?u=+n.product:n&&n.debt?T=+n.debt:n&&n.loan&&(S=+n.loan)),r&&r>0){const s=yield t.navCtrl.loading();t.tradeService.get(r).then(function(){var C=(0,v.Z)(function*(x){yield s.dismiss(),t.contactSelected=x.contact,t.productSelected=x.product,t.moneyAccountSelected=x.moneyAccount,t.trade=x,t.oldTrade=JSON.parse(JSON.stringify(x)),!x.moneyAccount&&!t.staffService.isStaff()&&t.moneyAccountService.getDefault().then(J=>{!J||(t.moneyAccountSelected=J,t.trade.moneyAccountId=J.id)}),t.tradeService.getCategoriesToTrade(r).then(J=>{t.categories=J}),t.moneyAccountTransactionService.getMoneyAccountTransactionByTrade(r).then(J=>{t.moneyAccountTransaction=J});const E=x.imageUrlsJson?JSON.parse(x.imageUrlsJson):[];t.pictures=E,t.buildPictureGrid()});return function(x){return C.apply(this,arguments)}}())}else if(t.staffService.isStaff()||t.moneyAccountService.getDefault().then(s=>{!s||(t.moneyAccountSelected=s,t.trade.moneyAccountId=s.id)}),i&&i>0)t.contactService.get(i).then(s=>{t.contactSelected=s,t.trade.contactId=s.id});else if(u&&u>0)t.productService.get(u,0).then(s=>{t.productSelected=s,t.trade.productId=s.id,t.trade.value=s.price});else if(T&&T>0)t.debtService.get(T).then(s=>{!s||(t.productSelected=s.product,t.trade.productId=s.product?s.product.id:0,t.contactSelected=s.contact,t.trade.contactId=s.contact?s.contact.id:0,t.trade.isPurchase=s.isPurchase,t.trade.productCount=s.productCount,t.trade.value=+s.value-+s.valuePaid,t.trade.orderId=s.order?s.order.id:0,t.trade.order=s.order,t.trade.debtId=s.id,t.trade.debt=s,t.trade.note=`${t.translateService.instant("trade-add.debt-explain")} #${s.id}; `,t.trade.order&&(t.trade.note+=t.translateService.instant("debt-add.order")+" #"+t.trade.order.orderCode),0===s.debtType?t.trade.isReceived=!1:1===s.debtType?t.trade.isReceived=!0:2===s.debtType?t.trade.isReceived=!1:3===s.debtType&&(t.trade.isReceived=!0))});else if(S&&S>0)t.debtService.get(S).then(s=>{t.productSelected=s.product,t.trade.productId=s.product?s.product.id:0,t.contactSelected=s.contact,t.trade.contactId=s.contact?s.contact.id:0,t.trade.isPurchase=s.isPurchase,t.trade.productCount=s.productCount,t.trade.value=s.value,0===s.debtType?t.trade.isReceived=!0:1===s.debtType&&(t.trade.isReceived=!1)});else{const s=[];let C=[];for(const x of t.pictures)C.push(x),3===C.length&&(s.push(C),C=[]);C.length>0&&s.push(C),t.arr=s}})()}showSearchContact(){var t=this;return(0,v.Z)(function*(){t.navCtrl.push("/contact",{callback:r=>{const i=r;i&&(t.contactSelected=i,t.trade.contactId=i.id)},searchMode:!0})})()}showSearchMoneyAccount(){var t=this;return(0,v.Z)(function*(){t.navCtrl.push("/money-account",{callback:r=>{const i=r;i&&(t.moneyAccountSelected=i,t.trade.moneyAccountId=i.id)},searchMode:!0})})()}showSearchProduct(){var t=this;return(0,v.Z)(function*(){t.navCtrl.push("/product",{callback:r=>{const i=r;i&&(t.productSelected=i,t.trade.productId=i.id,t.trade.value=i.price)},searchMode:!0})})()}save(){var t=this;return(0,v.Z)(function*(){const n=t.trade;t.trade.id&&n&&(n.orderId||n.debtId||n.receivedNoteId||n.transferNoteId)?alert(t.translateService.instant("trade.trade-related-update-alert")):t.trade.debt&&t.trade.debt.id&&t.trade.value>+t.trade.debt.value-+t.trade.debt.valuePaid?yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("trade-add.debt-amount-reached-warning"),buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{t.doSave()}},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present():t.doSave()})()}doSave(){var t=this;return(0,v.Z)(function*(){t.trade.imageUrlsJson=JSON.stringify(t.pictures),t.staffService.isStaff()&&(t.trade.staffId=t.staffService.selectedStaff.id),t.saveDisabled=!0;const n=yield t.navCtrl.loading(),r=Q(new Date).format(y.C.getDateDbFormat());t.trade.createdAt===r&&(t.trade.createdAt=Q(new Date).format(y.C.getDbFormat())),t.tradeService.saveTrade(t.trade).then(function(){var i=(0,v.Z)(function*(u){t.analyticsService.logEvent("trade-add-save-success");const T=[];if(t.contactSelected){const S=t.saveLastActive();T.push(S)}if(t.trade.debt&&t.trade.debtId>0){t.trade.debt.valuePaid+=+t.trade.value-+(t.oldTrade?t.oldTrade.value:0),t.oldTrade||t.trade.debt.countPaid++,t.trade.debt.valuePaid>=t.trade.debt.value&&(t.trade.debt.isPaid=!0);const S=t.debtService.saveDebt(t.trade.debt);if(t.trade.order&&t.trade.debt.isPaid){const s=yield t.debtService.getDebtsByOrder(t.trade.order.id,null,null);let C=!0;for(const x of s)if(!x.isPaid&&x.id!==t.trade.debt.id){C=!1;break}if(C){t.trade.order.status=3;const x=t.orderService.saveOrder(t.trade.order);T.push(x)}}T.push(S)}if(t.categories&&t.categories.length>0){const S=t.tradeService.saveCategoriesToTrade(t.categories,+u);T.push(S)}if(t.categoriesToRemove&&t.categoriesToRemove.length>0){const S=t.tradeService.deleteCategoriesToTrade(t.categoriesToRemove);T.push(S)}if(t.productSelected&&t.productSelected.id&&t.trade.isPurchase){const S=yield t.productService.getNotesByTrade(t.trade.id);let s=[];for(const x of S)s.push(t.productService.deleteProductNote(x));s.length&&(yield Promise.all(T),s=[]);const C=new de.d;C.tradeId=t.trade.id,C.contactId=t.trade.contactId,C.amount=t.trade.value*(t.trade.isReceived?1:-1),C.unitPrice=t.productSelected.price,C.unit=t.productSelected.unit,C.quantity=t.trade.productCount,C.productId=t.productSelected.id,C.productName=t.productSelected.title,C.productCode=t.productSelected.code,C.note=t.trade.note,C.staffId=t.staffService.isStaff()?t.staffService.selectedStaff.id:0,T.push(t.productService.saveProductNote(C))}Promise.all(T).then((0,v.Z)(function*(){yield n.dismiss(),t.trade.contact&&0!==t.trade.contact.id&&(t.navCtrl.publish("reloadContact",t.trade.contact),t.navCtrl.publish("reloadContactDebt",t.trade.contact.id)),t.trade.debt&&0!==t.trade.debt.id&&(t.navCtrl.publish("reloadDebtList",{type:t.trade.debt.debtType.toString()}),t.navCtrl.publish("reloadDebt",t.trade.debt)),t.trade.order&&0!==t.trade.order.id&&(t.navCtrl.publish("reloadOrder",t.trade.order),t.navCtrl.publish("reloadOrderList",null)),t.exitPage()}))});return function(u){return i.apply(this,arguments)}}())})()}isDisableMoneyAccount(){return!!(!this.trade||this.trade.orderId&&!this.trade.debtId||this.trade.receivedNoteId&&!this.trade.debtId)}saveLastActive(){return this.contactSelected.lastActive=y.C.toDbString(),this.contactSelected.lastAction="trade",this.contactService.saveContact(this.contactSelected).then(n=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.contactSelected),this.navCtrl.publish("reloadContactTrade",this.contactSelected.id),n))}exitPage(){var t=this;return(0,v.Z)(function*(){yield t.navCtrl.popOnly(),t.navCtrl.publish("reloadTradeList"),t.navCtrl.publish("reloadTrade",t.trade),t.isNew&&(yield t.navCtrl.push("/trade/detail",{id:t.trade.id}))})()}changeToMoneyIn(){this.trade.isReceived=!0}changeToMoneyOut(){this.trade.isReceived=!1}removeCategory(t){0!==t.id&&this.categoriesToRemove.push(t),L.remove(this.categories,n=>n.categoryId===t.categoryId)}showSearchCategory(){var t=this;return(0,v.Z)(function*(){const n=function(){var r=(0,v.Z)(function*(i){const u=i;if(u)if(t.categories.findIndex(T=>T.categoryId===u.id)>=0)yield(yield t.alertCtrl.create({header:"Ch\xfa \xfd",subHeader:"B\u1ea1n \u0111\xe3 th\xeam Danh m\u1ee5c n\xe0y r\u1ed3i.",buttons:["OK"]})).present();else{const T=new ce.p;T.tradeCategory=u,T.categoryId=u.id,t.categories.push(T)}});return function(u){return r.apply(this,arguments)}}();t.navCtrl.push("/trade-category",{callback:n,searchMode:!0})})()}removeContact(){this.contactSelected=null,this.trade.contactId=0}removeMoneyAccount(){this.moneyAccountSelected=null}removeProduct(){this.productSelected=null,this.trade.productId=0,this.trade.productCount=0,this.trade.isPurchase=!1}changeProductCount(){!this.productSelected||!this.trade.isPurchase||(this.trade.value=this.trade.productCount*this.productSelected.price)}changeIsPurchase(){this.trade.productCount=0}showDatePopup(){this.trade.createdAt=Q().format(y.C.getDateDbFormat())}dateFormat(t){return y.C.toUiDateString(t)}removeDate(){this.trade.createdAt=""}productName(t,n){return Z.W.productName(t,n)}selectAll(t){Z.W.selectAll(t)}refreshAvatar(){this.trade.avatarUrl=this.pictures&&this.pictures.length>0?this.pictures[0]:null}takePicture(){this.addImage(-1,!0)}browsePicture(){this.addImage(-1,!1)}showImage(t){var n=this;return(0,v.Z)(function*(){const r=JSON.parse(JSON.stringify(n.pictures)),i=yield n.modalCtrl.create({component:ie.v,componentProps:{images:r,id:t,canDelete:!0}});yield i.present();const{data:u}=yield i.onDidDismiss();if(u&&u.idsToDelete){const T=u.idsToDelete;for(const S of T)n.removePicture(S)}})()}buildPictureGrid(){const t=[];let n=[];for(const r of this.pictures)n.push(r),3===n.length&&(t.push(n),n=[]);n.length>0&&t.push(n),this.arr=t}removePicture(t){this.pictures.splice(t,1),this.buildPictureGrid(),this.refreshAvatar()}changePicture(t){this.addImage(t,!1)}addImage(t,n){if(!this.platform.is("capacitor"))return;let r=this.camera.PictureSourceType.CAMERA;n||(r=this.camera.PictureSourceType.SAVEDPHOTOALBUM),this.camera.getPicture({destinationType:this.camera.DestinationType.FILE_URI,correctOrientation:!0,saveToPhotoAlbum:!1,sourceType:r}).then(i=>{const u=i.substr(i.lastIndexOf("/")+1);this.downloadImage("trade_image_"+u,i,t)},i=>{console.error(i)})}downloadImage(t,n,r){var i=this;this.platform.ready().then((0,v.Z)(function*(){const u=yield i.transfer.create(),T=yield i.navCtrl.loading();u.download(n,i.storageDirectory+t).then(function(){var S=(0,v.Z)(function*(s){i.doAdd(s.toURL(),r),yield T.dismiss()});return function(s){return S.apply(this,arguments)}}(),(0,v.Z)(function*(){yield T.dismiss()}))}))}doAdd(t,n){n>=0&&n<=this.pictures.length-1?this.pictures[n]=t:this.pictures.push(t),this.buildPictureGrid(),this.refreshAvatar()}scan(){var t=this;return(0,v.Z)(function*(){if(t.analyticsService.logEvent("trade-add-scan-barcode"),t.navCtrl.isNotCordova()){const n=yield t.modalCtrl.create({component:se.k});yield n.present();const{data:r}=yield n.onDidDismiss();r&&r.barcode&&t.checkBarcodeScaned(r.barcode)}else t.barcodeScanner.scan().then(n=>{!n||!n.text||t.checkBarcodeScaned(n.text)})})()}checkBarcodeScaned(t){var n=this;this.productService.searchByBarcode(t).then(function(){var r=(0,v.Z)(function*(i){!i||(n.productSelected=i,n.trade.productId=i.id)});return function(i){return r.apply(this,arguments)}}())}addZerosToNumber(t){let n="";for(let r=0;r<t;r++)n+="0";if(this.trade&&this.trade.value){let r=this.trade.value.toString();r+=n,this.trade.value=Number(r)}}exitStore(){var t=this;return(0,v.Z)(function*(){var r;yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("store.exit-store-alert",{shop:t.store.name}),buttons:[{text:t.translateService.instant("common.agree"),handler:(r=(0,v.Z)(function*(){yield t.storeService.exitStore(),t.store=null,t.checkStore=null}),function(){return r.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(P.G),e.Y36(W.m),e.Y36($.$),e.Y36(I.sK),e.Y36(le.K),e.Y36(ue.V1),e.Y36(o.t4),e.Y36(o.IN),e.Y36(d.X),e.Y36(pe.E),e.Y36(X.x),e.Y36(h.y),e.Y36(z.M),e.Y36(he.U),e.Y36(_e.y),e.Y36(o.Br),e.Y36(me.d),e.Y36(m.y),e.Y36(g.K),e.Y36(fe.p))},a.\u0275cmp=e.Xpm({type:a,selectors:[["trade-add"]],decls:106,vars:90,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],["lines","none","color","success",4,"ngIf"],[3,"hidden"],["ion-text",""],["color","primary"],["color","dark","slot","end"],["color","dark","slot","end",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["fill","outline","slot","end",3,"click",4,"ngIf"],["lines","none",3,"hidden"],["fill","outline",3,"click",4,"ngIf"],["fill","outline",3,"click"],["name","barcode"],[2,"--min-height","0",3,"hidden"],[2,"font-size","0.75em"],[4,"ngIf"],["lines","none"],["position","stacked","color","primary"],[3,"clear","placeholder","moneyValue","moneyValueChange"],[3,"color","fill","click"],["fill","clear",3,"click"],["type","text","rows","6",3,"placeholder","ngModel","ngModelChange"],["name","add"],[4,"ngFor","ngForOf"],["pickerId","tradeAddPicker","min","2015-01-01","max","2025-12-31",3,"date","dateChange"],[3,"hidden",4,"ngIf"],["lines","none","color","success"],[1,"ion-text-wrap"],["color","dark","slot","end",3,"click"],["slot","end",3,"click"],["fill","outline","slot","end",3,"click"],["name","close"],[3,"ngModel","ngModelChange"],["type","number",3,"placeholder","ngModel","ngModelChange","focus"],["name","remove"],["ion-text","","color","dark","slot","end",3,"hidden","click",4,"ngIf"],["slot","end",3,"hidden","click",4,"ngIf"],["style","color: silver","slot","end",3,"hidden",4,"ngIf"],["fill","outline","slot","end",3,"disabled","click",4,"ngIf"],["ion-text","","color","dark","slot","end",3,"hidden","click"],["slot","end",3,"hidden","click"],["slot","end",2,"color","silver",3,"hidden"],["fill","outline","slot","end",3,"disabled","click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"ion-buttons",2)(8,"ion-button",3),e.NdJ("click",function(){return n.save()}),e._UZ(9,"ion-icon",4),e._uU(10),e.ALo(11,"translate"),e.qZA()()(),e.YNc(12,Te,3,1,"ion-item",5),e.qZA(),e.TgZ(13,"ion-content")(14,"ion-list")(15,"ion-item",6)(16,"p",7),e._uU(17),e.ALo(18,"translate"),e.qZA()(),e.TgZ(19,"ion-item",6)(20,"ion-text",8),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"ion-text",9),e._uU(24),e.qZA()(),e.TgZ(25,"ion-item",6)(26,"ion-text",8),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"ion-text",9),e._uU(30),e.qZA()(),e.TgZ(31,"ion-item",6)(32,"ion-text",8),e._uU(33),e.ALo(34,"translate"),e.qZA(),e.TgZ(35,"ion-text",9),e._uU(36),e.qZA()(),e.TgZ(37,"ion-item")(38,"ion-text",8),e._uU(39),e.ALo(40,"translate"),e.qZA(),e.YNc(41,Ce,2,1,"ion-text",10),e.YNc(42,ye,3,3,"ion-text",11),e.YNc(43,Se,2,0,"ion-button",12),e.qZA(),e.TgZ(44,"ion-item",13)(45,"ion-label",8),e._uU(46),e.ALo(47,"translate"),e.qZA(),e.YNc(48,Ae,2,1,"ion-text",10),e.YNc(49,Ze,3,3,"ion-text",11),e.TgZ(50,"ion-buttons",2),e.YNc(51,xe,2,0,"ion-button",14),e.TgZ(52,"ion-button",15),e.NdJ("click",function(){return n.scan()}),e._UZ(53,"ion-icon",16),e._uU(54),e.ALo(55,"translate"),e.qZA()()(),e.TgZ(56,"ion-item",17)(57,"ion-text",18),e._uU(58),e.ALo(59,"translate"),e.qZA()(),e.YNc(60,Ie,5,4,"ion-item",19),e.YNc(61,Ne,7,8,"ion-item",19),e.TgZ(62,"ion-item",20)(63,"ion-label",21),e._uU(64),e.ALo(65,"translate"),e.YNc(66,Ue,2,2,"span",19),e.qZA(),e.TgZ(67,"money-input",22),e.NdJ("moneyValueChange",function(i){return n.trade.value=i}),e.ALo(68,"translate"),e.qZA()(),e.TgZ(69,"ion-item")(70,"ion-buttons")(71,"ion-button",23),e.NdJ("click",function(){return n.changeToMoneyIn()}),e._uU(72),e.ALo(73,"translate"),e.qZA(),e.TgZ(74,"ion-button",23),e.NdJ("click",function(){return n.changeToMoneyOut()}),e._uU(75),e.ALo(76,"translate"),e.qZA()(),e.TgZ(77,"ion-buttons",2)(78,"ion-button",24),e.NdJ("click",function(){return n.addZerosToNumber(2)}),e._uU(79,".00"),e.qZA(),e.TgZ(80,"ion-button",24),e.NdJ("click",function(){return n.addZerosToNumber(3)}),e._uU(81,".000"),e.qZA()()(),e.TgZ(82,"ion-item")(83,"ion-label",21),e._uU(84),e.ALo(85,"translate"),e.qZA(),e.TgZ(86,"ion-textarea",25),e.NdJ("ngModelChange",function(i){return n.trade.note=i}),e.ALo(87,"translate"),e.qZA()()(),e.TgZ(88,"ion-list")(89,"ion-list-header")(90,"ion-label"),e._uU(91),e.ALo(92,"translate"),e.qZA(),e.TgZ(93,"ion-button",15),e.NdJ("click",function(){return n.showSearchCategory()}),e._UZ(94,"ion-icon",26),e._uU(95),e.ALo(96,"translate"),e.qZA()(),e.YNc(97,Je,7,4,"ion-item",27),e.TgZ(98,"ion-item")(99,"ion-text",8),e._uU(100),e.ALo(101,"translate"),e.qZA(),e.TgZ(102,"div")(103,"date-picker",28),e.NdJ("dateChange",function(i){return n.trade.createdAt=i}),e.qZA()()(),e.YNc(104,ke,8,7,"ion-item",19),e.YNc(105,Le,5,4,"ion-item",29),e.qZA()()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,52,"trade-add.title")),e.xp6(3),e.Q6J("disabled",n.saveDisabled),e.xp6(2),e.hij(" \xa0",e.lcZ(11,54,"action.save")," "),e.xp6(2),e.Q6J("ngIf",n.checkStore&&(null==n.selectedStaff||n.selectedStaff.hasFullAccess&&!n.selectedStaff.storeId)),e.xp6(1),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(2),e.Q6J("hidden",!n.trade.debt||0==n.trade.debt.id),e.xp6(2),e.Oqu(e.lcZ(18,56,"trade-add.debt-explain")),e.xp6(2),e.Q6J("hidden",!n.trade.debt||0==n.trade.debt.id),e.xp6(2),e.Oqu(e.lcZ(22,58,"trade-add.debt-no")),e.xp6(3),e.hij(" ",n.trade.debt?"#"+n.trade.debt.id:""," "),e.xp6(1),e.Q6J("hidden",!n.trade.order||0==n.trade.order.id),e.xp6(2),e.Oqu(e.lcZ(28,60,"debt-add.order")),e.xp6(3),e.hij(" ",n.trade.order?"#"+n.trade.order.orderCode:""," "),e.xp6(1),e.Q6J("hidden",!n.trade.receivedNote||0==n.trade.receivedNote.id),e.xp6(2),e.Oqu(e.lcZ(34,62,"debt-add.received-note")),e.xp6(3),e.hij(" ",n.trade.receivedNote?"#"+n.trade.receivedNote.id:""," "),e.xp6(3),e.Oqu(e.lcZ(40,64,"trade-add.contact")),e.xp6(2),e.Q6J("ngIf",n.contactSelected&&n.contactSelected.id>0),e.xp6(1),e.Q6J("ngIf",!n.contactSelected||0==n.contactSelected.id),e.xp6(1),e.Q6J("ngIf",n.contactSelected&&n.contactSelected.id>0),e.xp6(1),e.Q6J("hidden",n.trade.debtId),e.xp6(2),e.hij(" ",e.lcZ(47,66,"trade-add.product")," "),e.xp6(2),e.Q6J("ngIf",n.productSelected&&n.productSelected.id>0),e.xp6(1),e.Q6J("ngIf",!n.productSelected||0==n.productSelected.id),e.xp6(2),e.Q6J("ngIf",n.productSelected&&n.productSelected.id>0),e.xp6(3),e.hij(" ",e.lcZ(55,68,"product.scan-barcode")," "),e.xp6(2),e.Q6J("hidden",n.trade.debtId),e.xp6(2),e.hij(" ",e.lcZ(59,70,"trade-add.product-description")," "),e.xp6(2),e.Q6J("ngIf",n.productSelected),e.xp6(1),e.Q6J("ngIf",n.productSelected&&n.trade.isPurchase),e.xp6(3),e.hij("",e.lcZ(65,72,"trade-add.money")," "),e.xp6(2),e.Q6J("ngIf",n.currency),e.xp6(1),e.s9C("placeholder",e.lcZ(68,74,"trade-add.enter-money")),e.Q6J("clear",!0)("moneyValue",n.trade.value),e.xp6(4),e.Q6J("color",n.trade.isReceived?"primary":"dark")("fill",n.trade.isReceived?"outline":"clear"),e.xp6(1),e.hij(" ",e.lcZ(73,76,"trade-add.money-in")," "),e.xp6(2),e.Q6J("color",n.trade.isReceived?"dark":"primary")("fill",n.trade.isReceived?"clear":"outline"),e.xp6(1),e.hij(" ",e.lcZ(76,78,"trade-add.money-out")," "),e.xp6(9),e.Oqu(e.lcZ(85,80,"trade-add.short-description")),e.xp6(2),e.s9C("placeholder",e.lcZ(87,82,"trade-add.short-description")),e.Q6J("ngModel",n.trade.note),e.xp6(5),e.Oqu(e.lcZ(92,84,"trade-add.categories")),e.xp6(4),e.hij(" ",e.lcZ(96,86,"trade-add.add")," "),e.xp6(2),e.Q6J("ngForOf",n.categories),e.xp6(3),e.Oqu(e.lcZ(101,88,"trade-add.created-at")),e.xp6(3),e.Q6J("date",n.trade.createdAt),e.xp6(1),e.Q6J("ngIf",!n.staffService.isStaff()),e.xp6(1),e.Q6J("ngIf",!n.staffService.isStaff()&&n.moneyAccountSelected&&n.moneyAccountSelected.id>0))},dependencies:[p.sg,p.O5,c.JJ,c.On,o.oU,o.YG,o.Sm,o.W2,o.Gu,o.gu,o.pK,o.Ie,o.Q$,o.q_,o.yh,o.yW,o.g2,o.wd,o.ho,o.sr,o.w,o.as,o.j9,o.cs,ge.F,ve.L,p.H9,I.X$],encapsulation:2}),a})();var Fe=l(6841),Ye=l(7060),qe=l(3604),Qe=l(3064);const Re=["period-range"];function Be(a,f){if(1&a){const t=e.EpF();e.TgZ(0,"trade-item",18),e.NdJ("onPress",function(){const i=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.presentActionSheet(i))})("onClick",function(){const i=e.CHM(t).$implicit,u=e.oxw();return e.KtG(u.selectTrade(i.id))}),e.qZA()}if(2&a){const t=f.$implicit,n=e.oxw();e.Q6J("trade",t)("currency",n.currency)("showContact",!0)}}function Ke(a,f){1&a&&(e.TgZ(0,"ion-item",12),e._UZ(1,"div",19),e.ALo(2,"translate"),e.qZA()),2&a&&(e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,1,"trade.no-trade"),e.oJD))}const Ge=function(a,f,t){return[a,f,"symbol","1.0-2",t]},Ve=[{path:"",component:(()=>{class a{constructor(t,n,r,i,u,T,S,s,C,x,E,J,K,G){var A=this;this.platform=t,this.barcodeScanner=n,this.file=r,this.tradeService=i,this.translateService=u,this.staffService=T,this.userService=S,this.productService=s,this.modalCtrl=C,this.navCtrl=x,this.excelService=E,this.actionSheetCtrl=J,this.alertCtrl=K,this.analyticsService=G,this.params=null,this.searchKey="",this.noteFilter="frequency",this.total=0,this.dateFrom="",this.dateTo="",this.isLoading=!1,this.isReceivedTrade=-1,this.reload=(0,v.Z)(function*(){A.currency=yield A.userService.getAttr("current-currency"),A.params=A.navCtrl.getParams(A.params),A.dateFrom=A.params&&A.params.dateFrom?A.params.dateFrom:A.dateFrom?A.dateFrom:y.C.GetFirstDateOfMonth(),A.dateTo=A.params&&A.params.dateTo?A.params.dateTo:A.dateTo?A.dateTo:y.C.GetEndDateOfMonth();const V=yield A.navCtrl.loading();A.tradeService.getTrades(A.dateFrom,A.dateTo).then(function(){var H=(0,v.Z)(function*(Y){yield V.dismiss(),A.originalTrades=JSON.parse(JSON.stringify(Y)),A.trades=Y,A.total=L.sumBy(A.trades,R=>R.value*(R.isReceived?1:-1)),A.filter()});return function(Y){return H.apply(this,arguments)}}())}),this.navCtrl.unsubscribe("reloadTradeList",this.reload),this.navCtrl.subscribe("reloadTradeList",this.reload)}ionViewWillEnter(){var t=this;return(0,v.Z)(function*(){yield t.analyticsService.setCurrentScreen("trades")})()}ngOnInit(){this.reload()}onPeriodChanged(t){t&&(this.dateFrom=""!=t.dateFrom?y.C.toDbString(t.dateFrom,y.C.getDbFormat()):"",this.dateTo=""!=t.dateTo?y.C.toDbString(t.dateTo,y.C.getDbFormat()):"",this.isReceivedTrade=t.isReceivedTrade,this.tradeService.getTrades(this.dateFrom,this.dateTo,this.isReceivedTrade).then(n=>{this.originalTrades=JSON.parse(JSON.stringify(n)),this.trades=n,this.total=L.sumBy(this.trades,r=>r.value*(r.isReceived?1:-1)),this.filter()}))}openTradeAdd(){!this.staffService.isStaff()||this.staffService.selectedStaff.hasFullAccess||this.staffService.selectedStaff.canCreateNewTransaction?this.navCtrl.push("/trade/add"):alert(this.translateService.instant("trade.no-permission-to-create-trade"))}search(){var t=this;return(0,v.Z)(function*(){t.analyticsService.logEvent("trade-search");let n=JSON.parse(JSON.stringify(t.originalTrades));if(null!==t.searchKey&&""!==t.searchKey){const r=t.searchKey.toLowerCase();n=n.filter(i=>i.note&&-1!==i.note.toLowerCase().indexOf(r)||i.contact&&i.contact.fullName&&-1!==i.contact.fullName.toLowerCase().indexOf(r)||i.contact&&i.contact.mobile&&-1!==i.contact.mobile.toLowerCase().indexOf(r)||i.product&&i.product.code&&-1!==i.product.code.toLowerCase().indexOf(r)||i.product&&i.product.title&&-1!==i.product.title.toLowerCase().indexOf(r))}t.trades=n,t.total=L.sumBy(t.trades,r=>r.value*(r.isReceived?1:-1))})()}clearSearch(){this.searchKey=null,this.reload()}filter(){let t=JSON.parse(JSON.stringify(this.originalTrades));t=this.sortByModifiedAt(t),this.trades=t}sortByModifiedAt(t){return t?L.orderBy(t,["createdAt"],["desc"]):null}dateOnlyFormat(t){return y.C.toUiDateString(t)}selectTrade(t){this.navCtrl.push("/trade/detail",{id:t})}deleteTrade(t){var n=this;return(0,v.Z)(function*(){t&&(t.orderId||t.debtId||t.receivedNoteId||t.transferNoteId)?alert(n.translateService.instant("trade.trade-related-alert")):yield(yield n.alertCtrl.create({header:n.translateService.instant("common.confirm"),message:n.translateService.instant("trade.delete-alert"),buttons:[{text:n.translateService.instant("common.agree"),handler:()=>{n.tradeService.deleteTrade(t).then((0,v.Z)(function*(){n.analyticsService.logEvent("trade-delete-success");let i=n.trades.findIndex(u=>u.id==t.id);i>=0&&(n.trades.splice(i,1),n.total=L.sumBy(n.trades,u=>u.value*(u.isReceived?1:-1))),i=n.originalTrades.findIndex(u=>u.id==t.id),i>=0&&n.originalTrades.splice(i,1)}))}},{text:n.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}presentOtherActionSheet(){var t=this;return(0,v.Z)(function*(){yield(yield t.actionSheetCtrl.create({header:t.translateService.instant("action.action"),buttons:[{text:t.translateService.instant("export.export-to-excel"),handler:()=>{try{t.exportExcel()}catch(r){alert(r)}}},{text:t.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}exportExcel(){var t=this;const n=[];if(n.push([this.translateService.instant("export.transaction-report")]),this.dateFrom&&this.dateTo){const u=this.translateService.instant("common.from"),T=this.translateService.instant("common.to"),S=u+" "+this.dateFormat(this.dateFrom)+" "+T+" "+this.dateFormat(this.dateTo);n.push([S])}n.push([this.translateService.instant("common.total")+": "+this.total+" "+this.currency]),n.push([this.translateService.instant("export.contact"),this.translateService.instant("export.product"),this.translateService.instant("export.product-count"),this.translateService.instant("export.money"),this.translateService.instant("export.unit"),this.translateService.instant("export.date")]);for(const u of this.trades)n.push([0!=u.contactId&&u.contact?u.contact.fullName:"",0!=u.productId&&u.product?Z.W.productName(u.product.code,u.product.title):"",0!=u.productId&&u.product&&u.isPurchase?u.productCount?u.productCount:0:" ",u.isReceived?u.value:-1*u.value,this.currency,this.dateFormat(u.createdAt)]);const r=this.excelService.createSheetData(n),i="transaction-report-"+Z.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(r,i).then(function(){var u=(0,v.Z)(function*(T){t.navCtrl.isNotCordova()||(yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("report.file-save-alert")+t.file.externalDataDirectory+i,buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{}}]})).present(),t.userService.shareFile(null,T))});return function(T){return u.apply(this,arguments)}}())}dateFormat(t){return y.C.toUiDateString(t)}presentActionSheet(t){var n=this;return(0,v.Z)(function*(){yield(yield n.actionSheetCtrl.create({header:n.translateService.instant("action.action"),buttons:[{text:n.translateService.instant("trade.delete-trade"),role:"destructive",handler:()=>{n.deleteTrade(t)}},{text:n.translateService.instant("trade.edit-trade"),handler:()=>{n.selectTrade(t.id)}},{text:n.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}selectDateRangeForTrade(){var t=this;return(0,v.Z)(function*(){const n=yield t.modalCtrl.create({component:Fe.S,componentProps:{dateFromInput:t.dateFrom,dateToInput:t.dateTo}});yield n.present();const{data:r}=yield n.onDidDismiss();r&&(t.dateFrom=""!=r.dateFrom?y.C.toDbString(r.dateFrom,y.C.getDbFormat()):"",t.dateTo=""!=r.dateTo?y.C.toDbString(r.dateTo,y.C.getDbFormat()):"",t.tradeService.getTrades(t.dateFrom,t.dateTo).then(i=>{t.originalTrades=JSON.parse(JSON.stringify(i)),t.trades=i,t.total=L.sumBy(t.trades,u=>u.value*(u.isReceived?1:-1)),t.filter()}))})()}addReport(){this.navCtrl.navigateRoot("/report")}scan(){this.platform.is("capacitor")||this.platform.is("cordova")?this.barcodeScanner.scan().then(t=>{if(!t||!t.text||isNaN(+t.text))return;const n=+t.text;this.productService.get(n,0).then(()=>{this.navCtrl.push("/trade/add",{product:n})})}):alert(this.translateService.instant("common.feature-only-on-app"))}previousMoment(){}nextMoment(){}selectMomentType(){}}return a.\u0275fac=function(t){return new(t||a)(e.Y36(o.t4),e.Y36(W.m),e.Y36($.$),e.Y36(d.X),e.Y36(I.sK),e.Y36(X.x),e.Y36(g.K),e.Y36(z.M),e.Y36(o.IN),e.Y36(P.G),e.Y36(Ye.x),e.Y36(o.BX),e.Y36(o.Br),e.Y36(m.y))},a.\u0275cmp=e.Xpm({type:a,selectors:[["trade"]],viewQuery:function(t,n){if(1&t&&e.Gf(Re,7),2&t){let r;e.iGM(r=e.CRH())&&(n.periodRange=r.first)}},decls:34,vars:29,consts:[["slot","start"],["menu","first"],["color","primary",3,"click"],["name","home"],["slot","end"],["name","stats"],[3,"click"],["name","add-circle"],["name","ellipsis-vertical"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[1,"ion-padding",2,"padding-top","0","padding-bottom","0"],["page","trade",3,"onPeriodChanged"],[1,"ion-text-wrap"],[3,"color"],[3,"trade","currency","showContact","onPress","onClick",4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],[3,"trade","currency","showContact","onPress","onClick"],[3,"innerHTML"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-menu-button",1),e.TgZ(4,"ion-button",2),e.NdJ("click",function(){return n.navCtrl.home()}),e._UZ(5,"ion-icon",3),e.qZA()(),e.TgZ(6,"ion-title"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"ion-buttons",4)(10,"ion-button",2),e.NdJ("click",function(){return n.addReport()}),e._UZ(11,"ion-icon",5),e.qZA(),e.TgZ(12,"ion-button",6),e.NdJ("click",function(){return n.openTradeAdd()}),e._UZ(13,"ion-icon",7),e.qZA(),e.TgZ(14,"ion-button",2),e.NdJ("click",function(){return n.presentOtherActionSheet()}),e._UZ(15,"ion-icon",8),e.qZA()()(),e.TgZ(16,"ion-searchbar",9),e.NdJ("ionClear",function(){return n.clearSearch()})("ionChange",function(){return n.search()})("ngModelChange",function(i){return n.searchKey=i}),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"ion-content")(19,"div",10)(20,"period-range",11),e.NdJ("onPeriodChanged",function(i){return n.onPeriodChanged(i)}),e.qZA()(),e.TgZ(21,"ion-list")(22,"ion-item")(23,"ion-label",12),e._uU(24),e.ALo(25,"translate"),e.TgZ(26,"ion-text",13),e._uU(27),e.ALo(28,"currency"),e.qZA()()(),e.YNc(29,Be,1,3,"trade-item",14),e.YNc(30,Ke,3,3,"ion-item",15),e.qZA(),e.TgZ(31,"ion-fab",16)(32,"ion-fab-button",6),e.NdJ("click",function(){return n.openTradeAdd()}),e._UZ(33,"ion-icon",17),e.qZA()()()),2&t&&(e.xp6(7),e.Oqu(e.lcZ(8,13,"trade.title")),e.xp6(9),e.s9C("placeholder",e.lcZ(17,15,"trade.search")),e.Q6J("ngModel",n.searchKey),e.xp6(2),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(6),e.hij(" ",e.lcZ(25,17,"common.total"),":\xa0 "),e.xp6(2),e.s9C("color",n.total>=0?"secondary":"danger"),e.xp6(1),e.AsE("",n.total>=0?"+":""," ",e.G7q(28,19,e.kEZ(25,Ge,n.total,n.currency,n.translateService.currentLang)),"."),e.xp6(2),e.Q6J("ngForOf",n.trades),e.xp6(1),e.Q6J("ngIf",!n.originalTrades||0===n.originalTrades.length),e.xp6(1),e.Akn(n.navCtrl.hasAds()?"margin-bottom: 60px":""))},dependencies:[p.sg,p.O5,c.JJ,c.On,o.YG,o.Sm,o.W2,o.IJ,o.W4,o.Gu,o.gu,o.Ie,o.Q$,o.q_,o.fG,o.VI,o.yW,o.wd,o.sr,o.j9,qe._,Qe.M,p.H9,I.X$],encapsulation:2}),a})()},{path:"detail",component:ae},{path:"add",component:Ee}];let He=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[N.Bz.forChild(Ve),N.Bz]}),a})(),je=(()=>{class a{}return a.\u0275fac=function(t){return new(t||a)},a.\u0275mod=e.oAB({type:a}),a.\u0275inj=e.cJS({imports:[p.ez,c.u5,o.Pc,He,M.m,D.uH,I.aw.forChild({loader:{provide:I.Zw,useFactory:M.x,deps:[U.eN]}})]}),a})()}}]);