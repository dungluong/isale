"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[9326],{677:(q,Z,s)=>{s.r(Z),s.d(Z,{CategoryReportModule:()=>at});var d=s(6895),g=s(4006),i=s(191),h=s(3306),x=s(529),T=s(2216),A=s(3196),p=s(5861),R=s(7489),m=s(1914),C=s(6723),t=s(6738),_=s(4518),S=s(5851),J=s(323);function F(o,l){if(1&o&&(t.TgZ(0,"p",11)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&o){const e=t.oxw().$implicit,r=t.oxw();t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",r.getFilter(e)," ")}}function N(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item-sliding",3),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.selectReport(a.id))}),t.TgZ(1,"ion-item",8),t.NdJ("press",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.presentActionSheet(a))}),t.TgZ(2,"ion-label",9)(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"p",11)(6,"span"),t._uU(7),t.qZA()(),t.YNc(8,F,4,4,"p",12),t.TgZ(9,"p",11),t._uU(10),t.qZA()()()()}if(2&o){const e=l.$implicit,r=t.oxw();t.xp6(4),t.Oqu(r.limitText(e.name)),t.xp6(3),t.hij(" ",r.getDateType(e)," "),t.xp6(1),t.Q6J("ngIf",r.getFilter(e)),t.xp6(2),t.hij(" ",r.dateFormat(e.modifiedAt)," ")}}function E(o,l){1&o&&(t.TgZ(0,"ion-item",9),t._UZ(1,"div",13),t.ALo(2,"translate"),t.qZA()),2&o&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"report-category.no-report"),t.oJD))}let w=(()=>{class o{constructor(e,r,n,a,c,u){this.reportService=e,this.translateService=r,this.navCtrl=n,this.actionSheetCtrl=a,this.alertCtrl=c,this.analyticsService=u,this.searchKey="",this.navCtrl.unsubscribe("reloadCategoryReportList",this.reload),this.navCtrl.subscribe("reloadCategoryReportList",this.reload)}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("category-report")})()}ngOnInit(){this.reload()}reload(){var e=this;return(0,p.Z)(function*(){const r=[yield e.reportService.getCustomReport(1,"category-report")];e.originalReports=JSON.parse(JSON.stringify(r)),e.reports=r,e.filter()})()}openReportAdd(){this.navCtrl.push("/category-report/add")}search(){var e=this;return(0,p.Z)(function*(){e.analyticsService.logEvent("category-report-search");let r=JSON.parse(JSON.stringify(e.originalReports));if(null!==e.searchKey&&""!==e.searchKey){let n=e.searchKey.toLowerCase();r=r.filter(a=>a.name&&-1!==a.name.toLowerCase().indexOf(n))}e.reports=r})()}clearSearch(){this.searchKey=null,this.reload()}filter(){let e=JSON.parse(JSON.stringify(this.originalReports));e=this.sortByModifiedAt(e),this.reports=e}sortByModifiedAt(e){return e?R.orderBy(e,["modifiedAt"],["desc"]):null}dateFormat(e){return m.C.toUiString(e)}limitText(e,r=200){return C.W.limitText(e,r)}selectReport(e){this.navCtrl.push("/category-report/detail",{id:e})}deleteReport(e){var r=this;return(0,p.Z)(function*(){yield(yield r.alertCtrl.create({header:r.translateService.instant("common.confirm"),message:r.translateService.instant("report-category.delete-alert"),buttons:[{text:r.translateService.instant("common.agree"),handler:()=>{r.reportService.deleteCategoryReport(e).then((0,p.Z)(function*(){r.analyticsService.logEvent("category-report-delete-success");let a=r.reports.findIndex(c=>c.id==e.id);a>=0&&r.reports.splice(a,1),a=r.originalReports.findIndex(c=>c.id==e.id),a>=0&&r.originalReports.splice(a,1)}))}},{text:r.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}presentActionSheet(e){var r=this;return(0,p.Z)(function*(){yield(yield r.actionSheetCtrl.create({header:r.translateService.instant("action.action"),buttons:[{text:r.translateService.instant("report-detail.delete-report"),role:"destructive",handler:()=>{r.deleteReport(e)}},{text:r.translateService.instant("report-category.view-detail"),handler:()=>{r.selectReport(e.id)}},{text:r.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}getDateType(e){return 0==e.dateType?this.translateService.instant("report-category.by-week"):1==e.dateType?this.translateService.instant("report-category.by-month"):2==e.dateType?this.translateService.instant("report-category.by-year"):3==e.dateType?this.translateService.instant("report-category.by-day"):4==e.dateType?this.translateService.instant("report-category.custom"):5==e.dateType?this.translateService.instant("report-category.by-quarter"):""}getFilter(e){let r="";return(0!=e.categoryListType||0!=e.ignoreCategory)&&(""!=r&&(r+="; "),r+=this.translateService.instant("report-category.contact-limited")),r}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(_.r),t.Y36(h.sK),t.Y36(S.G),t.Y36(i.BX),t.Y36(i.Br),t.Y36(J.y))},o.\u0275cmp=t.Xpm({type:o,selectors:[["category-report"]],decls:16,vars:11,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],[3,"click"],["name","add-circle"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[3,"click",4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["text-wrap","",3,"press"],[1,"ion-text-wrap"],[2,"white-space","pre-wrap"],[2,"padding-top","5px"],["style","padding-top: 5px;",4,"ngIf"],[3,"innerHTML"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return r.openReportAdd()}),t._UZ(9,"ion-icon",4),t.qZA()()()(),t.TgZ(10,"ion-content")(11,"ion-searchbar",5),t.NdJ("ionClear",function(){return r.clearSearch()})("ionChange",function(){return r.search()})("ngModelChange",function(a){return r.searchKey=a}),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"ion-list"),t.YNc(14,N,11,4,"ion-item-sliding",6),t.YNc(15,E,3,3,"ion-item",7),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,7,"report-category.title")),t.xp6(5),t.Akn(r.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.s9C("placeholder",t.lcZ(12,9,"report-category.search")),t.Q6J("ngModel",r.searchKey),t.xp6(3),t.Q6J("ngForOf",r.reports),t.xp6(1),t.Q6J("ngIf",!r.originalReports||0===r.originalReports.length))},dependencies:[d.sg,d.O5,g.JJ,g.On,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.td,i.Q$,i.q_,i.VI,i.wd,i.sr,i.j9,i.cs,h.X$],encapsulation:2}),o})();class L{constructor(){this.createdAt="",this.modifiedAt="",this.id=0,this.name="",this.dateType=0,this.dateFrom="",this.dateTo="",this.categoryListType=0,this.categoryListCustom="",this.ignoreCategory=0,this.ignoredCategories=""}}var Q=s(8007);function k(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"date-item",12),t.NdJ("dateChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.report.dateFrom=n)}),t.ALo(1,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("date",e.report.dateFrom)("label",t.lcZ(1,2,"report-category-add.start-date"))}}function Y(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"date-item",13),t.NdJ("dateChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.report.dateTo=n)}),t.ALo(1,"translate"),t.qZA()}if(2&o){const e=t.oxw();t.Q6J("date",e.report.dateTo)("label",t.lcZ(1,2,"report-category-add.end-date"))}}function K(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.showSearchCategory())}),t._UZ(4,"ion-icon",15),t._uU(5),t.ALo(6,"translate"),t.qZA()()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"report-category-add.list-category"),": "),t.xp6(4),t.hij(" ",t.lcZ(6,4,"report-category-add.add")," "))}function P(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.removeSelectedCategory(a))}),t._UZ(4,"ion-icon",16),t._uU(5),t.ALo(6,"translate"),t.qZA()()}if(2&o){const e=l.$implicit;t.xp6(2),t.Oqu(e.title),t.xp6(3),t.hij(" ",t.lcZ(6,2,"report-category-add.remove")," ")}}function G(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.showSearchCategory(!1))}),t._UZ(4,"ion-icon",15),t._uU(5),t.ALo(6,"translate"),t.qZA()()}2&o&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"report-category-add.list-category"),": "),t.xp6(4),t.hij(" ",t.lcZ(6,4,"report-category-add.add")," "))}function j(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.removeIgnoredCategory(a))}),t._UZ(4,"ion-icon",16),t._uU(5),t.ALo(6,"translate"),t.qZA()()}if(2&o){const e=l.$implicit;t.xp6(2),t.Oqu(e.title),t.xp6(3),t.hij(" ",t.lcZ(6,2,"report-category-add.remove")," ")}}let H=(()=>{class o{constructor(e,r,n,a){this.navCtrl=e,this.modalCtrl=r,this.reportService=n,this.analyticsService=a,this.params=null,this.report=new L,this.selectedCategories=[],this.ignoredCategories=[]}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("category-report-add")})()}ngOnInit(){let e=0;this.params=this.navCtrl.getParams(this.params),this.params&&this.params.id&&this.params.id>0&&(e=this.params.id),e&&e>0&&this.reportService.getCustomReport(e,"category-report").then(r=>{this.report=r,r.categoryListCustom&&""!==r.categoryListCustom&&(this.selectedCategories=JSON.parse(r.categoryListCustom)),r.ignoredCategories&&""!==r.ignoredCategories&&(this.ignoredCategories=JSON.parse(r.ignoredCategories))})}save(){var e=this;this.reportService.saveCustomReport(this.report,"category-report").then(function(){var r=(0,p.Z)(function*(n){e.analyticsService.logEvent("category-report-add-save-success"),e.report.id=n,e.exitPage()});return function(n){return r.apply(this,arguments)}}())}exitPage(){var e=this;return(0,p.Z)(function*(){yield e.navCtrl.popOnly(),(!e.params||!e.params.id)&&(yield e.navCtrl.push("/category-report/detail",{id:e.report.id})),e.navCtrl.publish("reloadReportList"),e.navCtrl.publish("reloadCategoryReport",e.report)})()}showSearchCategory(e=!0){var r=this;return(0,p.Z)(function*(){const n=function(){var a=(0,p.Z)(function*(c){const u=c;if(u)if(e){if(r.selectedCategories.findIndex(v=>v.id===u.id)>=0)return;r.selectedCategories.push(u),r.report.categoryListCustom=JSON.stringify(r.selectedCategories)}else{if(r.ignoredCategories.findIndex(v=>v.id===u.id)>=0)return;r.ignoredCategories.push(u),r.report.ignoredCategories=JSON.stringify(r.ignoredCategories)}});return function(u){return a.apply(this,arguments)}}();r.navCtrl.push("/trade-category",{callback:n,searchMode:!0})})()}removeIgnoredCategory(e){const r=this.ignoredCategories.findIndex(n=>n.id===e.id);r>=0&&(this.ignoredCategories.splice(r,1),this.report.ignoredCategories=JSON.stringify(this.ignoredCategories))}removeSelectedCategory(e){const r=this.selectedCategories.findIndex(n=>n.id===e.id);r>=0&&(this.selectedCategories.splice(r,1),this.report.categoryListCustom=JSON.stringify(this.selectedCategories))}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(S.G),t.Y36(i.IN),t.Y36(_.r),t.Y36(J.y))},o.\u0275cmp=t.Xpm({type:o,selectors:[["category-report-add"]],decls:65,vars:66,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","checkmark"],["color","primary"],[3,"ngModel","ngModelChange"],[3,"value"],["pickerId","reportDateFromPicker",3,"date","label","dateChange",4,"ngIf"],["pickerId","reportDateEndPicker",3,"date","label","dateChange",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["pickerId","reportDateFromPicker",3,"date","label","dateChange"],["pickerId","reportDateEndPicker",3,"date","label","dateChange"],["fill","outline","slot","end",3,"click"],["name","add"],["name","remove"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return r.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item")(15,"ion-label",5),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-select",6),t.NdJ("ngModelChange",function(a){return r.report.dateType=a}),t.TgZ(19,"ion-select-option",7),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-select-option",7),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"ion-select-option",7),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"ion-select-option",7),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-select-option",7),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"ion-select-option",7),t._uU(35),t.ALo(36,"translate"),t.qZA()()(),t.YNc(37,k,2,4,"date-item",8),t.YNc(38,Y,2,4,"date-item",9),t.TgZ(39,"ion-item")(40,"ion-label",5),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-select",6),t.NdJ("ngModelChange",function(a){return r.report.categoryListType=a}),t.TgZ(44,"ion-select-option",7),t._uU(45),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ion-select-option",7),t._uU(48),t.ALo(49,"translate"),t.qZA()()(),t.YNc(50,K,7,6,"ion-item",10),t.YNc(51,P,7,4,"ion-item",11),t.TgZ(52,"ion-item")(53,"ion-label",5),t._uU(54),t.ALo(55,"translate"),t.qZA(),t.TgZ(56,"ion-select",6),t.NdJ("ngModelChange",function(a){return r.report.ignoreCategory=a}),t.TgZ(57,"ion-select-option",7),t._uU(58),t.ALo(59,"translate"),t.qZA(),t.TgZ(60,"ion-select-option",7),t._uU(61),t.ALo(62,"translate"),t.qZA()()(),t.YNc(63,G,7,6,"ion-item",10),t.YNc(64,j,7,4,"ion-item",11),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,36,"report-category-add.title")),t.xp6(5),t.hij(" \xa0",t.lcZ(11,38,"action.save")," "),t.xp6(2),t.Akn(r.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(4),t.Oqu(t.lcZ(17,40,"report-category-add.date-range")),t.xp6(2),t.Q6J("ngModel",r.report.dateType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(21,42,"report-category.by-week")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(24,44,"report-category.by-month")),t.xp6(2),t.Q6J("value",2),t.xp6(1),t.Oqu(t.lcZ(27,46,"report-category.by-year")),t.xp6(2),t.Q6J("value",3),t.xp6(1),t.Oqu(t.lcZ(30,48,"report-category.by-day")),t.xp6(2),t.Q6J("value",5),t.xp6(1),t.Oqu(t.lcZ(33,50,"report-category.by-quarter")),t.xp6(2),t.Q6J("value",4),t.xp6(1),t.Oqu(t.lcZ(36,52,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",4===r.report.dateType),t.xp6(1),t.Q6J("ngIf",4===r.report.dateType),t.xp6(3),t.Oqu(t.lcZ(42,54,"report-category-add.select-category")),t.xp6(2),t.Q6J("ngModel",r.report.categoryListType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(46,56,"report-category-add.all")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(49,58,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",1===r.report.categoryListType),t.xp6(1),t.Q6J("ngForOf",r.selectedCategories),t.xp6(3),t.Oqu(t.lcZ(55,60,"report-category-add.ignored-categories")),t.xp6(2),t.Q6J("ngModel",r.report.ignoreCategory),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(59,62,"report-category-add.none")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(62,64,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",1===r.report.ignoreCategory),t.xp6(1),t.Q6J("ngForOf",r.ignoredCategories))},dependencies:[d.sg,d.O5,g.JJ,g.On,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.Q$,i.q_,i.t9,i.n0,i.wd,i.sr,i.QI,i.cs,Q.p,h.X$],encapsulation:2}),o})();var y=s(1464),M=s(3363),B=s(4013),$=s(3989),f=s(5439),W=s(4433),V=s(7488),X=s(7060),U=s(4155);const z=["chart"];function tt(o,l){if(1&o&&(t.TgZ(0,"p",9)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&o){const e=t.oxw();t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.filter," ")}}function et(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-select",22),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.barChartType=n)}),t.TgZ(2,"ion-select-option",23),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-select-option",24),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"ion-select-option",25),t._uU(9),t.ALo(10,"translate"),t.qZA()()()}if(2&o){const e=t.oxw();t.xp6(1),t.Q6J("ngModel",e.barChartType),t.xp6(2),t.Oqu(t.lcZ(4,4,"common.bar")),t.xp6(3),t.Oqu(t.lcZ(7,6,"common.pie")),t.xp6(3),t.Oqu(t.lcZ(10,8,"common.line"))}}function rt(o,l){if(1&o&&t._UZ(0,"canvas",26,27),2&o){const e=t.oxw();t.Q6J("hidden",e.isCapturing)("datasets",e.barChartData)("labels",e.barChartLabels)("options",e.barChartOptions)("legend",e.barChartLegend)("type",e.barChartType)}}const D=function(o,l,e){return[o,l,"symbol","1.0-2",e]};function ot(o,l){if(1&o){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item",28),t.NdJ("click",function(){const a=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.selectReport(a))}),t.TgZ(2,"ion-label",8)(3,"ion-text",11),t._uU(4),t.ALo(5,"currency"),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()()()()}if(2&o){const e=l.$implicit,r=t.oxw();t.xp6(3),t.s9C("color",e.value>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.value>=0?"+":"","",t.G7q(5,4,t.kEZ(10,D,e.value,r.currency,r.translateService.currentLang)),""),t.xp6(3),t.Oqu(e.category.title)}}const nt=[{path:"",component:w},{path:"add",component:H},{path:"detail",component:(()=>{class o{constructor(e,r,n,a,c,u,b,v,st){this.navCtrl=e,this.translateService=r,this.file=n,this.userService=a,this.reportService=c,this.actionSheetCtrl=u,this.alertCtrl=b,this.excelService=v,this.analyticsService=st,this.report=new L,this.params=null,this.isCapturing=!1,this.categoryReports=[],this.totalCategory=0,this.totalValue=0,this.dateType="",this.dateFrom="",this.dateTo="",this.filter="",this.currentMoment=f(),this.isLoadingChart=!1,this.barChartOptions={scaleShowVerticalLines:!1,responsive:!0,bezierCurve:!1,onAnimationComplete:this.done},this.barChartLabels=[""],this.barChartType="bar",this.barChartLegend=!0,this.barChartData=[{data:[0]}],this.isInChartMode=!1;const I=lt=>{this.report&&lt.detail.id===this.report.id&&this.reload()};this.navCtrl.unsubscribe("reloadCategoryReport",I),this.navCtrl.subscribe("reloadCategoryReport",I)}done(){}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("category-report-detail")})()}ngOnInit(){this.reload()}reload(){this.userService.getAttr("current-currency").then(e=>{this.currency=e}),this.params=this.navCtrl.getParams(this.params),this.params&&this.params.id&&this.params.id>0&&this.reportService.getCustomReport(this.params.id,"category-report").then(r=>{this.report=r,this.doCalculate()})}doCalculate(){this.isLoadingChart=!0,this.reportService.calculateCategoryReport(this.report,this.currentMoment).then(e=>{this.categoryReports=e.reports,this.totalCategory=e.totalItem,this.totalValue=e.totalValue,this.dateType=e.dateType,this.dateFrom=e.dateFrom,this.dateTo=e.dateTo,this.filter=e.filter,this.showChart(),this.isInChartMode=!0,this.isLoadingChart=!1})}edit(){this.navCtrl.push("/category-report/add",{id:this.report.id})}presentActionSheet(){var e=this;return(0,p.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("report-detail.delete-report"),role:"destructive",handler:()=>{e.deleteReport()}},{text:e.translateService.instant("report-detail.share"),role:"destructive",handler:()=>{e.shareReport()}},{text:e.translateService.instant("export.export-to-excel"),handler:()=>{e.exportExcel()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}deleteReport(){var e=this;return(0,p.Z)(function*(){yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report-detail.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{e.reportService.deleteCategoryReport(e.report).then((0,p.Z)(function*(){e.analyticsService.logEvent("category-report-detail-delete-success"),e.navCtrl.publish("reloadReportList"),e.navCtrl.pop()}))}},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}showChart(){const e={label:"",data:[]},r=[];for(const n of this.categoryReports)r.push(n.category.title),e.data.push(n.value);this.barChartLabels=r,this.barChartData=[e]}enableChart(){this.isInChartMode=!this.isInChartMode}selectReport(e){this.navCtrl.push("/trade-category/detail",{id:e.categoryId,dateFrom:m.C.toDbString(this.dateFrom,m.C.getUiDateFormat()),dateTo:m.C.toDbString(this.dateTo,m.C.getUiDateFormat())})}previousMoment(){this.currentMoment=f(this.currentMoment).subtract(1,m.C.dateTypeToDuration(this.report.dateType)),this.doCalculate()}nextMoment(){this.currentMoment=f(this.currentMoment).add(1,m.C.dateTypeToDuration(this.report.dateType)),this.doCalculate()}viewTrend(){const e=new $.k;e.dataType=1,e.dateType=this.report.dateType,3!=e.dateType&&4!=e.dateType&&(e.dateFrom=f().startOf("year").format(m.C.getDbFormat())),e.dateTo=f().endOf("day").format(m.C.getDbFormat()),e.dataSources=JSON.stringify([this.report]),this.reportService.calculateChart(e).then(r=>{this.navCtrl.push("/chart/detail",{chart:e,data:r})})}shareReport(){this.isCapturing=!0,this.chartImg=this.chart.nativeElement.toDataURL(),this.userService.shareScreenshot().then(()=>{this.isCapturing=!1}).catch(()=>{this.isCapturing=!1})}exportExcel(){var e=this;const r=new B.m;let n=new M._;n.addColumn(new y.d(this.translateService.instant("export.category"))),n.addColumn(new y.d(this.translateService.instant("export.money"))),n.addColumn(new y.d(this.translateService.instant("export.unit"))),r.addRow(n);for(const c of this.categoryReports)n=new M._,n.addColumn(new y.d(c.category.title)),n.addColumn(new y.d(c.value,"number")),n.addColumn(new y.d(this.currency)),r.addRow(n);const a="category-report-"+C.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(r,a).then(function(){var c=(0,p.Z)(function*(u){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+a,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,u))});return function(u){return c.apply(this,arguments)}}())}}return o.\u0275fac=function(e){return new(e||o)(t.Y36(S.G),t.Y36(h.sK),t.Y36(W.$),t.Y36(V.K),t.Y36(_.r),t.Y36(i.BX),t.Y36(i.Br),t.Y36(X.x),t.Y36(J.y))},o.\u0275cmp=t.Xpm({type:o,selectors:[["category-report-detail"]],viewQuery:function(e,r){if(1&e&&t.Gf(z,7),2&e){let n;t.iGM(n=t.CRH())&&(r.chart=n.first)}},decls:52,vars:53,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["ion-button","","color","primary",3,"click"],["name","create"],["color","primary",3,"click"],["name","stats-chart"],["name","ellipsis-vertical"],[1,"ion-text-wrap"],[2,"padding-top","5px"],["style","padding-top: 5px;",4,"ngIf"],[3,"color"],["fill","outline",3,"disabled","click"],["name","chevron-back"],["name","chevron-forward"],["fill","outline",3,"click"],["name","trending-up"],[4,"ngIf"],[3,"hidden"],[3,"hidden","src"],["baseChart","",3,"hidden","datasets","labels","options","legend","type",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],["value","bar"],["value","pie"],["value","line"],["baseChart","",3,"hidden","datasets","labels","options","legend","type"],["chart",""],["text-wrap","",3,"click"]],template:function(e,r){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return r.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",5),t.NdJ("click",function(){return r.enableChart()}),t._UZ(11,"ion-icon",6),t.qZA(),t.TgZ(12,"ion-button",5),t.NdJ("click",function(){return r.presentActionSheet()}),t._UZ(13,"ion-icon",7),t.qZA()()()(),t.TgZ(14,"ion-content")(15,"ion-list")(16,"ion-item")(17,"ion-label",8)(18,"b"),t._uU(19),t.qZA(),t.TgZ(20,"ion-text",9)(21,"span"),t._uU(22),t.ALo(23,"translate"),t.ALo(24,"translate"),t.qZA()(),t._UZ(25,"br"),t.YNc(26,tt,4,4,"p",10),t.TgZ(27,"p",9)(28,"ion-text",11),t._uU(29),t.ALo(30,"translate"),t.ALo(31,"currency"),t.qZA(),t._uU(32),t.ALo(33,"translate"),t.qZA()()(),t.TgZ(34,"ion-item")(35,"ion-button",12),t.NdJ("click",function(){return r.previousMoment()}),t._UZ(36,"ion-icon",13),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.TgZ(39,"ion-button",12),t.NdJ("click",function(){return r.nextMoment()}),t._uU(40),t.ALo(41,"translate"),t._UZ(42,"ion-icon",14),t.qZA(),t.TgZ(43,"ion-button",15),t.NdJ("click",function(){return r.viewTrend()}),t._UZ(44,"ion-icon",16),t._uU(45),t.ALo(46,"translate"),t.qZA()(),t.YNc(47,et,11,10,"ion-item",17),t.TgZ(48,"div",18),t._UZ(49,"img",19),t.YNc(50,rt,2,6,"canvas",20),t.qZA(),t.YNc(51,ot,8,14,"ion-item-sliding",21),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,27,"report-category-detail.title")),t.xp6(9),t.Akn(r.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(5),t.Oqu(r.report.name),t.xp6(3),t.xDo(" ",r.dateType," (",t.lcZ(23,29,"common.from")," ",r.dateFrom," ",t.lcZ(24,31,"common.to")," ",r.dateTo,") "),t.xp6(4),t.Q6J("ngIf",r.filter),t.xp6(2),t.s9C("color",r.totalValue>=0?"secondary":"danger"),t.xp6(1),t.lnq(" ",t.lcZ(30,33,"common.total"),": ",r.totalValue>=0?"+":"","",t.G7q(31,35,t.kEZ(49,D,r.totalValue,r.currency,r.translateService.currentLang))," "),t.xp6(3),t.AsE(" / ",r.totalCategory," ",t.lcZ(33,41,"report-category-detail.category"),". "),t.xp6(3),t.Q6J("disabled",r.isLoadingChart),t.xp6(2),t.hij("\xa0 ",t.lcZ(38,43,"report-detail.pre")," "),t.xp6(2),t.Q6J("disabled",r.isLoadingChart),t.xp6(1),t.hij(" ",t.lcZ(41,45,"report-detail.next"),"\xa0 "),t.xp6(5),t.hij(" ",t.lcZ(46,47,"report-detail.view-trend")," "),t.xp6(2),t.Q6J("ngIf",r.isInChartMode),t.xp6(1),t.Q6J("hidden",!r.isInChartMode),t.xp6(1),t.Q6J("hidden",!r.isCapturing)("src",r.chartImg,t.LSH),t.xp6(1),t.Q6J("ngIf",!r.isLoadingChart),t.xp6(1),t.Q6J("ngForOf",r.categoryReports))},dependencies:[d.sg,d.O5,g.JJ,g.On,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.td,i.Q$,i.q_,i.t9,i.n0,i.yW,i.wd,i.sr,i.QI,i.cs,U.jh,d.H9,h.X$],encapsulation:2}),o})()}];let it=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[A.Bz.forChild(nt),A.Bz]}),o})();var O=s(3093);let at=(()=>{class o{}return o.\u0275fac=function(e){return new(e||o)},o.\u0275mod=t.oAB({type:o}),o.\u0275inj=t.cJS({imports:[d.ez,g.u5,i.Pc,it,O.m,U.vQ,T.uH,h.aw.forChild({loader:{provide:h.Zw,useFactory:O.x,deps:[x.eN]}})]}),o})()},8851:(q,Z,s)=>{s.d(Z,{L:()=>A});var d=s(6738),g=s(5439),h=s(1914),x=s(4006),T=s(191);let A=(()=>{class p{constructor(){this.min=null,this.max=null,this.pickerId=null,this.date="",this.type="date",this.dateChange=new d.vpe}ionViewWillEnter(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?g(this.date.split(":00Z").join("")).format(h.C.getDateTimeDbFormat()):g(this.date.split(":00Z").join("")).format(h.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}ngOnInit(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?g(this.date.split(":00Z").join("")).format(h.C.getDateTimeDbFormat()):g(this.date.split(":00Z").join("")).format(h.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}change(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?g(this.date.split(":00Z").join("")).format(h.C.getDateTimeDbFormat()):g(this.date.split(":00Z").join("")).format(h.C.getDateDbFormat()):this.date,this.dateChange.emit(this.date)}}return p.\u0275fac=function(m){return new(m||p)},p.\u0275cmp=d.Xpm({type:p,selectors:[["date-picker"]],inputs:{min:"min",max:"max",pickerId:"pickerId",date:"date",type:"type"},outputs:{dateChange:"dateChange"},decls:1,vars:4,consts:[["color","primary",1,"ion-button",2,"font-size","0.8em",3,"type","ngModel","min","max","ngModelChange","ionChange"]],template:function(m,C){1&m&&(d.TgZ(0,"ion-input",0),d.NdJ("ngModelChange",function(_){return C.date=_})("ionChange",function(){return C.change()}),d.qZA()),2&m&&d.Q6J("type",C.type)("ngModel",C.date)("min",C.min)("max",C.max)},dependencies:[x.JJ,x.On,T.pK,T.j9],encapsulation:2}),p})()}}]);