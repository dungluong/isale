"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8138],{4699:(O,y,l)=>{l.r(y),l.d(y,{ReportModule:()=>ut});var m=l(6895),h=l(4006),a=l(191),u=l(3306),A=l(529),T=l(3196),g=l(5861),d=l(1914),f=l(6723),t=l(6738),_=l(4518),R=l(7488),x=l(5851),U=l(323);function D(n,i){if(1&n&&(t.TgZ(0,"p",12)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.getFilter(e.timelyReport)," ")}}function F(n,i){if(1&n&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.TgZ(2,"span",11),t._uU(3),t.qZA(),t.TgZ(4,"p",12)(5,"span"),t._uU(6),t.qZA()(),t.YNc(7,D,4,4,"p",13),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.limitText(e.timelyReport.name)),t.xp6(3),t.hij(" ",e.getDateType(e.timelyReport)," "),t.xp6(1),t.Q6J("ngIf",e.getFilter(e.timelyReport))}}function I(n,i){if(1&n&&(t.TgZ(0,"p",12)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.getFilter(e.report)," ")}}function N(n,i){if(1&n&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.TgZ(2,"span",11),t._uU(3),t.qZA(),t.TgZ(4,"p",12)(5,"span"),t._uU(6),t.qZA()(),t.YNc(7,I,4,4,"p",13),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.limitText(e.report.name)),t.xp6(3),t.hij(" ",e.getDateType(e.report)," "),t.xp6(1),t.Q6J("ngIf",e.getFilter(e.report))}}function Q(n,i){if(1&n&&(t.TgZ(0,"p",12)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.getProductFilter(e.productReport)," ")}}function w(n,i){if(1&n&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.TgZ(2,"span",11),t._uU(3),t.qZA(),t.TgZ(4,"p",12)(5,"span"),t._uU(6),t.qZA()(),t.YNc(7,Q,4,4,"p",13),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.limitText(e.productReport.name)),t.xp6(3),t.hij(" ",e.getDateType(e.productReport)," "),t.xp6(1),t.Q6J("ngIf",e.getProductFilter(e.productReport))}}function E(n,i){if(1&n&&(t.TgZ(0,"p",12)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n){const e=t.oxw(2);t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.getCategoryFilter(e.categoryReport)," ")}}function k(n,i){if(1&n&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.TgZ(2,"span",11),t._uU(3),t.qZA(),t.TgZ(4,"p",12)(5,"span"),t._uU(6),t.qZA()(),t.YNc(7,E,4,4,"p",13),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(e.limitText(e.categoryReport.name)),t.xp6(3),t.hij(" ",e.getDateType(e.categoryReport)," "),t.xp6(1),t.Q6J("ngIf",e.getCategoryFilter(e.categoryReport))}}let Y=(()=>{class n{constructor(e,o,r,s,c){var p=this;this.reportService=e,this.translateService=o,this.userService=r,this.navCtrl=s,this.analyticsService=c,this.reload=(0,g.Z)(function*(){p.timelyReport=yield p.reportService.getCustomReport(1,"timely-report"),p.report=yield p.reportService.getCustomReport(1,"customer-report"),p.categoryReport=yield p.reportService.getCustomReport(1,"category-report"),p.productReport=yield p.reportService.getCustomReport(1,"product-report")}),this.navCtrl.unsubscribe("reloadReportList",this.reload),this.navCtrl.subscribe("reloadReportList",this.reload),this.navCtrl.unsubscribe("reloadTimelyReportList",this.reload),this.navCtrl.subscribe("reloadTimelyReportList",this.reload)}ionViewWillEnter(){var e=this;return(0,g.Z)(function*(){yield e.analyticsService.setCurrentScreen("report-home")})()}ngOnInit(){this.reload()}dateFormat(e){return d.C.toUiString(e)}limitText(e,o=200){return f.W.limitText(e,o)}selectTimelyReport(){this.timelyReport?this.navCtrl.push("/timely-report/detail",{id:1}):this.navCtrl.push("/timely-report/add")}selectCustomerReport(){this.report?this.navCtrl.push("/report/detail",{id:this.report.id}):this.navCtrl.push("/report/add")}selectCategoryReport(){this.categoryReport?this.navCtrl.push("/category-report/detail",{id:this.categoryReport.id}):this.navCtrl.push("/category-report/add")}selectProductReport(){this.productReport?this.navCtrl.push("/product-report/detail",{id:this.productReport.id}):this.navCtrl.push("/product-report/add")}getDateType(e){return 0==e.dateType?this.translateService.instant("report-category.by-week"):1==e.dateType?this.translateService.instant("report-category.by-month"):2==e.dateType?this.translateService.instant("report-category.by-year"):3==e.dateType?this.translateService.instant("report-category.by-day"):4==e.dateType?this.translateService.instant("report-category.custom"):5==e.dateType?this.translateService.instant("report-category.by-quarter"):""}getFilter(e){let o="";return 1==e.genderType?o=this.translateService.instant("contact-add.gender-male"):2==e.genderType&&(o=this.translateService.instant("contact-add.gender-female")),1==e.ageType?(""!=o&&(o+="; "),o+=this.translateService.instant("report-output.year-from-to",{ageFrom:e.ageFrom,ageTo:e.ageTo})):2==e.ageType&&(""!=o&&(o+="; "),o+=this.translateService.instant("report-output.age-from-to",{ageFrom:e.ageFrom,ageTo:e.ageTo})),(0!=e.contactListType||0!=e.ignoreContact)&&(""!=o&&(o+="; "),o+=this.translateService.instant("report-output.contact-limited")),o}getCategoryFilter(e){let o="";return(0!=e.categoryListType||0!=e.ignoreCategory)&&(""!=o&&(o+="; "),o+=this.translateService.instant("report-category.category-limited")),o}getProductFilter(e){let o="";return(0!=e.productListType||0!=e.ignoreProduct)&&(""!=o&&(o+="; "),o+=this.translateService.instant("report-output.product-limited")),o}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(_.r),t.Y36(u.sK),t.Y36(R.K),t.Y36(x.G),t.Y36(U.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["report-home"]],decls:39,vars:21,consts:[["slot","start"],["menu","first"],["color","primary",3,"click"],["name","home"],[3,"click"],["slot","start","name","calendar"],[1,"ion-text-wrap"],[4,"ngIf"],["slot","start","name","people"],["slot","start","name","cart"],["slot","start","name","folder"],[2,"white-space","pre-wrap"],[2,"padding-top","5px"],["style","padding-top: 5px;",4,"ngIf"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button",1),t.TgZ(4,"ion-button",2),t.NdJ("click",function(){return o.navCtrl.home()}),t._UZ(5,"ion-icon",3),t.qZA()(),t.TgZ(6,"ion-title"),t._uU(7),t.ALo(8,"translate"),t.qZA()()(),t.TgZ(9,"ion-content")(10,"ion-list")(11,"ion-item",4),t.NdJ("click",function(){return o.selectTimelyReport()}),t._UZ(12,"ion-icon",5),t.TgZ(13,"ion-label",6)(14,"span"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.YNc(17,F,8,3,"span",7),t.qZA()(),t.TgZ(18,"ion-item",4),t.NdJ("click",function(){return o.selectCustomerReport()}),t._UZ(19,"ion-icon",8),t.TgZ(20,"ion-label",6)(21,"span"),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.YNc(24,N,8,3,"span",7),t.qZA()(),t.TgZ(25,"ion-item",4),t.NdJ("click",function(){return o.selectProductReport()}),t._UZ(26,"ion-icon",9),t.TgZ(27,"ion-label",6)(28,"span"),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.YNc(31,w,8,3,"span",7),t.qZA()(),t.TgZ(32,"ion-item",4),t.NdJ("click",function(){return o.selectCategoryReport()}),t._UZ(33,"ion-icon",10),t.TgZ(34,"ion-label",6)(35,"span"),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.YNc(38,k,8,3,"span",7),t.qZA()()()()),2&e&&(t.xp6(7),t.Oqu(t.lcZ(8,11,"report.title-all")),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(6),t.Oqu(t.lcZ(16,13,"report-detail.timely-report-title")),t.xp6(2),t.Q6J("ngIf",o.timelyReport),t.xp6(5),t.Oqu(t.lcZ(23,15,"report.title")),t.xp6(2),t.Q6J("ngIf",o.report),t.xp6(5),t.Oqu(t.lcZ(30,17,"report-product.title")),t.xp6(2),t.Q6J("ngIf",o.productReport),t.xp6(5),t.Oqu(t.lcZ(37,19,"report-category.title")),t.xp6(2),t.Q6J("ngIf",o.categoryReport))},dependencies:[m.O5,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.Q$,a.q_,a.fG,a.wd,a.sr,u.X$],encapsulation:2}),n})();var C=l(1464),b=l(3363),H=l(4013),P=l(3989),L=l(266),v=l(5439),G=l(4433),j=l(7060),q=l(4155);const K=["chart"];function $(n,i){if(1&n&&(t.TgZ(0,"p",8)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.filter," ")}}function W(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-select",21),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.barChartType=r)}),t.TgZ(5,"ion-select-option",22),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"ion-select-option",23),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"ion-select-option",24),t._uU(12),t.ALo(13,"translate"),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"common.chart")),t.xp6(2),t.Q6J("ngModel",e.barChartType),t.xp6(2),t.Oqu(t.lcZ(7,7,"common.bar")),t.xp6(3),t.Oqu(t.lcZ(10,9,"common.pie")),t.xp6(3),t.Oqu(t.lcZ(13,11,"common.line"))}}function B(n,i){if(1&n&&t._UZ(0,"canvas",25,26),2&n){const e=t.oxw();t.Q6J("hidden",e.isCapturing)("datasets",e.barChartData)("labels",e.barChartLabels)("options",e.barChartOptions)("legend",e.barChartLegend)("type",e.barChartType)}}const J=function(n,i,e){return[n,i,"symbol","1.0-2",e]};function V(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item",27),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.selectReport(s))}),t.TgZ(2,"ion-label",7)(3,"ion-text",10),t._uU(4),t.ALo(5,"currency"),t.qZA(),t.TgZ(6,"p"),t._uU(7),t.qZA()(),t.TgZ(8,"ion-avatar",2),t._UZ(9,"img",28),t.qZA()()()}if(2&n){const e=i.$implicit,o=t.oxw();t.xp6(3),t.s9C("color",e.value>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.value>=0?"+":"","",t.G7q(5,5,t.kEZ(11,J,e.value,o.currency,o.translateService.currentLang)),""),t.xp6(3),t.Oqu(e.contact.fullName),t.xp6(2),t.Q6J("src",o.contactImageOrPlaceholder(e.contact),t.LSH)}}let X=(()=>{class n{constructor(e,o,r,s,c,p,Z,gt,ht){this.navCtrl=e,this.translateService=o,this.userService=r,this.file=s,this.reportService=c,this.actionSheetCtrl=p,this.alertCtrl=Z,this.excelService=gt,this.analyticsService=ht,this.params=null,this.isCapturing=!1,this.report=new L.y,this.contactReports=[],this.totalContact=0,this.totalValue=0,this.dateType="",this.dateFrom="",this.dateTo="",this.filter="",this.currentMoment=v(),this.barChartOptions={scaleShowVerticalLines:!1,responsive:!0,bezierCurve:!1,onAnimationComplete:this.done},this.barChartLabels=[""],this.barChartType="bar",this.barChartLegend=!0,this.barChartData=[{data:[0]}],this.isInChartMode=!1,this.isLoadingChart=!1;const M=_t=>{this.report&&_t.detail.id===this.report.id&&this.reload()};this.navCtrl.unsubscribe("reloadReport",M),this.navCtrl.subscribe("reloadReport",M)}done(){}ionViewWillEnter(){var e=this;return(0,g.Z)(function*(){yield e.analyticsService.setCurrentScreen("report-detail")})()}ngOnInit(){this.reload()}reload(){var e=this;return(0,g.Z)(function*(){e.currency=yield e.userService.getAttr("current-currency"),e.params=e.navCtrl.getParams(e.params),e.params&&e.params.id&&e.params.id>0?e.reportService.getCustomReport(e.params.id,"customer-report").then(r=>{e.report=r,e.doCalculate()}):e.params&&e.params.templateReport&&(e.report=e.params.templateReport,e.doCalculate())})()}doCalculate(){this.isLoadingChart=!0,this.reportService.calculateReport(this.report,this.currentMoment).then(e=>{this.contactReports=e.reports,this.totalContact=e.totalItem,this.totalValue=e.totalValue,this.dateType=e.dateType,this.dateFrom=e.dateFrom,this.dateTo=e.dateTo,this.filter=e.filter,this.showChart(),this.isInChartMode=!0,this.isLoadingChart=!1})}contactImageOrPlaceholder(e){return f.W.contactImageOrPlaceholder(e.avatarUrl)}edit(){this.navCtrl.push("/report/add",{id:this.report.id})}presentActionSheet(){var e=this;return(0,g.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("report-detail.delete-report"),role:"destructive",handler:()=>{e.deleteReport()}},{text:e.translateService.instant("report-detail.share"),role:"destructive",handler:()=>{e.shareReport()}},{text:e.translateService.instant("export.export-to-excel"),handler:()=>{e.exportExcel()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}deleteReport(){var e=this;return(0,g.Z)(function*(){yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report-detail.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{e.reportService.deleteReport(e.report).then((0,g.Z)(function*(){e.analyticsService.logEvent("report-detail-delete-success"),e.navCtrl.publish("reloadReportList"),e.navCtrl.pop()}))}},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}showChart(){const e={label:"",data:[]},o=[];for(const r of this.contactReports)o.push(r.contact.fullName),e.data.push(r.value);this.barChartLabels=o,this.barChartData=[e]}enableChart(){this.isInChartMode=!this.isInChartMode}selectReport(e){this.navCtrl.push("/contact/detail",{id:e.contactId,tab:"trade",dateFrom:d.C.toDbString(this.dateFrom,d.C.getUiDateFormat()),dateTo:d.C.toDbString(this.dateTo,d.C.getUiDateFormat())})}previousMoment(){this.currentMoment=v(this.currentMoment).subtract(1,d.C.dateTypeToDuration(this.report.dateType)),this.doCalculate()}nextMoment(){this.currentMoment=v(this.currentMoment).add(1,d.C.dateTypeToDuration(this.report.dateType)),this.doCalculate()}viewTrend(){const e=new P.k;e.dataType=0,e.dateType=this.report.dateType,3!=e.dateType&&4!=e.dateType&&(e.dateFrom=v().startOf("year").format(d.C.getDbFormat())),e.dateTo=v().endOf("day").format(d.C.getDbFormat()),e.dataSources=JSON.stringify([this.report]),this.reportService.calculateChart(e).then(o=>{this.navCtrl.push("/chart/detail",{chart:e,data:o})})}shareReport(){this.isCapturing=!0,this.chartImg=this.chart.nativeElement.toDataURL(),this.userService.shareScreenshot().then(()=>{this.isCapturing=!1}).catch(()=>{this.isCapturing=!1})}exportExcel(){var e=this;const o=new H.m;let r=new b._;if(r.addColumn(new C.d(this.translateService.instant("report.title"))),o.addRow(r),this.dateFrom&&this.dateTo){r=new b._;const c=this.translateService.instant("common.from"),p=this.translateService.instant("common.to");r.addColumn(new C.d(`${this.dateType} ${c} ${this.dateFrom} ${p} ${this.dateTo}`)),o.addRow(r)}r=new b._,r.addColumn(new C.d(this.translateService.instant("export.contact"))),r.addColumn(new C.d(this.translateService.instant("export.money"))),r.addColumn(new C.d(this.translateService.instant("export.unit"))),o.addRow(r);for(const c of this.contactReports)r=new b._,r.addColumn(new C.d(c.contact.fullName)),r.addColumn(new C.d(c.value,"number")),r.addColumn(new C.d(this.currency)),o.addRow(r);const s="customer-report-"+this.report.id+"-"+f.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(o,s).then(function(){var c=(0,g.Z)(function*(p){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+s,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,p))});return function(p){return c.apply(this,arguments)}}())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.G),t.Y36(u.sK),t.Y36(R.K),t.Y36(G.$),t.Y36(_.r),t.Y36(a.BX),t.Y36(a.Br),t.Y36(j.x),t.Y36(U.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["report-detail"]],viewQuery:function(e,o){if(1&e&&t.Gf(K,7),2&e){let r;t.iGM(r=t.CRH())&&(o.chart=r.first)}},decls:52,vars:53,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","stats-chart"],["name","ellipsis-vertical"],[1,"ion-text-wrap"],[2,"padding-top","5px"],["style","padding-top: 5px;",4,"ngIf"],[3,"color"],["fill","outline",3,"disabled","click"],["name","chevron-back"],["name","chevron-forward"],["fill","outline",3,"click"],["name","trending-up"],[4,"ngIf"],[3,"hidden"],[3,"hidden","src"],["baseChart","",3,"hidden","datasets","labels","options","legend","type",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],["value","bar"],["value","pie"],["value","line"],["baseChart","",3,"hidden","datasets","labels","options","legend","type"],["chart",""],[3,"click"],[3,"src"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",3),t.NdJ("click",function(){return o.enableChart()}),t._UZ(11,"ion-icon",5),t.qZA(),t.TgZ(12,"ion-button",3),t.NdJ("click",function(){return o.presentActionSheet()}),t._UZ(13,"ion-icon",6),t.qZA()()()(),t.TgZ(14,"ion-content")(15,"ion-list")(16,"ion-item")(17,"ion-label",7)(18,"b"),t._uU(19),t.qZA(),t.TgZ(20,"ion-text",8)(21,"span"),t._uU(22),t.ALo(23,"translate"),t.ALo(24,"translate"),t.qZA()(),t._UZ(25,"br"),t.YNc(26,$,4,4,"p",9),t.TgZ(27,"p",8)(28,"ion-text",10),t._uU(29),t.ALo(30,"translate"),t.ALo(31,"currency"),t.qZA(),t._uU(32),t.ALo(33,"translate"),t.qZA()()(),t.TgZ(34,"ion-item")(35,"ion-button",11),t.NdJ("click",function(){return o.previousMoment()}),t._UZ(36,"ion-icon",12),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.TgZ(39,"ion-button",11),t.NdJ("click",function(){return o.nextMoment()}),t._uU(40),t.ALo(41,"translate"),t._UZ(42,"ion-icon",13),t.qZA(),t.TgZ(43,"ion-button",14),t.NdJ("click",function(){return o.viewTrend()}),t._UZ(44,"ion-icon",15),t._uU(45),t.ALo(46,"translate"),t.qZA()(),t.YNc(47,W,14,13,"ion-item",16),t.TgZ(48,"div",17),t._UZ(49,"img",18),t.YNc(50,B,2,6,"canvas",19),t.qZA(),t.YNc(51,V,10,15,"ion-item-sliding",20),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,27,"report-detail.title")),t.xp6(9),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(5),t.Oqu(o.report.name),t.xp6(3),t.xDo(" ",o.dateType," (",t.lcZ(23,29,"common.from")," ",o.dateFrom," ",t.lcZ(24,31,"common.to")," ",o.dateTo,") "),t.xp6(4),t.Q6J("ngIf",o.filter),t.xp6(2),t.s9C("color",o.totalValue>=0?"secondary":"danger"),t.xp6(1),t.lnq(" ",t.lcZ(30,33,"common.total"),": ",o.totalValue>=0?"+":"","",t.G7q(31,35,t.kEZ(49,J,o.totalValue,o.currency,o.translateService.currentLang))," "),t.xp6(3),t.AsE(" / ",o.totalContact," ",t.lcZ(33,41,"report-detail.contacts"),". "),t.xp6(3),t.Q6J("disabled",o.isLoadingChart),t.xp6(2),t.hij("\xa0 ",t.lcZ(38,43,"report-detail.pre")," "),t.xp6(2),t.Q6J("disabled",o.isLoadingChart),t.xp6(1),t.hij(" ",t.lcZ(41,45,"report-detail.next"),"\xa0 "),t.xp6(5),t.hij(" ",t.lcZ(46,47,"report-detail.view-trend")," "),t.xp6(2),t.Q6J("ngIf",o.isInChartMode),t.xp6(1),t.Q6J("hidden",!o.isInChartMode),t.xp6(1),t.Q6J("hidden",!o.isCapturing)("src",o.chartImg,t.LSH),t.xp6(1),t.Q6J("ngIf",!o.isLoadingChart),t.xp6(1),t.Q6J("ngForOf",o.contactReports))},dependencies:[m.sg,m.O5,h.JJ,h.On,a.BJ,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.td,a.Q$,a.q_,a.t9,a.n0,a.yW,a.wd,a.sr,a.QI,a.cs,q.jh,m.H9,u.X$],encapsulation:2}),n})();var z=l(8007);function tt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"date-item",12),t.NdJ("dateChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.report.dateFrom=r)}),t.ALo(1,"translate"),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("date",e.report.dateFrom)("label",t.lcZ(1,2,"report-category-add.start-date"))}}function et(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"date-item",13),t.NdJ("dateChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.report.dateTo=r)}),t.ALo(1,"translate"),t.qZA()}if(2&n){const e=t.oxw();t.Q6J("date",e.report.dateTo)("label",t.lcZ(1,2,"report-category-add.end-date"))}}function ot(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.showSearchContact())}),t._UZ(4,"ion-icon",15),t._uU(5),t.ALo(6,"translate"),t.qZA()()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"report-add.list"),": "),t.xp6(4),t.hij(" ",t.lcZ(6,4,"report-add.add")," "))}function nt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.removeSelectedContact(s))}),t._UZ(4,"ion-icon",16),t._uU(5),t.ALo(6,"translate"),t.qZA()()}if(2&n){const e=i.$implicit;t.xp6(2),t.Oqu(e.fullName),t.xp6(3),t.hij(" ",t.lcZ(6,2,"report-add.remove")," ")}}function rt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.showSearchContact(!1))}),t._UZ(4,"ion-icon",15),t._uU(5),t.ALo(6,"translate"),t.qZA()()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"report-add.list"),": "),t.xp6(4),t.hij(" ",t.lcZ(6,4,"report-add.add")," "))}function at(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){const s=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.removeIgnoredContact(s))}),t._UZ(4,"ion-icon",16),t._uU(5),t.ALo(6,"translate"),t.qZA()()}if(2&n){const e=i.$implicit;t.xp6(2),t.Oqu(e.fullName),t.xp6(3),t.hij(" ",t.lcZ(6,2,"report-add.remove")," ")}}function it(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",5),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",17),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.report.ageFrom=r)}),t.ALo(5,"translate"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"report-add.from-year")),t.xp6(2),t.s9C("placeholder",t.lcZ(5,5,"report-add.enter-from-year")),t.Q6J("ngModel",e.report.ageFrom)}}function st(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",5),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",17),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.report.ageTo=r)}),t.ALo(5,"translate"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"report-add.to-year")),t.xp6(2),t.s9C("placeholder",t.lcZ(5,5,"report-add.enter-to-year")),t.Q6J("ngModel",e.report.ageTo)}}function lt(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",5),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",17),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.report.ageFrom=r)}),t.ALo(5,"translate"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"report-add.from-age")),t.xp6(2),t.s9C("placeholder",t.lcZ(5,5,"report-add.enter-from-age")),t.Q6J("ngModel",e.report.ageFrom)}}function ct(n,i){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",5),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",17),t.NdJ("ngModelChange",function(r){t.CHM(e);const s=t.oxw();return t.KtG(s.report.ageTo=r)}),t.ALo(5,"translate"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,3,"report-add.to-age")),t.xp6(2),t.s9C("placeholder",t.lcZ(5,5,"report-add.enter-to-year")),t.Q6J("ngModel",e.report.ageTo)}}const pt=[{path:"",component:Y},{path:"detail",component:X},{path:"add",component:(()=>{class n{constructor(e,o,r,s){this.navCtrl=e,this.modalCtrl=o,this.reportService=r,this.analyticsService=s,this.params=null,this.report=new L.y,this.selectedContacts=[],this.ignoredContacts=[]}ionViewWillEnter(){var e=this;return(0,g.Z)(function*(){yield e.analyticsService.setCurrentScreen("report-add")})()}ngOnInit(){let e=0;this.params=this.navCtrl.getParams(this.params),this.params&&this.params.id&&(e=this.params.id),e&&e>0&&this.reportService.getCustomReport(e,"customer-report").then(o=>{this.report=o,o.contactListCustom&&""!==o.contactListCustom&&(this.selectedContacts=JSON.parse(o.contactListCustom)),o.ignoredContacts&&""!==o.ignoredContacts&&(this.ignoredContacts=JSON.parse(o.ignoredContacts))})}save(){var e=this;this.reportService.saveCustomReport(this.report,"customer-report").then(function(){var o=(0,g.Z)(function*(r){e.analyticsService.logEvent("report-add-save-success"),e.report.id=r,e.exitPage()});return function(r){return o.apply(this,arguments)}}())}exitPage(){var e=this;return(0,g.Z)(function*(){yield e.navCtrl.popOnly(),(!e.params||!e.params.id)&&(yield e.navCtrl.push("/report/detail",{id:e.report.id})),e.navCtrl.publish("reloadReportList"),e.navCtrl.publish("reloadReport",e.report)})()}showSearchContact(e=!0){var o=this;return(0,g.Z)(function*(){o.navCtrl.push("/contact",{callback:s=>{const c=s;if(c)if(e){if(o.selectedContacts.findIndex(Z=>Z.id===c.id)>=0)return;o.selectedContacts.push(c),o.report.contactListCustom=JSON.stringify(o.selectedContacts)}else{if(o.ignoredContacts.findIndex(Z=>Z.id===c.id)>=0)return;o.ignoredContacts.push(c),o.report.ignoredContacts=JSON.stringify(o.ignoredContacts)}},searchMode:!0})})()}removeIgnoredContact(e){const o=this.ignoredContacts.findIndex(r=>r.id===e.id);o>=0&&(this.ignoredContacts.splice(o,1),this.report.ignoredContacts=JSON.stringify(this.ignoredContacts))}removeSelectedContact(e){const o=this.selectedContacts.findIndex(r=>r.id===e.id);o>=0&&(this.selectedContacts.splice(o,1),this.report.contactListCustom=JSON.stringify(this.selectedContacts))}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(x.G),t.Y36(a.IN),t.Y36(_.r),t.Y36(U.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["report-add"]],decls:97,vars:102,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","checkmark"],["color","primary"],[3,"ngModel","ngModelChange"],[3,"value"],["pickerId","reportDateFromPicker2",3,"date","label","dateChange",4,"ngIf"],["pickerId","reportDateEndPicker2",3,"date","label","dateChange",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["pickerId","reportDateFromPicker2",3,"date","label","dateChange"],["pickerId","reportDateEndPicker2",3,"date","label","dateChange"],["fill","outline","slot","end",3,"click"],["name","add"],["name","remove"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item")(15,"ion-label",5),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-select",6),t.NdJ("ngModelChange",function(s){return o.report.dateType=s}),t.TgZ(19,"ion-select-option",7),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-select-option",7),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"ion-select-option",7),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"ion-select-option",7),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-select-option",7),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"ion-select-option",7),t._uU(35),t.ALo(36,"translate"),t.qZA()()(),t.YNc(37,tt,2,4,"date-item",8),t.YNc(38,et,2,4,"date-item",9),t.TgZ(39,"ion-item")(40,"ion-label",5),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-select",6),t.NdJ("ngModelChange",function(s){return o.report.contactListType=s}),t.TgZ(44,"ion-select-option",7),t._uU(45),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ion-select-option",7),t._uU(48),t.ALo(49,"translate"),t.qZA()()(),t.YNc(50,ot,7,6,"ion-item",10),t.YNc(51,nt,7,4,"ion-item",11),t.TgZ(52,"ion-item")(53,"ion-label",5),t._uU(54),t.ALo(55,"translate"),t.qZA(),t.TgZ(56,"ion-select",6),t.NdJ("ngModelChange",function(s){return o.report.ignoreContact=s}),t.TgZ(57,"ion-select-option",7),t._uU(58),t.ALo(59,"translate"),t.qZA(),t.TgZ(60,"ion-select-option",7),t._uU(61),t.ALo(62,"translate"),t.qZA()()(),t.YNc(63,rt,7,6,"ion-item",10),t.YNc(64,at,7,4,"ion-item",11),t.TgZ(65,"ion-item")(66,"ion-label",5),t._uU(67),t.ALo(68,"translate"),t.qZA(),t.TgZ(69,"ion-select",6),t.NdJ("ngModelChange",function(s){return o.report.genderType=s}),t.TgZ(70,"ion-select-option",7),t._uU(71),t.ALo(72,"translate"),t.qZA(),t.TgZ(73,"ion-select-option",7),t._uU(74),t.ALo(75,"translate"),t.qZA(),t.TgZ(76,"ion-select-option",7),t._uU(77),t.ALo(78,"translate"),t.qZA()()(),t.TgZ(79,"ion-item")(80,"ion-label",5),t._uU(81),t.ALo(82,"translate"),t.qZA(),t.TgZ(83,"ion-select",6),t.NdJ("ngModelChange",function(s){return o.report.ageType=s}),t.TgZ(84,"ion-select-option",7),t._uU(85),t.ALo(86,"translate"),t.qZA(),t.TgZ(87,"ion-select-option",7),t._uU(88),t.ALo(89,"translate"),t.qZA(),t.TgZ(90,"ion-select-option",7),t._uU(91),t.ALo(92,"translate"),t.qZA()()(),t.YNc(93,it,6,7,"ion-item",10),t.YNc(94,st,6,7,"ion-item",10),t.YNc(95,lt,6,7,"ion-item",10),t.YNc(96,ct,6,7,"ion-item",10),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,56,"report-add.title")),t.xp6(5),t.hij(" \xa0",t.lcZ(11,58,"action.save")," "),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(4),t.Oqu(t.lcZ(17,60,"report-category-add.date-range")),t.xp6(2),t.Q6J("ngModel",o.report.dateType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(21,62,"report-category.by-week")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(24,64,"report-category.by-month")),t.xp6(2),t.Q6J("value",2),t.xp6(1),t.Oqu(t.lcZ(27,66,"report-category.by-year")),t.xp6(2),t.Q6J("value",3),t.xp6(1),t.Oqu(t.lcZ(30,68,"report-category.by-day")),t.xp6(2),t.Q6J("value",5),t.xp6(1),t.Oqu(t.lcZ(33,70,"report-category.by-quarter")),t.xp6(2),t.Q6J("value",4),t.xp6(1),t.Oqu(t.lcZ(36,72,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",4===o.report.dateType),t.xp6(1),t.Q6J("ngIf",4===o.report.dateType),t.xp6(3),t.Oqu(t.lcZ(42,74,"report-add.select-contact")),t.xp6(2),t.Q6J("ngModel",o.report.contactListType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(46,76,"report-category-add.all")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(49,78,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",1===o.report.contactListType),t.xp6(1),t.Q6J("ngForOf",o.selectedContacts),t.xp6(3),t.Oqu(t.lcZ(55,80,"report-add.ignore-contact")),t.xp6(2),t.Q6J("ngModel",o.report.ignoreContact),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(59,82,"report-category-add.none")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(62,84,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",1===o.report.ignoreContact),t.xp6(1),t.Q6J("ngForOf",o.ignoredContacts),t.xp6(3),t.Oqu(t.lcZ(68,86,"report-add.gender")),t.xp6(2),t.Q6J("ngModel",o.report.genderType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(72,88,"report-category-add.all")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(75,90,"contact-add.gender-male")),t.xp6(2),t.Q6J("value",2),t.xp6(1),t.Oqu(t.lcZ(78,92,"contact-add.gender-female")),t.xp6(4),t.Oqu(t.lcZ(82,94,"report-add.age-range")),t.xp6(2),t.Q6J("ngModel",o.report.ageType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(86,96,"report-category-add.all")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(89,98,"report-add.by-year")),t.xp6(2),t.Q6J("value",2),t.xp6(1),t.Oqu(t.lcZ(92,100,"report-add.by-age")),t.xp6(2),t.Q6J("ngIf",1===o.report.ageType),t.xp6(1),t.Q6J("ngIf",1===o.report.ageType),t.xp6(1),t.Q6J("ngIf",2===o.report.ageType),t.xp6(1),t.Q6J("ngIf",2===o.report.ageType))},dependencies:[m.sg,m.O5,h.JJ,h.On,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.t9,a.n0,a.wd,a.sr,a.as,a.QI,a.cs,z.p,u.X$],encapsulation:2}),n})()}];let dt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[T.Bz.forChild(pt),T.Bz]}),n})();var S=l(3093),mt=l(2216);let ut=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({providers:[q.fY,{provide:q.$g,useValue:{generateColors:!1}}],imports:[m.ez,h.u5,a.Pc,dt,S.m,mt.uH,q.vQ,u.aw.forChild({loader:{provide:u.Zw,useFactory:S.x,deps:[A.eN]}})]}),n})()},8851:(O,y,l)=>{l.d(y,{L:()=>g});var m=l(6738),h=l(5439),u=l(1914),A=l(4006),T=l(191);let g=(()=>{class d{constructor(){this.min=null,this.max=null,this.pickerId=null,this.date="",this.type="date",this.dateChange=new m.vpe}ionViewWillEnter(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?h(this.date.split(":00Z").join("")).format(u.C.getDateTimeDbFormat()):h(this.date.split(":00Z").join("")).format(u.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}ngOnInit(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?h(this.date.split(":00Z").join("")).format(u.C.getDateTimeDbFormat()):h(this.date.split(":00Z").join("")).format(u.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}change(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?h(this.date.split(":00Z").join("")).format(u.C.getDateTimeDbFormat()):h(this.date.split(":00Z").join("")).format(u.C.getDateDbFormat()):this.date,this.dateChange.emit(this.date)}}return d.\u0275fac=function(t){return new(t||d)},d.\u0275cmp=m.Xpm({type:d,selectors:[["date-picker"]],inputs:{min:"min",max:"max",pickerId:"pickerId",date:"date",type:"type"},outputs:{dateChange:"dateChange"},decls:1,vars:4,consts:[["color","primary",1,"ion-button",2,"font-size","0.8em",3,"type","ngModel","min","max","ngModelChange","ionChange"]],template:function(t,_){1&t&&(m.TgZ(0,"ion-input",0),m.NdJ("ngModelChange",function(x){return _.date=x})("ionChange",function(){return _.change()}),m.qZA()),2&t&&m.Q6J("type",_.type)("ngModel",_.date)("min",_.min)("max",_.max)},dependencies:[A.JJ,A.On,T.pK,T.j9],encapsulation:2}),d})()}}]);