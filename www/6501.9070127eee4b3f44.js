"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6501],{8257:(V,w,f)=>{f.d(w,{r:()=>d});var u=f(6900);class d{constructor(y=0,L="",J="",P="",U=!1){this.id=0,this.code="",this.staffId=0,this.businessTypeId=0,this.salesLineId=0,this.avatarUrl="",this.fullName="",this.mobile="",this.isImportant=!1,this.gender="",this.email="",this.address="",this.dateOfBirth="",this.lastActive="",this.lastAction="",this.onlineId=0,this.staff=new u.O,this.businessType=null,this.salesLine=null,this.point=0,this.levelId=0,this.level=null,this.buyCount=0,this.fbUserId=null,this.source=null,this.id=y,this.avatarUrl=L,this.fullName=J,this.mobile=P,this.isImportant=U}}},6900:(V,w,f)=>{f.d(w,{O:()=>u});class u{constructor(a=0,y="",L="",J=""){this.hourLimit=1,this.storeId=0,this.store=null,this.isCollaborator=!1,this.shiftId=0,this.shift=null,this.blockViewingQuantity=!1,this.id=0,this.avatarUrl="",this.name="",this.userName="",this.shopName="",this.createdAt="",this.hasFullAccess=!1,this.canCreateOrder=!1,this.canUpdateDeleteOrder=!1,this.canCreateNewTransaction=!1,this.canUpdateDeleteTransaction=!1,this.canCreateUpdateNote=!1,this.canCreateUpdateDebt=!1,this.canUpdateDeleteProduct=!1,this.canViewProductCostPrice=!1,this.canUpdateProductCostPrice=!1,this.canViewAllContacts=!1,this.canManageContacts=!1,this.updateStatusExceptDone=!1,this.blockEditingOrderPrice=!1,this.id=a,this.avatarUrl=y,this.name=L,this.userName=J}}},2733:(V,w,f)=>{f.r(w),f.d(w,{TransferNoteModule:()=>yn});var u=f(6895),d=f(4006),a=f(191),y=f(3306),L=f(529),J=f(3093),P=f(2216),U=f(3196),p=f(5861),C=f(1914),v=f(6723),t=f(6738),Z=f(5851),b=f(7488),l=f(667),x=f(6961),g=f(7696),M=f(323),z=f(6861),H=f(7613);const R=["barcodeInput"];function D(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-searchbar",23,24),t.NdJ("ionClear",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.clearSearch())})("ionChange",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.search())})("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.searchKey=o)})("ngModelChange",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.barcodeChanged())}),t.ALo(2,"translate"),t.qZA()}if(2&r){const e=t.oxw();t.s9C("placeholder",t.lcZ(2,2,"product-selector.filter-by-words")),t.Q6J("ngModel",e.searchKey)}}function ft(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.hij(" (",e.unit,")")}}function mt(r,s){if(1&r&&(t.TgZ(0,"span",36),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.lnq("",t.lcZ(2,3,"product-selector.quantity-left"),": ",e.actualQuantity-e.actualExport>0?n.toFixQuantity(e.actualQuantity-e.actualExport):0," ",e.unit," ")}}function ht(r,s){if(1&r&&(t.TgZ(0,"ion-avatar",3),t._UZ(1,"img",37),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function gt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-grid",38)(1,"ion-row")(2,"ion-col")(3,"ion-label",39),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"money-input",40),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.unitPrice=o)})("moneyValueChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"ion-col")(9,"ion-label",39),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"ion-input",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.actualExport=o)})("ngModelChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(13,"translate"),t.qZA()(),t.TgZ(14,"ion-col")(15,"ion-label",39),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-input",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.actualImport=o)})("ngModelChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(19,"translate"),t.qZA()()(),t.TgZ(20,"ion-row")(21,"ion-col")(22,"ion-label",39),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"money-input",40),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.amount=o)}),t.ALo(26,"translate"),t.qZA()(),t.TgZ(27,"ion-col")(28,"ion-label",42),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-input",43),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.note=o)}),t.ALo(32,"translate"),t.qZA()()()()}if(2&r){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",t.lcZ(5,17,"transfer-note-add.product-unit-price")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(7,19,"order-add.enter-product-price")),t.Q6J("clear",!0)("moneyValue",e.unitPrice),t.xp6(4),t.hij(" ",t.lcZ(11,21,"transfer-note-add.product-export-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(13,23,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",e.actualExport),t.xp6(4),t.hij(" ",t.lcZ(17,25,"transfer-note-add.product-import-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(19,27,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",e.actualImport),t.xp6(5),t.hij(" ",t.lcZ(24,29,"transfer-note-add.product-total")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(26,31,"transfer-note-add.enter-product-total")),t.Q6J("clear",!0)("moneyValue",e.amount),t.xp6(4),t.hij("",t.lcZ(30,33,"transfer-note-add.product-note")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(32,35,"transfer-note-add.enter-product-note")),t.Q6J("ngModel",e.note)}}function xt(r,s){if(1&r){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item",25)(2,"ion-buttons")(3,"ion-button",26),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.expand(i))}),t._UZ(4,"fa-icon",27),t.qZA()(),t.TgZ(5,"ion-label",28)(6,"ion-text",29),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.increase(i))}),t._uU(7),t.YNc(8,ft,2,1,"span",21),t.qZA(),t._UZ(9,"br"),t.YNc(10,mt,3,5,"span",30),t.qZA(),t.YNc(11,ht,2,1,"ion-avatar",31),t.TgZ(12,"ion-buttons",3)(13,"ion-button",32),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.decrease(i))}),t._UZ(14,"ion-icon",33),t.qZA(),t.TgZ(15,"ion-button",32),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.increase(i))}),t._UZ(16,"ion-icon",34),t.qZA()()(),t.YNc(17,gt,33,37,"ion-grid",35),t.BQk()}if(2&r){const e=s.$implicit,n=t.oxw();t.xp6(4),t.s9C("icon",e.isExpand?"compress-arrows-alt":"expand-arrows-alt"),t.xp6(2),t.Udp("font-weight",e.actualExport>0?"bold":"normal"),t.Q6J("color",e.actualExport>0?"primary":"normal"),t.xp6(1),t.hij(" ",n.productName(e.code,e.title),""),t.xp6(1),t.Q6J("ngIf",e.unitsJson),t.xp6(2),t.Q6J("ngIf",!e.isService&&!e.isCombo),t.xp6(1),t.Q6J("ngIf",e.avatarUrl),t.xp6(6),t.Q6J("ngIf",e.actualExport)}}function Zt(r,s){1&r&&(t.TgZ(0,"ion-select-option",44),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"product.list-option-customer-price"),""))}function Tt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item",15)(1,"ion-label",45),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-buttons",3)(5,"ion-button",46),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.previousPage())}),t._UZ(6,"ion-icon",47),t.qZA(),t.TgZ(7,"ion-button",46),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.nextPage())}),t._UZ(8,"ion-icon",48),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"common.page")," ",e.currentPage+1," ")}}function Ct(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.hij(" (",e.unit,")")}}function At(r,s){if(1&r&&(t.TgZ(0,"span",36),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.lnq("",t.lcZ(2,3,"product-selector.quantity-left"),": ",e.actualQuantity-e.actualExport>0?n.toFixQuantity(e.actualQuantity-e.actualExport):0," ",e.unit," ")}}function vt(r,s){if(1&r&&(t.TgZ(0,"ion-avatar",3),t._UZ(1,"img",37),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function yt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-grid",51)(1,"ion-row")(2,"ion-col")(3,"ion-label",39),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"money-input",40),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.unitPrice=o)})("moneyValueChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(7,"translate"),t.qZA()(),t.TgZ(8,"ion-col")(9,"ion-label",39),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"ion-input",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.actualExport=o)})("ngModelChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(13,"translate"),t.qZA()(),t.TgZ(14,"ion-col")(15,"ion-label",39),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-input",41),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.actualImport=o)})("ngModelChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(19,"translate"),t.qZA()()(),t.TgZ(20,"ion-row")(21,"ion-col")(22,"ion-label",39),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"money-input",40),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.amount=o)}),t.ALo(26,"translate"),t.qZA()(),t.TgZ(27,"ion-col")(28,"ion-label",42),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-input",43),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.note=o)}),t.ALo(32,"translate"),t.qZA()()()()}if(2&r){const e=t.oxw().$implicit;t.xp6(4),t.hij(" ",t.lcZ(5,17,"transfer-note-add.product-unit-price")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(7,19,"order-add.enter-product-price")),t.Q6J("clear",!0)("moneyValue",e.unitPrice),t.xp6(4),t.hij(" ",t.lcZ(11,21,"transfer-note-add.product-export-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(13,23,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",e.actualExport),t.xp6(4),t.hij(" ",t.lcZ(17,25,"transfer-note-add.product-import-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(19,27,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",e.actualImport),t.xp6(5),t.hij(" ",t.lcZ(24,29,"transfer-note-add.product-total")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(26,31,"transfer-note-add.enter-product-total")),t.Q6J("clear",!0)("moneyValue",e.amount),t.xp6(4),t.hij("",t.lcZ(30,33,"transfer-note-add.product-note")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(32,35,"transfer-note-add.enter-product-note")),t.Q6J("ngModel",e.note)}}function St(r,s){if(1&r){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item",49)(2,"ion-buttons")(3,"ion-button",26),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.expand(i))}),t._UZ(4,"fa-icon",27),t.qZA()(),t.TgZ(5,"ion-label",28)(6,"ion-text",29),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.increase(i))}),t._uU(7),t.YNc(8,Ct,2,1,"span",21),t.qZA(),t._UZ(9,"br"),t.YNc(10,At,3,5,"span",30),t.qZA(),t.YNc(11,vt,2,1,"ion-avatar",31),t.TgZ(12,"ion-buttons",3)(13,"ion-button",32),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.decrease(i))}),t._UZ(14,"ion-icon",33),t.qZA(),t.TgZ(15,"ion-button",32),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.increase(i))}),t._UZ(16,"ion-icon",34),t.qZA()()(),t.YNc(17,yt,33,37,"ion-grid",50),t.BQk()}if(2&r){const e=s.$implicit,n=t.oxw();t.xp6(4),t.s9C("icon",e.isExpand?"compress-arrows-alt":"expand-arrows-alt"),t.xp6(2),t.Udp("font-weight",e.actualExport>0?"bold":"normal"),t.Q6J("color",e.actualExport>0?"primary":"normal"),t.xp6(1),t.hij(" ",n.productName(e.code,e.title),""),t.xp6(1),t.Q6J("ngIf",e.unitsJson),t.xp6(2),t.Q6J("ngIf",!e.isService&&!e.isCombo),t.xp6(1),t.Q6J("ngIf",e.avatarUrl),t.xp6(6),t.Q6J("ngIf",e.actualExport)}}function Nt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",45),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-buttons",3)(5,"ion-button",46),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.previousPage())}),t._UZ(6,"ion-icon",47),t.qZA(),t.TgZ(7,"ion-button",46),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.nextPage())}),t._UZ(8,"ion-icon",48),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"common.page")," ",e.currentPage+1," ")}}function bt(r,s){1&r&&(t.TgZ(0,"ion-item",52),t._UZ(1,"div",53),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"product-selector.no-product"),t.oJD))}let Mt=(()=>{class r{constructor(e,n,o,i,c,h,T,S,q){var m=this;this.navCtrl=e,this.userService=n,this.staffService=o,this.translateService=i,this.productService=c,this.contactService=h,this.analyticsService=T,this.planService=S,this.modalCtrl=q,this.products=[],this.selectedProducts=[],this.originalProducts=[],this.searchKey="",this.tab="all",this.start=0,this.end=19,this.pageSize=20,this.currentPage=0,this.listOption="all",this.checkProduct=0,this.currentPlan=null,this.reloadProducts=(0,p.Z)(function*(){m.currentPlan=yield m.planService.getCurrentPlan(),m.currentPlan||(m.checkProduct=yield m.planService.checkProduct(),m.checkProduct>=30&&(m.isOnTrial=yield m.planService.isOnTrial(m.currentPlan))),m.params=m.navCtrl.getParams(m.params),m.params&&m.params.callback&&(m.callback=m.params.callback),m.params&&m.params.exportStore&&(m.exportStore=m.params.exportStore),m.params&&m.params.contactId&&(m.contactId=m.params.contactId),m.params&&m.params.staffId&&(m.staffId=m.params.staffId);const E=yield m.navCtrl.loading();m.currency=yield m.userService.getAttr("current-currency"),m.selectedStaff=m.staffService.selectedStaff;const Y=m.exportStore&&!m.exportStore.isMainShop?m.exportStore.id:0;("all"===m.listOption?m.productService.getProducts(Y,0):"expiry"===m.listOption?m.productService.getProductsExpiry(Y,0):"quantity"===m.listOption?m.productService.getProductsQuantity(Y,0):Promise.resolve(null)).then(function(){var A=(0,p.Z)(function*(Q){let N=JSON.parse(JSON.stringify(Q));const F=[];for(const _ of N){if(F.push(_),_.units=_.unitsJson?JSON.parse(_.unitsJson):[],_.units&&_.units.length)for(const k of _.units){const I=JSON.parse(JSON.stringify(_));I.unit=k.unit,I.basicUnit=_.unit,I.unitExchange=k.exchange,I.price=k.price,I.count=Math.floor(_.count/k.exchange),F.push(I)}else _.unitsJson=null;_.units=null}if(N=F,N&&N.length)for(const _ of N)_.amount=0,_.actualQuantity=!m.exportStore||m.exportStore.isMainShop?_.count:_.storeQuantity?_.storeQuantity:0,_.actualImport=0,_.actualExport=0,_.unitPrice=_.price?_.price:_.costPrice;m.originalProducts=N,m.products=N,yield E.dismiss()});return function(Q){return A.apply(this,arguments)}}())}),this.navCtrl.removeEventListener("reloadNoteProductSelector",this.reloadProducts),this.navCtrl.addEventListener("reloadNoteProductSelector",this.reloadProducts)}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("note-product-selector")})()}tabChanged(){}barcodeChanged(){var e=this;return(0,p.Z)(function*(){!e.searchKey||e.searchKey.length<5||(e.analyticsService.logEvent("note-product-selector-barcode-entered"),e.productService.searchByBarcode(e.searchKey).then(n=>{if(!n)return;e.analyticsService.logEvent("note-product-selector-barcode-entered-ok");let o=e.originalProducts;if(o=o.filter(i=>i.id===n.id),o&&o.length)for(const i of o)e.increase(i);e.products=o}))})()}getProductsWithCustomerPrice(){var e=this;return(0,p.Z)(function*(){if(!e.contactId)return null;const n=yield e.contactService.getCustomerPricesByContact(e.contactId);if(!n||!n.length)return[];for(const o of n)o.product&&(o.product.costPrice=o.costPrice);return n.map(o=>o.product)})()}getProductsWithStaffPrice(){var e=this;return(0,p.Z)(function*(){if(!e.staffService.isStaff()&&!e.staffId)return null;const n=e.staffService.isStaff()?e.staffService.selectedStaff.id:e.staffId,o=yield e.contactService.getCustomerPricesByStaff(n);if(!o||!o.length)return[];for(const i of o)i.product&&(i.product.costPrice=i.costPrice);return o.map(i=>i.product)})()}getProductsWithCollaboratorPrice(){var e=this;return(0,p.Z)(function*(){if(!e.staffService.isStaff())return null;const n=yield e.contactService.getCollaboratorPrices();if(!n||!n.length)return[];for(const o of n)o.product&&(o.product.costPrice=o.costPrice);return n.map(o=>o.product)})()}reCalc(e){e.amount=e.actualExport*e.unitPrice}toFixQuantity(e){return v.W.toFixQuantity(e)}increase(e){var n=this;return(0,p.Z)(function*(){if(e.actualQuantity-e.actualExport<=0&&!e.isService&&!e.isCombo)return n.analyticsService.logEvent("transfer-product-selector-outstock-alert"),void alert(n.translateService.instant("transfer-note-add.outstock-alert"));n.selectedProducts.find(i=>i.id===e.id&&i.unit===e.unit)||n.selectedProducts.push(e),e.actualImport++,e.actualExport++,n.reCalc(e)})()}decrease(e){var n=this;return(0,p.Z)(function*(){if(e){if(e.actualImport&&e.actualImport>0&&e.actualImport--,e.actualExport&&e.actualExport>0&&e.actualExport--,n.analyticsService.logEvent("transfer-product-selector-decrease"),0===e.actualExport){const o=n.selectedProducts.findIndex(i=>i.id===e.id&&i.unit===e.unit);o>=0&&n.selectedProducts.splice(o,1),(!n.selectedProducts||!n.selectedProducts.length)&&"all"!==n.tab&&(n.tab="all",n.tabChanged())}n.reCalc(e)}})()}ngOnInit(){this.reloadProducts()}dateFormat(e){return C.C.toUiString(e)}search(){var e=this;return(0,p.Z)(function*(){e.analyticsService.logEvent("note-product-selector-search");let n=e.originalProducts;if(null!==e.searchKey&&""!==e.searchKey){e.start=0,e.end=19,e.currentPage=0;const o=e.searchKey.toLowerCase();n=n.filter(i=>i.title&&-1!==i.title.toLowerCase().indexOf(o)||i.code&&-1!==i.code.toLowerCase().indexOf(o))}e.products=n})()}clearSearch(){var e=this;return(0,p.Z)(function*(){e.start=0,e.end=19,e.currentPage=0,e.analyticsService.logEvent("note-product-selector-clear-search"),e.searchKey=null,e.products=e.originalProducts})()}dismiss(){var e=this;return(0,p.Z)(function*(){if(e.callback)return e.callback(null),void(yield e.navCtrl.back());e.modalCtrl.dismiss()})()}ok(){var e=this;return(0,p.Z)(function*(){if(e.analyticsService.logEvent("note-product-selector-ok"),e.callback)return e.callback(e.selectedProducts),void(yield e.navCtrl.back());e.modalCtrl.dismiss(e.selectedProducts)})()}productName(e,n){let i=v.W.productName(e,n);return!i||i.length<=100||(i=i.substr(0,100),i=i.substr(0,Math.min(i.length,i.lastIndexOf(" ")))+"..."),i}get isShowPaging(){return!!(this.products&&this.products.length>this.pageSize)}previousPage(){this.currentPage<=0?this.currentPage=0:(this.currentPage--,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1)}nextPage(){(this.currentPage+1)*this.pageSize>=this.products.length||(this.currentPage++,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1)}expand(e){var n=this;return(0,p.Z)(function*(){const o=!e.isExpand;for(const i of n.products)i.isExpand=!1;e.isExpand=o,o&&n.analyticsService.logEvent("note-product-selector-expand")})()}changeListOption(){this.start=0,this.end=19,this.currentPage=0,this.reloadProducts()}add(){if(!this.currentPlan&&this.checkProduct>=30&&!this.isOnTrial)return this.analyticsService.logEvent("check-product-alert"),void alert(this.translateService.instant("product.check-product-alert",{total:this.checkProduct}));this.navCtrl.push("/product/quick-add",{fromSearch:!0})}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(Z.G),t.Y36(b.K),t.Y36(l.x),t.Y36(y.sK),t.Y36(x.M),t.Y36(g.y),t.Y36(M.y),t.Y36(z.D),t.Y36(a.IN))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-product-selector"]],viewQuery:function(e,n){if(1&e&&t.Gf(R,5),2&e){let o;t.iGM(o=t.CRH())&&(n.barcodeInput=o.first)}},decls:56,vars:47,consts:[["slot","start"],[3,"click"],["name","close"],["slot","end"],["name","add"],["name","checkmark"],["color","primary",3,"ngModel","ngModelChange"],["value","all"],["value","selected"],["color","danger"],["autofocus","true","debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange",4,"ngIf"],[1,"ion-padding",2,"padding-top","5px","padding-bottom","0","margin-top","0","margin-bottom","0","font-size","0.8em"],[3,"hidden"],[4,"ngFor","ngForOf"],["size","6",1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],[2,"max-width","100% !important",3,"placeholder","ngModel","ngModelChange"],["value","expiry"],["value","quantity"],["value","customer-price",4,"ngIf"],["lines","none","class","ion-no-padding",4,"ngIf"],[4,"ngIf"],["text-wrap","",4,"ngIf"],["autofocus","true","debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],["barcodeInput",""],["text-wrap","",2,"--min-height","0"],["fill","clear","color","medium",3,"click"],[3,"icon"],[1,"ion-text-wrap"],[2,"padding","0",3,"color","click"],["style","font-size: 0.8em",4,"ngIf"],["slot","end",4,"ngIf"],["fill","clear","size","large",3,"click"],["slot","icon-only","size","large","name","remove"],["slot","icon-only","size","large","name","add"],["style","padding-left: 15px; padding-right: 15px; margin: 0;","color","light",4,"ngIf"],[2,"font-size","0.8em"],[3,"src"],["color","light",2,"padding-left","15px","padding-right","15px","margin","0"],["position","stacked","color","primary"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange"],["position","\n                        ","color","primary"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["value","customer-price"],[1,"ion-text-wrap","ion-text-right"],["fill","solid",3,"click"],["slot","icon-only","name","arrow-back-circle"],["slot","icon-only","name","arrow-forward-circle"],["text-wrap","","lines","none",2,"--min-height","0"],["style","padding-left: 15px; padding-right: 15px; margin: 0;","color","light","class","ion-no-padding",4,"ngIf"],["color","light",1,"ion-no-padding",2,"padding-left","15px","padding-right","15px","margin","0"],["text-wrap",""],[3,"innerHTML"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return n.dismiss()}),t._UZ(4,"ion-icon",2),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"ion-buttons",3)(9,"ion-button",1),t.NdJ("click",function(){return n.add()}),t._UZ(10,"ion-icon",4),t.qZA(),t.TgZ(11,"ion-button",1),t.NdJ("click",function(){return n.ok()}),t._UZ(12,"ion-icon",5),t._uU(13),t.ALo(14,"translate"),t.qZA()()(),t.TgZ(15,"ion-segment",6),t.NdJ("ngModelChange",function(i){return n.tab=i})("ngModelChange",function(){return n.tabChanged()}),t.TgZ(16,"ion-segment-button",7),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"ion-segment-button",8)(20,"ion-text"),t._uU(21),t.ALo(22,"translate"),t.TgZ(23,"ion-text",9),t._uU(24),t.qZA()()()(),t.YNc(25,D,3,4,"ion-searchbar",10),t.qZA(),t.TgZ(26,"ion-content")(27,"p",11)(28,"i"),t._uU(29),t.ALo(30,"translate"),t.qZA()(),t.TgZ(31,"ion-list",12),t.YNc(32,xt,18,9,"ng-container",13),t.qZA(),t.TgZ(33,"ion-list",12)(34,"ion-grid")(35,"ion-row")(36,"ion-col",14)(37,"ion-item",15)(38,"ion-select",16),t.NdJ("ngModelChange",function(i){return n.listOption=i})("ngModelChange",function(){return n.changeListOption()}),t.ALo(39,"translate"),t.TgZ(40,"ion-select-option",7),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-select-option",17),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.TgZ(46,"ion-select-option",18),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.YNc(49,Zt,3,3,"ion-select-option",19),t.qZA()()(),t.TgZ(50,"ion-col",14),t.YNc(51,Tt,9,4,"ion-item",20),t.qZA()()(),t.YNc(52,St,18,9,"ng-container",13),t.ALo(53,"slice"),t.YNc(54,Nt,9,4,"ion-item",21),t.YNc(55,bt,3,3,"ion-item",22),t.qZA()()),2&e&&(t.xp6(6),t.hij(" ",t.lcZ(7,25,"product-selector.title")," "),t.xp6(7),t.hij("\xa0",t.lcZ(14,27,"action.save")," "),t.xp6(2),t.Q6J("ngModel",n.tab),t.xp6(2),t.hij(" ",t.lcZ(18,29,"product-selector.filter-all")," "),t.xp6(3),t.Udp("font-weight",n.selectedProducts&&n.selectedProducts.length?"bold":"normal"),t.xp6(1),t.hij(" ",t.lcZ(22,31,"product-selector.filter-selected")," "),t.xp6(3),t.hij(" (",n.selectedProducts?n.selectedProducts.length:0,")"),t.xp6(1),t.Q6J("ngIf","all"==n.tab),t.xp6(1),t.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(3),t.Oqu(t.lcZ(30,33,"product-selector.enter-note-description")),t.xp6(2),t.Q6J("hidden","all"==n.tab),t.xp6(1),t.Q6J("ngForOf",n.selectedProducts),t.xp6(1),t.Q6J("hidden","selected"==n.tab),t.xp6(5),t.s9C("placeholder",t.lcZ(39,35,"product.select-option")),t.Q6J("ngModel",n.listOption),t.xp6(3),t.Oqu(t.lcZ(42,37,"product.list-option-all")),t.xp6(3),t.Oqu(t.lcZ(45,39,"product.list-option-expiry")),t.xp6(3),t.Oqu(t.lcZ(48,41,"product.list-option-quantiy")),t.xp6(2),t.Q6J("ngIf",n.contactId),t.xp6(2),t.Q6J("ngIf",n.isShowPaging&&n.products&&n.products.length),t.xp6(1),t.Q6J("ngForOf",t.Dn7(53,43,n.products,n.start,n.end+1)),t.xp6(2),t.Q6J("ngIf",n.isShowPaging&&n.products&&n.products.length),t.xp6(1),t.Q6J("ngIf",!n.originalProducts||0===n.originalProducts.length))},dependencies:[u.sg,u.O5,d.JJ,d.On,a.BJ,a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.Nd,a.VI,a.cJ,a.GO,a.t9,a.n0,a.yW,a.wd,a.sr,a.as,a.QI,a.j9,P.BN,H.F,u.OU,y.X$],encapsulation:2}),r})();var X=f(5439),It=f(4372),it=f(6026);function Ut(r,s){1&r&&(t.TgZ(0,"ion-col",17)(1,"ion-text",18)(2,"i"),t._uU(3),t.ALo(4,"translate"),t.qZA()()()),2&r&&(t.xp6(3),t.Oqu(t.lcZ(4,1,"transfer-note-add.adding-new-product-alert")))}function qt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",4),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-input",15),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.product.barcode=o)}),t.ALo(6,"translate"),t.qZA()(),t.YNc(7,Ut,5,3,"ion-col",16),t.qZA()}if(2&r){const e=t.oxw();t.xp6(3),t.hij("",t.lcZ(4,5,"order-add.enter-barcode")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(6,7,"order-add.enter-barcode-placeholder")),t.Q6J("disabled",!0)("ngModel",e.product.barcode),t.xp6(2),t.Q6J("ngIf",!e.product.productId)}}let Pt=(()=>{class r{constructor(e,n,o,i){this.viewCtrl=e,this.analyticsService=n,this.translate=o,this.navCtrl=i,this.reload=()=>{this.reCalc()}}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("transfer-note-product-edit")})()}ngOnInit(){this.reload()}reCalc(){const e=this.product.actualExport*this.product.unitPrice;this.product.amount=e-(0===this.product.discountType?1*this.product.discount:e*this.product.discount/100)}dismiss(){this.viewCtrl.dismiss()}validate(){return this.product.actualImport?this.product.actualExport?null==this.product.discount?(alert(this.translate.instant("transfer-note.no-discount-alert")),!1):this.product.productId||this.product.productCode?this.product.productName?!!this.product.unitPrice||(alert(this.translate.instant("transfer-note.no-price-alert")),!1):(alert(this.translate.instant("transfer-note.no-name-alert")),!1):(alert(this.translate.instant("transfer-note.no-code-alert")),!1):(alert(this.translate.instant("transfer-note.no-actual-export-alert")),!1):(alert(this.translate.instant("transfer-note.no-actual-import-alert")),!1)}ok(){!this.validate()||this.viewCtrl.dismiss(this.product)}increase(){this.product.actualExport++,this.product.actualImport++,this.reCalc()}decrease(){this.product.actualExport>0&&this.product.actualExport--,this.product.actualImport>0&&this.product.actualImport--,this.reCalc()}selectAll(e){v.W.selectAll(e)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(a.IN),t.Y36(M.y),t.Y36(y.sK),t.Y36(Z.G))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-product-edit"]],inputs:{product:"product",currency:"currency",foreignCurrency:"foreignCurrency"},decls:82,vars:70,consts:[["slot","start"],[3,"click"],["name","close"],[4,"ngIf"],["position","stacked","color","primary"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus"],["size","small","expand","block","fill","solid",3,"click"],["slot","icon-only","name","chevron-down-circle"],["slot","icon-only","name","chevron-up-circle"],["position","\n                ","color","primary"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange","focus"],["expand","full","color","primary",3,"click"],["expand","full","color","secondary",3,"click"],["clearInput","","type","text",3,"disabled","placeholder","ngModel","ngModelChange"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["color","warning",2,"font-size","0.8em"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return n.dismiss()}),t._UZ(4,"ion-icon",2),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"translate"),t.qZA()()(),t.TgZ(8,"ion-content")(9,"ion-grid"),t.YNc(10,qt,8,9,"ion-row",3),t.TgZ(11,"ion-row")(12,"ion-col")(13,"ion-label",4),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"ion-input",5),t.NdJ("ngModelChange",function(i){return n.product.productCode=i}),t.ALo(17,"translate"),t.qZA()(),t.TgZ(18,"ion-col")(19,"ion-label",4),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-input",5),t.NdJ("ngModelChange",function(i){return n.product.productName=i}),t.ALo(23,"translate"),t.qZA()(),t.TgZ(24,"ion-col")(25,"ion-label",4),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"ion-input",5),t.NdJ("ngModelChange",function(i){return n.product.unit=i}),t.ALo(29,"translate"),t.qZA()()(),t.TgZ(30,"ion-row")(31,"ion-col")(32,"ion-label",4),t._uU(33),t.ALo(34,"translate"),t.qZA(),t.TgZ(35,"money-input",6),t.NdJ("moneyValueChange",function(i){return n.product.unitPrice=i}),t.ALo(36,"translate"),t.qZA()(),t.TgZ(37,"ion-col")(38,"ion-label",4),t._uU(39),t.ALo(40,"translate"),t.qZA(),t.TgZ(41,"ion-input",7),t.NdJ("ngModelChange",function(i){return n.product.actualExport=i})("ngModelChange",function(){return n.reCalc()})("focus",function(i){return n.selectAll(i)}),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-buttons")(44,"ion-button",8),t.NdJ("click",function(){return n.decrease()}),t._UZ(45,"ion-icon",9),t.qZA(),t.TgZ(46,"ion-button",8),t.NdJ("click",function(){return n.increase()}),t._UZ(47,"ion-icon",10),t.qZA()()(),t.TgZ(48,"ion-col")(49,"ion-label",4),t._uU(50),t.ALo(51,"translate"),t.qZA(),t.TgZ(52,"ion-input",7),t.NdJ("ngModelChange",function(i){return n.product.actualImport=i})("ngModelChange",function(){return n.reCalc()})("focus",function(i){return n.selectAll(i)}),t.ALo(53,"translate"),t.qZA(),t.TgZ(54,"ion-buttons")(55,"ion-button",8),t.NdJ("click",function(){return n.decrease()}),t._UZ(56,"ion-icon",9),t.qZA(),t.TgZ(57,"ion-button",8),t.NdJ("click",function(){return n.increase()}),t._UZ(58,"ion-icon",10),t.qZA()()()(),t.TgZ(59,"ion-row")(60,"ion-col")(61,"ion-label",4),t._uU(62),t.ALo(63,"translate"),t.qZA(),t.TgZ(64,"money-input",6),t.NdJ("moneyValueChange",function(i){return n.product.amount=i}),t.ALo(65,"translate"),t.qZA()(),t.TgZ(66,"ion-col")(67,"ion-label",11),t._uU(68),t.ALo(69,"translate"),t.qZA(),t.TgZ(70,"ion-input",12),t.NdJ("ngModelChange",function(i){return n.product.note=i})("focus",function(i){return n.selectAll(i)}),t.ALo(71,"translate"),t.qZA()()()(),t.TgZ(72,"ion-grid")(73,"ion-row")(74,"ion-col")(75,"ion-button",13),t.NdJ("click",function(){return n.ok()}),t._uU(76),t.ALo(77,"translate"),t.qZA()(),t.TgZ(78,"ion-col")(79,"ion-button",14),t.NdJ("click",function(){return n.dismiss()}),t._uU(80),t.ALo(81,"translate"),t.qZA()()()()()),2&e&&(t.xp6(6),t.hij(" ",t.lcZ(7,32,"transfer-note-add.product-edit")," "),t.xp6(2),t.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(2),t.Q6J("ngIf",n.product.barcode),t.xp6(4),t.hij("",t.lcZ(15,34,"transfer-note-add.product-code")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(17,36,"transfer-note-add.enter-product-code")),t.Q6J("ngModel",n.product.productCode),t.xp6(4),t.hij("",t.lcZ(21,38,"transfer-note-add.product-name")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(23,40,"transfer-note-add.enter-product-name")),t.Q6J("ngModel",n.product.productName),t.xp6(4),t.hij("",t.lcZ(27,42,"transfer-note-add.product-unit")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(29,44,"transfer-note-add.enter-product-unit")),t.Q6J("ngModel",n.product.unit),t.xp6(5),t.Oqu(t.lcZ(34,46,"transfer-note-add.product-unit-price")),t.xp6(2),t.s9C("placeholder",t.lcZ(36,48,"transfer-note-add.enter-product-sale-price")),t.Q6J("clear",!0)("moneyValue",n.product.unitPrice),t.xp6(4),t.hij("",t.lcZ(40,50,"transfer-note-add.product-export-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(42,52,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",n.product.actualExport),t.xp6(9),t.hij("",t.lcZ(51,54,"transfer-note-add.product-import-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(53,56,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",n.product.actualImport),t.xp6(10),t.hij("",t.lcZ(63,58,"transfer-note-add.product-total")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(65,60,"transfer-note-add.enter-product-total")),t.Q6J("clear",!0)("moneyValue",n.product.amount),t.xp6(4),t.hij("",t.lcZ(69,62,"transfer-note-add.product-note")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(71,64,"transfer-note-add.enter-product-note")),t.Q6J("ngModel",n.product.note),t.xp6(6),t.hij("",t.lcZ(77,66,"order-add.product-edit-ok")," "),t.xp6(4),t.hij(" ",t.lcZ(81,68,"order-add.product-edit-cancel"),""))},dependencies:[u.O5,d.JJ,d.On,a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Q$,a.Nd,a.yW,a.wd,a.sr,a.as,a.j9,H.F,y.X$],encapsulation:2}),r})();class at{constructor(){this.id=0,this.receiptId=0,this.productId=0,this.productCode="",this.barcode="",this.productName="",this.actualExport=0,this.actualImport=0,this.unit="",this.unitExchange=null,this.basicUnit=null,this.unitPrice=0,this.costPrice=null,this.foreignCurrency="",this.amount=0,this.note="",this.isExpand=!1,this.onlineId=0,this.discount=0,this.discountType=0}}var ct=f(4220),st=f(9645),tt=f(7562),j=f(3876),wt=f(212),et=f(2126),$=f(3142),Lt=f(360),Jt=f(8851);const Et=["barcodeInput"];function kt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-text",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchExportStore())}),t._uU(1),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.exportStore.name," ")}}function Ot(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-text",34),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchExportStore())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"transfer-note-add.select-export-store")," "))}function Yt(r,s){if(1&r&&(t.TgZ(0,"p"),t.YNc(1,kt,2,1,"ion-text",31),t.YNc(2,Ot,3,3,"ion-text",32),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.exportStore&&e.exportStore.id>0),t.xp6(1),t.Q6J("ngIf",!e.exportStore||0===e.exportStore.id)}}function Qt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",35),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.removeExportStore())}),t._UZ(1,"ion-icon",36),t.qZA()}}function Ft(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item",11)(1,"ion-checkbox",28),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.isMainStoreForExport=o)}),t.qZA(),t.TgZ(2,"span",27),t._uU(3),t.ALo(4,"translate"),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngModel",e.isMainStoreForExport),t.xp6(2),t.Oqu(t.lcZ(4,2,"transfer-note-add.main-store"))}}function Dt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-text",33),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchImportStore())}),t._uU(1),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.importStore.name," ")}}function Kt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-text",34),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchImportStore())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"transfer-note-add.select-export-store")," "))}function Gt(r,s){if(1&r&&(t.TgZ(0,"p"),t.YNc(1,Dt,2,1,"ion-text",31),t.YNc(2,Kt,3,3,"ion-text",32),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.importStore&&e.importStore.id>0),t.xp6(1),t.Q6J("ngIf",!e.importStore||0===e.importStore.id)}}function Ht(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",35),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.removeImportStore())}),t._UZ(1,"ion-icon",36),t.qZA()}}function jt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item",11)(1,"ion-checkbox",28),t.NdJ("ngModelChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.isMainStoreForImport=o)}),t.qZA(),t.TgZ(2,"span",27),t._uU(3),t.ALo(4,"translate"),t.qZA()()}if(2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngModel",e.isMainStoreForImport),t.xp6(2),t.Oqu(t.lcZ(4,2,"transfer-note-add.main-store"))}}function Bt(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.hij("",e.productCode,"-")}}function Vt(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.hij(" (",e.unit,")")}}const $t=function(r,s,e){return[r,s,"symbol","1.0-2",e]};function Wt(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&r){const e=t.oxw().$implicit,n=t.oxw();t.xp6(1),t.hij("- ",t.G7q(2,1,t.kEZ(7,$t,e.amount,n.currency.code,n.translateService.currentLang)),"")}}function zt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-col")(1,"ion-label",7),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"money-input",45),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.unitPrice=o)})("moneyValueChange",function(){t.CHM(e);const o=t.oxw().$implicit,i=t.oxw();return t.KtG(i.reCalc(o))}),t.ALo(5,"translate"),t.qZA()()}if(2&r){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",t.lcZ(3,4,"transfer-note-add.product-unit-price")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(5,6,"transfer-note-add.enter-product-unit-price")),t.Q6J("clear",!0)("moneyValue",e.unitPrice)}}function Rt(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-col")(1,"ion-label",7),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"money-input",45),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw().$implicit;return t.KtG(i.amount=o)})("moneyValueChange",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.applyItemTotal())}),t.ALo(5,"translate"),t.qZA()()}if(2&r){const e=t.oxw().$implicit;t.xp6(2),t.hij(" ",t.lcZ(3,4,"transfer-note-add.product-total")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(5,6,"transfer-note-add.enter-product-total")),t.Q6J("clear",!0)("moneyValue",e.amount)}}function Xt(r,s){if(1&r){const e=t.EpF();t.ynx(0,16),t.TgZ(1,"ion-item",16)(2,"ion-buttons")(3,"ion-button",18),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.expand(i))}),t._UZ(4,"fa-icon",37),t.qZA()(),t.TgZ(5,"ion-text",38),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.expand(i))}),t.YNc(6,Bt,2,1,"span",13),t._uU(7),t.YNc(8,Vt,2,1,"span",13),t._UZ(9,"br"),t.TgZ(10,"span",27),t._uU(11),t.ALo(12,"translate"),t.ALo(13,"translate"),t.YNc(14,Wt,3,11,"span",13),t.qZA()(),t.TgZ(15,"ion-buttons",2)(16,"ion-button",18),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.removeProduct(i))}),t._UZ(17,"ion-icon",39),t.qZA()()(),t.TgZ(18,"ion-grid",40)(19,"ion-row"),t.YNc(20,zt,6,8,"ion-col",13),t.TgZ(21,"ion-col")(22,"ion-label",7),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"ion-input",41),t.NdJ("ngModelChange",function(o){const c=t.CHM(e).$implicit;return t.KtG(c.actualExport=o)})("ngModelChange",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.reCalc(i))})("focus",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.selectAll(o))}),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"ion-buttons")(28,"ion-button",42),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.decrease(i))}),t._UZ(29,"ion-icon",43),t.qZA(),t.TgZ(30,"ion-button",42),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.increase(i))}),t._UZ(31,"ion-icon",44),t.qZA()()(),t.TgZ(32,"ion-col")(33,"ion-label",7),t._uU(34),t.ALo(35,"translate"),t.qZA(),t.TgZ(36,"ion-input",41),t.NdJ("ngModelChange",function(o){const c=t.CHM(e).$implicit;return t.KtG(c.actualImport=o)})("ngModelChange",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.reCalc(i))})("focus",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.selectAll(o))}),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"ion-buttons")(39,"ion-button",42),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.decrease(i))}),t._UZ(40,"ion-icon",43),t.qZA(),t.TgZ(41,"ion-button",42),t.NdJ("click",function(){const i=t.CHM(e).$implicit,c=t.oxw();return t.KtG(c.increase(i))}),t._UZ(42,"ion-icon",44),t.qZA()()()(),t.TgZ(43,"ion-row"),t.YNc(44,Rt,6,8,"ion-col",13),t.TgZ(45,"ion-col")(46,"ion-label",7),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"ion-input",29),t.NdJ("ngModelChange",function(o){const c=t.CHM(e).$implicit;return t.KtG(c.note=o)})("focus",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.selectAll(o))}),t.ALo(50,"translate"),t.qZA()()()(),t.BQk()}if(2&r){const e=s.$implicit,n=t.oxw();t.xp6(4),t.s9C("icon",e.isExpand?"compress-arrows-alt":"edit"),t.xp6(2),t.Q6J("ngIf",e.productCode),t.xp6(1),t.hij("",e.productName," "),t.xp6(1),t.Q6J("ngIf",e.unit),t.xp6(3),t.HOy("",t.lcZ(12,21,"transfer-note-add.product-export-count"),": ",e.actualExport," - ",t.lcZ(13,23,"transfer-note-add.product-import-count"),": ",e.actualImport," "),t.xp6(3),t.Q6J("ngIf",n.note.hasPayment),t.xp6(4),t.Q6J("hidden",!e.isExpand),t.xp6(2),t.Q6J("ngIf",n.note.hasPayment),t.xp6(3),t.hij(" ",t.lcZ(24,25,"transfer-note-add.product-export-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(26,27,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",e.actualExport),t.xp6(9),t.hij(" ",t.lcZ(35,29,"transfer-note-add.product-export-count")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(37,31,"transfer-note-add.enter-product-count")),t.Q6J("ngModel",e.actualImport),t.xp6(8),t.Q6J("ngIf",n.note.hasPayment),t.xp6(3),t.hij(" ",t.lcZ(48,33,"transfer-note-add.product-note")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(50,35,"transfer-note-add.enter-product-note")),t.Q6J("ngModel",e.note)}}function te(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",50),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchExportMoneyAccount())}),t._uU(1),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.exportMoneyAccount.accountName," ")}}function ee(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",51),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchExportMoneyAccount())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"trade-add.select-money-account")," "))}function ne(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",51),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.removeExportMoneyAccount())}),t._UZ(1,"ion-icon",36),t.qZA()}}function oe(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",50),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchImportMoneyAccount())}),t._uU(1),t.qZA()}if(2&r){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.importMoneyAccount.accountName," ")}}function re(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",51),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.showSearchImportMoneyAccount())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"trade-add.select-money-account")," "))}function ie(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-button",51),t.NdJ("click",function(){t.CHM(e);const o=t.oxw(2);return t.KtG(o.removeImportMoneyAccount())}),t._UZ(1,"ion-icon",36),t.qZA()}}function ae(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"ion-label",46),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"money-input",45),t.NdJ("moneyValueChange",function(o){t.CHM(e);const i=t.oxw();return t.KtG(i.note.total=o)}),t.ALo(7,"translate"),t.qZA()()(),t.TgZ(8,"ion-row")(9,"ion-col")(10,"ion-label",47),t._uU(11),t.ALo(12,"translate"),t.qZA(),t._UZ(13,"br"),t.YNc(14,te,2,1,"ion-button",48),t.YNc(15,ee,3,3,"ion-button",49),t.YNc(16,ne,2,0,"ion-button",49),t.qZA(),t.TgZ(17,"ion-col")(18,"ion-label",47),t._uU(19),t.ALo(20,"translate"),t.qZA(),t._UZ(21,"br"),t.YNc(22,oe,2,1,"ion-button",48),t.YNc(23,re,3,3,"ion-button",49),t.YNc(24,ie,2,0,"ion-button",49),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(4),t.AsE(" ",t.lcZ(5,13,"transfer-note-add.total")," (",e.currency?e.currency.code:"",")"),t.xp6(2),t.s9C("placeholder",t.lcZ(7,15,"transfer-note-add.enter-total")),t.Q6J("clear",!0)("moneyValue",e.note.total),t.xp6(5),t.hij(" ",t.lcZ(12,17,"transfer-note-add.export-money-account")," "),t.xp6(3),t.Q6J("ngIf",e.exportMoneyAccount&&e.exportMoneyAccount.id>0),t.xp6(1),t.Q6J("ngIf",!e.exportMoneyAccount||0===e.exportMoneyAccount.id),t.xp6(1),t.Q6J("ngIf",e.exportMoneyAccount&&e.exportMoneyAccount.id>0),t.xp6(3),t.hij(" ",t.lcZ(20,19,"transfer-note-add.import-money-account")," "),t.xp6(3),t.Q6J("ngIf",e.importMoneyAccount&&e.importMoneyAccount.id>0),t.xp6(1),t.Q6J("ngIf",!e.importMoneyAccount||0===e.importMoneyAccount.id),t.xp6(1),t.Q6J("ngIf",e.importMoneyAccount&&e.importMoneyAccount.id>0)}}let ce=(()=>{class r{constructor(e,n,o,i,c,h,T,S,q,m,E,Y,B,A,Q){this.navCtrl=e,this.barcodeScanner=n,this.platform=o,this.modalCtrl=i,this.productService=c,this.staffService=h,this.transferNoteService=T,this.translateService=S,this.userService=q,this.toastCtrl=m,this.storeService=E,this.analyticsService=Y,this.moneyAccountService=B,this.tradeService=A,this.dataService=Q,this.params=null,this.note={items:[]},this.oldNote=null,this.currency={code:"vnd"},this.isNew=!0,this.oldBarcode="",this.barcode="",this.saveDisabled=!1,this.isMobile=!0,this.stores=[],this.onKeyPress=N=>{!N.target||"body"!==N.target.localName||("s"===N.key||"S"===N.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("transfer-note-add")})()}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.stores=yield e.storeService.getStores(),e.mainStore=yield e.dataService.getFirstObject("shop"),e.platform.resize.subscribe(()=>{e.isMobile=e.platform.width()<720}),e.userService.getAttr("current-currency").then(c=>{e.currency=v.W.getCurrencyByCode(c)}),e.isMobile=e.platform.width()<720,e.note={items:[],code:X().format("YYMMDD-HHmmss")},e.note.createdAt=X().format(C.C.getDateTimeDbFormat()),e.store=yield e.storeService.getCurrentStore();const n=e.params?e.params:e.navCtrl.getParams();e.params=n;let o=0,i=0;if(n&&(n&&n.id?(o=n.id,e.isNew=!1):n&&n.product&&(i=+n.product)),o&&o>0){const c=yield e.navCtrl.loading();e.transferNoteService.get(o).then(function(){var h=(0,p.Z)(function*(T){yield c.dismiss(),e.note=T,e.mainStore.isMainShop=!0,e.exportStore=e.note.exportStoreId&&e.stores&&e.stores.length?e.stores.find(S=>S.id==e.note.exportStoreId):e.mainStore,e.importStore=e.note.importStoreId&&e.stores&&e.stores.length?e.stores.find(S=>S.id==e.note.importStoreId):e.mainStore,e.oldNote=JSON.parse(JSON.stringify(T)),e.note.items=JSON.parse(e.note.itemsJson)});return function(T){return h.apply(this,arguments)}}())}else i&&i>0&&e.productService.get(i,e.store?e.store.id:0).then(c=>{e.addProduct(c)});e.barcodeFocus()})()}ionViewLoaded(){this.barcodeFocus()}barcodeFocus(){setTimeout(()=>{this.barcodeInput&&this.barcodeInput.setFocus()},500)}validate(){return this.exportStore&&this.importStore?this.note.exportStoreId===this.note.importStoreId?(alert(this.translateService.instant("transfer-note-add.stores-must-different")),!1):!this.note.hasPayment||this.exportMoneyAccount&&this.importMoneyAccount?!(!this.note.items||!this.note.items.length)||(alert(this.translateService.instant("transfer-note-add.no-items-alert")),!1):(alert(this.translateService.instant("transfer-note-add.has-payment-but-missing-money-accounts")),!1):(alert(this.translateService.instant("transfer-note-add.must-select-stores")),!1)}save(){var e=this;return(0,p.Z)(function*(){if(!e.validate())return;e.saveDisabled=!0;const n=yield e.navCtrl.loading();e.staffService.isStaff()&&(e.note.staffId=e.staffService.selectedStaff.id),e.note.itemsJson=JSON.stringify(e.note.items),e.note.exportStoreId=e.exportStore&&!e.isMainStoreForExport?e.exportStore.id:0,e.note.importStoreId=e.importStore&&!e.isMainStoreForImport?e.importStore.id:0,e.note.hasPayment||(e.note.total=0),e.transferNoteService.save(e.note).then((0,p.Z)(function*(){e.analyticsService.logEvent("transfer-note-add-save-success"),Promise.all([]).then((0,p.Z)(function*(){yield e.createTransactionsForExport(),yield e.createTransactionsForImport(),yield e.addProductNotes(),yield n.dismiss(),e.exitPage()}))}))})()}createTransactionsForImport(){var e=this;return(0,p.Z)(function*(){if(!e.note.id)return;let n=0;e.staffService.isStaff()&&(n=e.staffService.selectedStaff.id);const o=[],i=yield e.tradeService.getTradesByTransferNote(e.note.id);for(const h of i)h.debtId||o.push(e.tradeService.deleteTrade(h));const c=new ct.h;c.contactId=e.note.contactId,c.staffId=n,c.isPurchase=!1,c.isReceived=!1,c.value=e.note.total,c.transferNoteId=e.note.id,c.moneyAccountId=e.note.importMoneyAccountId,c.note=e.translateService.instant("transfer-note-add.transfer-note")+" #"+e.note.id,c.createdAt=e.note.createdAt,o.push(e.tradeService.saveTrade(c)),yield Promise.all(o)})()}createTransactionsForExport(){var e=this;return(0,p.Z)(function*(){if(!e.note.id)return;let n=0;e.staffService.isStaff()&&(n=e.staffService.selectedStaff.id);const o=[],i=yield e.tradeService.getTradesByTransferNote(e.note.id);for(const h of i)h.debtId||o.push(e.tradeService.deleteTrade(h));const c=new ct.h;c.contactId=e.note.contactId,c.staffId=n,c.isPurchase=!1,c.isReceived=!0,c.value=e.note.total,c.transferNoteId=e.note.id,c.moneyAccountId=e.note.exportMoneyAccountId,c.note=e.translateService.instant("transfer-note-add.transfer-note")+" #"+e.note.id,c.createdAt=e.note.createdAt,o.push(e.tradeService.saveTrade(c)),yield Promise.all(o)})()}hasPaymentChanged(){this.exportStore&&(this.exportMoneyAccount=this.exportStore.moneyAccount),this.importStore&&(this.importMoneyAccount=this.importStore.moneyAccount)}showSearchExportMoneyAccount(){var e=this;return(0,p.Z)(function*(){e.navCtrl.push("/money-account",{callback:o=>{const i=o;i&&(e.exportMoneyAccount=i,e.note.exportMoneyAccountId=i.id)},searchMode:!0})})()}showSearchImportMoneyAccount(){var e=this;return(0,p.Z)(function*(){e.navCtrl.push("/money-account",{callback:o=>{const i=o;i&&(e.importMoneyAccount=i,e.note.importMoneyAccountId=i.id)},searchMode:!0})})()}removeExportMoneyAccount(){this.exportMoneyAccount=null,this.note.exportMoneyAccountId=0}removeImportMoneyAccount(){this.importMoneyAccount=null,this.note.importMoneyAccountId=0}exitPage(){var e=this;return(0,p.Z)(function*(){yield e.navCtrl.popOnly(),e.navCtrl.publish("reloadTransferNoteList"),e.navCtrl.publish("reloadTransferNote",e.note),e.isNew&&(yield e.navCtrl.push("/transfer-note/detail",{id:e.note.id}))})()}showDatePopup(){this.note.createdAt=X().format("YYYY-MM-DD")}dateFormat(e){return C.C.toUiDateString(e)}removeDate(){this.note.createdAt=""}productName(e,n){return v.W.productName(e,n)}selectAll(e){v.W.selectAll(e)}showSearchProduct(){var e=this;return(0,p.Z)(function*(){if(!e.exportStore)return void alert(e.translateService.instant("transfer-note-add.select-export-store-first"));const n=function(){var o=(0,p.Z)(function*(i){if(i&&i.length){for(const c of e.note.items)c.isExpand=!1;for(const c of i)yield e.addProductFromArr(c)}});return function(c){return o.apply(this,arguments)}}();e.navCtrl.push("/transfer-note/transfer-product-selector",{callback:n,exportStore:e.exportStore})})()}addProductFromArr(e){var n=this;return(0,p.Z)(function*(){if(!e)return;const o=new at;o.unitPrice=e.unitPrice,o.productId=e.id,o.productCode=e.code,o.productName=e.title,o.note=e.note,o.unit=e.unit,o.unitExchange=e.unitExchange,o.basicUnit=e.basicUnit,o.actualExport=e.actualExport,o.actualImport=e.actualImport,o.isExpand=!1,n.note.items.unshift(o),n.reCalc(o);const i=n.translateService.instant("transfer-note-add.added-product",{product:v.W.productName(e.code,e.title)});n.presentToast(i)})()}addProduct(e){var n=this;return(0,p.Z)(function*(){if(e){for(const m of n.note.items)m.isExpand=!1;const o=n.note.items.findIndex(m=>m.productId===e.id&&(!e.fromUnit||m.unit===e.fromUnit));if(o>=0){const m=n.note.items[o];return m.isExpand=!0,m.quantity=1*m.quantity+1,void n.reCalc(m)}let i=null;if(e.fromUnit){const m=e.unitsJson?JSON.parse(e.unitsJson):null;if(m&&m.length)for(const E of m)if(E&&E.unit===e.fromUnit){i=E;break}}const c=new at,h=e.price?e.price:e.costPrice;c.unitPrice=i?i.price:h,c.productId=e.id,c.productName=e.title,c.productCode=e.code?e.code.toUpperCase():"",c.unit=i?i.unit:e.unit,c.basicUnit=i?e.unit:null,c.unitExchange=i?i.exchange:null,c.actualExport=1,c.actualImport=1,c.isExpand=!1;const T=yield n.modalCtrl.create({component:Pt,componentProps:{product:c,currency:n.currency,foreignCurrency:n.note.foreignCurrency}});yield T.present();const{data:S}=yield T.onDidDismiss();if(!S)return;n.note.items.unshift(c),n.reCalc(c);const q=n.translateService.instant("transfer-note-add.added-product",{product:c.productName});n.presentToast(q),n.barcodeFocus()}})()}barcodeChanged(){if(!this.barcode||this.barcode.length<5)return void(this.oldBarcode=this.barcode);let e=!1;!this.oldBarcode&&this.barcode&&(e=!0);const n=this.barcode;this.oldBarcode=n,e&&setTimeout(()=>{this.barcode="",this.oldBarcode=""},200),this.productService.searchByBarcode(n).then(o=>{!o||(this.addProduct(o),this.barcode="",this.oldBarcode="",this.barcodeFocus())})}presentToast(e){var n=this;return(0,p.Z)(function*(){yield(yield n.toastCtrl.create({message:e,duration:3e3,position:"top"})).present()})()}removeProduct(e){const n=this.note.items.findIndex(o=>o.productId==e.productId);n>=0&&this.note.items.splice(n,1),this.applyItemTotal()}reCalc(e){const n=e.actualImport*e.unitPrice;e.amount=n-(0==e.discountType?1*e.discount:n*e.discount/100),this.applyItemTotal()}applyItemTotal(){let e=0;for(const n of this.note.items)e+=1*n.amount;this.note.total=1*e,this.reCalcTotal()}expand(e){const n=!e.isExpand;for(const o of this.note.items)o.isExpand=!1;e.isExpand=n}reCalcTotal(){}scan(){var e=this;return(0,p.Z)(function*(){if(e.navCtrl.isNotCordova()){const n=yield e.modalCtrl.create({component:it.k});yield n.present();const{data:o}=yield n.onDidDismiss();o&&o.barcode&&e.productService.searchByBarcode(o.barcode).then(i=>{!i||e.addProduct(i)})}else e.barcodeScanner.scan().then(n=>{!n||!n.text||e.productService.searchByBarcode(n.text).then(o=>{!o||e.addProduct(o)})})})()}addProductNotes(){var e=this;return(0,p.Z)(function*(){if(!e.note.id)return;const n=yield e.productService.getNotesByTransferNote(e.note.id);for(const o of n)yield e.productService.deleteProductNote(o);for(const o of e.note.items){const i=e.buildProductNote(e.exportStore&&!e.exportStore.isMainShop?e.exportStore.id:0,o,-o.actualExport,!0),c=e.buildProductNote(e.importStore&&!e.importStore.isMainShop?e.importStore.id:0,o,+o.actualImport,!1);yield e.productService.saveProductNote(i),yield e.productService.saveProductNote(c)}})()}buildProductNote(e,n,o,i){const c=new It.d;return c.transferNoteId=this.note.id,c.storeId=e,c.amount=this.note.hasPayment?(i?1:-1)*n.amount:0,c.unitPrice=n.costPrice?n.costPrice:n.unitPrice,c.unit=n.unit,c.basicUnit=n.basicUnit,c.unitExchange=n.unitExchange,c.quantity=o,c.productId=n.productId,c.productName=n.productName,c.productCode=n.productCode,c.staffId=this.staffService.isStaff()?this.staffService.selectedStaff.id:0,c.note=n.note?n.note:this.translateService.instant("transfer-note-add.transfer-note")+" #"+this.note.id,c}increase(e){e.actualExport++,e.actualImport++,this.reCalc(e)}decrease(e){e.actualExport>0&&e.actualExport--,e.actualImport>0&&e.actualImport--,this.reCalc(e)}showSearchExportStore(){var e=this;return(0,p.Z)(function*(){const n=function(){var o=(0,p.Z)(function*(i){const c=i;c&&(e.exportStore=c,e.note.exportStoreId=c.isMainShop?0:c.id,e.exportStore.isMainShop&&(e.mainShopMoneyAccount||(e.mainShopMoneyAccount=yield e.moneyAccountService.getDefault()),e.exportStore.moneyAccount=e.mainShopMoneyAccount),e.exportMoneyAccount=e.exportStore.moneyAccount,e.note.exportMoneyAccountId=e.exportMoneyAccount?e.exportMoneyAccount.id:0)});return function(c){return o.apply(this,arguments)}}();e.navCtrl.push("/store",{callback:n,searchMode:!0})})()}removeExportStore(){this.exportStore=null,this.note.exportStoreId=0}showSearchImportStore(){var e=this;return(0,p.Z)(function*(){const n=function(){var o=(0,p.Z)(function*(i){const c=i;c&&(e.importStore=c,e.note.importStoreId=c.isMainShop?0:c.id,e.importStore.isMainShop&&(e.mainShopMoneyAccount||(e.mainShopMoneyAccount=yield e.moneyAccountService.getDefault()),e.importStore.moneyAccount=e.mainShopMoneyAccount),e.importMoneyAccount=e.importStore.moneyAccount,e.note.importMoneyAccountId=e.importMoneyAccount?e.importMoneyAccount.id:0)});return function(c){return o.apply(this,arguments)}}();e.navCtrl.push("/store",{callback:n,searchMode:!0})})()}removeImportStore(){this.importStore=null,this.note.importStoreId=0}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(Z.G),t.Y36(st.m),t.Y36(a.t4),t.Y36(a.IN),t.Y36(x.M),t.Y36(l.x),t.Y36(tt.u),t.Y36(y.sK),t.Y36(b.K),t.Y36(a.yF),t.Y36(j.d),t.Y36(M.y),t.Y36(wt.U),t.Y36(et.X),t.Y36($.D))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-add"]],viewQuery:function(e,n){if(1&e&&t.Gf(Et,7),2&e){let o;t.iGM(o=t.CRH())&&(n.barcodeInput=o.first)}},decls:119,vars:100,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],[2,"padding","0 !important","margin","0 !important"],["size","12","size-sm",""],["position","stacked","color","primary"],["clearInput","","type","text",3,"ngModel","ngModelChange"],["type","datetime-local","pickerId","noteAddPicker","min","2015-01-01","max","2025-12-31",3,"date","dateChange"],[3,"size"],["lines","none",1,"ion-no-padding",2,"--min-height","0px"],["color","primary"],[4,"ngIf"],["fill","clear","slot","end",3,"click",4,"ngIf"],["lines","none","class","ion-no-padding","style","--min-height: 0px;",4,"ngIf"],["color","light"],["color","primary",1,"ion-text-wrap"],["fill","clear","color","primary",3,"click"],["name","add"],["name","barcode"],["clearInput","","autofocus","true","type","text",3,"placeholder","ngModel","ngModelChange"],["barcodeInput",""],["color","light",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"hidden"],[3,"innerHTML"],[1,"ion-text-wrap"],[2,"font-size","0.8em"],["slot","start",3,"ngModel","ngModelChange"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange","focus"],[1,"ion-padding",2,"padding-top","0 !important"],["color","dark","slot","end",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["color","dark","slot","end",3,"click"],["slot","end",3,"click"],["fill","clear","slot","end",3,"click"],["slot","icon-only","name","close"],["size","xs",3,"icon"],["color","primary",3,"click"],["name","close"],[3,"hidden"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus"],["expand","block","fill","solid",3,"click"],["slot","icon-only","name","remove"],["slot","icon-only","name","add"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["position","stacked","color","primary",2,"font-weight","bold"],["position","stacked","color","primary",1,"ion-text-wrap"],["color","dark","size","small",3,"click",4,"ngIf"],["size","small",3,"click",4,"ngIf"],["color","dark","size","small",3,"click"],["size","small",3,"click"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return n.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-grid",5)(14,"ion-row")(15,"ion-col",6)(16,"ion-grid")(17,"ion-row")(18,"ion-col")(19,"ion-label",7),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-input",8),t.NdJ("ngModelChange",function(i){return n.note.code=i}),t.qZA()(),t.TgZ(23,"ion-col")(24,"ion-label",7),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"div")(28,"date-picker",9),t.NdJ("dateChange",function(i){return n.note.createdAt=i}),t.qZA()()()(),t.TgZ(29,"ion-row")(30,"ion-col",10)(31,"ion-item",11)(32,"ion-label",12),t._uU(33),t.ALo(34,"translate"),t.YNc(35,Yt,3,2,"p",13),t.qZA(),t.YNc(36,Qt,2,0,"ion-button",14),t.qZA(),t.YNc(37,Ft,5,4,"ion-item",15),t.qZA(),t.TgZ(38,"ion-col",10)(39,"ion-item",11)(40,"ion-label",12),t._uU(41),t.ALo(42,"translate"),t.YNc(43,Gt,3,2,"p",13),t.qZA(),t.YNc(44,Ht,2,0,"ion-button",14),t.qZA(),t.YNc(45,jt,5,4,"ion-item",15),t.qZA()()(),t.TgZ(46,"ion-list")(47,"ion-item-divider",16),t._uU(48),t.ALo(49,"translate"),t.qZA(),t.TgZ(50,"ion-item",16)(51,"ion-text",17),t._uU(52),t.ALo(53,"translate"),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"ion-buttons")(56,"ion-button",18),t.NdJ("click",function(){return n.showSearchProduct()}),t._UZ(57,"ion-icon",19),t._uU(58),t.ALo(59,"translate"),t.qZA(),t.TgZ(60,"ion-button",18),t.NdJ("click",function(){return n.scan()}),t._UZ(61,"ion-icon",20),t._uU(62),t.ALo(63,"translate"),t.qZA()()(),t.TgZ(64,"ion-item",16)(65,"ion-input",21,22),t.NdJ("ngModelChange",function(i){return n.barcode=i})("ngModelChange",function(){return n.barcodeChanged()}),t.ALo(67,"translate"),t.qZA()()(),t.YNc(68,Xt,51,37,"ng-container",23),t.TgZ(69,"ion-item",24),t._UZ(70,"div",25),t.ALo(71,"translate"),t.qZA()(),t.TgZ(72,"ion-col",6)(73,"ion-list")(74,"ion-item-divider",16)(75,"ion-label",26),t._uU(76),t.ALo(77,"translate"),t.TgZ(78,"p",27),t._uU(79),t.ALo(80,"translate"),t.qZA()()(),t.TgZ(81,"ion-item")(82,"ion-label"),t._uU(83),t.ALo(84,"translate"),t.qZA(),t.TgZ(85,"ion-checkbox",28),t.NdJ("ngModelChange",function(i){return n.note.hasPayment=i})("ngModelChange",function(){return n.hasPaymentChanged()}),t.qZA()(),t.YNc(86,ae,25,21,"ion-grid",13),t.TgZ(87,"ion-item-divider",16),t._uU(88),t.ALo(89,"translate"),t.qZA(),t.TgZ(90,"ion-grid")(91,"ion-row")(92,"ion-col",10)(93,"ion-label",7),t._uU(94),t.ALo(95,"translate"),t.qZA(),t.TgZ(96,"ion-input",29),t.NdJ("ngModelChange",function(i){return n.note.deliverer=i})("focus",function(i){return n.selectAll(i)}),t.ALo(97,"translate"),t.qZA()(),t.TgZ(98,"ion-col",10)(99,"ion-label",7),t._uU(100),t.ALo(101,"translate"),t.qZA(),t.TgZ(102,"ion-input",29),t.NdJ("ngModelChange",function(i){return n.note.transportation=i})("focus",function(i){return n.selectAll(i)}),t.ALo(103,"translate"),t.qZA()(),t.TgZ(104,"ion-col",10)(105,"ion-label",7),t._uU(106),t.ALo(107,"translate"),t.qZA(),t.TgZ(108,"ion-input",29),t.NdJ("ngModelChange",function(i){return n.note.receiver=i})("focus",function(i){return n.selectAll(i)}),t.ALo(109,"translate"),t.qZA()()(),t.TgZ(110,"ion-row")(111,"ion-col")(112,"ion-label",7),t._uU(113),t.ALo(114,"translate"),t.qZA(),t.TgZ(115,"ion-input",29),t.NdJ("ngModelChange",function(i){return n.note.deliveryAddress=i})("focus",function(i){return n.selectAll(i)}),t.ALo(116,"translate"),t.qZA()()()()()()()(),t.TgZ(117,"div",30),t._UZ(118,"support"),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,50,"transfer-note-add.title")),t.xp6(3),t.Q6J("disabled",n.saveDisabled),t.xp6(2),t.hij(" \xa0",t.lcZ(11,52,"action.save")," "),t.xp6(2),t.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(8),t.hij("",t.lcZ(21,54,"transfer-note-add.code")," "),t.xp6(2),t.Q6J("ngModel",n.note.code),t.xp6(3),t.hij("",t.lcZ(26,56,"transfer-note-add.date")," "),t.xp6(3),t.Q6J("date",n.note.createdAt),t.xp6(2),t.Q6J("size",n.isMobile?6:4),t.xp6(3),t.hij(" ",t.lcZ(34,58,"transfer-note-add.export-store")," "),t.xp6(2),t.Q6J("ngIf",!n.isMainStoreForExport),t.xp6(1),t.Q6J("ngIf",!n.isMainStoreForExport&&n.exportStore&&n.exportStore.id>0),t.xp6(1),t.Q6J("ngIf",!n.exportStore||0===n.exportStore.id),t.xp6(1),t.Q6J("size",n.isMobile?6:4),t.xp6(3),t.hij(" ",t.lcZ(42,60,"transfer-note-add.import-store")," "),t.xp6(2),t.Q6J("ngIf",!n.isMainStoreForImport),t.xp6(1),t.Q6J("ngIf",!n.isMainStoreForImport&&n.importStore&&n.importStore.id>0),t.xp6(1),t.Q6J("ngIf",!n.importStore||0===n.importStore.id),t.xp6(3),t.hij(" ",t.lcZ(49,62,"transfer-note-add.product")," "),t.xp6(4),t.AsE(" ",t.lcZ(53,64,"transfer-note-add.enter-barcode")," ",t.lcZ(54,66,"order-add.or"),"..."),t.xp6(6),t.hij(" \xa0",t.lcZ(59,68,"order-add.add-manual")," "),t.xp6(4),t.hij(" \xa0",t.lcZ(63,70,"order-add.mobile-scan")," "),t.xp6(3),t.s9C("placeholder",t.lcZ(67,72,"transfer-note-add.enter-barcode-placeholder")),t.Q6J("ngModel",n.barcode),t.xp6(3),t.Q6J("ngForOf",n.note.items),t.xp6(1),t.Q6J("hidden",n.note.items&&n.note.items.length>0),t.xp6(1),t.Q6J("innerHTML",t.lcZ(71,74,"transfer-note-add.no-product"),t.oJD),t.xp6(6),t.hij(" ",t.lcZ(77,76,"transfer-note-add.payment-info")," "),t.xp6(3),t.hij(" ",t.lcZ(80,78,"transfer-note-add.payment-description")," "),t.xp6(4),t.hij(" ",t.lcZ(84,80,"transfer-note-add.has-payment")," "),t.xp6(2),t.Q6J("ngModel",n.note.hasPayment),t.xp6(1),t.Q6J("ngIf",n.note.hasPayment&&!n.staffService.isStaff()),t.xp6(2),t.hij(" ",t.lcZ(89,82,"transfer-note-add.delivery-info")," "),t.xp6(4),t.Q6J("size",n.isMobile?6:4),t.xp6(2),t.hij(" ",t.lcZ(95,84,"transfer-note-add.delivery-person")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(97,86,"transfer-note-add.delivery-person")),t.Q6J("ngModel",n.note.deliverer),t.xp6(2),t.Q6J("size",n.isMobile?6:4),t.xp6(2),t.hij(" ",t.lcZ(101,88,"transfer-note-add.transportation")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(103,90,"transfer-note-add.enter-transportation")),t.Q6J("ngModel",n.note.transportation),t.xp6(2),t.Q6J("size",n.isMobile?6:4),t.xp6(2),t.hij(" ",t.lcZ(107,92,"transfer-note-add.receiver")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(109,94,"transfer-note-add.enter-receiver")),t.Q6J("ngModel",n.note.receiver),t.xp6(5),t.hij(" ",t.lcZ(114,96,"transfer-note-add.delivery-address")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(116,98,"transfer-note-add.enter-delivery-address")),t.Q6J("ngModel",n.note.deliveryAddress))},dependencies:[u.sg,u.O5,d.JJ,d.On,a.oU,a.YG,a.Sm,a.nz,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Ie,a.rH,a.Q$,a.q_,a.Nd,a.yW,a.wd,a.sr,a.w,a.as,a.j9,a.cs,Lt.Y,H.F,Jt.L,P.BN,u.H9,y.X$],encapsulation:2}),r})();var se=f(9921);function le(r,s){if(1&r&&(t.TgZ(0,"td",15),t._UZ(1,"img",16),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.shop.iconUrl,t.LSH)}}function de(r,s){if(1&r&&(t.TgZ(0,"span")(1,"b"),t._uU(2),t.qZA(),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(2),t.Oqu(e.shop.name)}}function pe(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.phone"),": ",e.shop.phone,"")}}function ue(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.email"),": ",e.shop.email,"")}}function _e(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.facebook"),": ",e.shop.facebook,"")}}function fe(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.address"),": ",e.shop.address,"")}}function me(r,s){if(1&r&&(t.TgZ(0,"table",11)(1,"tr",12),t.YNc(2,le,2,1,"td",13),t.TgZ(3,"td",14),t.YNc(4,de,4,1,"span",10),t.YNc(5,pe,4,4,"span",10),t.YNc(6,ue,4,4,"span",10),t.YNc(7,_e,4,4,"span",10),t.YNc(8,fe,4,4,"span",10),t.qZA()()()),2&r){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",e.shop.iconUrl),t.xp6(2),t.Q6J("ngIf",e.shop&&e.shop.name),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.phone),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.email),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.facebook),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.address)}}const lt=function(r,s,e){return[r,s,"symbol","1.0-2",e]};function he(r,s){if(1&r&&(t.TgZ(0,"tr")(1,"td",7),t._uU(2),t.qZA(),t.TgZ(3,"td",7),t._uU(4),t.qZA(),t.TgZ(5,"td",8),t._uU(6),t.ALo(7,"currency"),t.qZA(),t.TgZ(8,"td",8),t._uU(9),t.qZA(),t.TgZ(10,"td",8),t._uU(11),t.qZA(),t.TgZ(12,"td",8),t._uU(13),t.ALo(14,"currency"),t.qZA(),t.TgZ(15,"td",8),t._uU(16),t.qZA()()),2&r){const e=s.$implicit,n=s.index,o=t.oxw();t.xp6(2),t.lnq("",n+1,". ",e.productCode?e.productCode.toUpperCase()+"-":"","",e.productName,""),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(t.G7q(7,9,t.kEZ(21,lt,e.unitPrice,o.currency,o.translateService.currentLang))),t.xp6(3),t.Oqu(e.actualExport),t.xp6(2),t.Oqu(e.actualImport),t.xp6(2),t.Oqu(t.G7q(14,15,t.kEZ(25,lt,e.amount,o.currency,o.translateService.currentLang))),t.xp6(3),t.Oqu(e.note)}}function ge(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"transfer-note-add.export-store"),": ",e.note.exportStore.name,"")}}function xe(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"transfer-note-add.import-store"),": ",e.note.importStore.name,"")}}function Ze(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"transfer-note-add.delivery-person"),": ",e.note.deliverer,"")}}function Te(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"transfer-note-add.receiver"),": ",e.note.receiver,"")}}function Ce(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"transfer-note-add.transportation"),": ",e.note.transportation,"")}}function Ae(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"transfer-note-add.delivery-address"),": ",e.note.deliveryAddress,"")}}let ve=(()=>{class r{constructor(e,n,o,i,c,h){this.navCtrl=e,this.translateService=n,this.printer=o,this.dataService=i,this.storeService=c,this.userService=h,this.params=null,this.note={}}ngOnInit(){this.reload()}reload(){var e=this;return(0,p.Z)(function*(){e.userService.getAttr("current-currency").then(o=>{e.currency=o});const n=yield e.storeService.getCurrentStore();if(e.shop=n||(yield e.dataService.getFirstObject("shop")),e.note={},e.params=e.navCtrl.getParams(e.params),e.params&&e.params.note){e.note=e.params.note;let o="",i="";0!=e.note.contactId&&e.note.contact&&e.note.contact.fullName&&(o=e.note.contact.fullName),0!=e.note.contactId&&e.note.contact&&e.note.contact.mobile&&(i=e.note.contact.mobile),0==e.note.contactId&&e.note.contactName&&(o=e.note.contactName),0==e.note.contactId&&e.note.contactPhone&&(i=e.note.contactPhone),e.noteCustomer=(o||"...")+" | "+(i||"..."),setTimeout((0,p.Z)(function*(){const h=document.getElementById("print-page").innerHTML;if(e.navCtrl.isNotCordova())return v.W.webPrint(h,500),void e.navCtrl.back();yield e.printer.print(h,{orientation:"landscape"}),e.navCtrl.back()}),1e3)}})()}dateFormat(e){return C.C.toUiDateString(e)}dateTimeFormat(e){return C.C.toUiString(e)}productName(e,n){return v.W.productName(e,n)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(Z.G),t.Y36(y.sK),t.Y36(se.F),t.Y36($.D),t.Y36(j.d),t.Y36(b.K))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-detail-print"]],decls:62,vars:44,consts:[["id","print-page",2,"padding","5px"],["style","width: 100%; border: 0px;",4,"ngIf"],[2,"text-align","center"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"hr"],[2,"width","100%"],["nowrap",""],[2,"text-align","right"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"width","100%","border","0px"],[2,"border-bottom","1px solid #ccc"],["style","padding: 10px;",4,"ngIf"],[2,"padding","10px","text-align","center","vertical-align","text-top"],[2,"padding","10px"],[2,"max-width","100px",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,me,9,6,"table",1),t.TgZ(2,"div",2)(3,"h2",3),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"b",4),t._uU(7),t.ALo(8,"translate"),t.qZA(),t._UZ(9,"br"),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t._UZ(13,"br"),t.TgZ(14,"span"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t._UZ(17,"hr",5),t.TgZ(18,"table",6)(19,"thead")(20,"td",7)(21,"b"),t._uU(22),t.ALo(23,"translate"),t.qZA()(),t.TgZ(24,"td",7)(25,"b"),t._uU(26),t.ALo(27,"translate"),t.qZA()(),t.TgZ(28,"td",8)(29,"b"),t._uU(30),t.ALo(31,"translate"),t.qZA()(),t.TgZ(32,"td",8)(33,"b"),t._uU(34),t.ALo(35,"translate"),t.qZA()(),t.TgZ(36,"td",8)(37,"b"),t._uU(38),t.ALo(39,"translate"),t.qZA()(),t.TgZ(40,"td",8)(41,"b"),t._uU(42),t.ALo(43,"translate"),t.qZA()(),t.TgZ(44,"td",8)(45,"b"),t._uU(46),t.ALo(47,"translate"),t.qZA()()(),t.TgZ(48,"tbody"),t.YNc(49,he,17,29,"tr",9),t._UZ(50,"tr"),t.qZA()(),t.YNc(51,ge,3,4,"span",10),t._UZ(52,"br"),t.YNc(53,xe,3,4,"span",10),t._UZ(54,"br"),t.YNc(55,Ze,3,4,"span",10),t._UZ(56,"br"),t.YNc(57,Te,3,4,"span",10),t._UZ(58,"br"),t.YNc(59,Ce,3,4,"span",10),t._UZ(60,"br"),t.YNc(61,Ae,3,4,"span",10),t.qZA()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.shop),t.xp6(3),t.Oqu(t.lcZ(5,22,"received-note-detail.received-note-print-title")),t.xp6(3),t.AsE("",t.lcZ(8,24,"received-note-detail.code"),": #",n.note.id,""),t.xp6(4),t.AsE("",t.lcZ(12,26,"order-print.date"),": ",n.dateFormat(n.note.createdAt),""),t.xp6(4),t.AsE("",t.lcZ(16,28,"received-note-detail.contact-info"),": ",n.noteCustomer,""),t.xp6(7),t.Oqu(t.lcZ(23,30,"received-note-print.product-name")),t.xp6(4),t.Oqu(t.lcZ(27,32,"received-note-print.product-unit")),t.xp6(4),t.Oqu(t.lcZ(31,34,"received-note-print.product-unit-price")),t.xp6(4),t.Oqu(t.lcZ(35,36,"transfer-note-add.product-export-count")),t.xp6(4),t.Oqu(t.lcZ(39,38,"transfer-note-add.product-import-count")),t.xp6(4),t.Oqu(t.lcZ(43,40,"received-note-print.product-total")),t.xp6(4),t.Oqu(t.lcZ(47,42,"received-note-print.product-note")),t.xp6(3),t.Q6J("ngForOf",n.note.items),t.xp6(2),t.Q6J("ngIf",n.note&&n.note.exportStore),t.xp6(2),t.Q6J("ngIf",n.note&&n.note.importStore),t.xp6(2),t.Q6J("ngIf",n.note&&n.note.deliverer),t.xp6(2),t.Q6J("ngIf",n.note&&n.note.receiver),t.xp6(2),t.Q6J("ngIf",n.note&&n.note.transportation),t.xp6(2),t.Q6J("ngIf",n.note&&n.note.deliveryAddress))},dependencies:[u.sg,u.O5,u.H9,y.X$],encapsulation:2}),r})();var dt=f(1001);function ye(r,s){if(1&r&&(t.TgZ(0,"td",15),t._UZ(1,"img",16),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.shop.iconUrl,t.LSH)}}function Se(r,s){if(1&r&&(t.TgZ(0,"span")(1,"b"),t._uU(2),t.qZA(),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(2),t.Oqu(e.shop.name)}}function Ne(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.phone"),": ",e.shop.phone,"")}}function be(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.email"),": ",e.shop.email,"")}}function Me(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.facebook"),": ",e.shop.facebook,"")}}function Ie(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t._UZ(3,"br"),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.address"),": ",e.shop.address,"")}}function Ue(r,s){if(1&r&&(t.TgZ(0,"table",11)(1,"tr",12),t.YNc(2,ye,2,1,"td",13),t.TgZ(3,"td",14),t.YNc(4,Se,4,1,"span",10),t.YNc(5,Ne,4,4,"span",10),t.YNc(6,be,4,4,"span",10),t.YNc(7,Me,4,4,"span",10),t.YNc(8,Ie,4,4,"span",10),t.qZA()()()),2&r){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",e.shop.iconUrl),t.xp6(2),t.Q6J("ngIf",e.shop&&e.shop.name),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.phone),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.email),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.facebook),t.xp6(1),t.Q6J("ngIf",e.shop&&e.shop.address)}}const K=function(r,s,e){return[r,s,"symbol","1.0-2",e]};function qe(r,s){if(1&r&&(t.TgZ(0,"tr")(1,"td",7),t._uU(2),t.qZA(),t.TgZ(3,"td",7),t._uU(4),t.qZA(),t.TgZ(5,"td",7),t._uU(6),t.qZA(),t.TgZ(7,"td",8),t._uU(8),t.ALo(9,"currency"),t.qZA(),t.TgZ(10,"td",8),t._uU(11),t.qZA(),t.TgZ(12,"td",8),t._uU(13),t.ALo(14,"currency"),t.qZA(),t.TgZ(15,"td",8),t._uU(16),t.ALo(17,"currency"),t.qZA(),t.TgZ(18,"td",8),t._uU(19),t.qZA()()),2&r){const e=s.$implicit,n=t.oxw();t.xp6(2),t.Oqu(e.productCode),t.xp6(2),t.Oqu(e.productName),t.xp6(2),t.Oqu(e.unit),t.xp6(2),t.Oqu(t.G7q(9,8,t.kEZ(26,K,e.unitPrice,n.currency,n.translateService.currentLang))),t.xp6(3),t.Oqu(e.quantity),t.xp6(2),t.Oqu(t.G7q(14,14,t.kEZ(30,K,e.discount,n.currency,n.translateService.currentLang))),t.xp6(3),t.Oqu(t.G7q(17,20,t.kEZ(34,K,e.amount,n.currency,n.translateService.currentLang))),t.xp6(3),t.Oqu(e.note)}}function Pe(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.hij("(",e.receivedNote.foreignCurrency,")")}}let we=(()=>{class r{constructor(e,n,o,i,c,h){this.navCtrl=e,this.dataService=n,this.currencyPipe=o,this.storeService=i,this.translateService=c,this.userService=h,this.params=null,this.receivedNote=new dt.Y}ngOnInit(){this.reload()}reload(){var e=this;return(0,p.Z)(function*(){e.userService.getAttr("current-currency").then(o=>{e.currency=o});const n=yield e.storeService.getCurrentStore();if(e.shop=n||(yield e.dataService.getFirstObject("shop")),e.receivedNote=new dt.Y,e.params=e.navCtrl.getParams(e.params),e.params&&e.params.receivedNote){e.receivedNote=e.params.receivedNote;let o="",i="";0!=e.receivedNote.contactId&&e.receivedNote.contact&&e.receivedNote.contact.fullName&&(o=e.receivedNote.contact.fullName),0!=e.receivedNote.contactId&&e.receivedNote.contact&&e.receivedNote.contact.mobile&&(i=e.receivedNote.contact.mobile),0==e.receivedNote.contactId&&e.receivedNote.contactName&&(o=e.receivedNote.contactName),0==e.receivedNote.contactId&&e.receivedNote.contactPhone&&(i=e.receivedNote.contactPhone),e.noteCustomer=(o||"...")+" | "+(i||"..."),setTimeout((0,p.Z)(function*(){yield e.shareNote(),e.navCtrl.back()}),1e3)}})()}shareNote(){var e=this;return(0,p.Z)(function*(){if(e.navCtrl.isNotCordova())return void alert(e.translateService.instant("common.feature-only-on-app"));const n=e.currencyPipe.transform(e.receivedNote.total,e.currency,!0,"1.0-2"),o=e.currencyPipe.transform(e.receivedNote.shippingFee,e.currency,!0,"1.0-2"),i=e.currencyPipe.transform(e.receivedNote.tax,e.currency,!0,"1.0-2"),c=[e.translateService.instant("received-note-add.code")+": #"+e.receivedNote.id,e.translateService.instant("received-note-add.total")+": "+n];0!=e.receivedNote.shippingFee&&c.push(e.translateService.instant("received-note-add.shipping-fee")+": "+o),0!=e.receivedNote.tax&&c.push(e.translateService.instant("received-note-add.tax")+": "+i);let h="",T="";0!=e.receivedNote.contactId&&e.receivedNote.contact&&e.receivedNote.contact.fullName&&(h=e.receivedNote.contact.fullName),0!=e.receivedNote.contactId&&e.receivedNote.contact&&e.receivedNote.contact.mobile&&(T=e.receivedNote.contact.mobile),0==e.receivedNote.contactId&&e.receivedNote.contactName&&(h=e.receivedNote.contactName),0==e.receivedNote.contactId&&e.receivedNote.contactPhone&&(T=e.receivedNote.contactPhone);const S=[];h&&S.push(h),T&&S.push(T);const q=S&&S.length>0?S.join(" - "):"";q&&c.push(q);const m=c.join(" - ");yield e.userService.shareScreenshot(m)})()}dateFormat(e){return C.C.toUiDateString(e)}dateTimeFormat(e){return C.C.toUiString(e)}productName(e,n){return v.W.productName(e,n)}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(Z.G),t.Y36($.D),t.Y36(u.H9),t.Y36(j.d),t.Y36(y.sK),t.Y36(b.K))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-detail-share"]],decls:85,vars:116,consts:[["id","print-page",2,"padding","5px"],["style","width: 100%; border: 0px;",4,"ngIf"],[2,"text-align","center"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"hr"],[2,"width","100%"],["nowrap",""],[2,"text-align","right"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"width","100%","border","0px"],[2,"border-bottom","1px solid #ccc"],["style","padding: 10px;",4,"ngIf"],[2,"padding","10px","text-align","center","vertical-align","text-top"],[2,"padding","10px"],[2,"max-width","100px",3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"div",0),t.YNc(1,Ue,9,6,"table",1),t.TgZ(2,"div",2)(3,"h2",3),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"b",4),t._uU(7),t.ALo(8,"translate"),t.qZA(),t._UZ(9,"br"),t.TgZ(10,"span"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t._UZ(13,"br"),t.TgZ(14,"span"),t._uU(15),t.ALo(16,"translate"),t.qZA(),t._UZ(17,"hr",5),t.TgZ(18,"table",6)(19,"thead")(20,"td",7)(21,"b"),t._uU(22),t.ALo(23,"translate"),t.qZA()(),t.TgZ(24,"td",7)(25,"b"),t._uU(26),t.ALo(27,"translate"),t.qZA()(),t.TgZ(28,"td",7)(29,"b"),t._uU(30),t.ALo(31,"translate"),t.qZA()(),t.TgZ(32,"td",8)(33,"b"),t._uU(34),t.ALo(35,"translate"),t.qZA()(),t.TgZ(36,"td",8)(37,"b"),t._uU(38),t.ALo(39,"translate"),t.qZA()(),t.TgZ(40,"td",8)(41,"b"),t._uU(42),t.ALo(43,"translate"),t.qZA()(),t.TgZ(44,"td",8)(45,"b"),t._uU(46),t.ALo(47,"translate"),t.qZA()(),t.TgZ(48,"td",8)(49,"b"),t._uU(50),t.ALo(51,"translate"),t.qZA()()(),t.TgZ(52,"tbody"),t.YNc(53,qe,20,38,"tr",9),t._UZ(54,"tr"),t.qZA()(),t._UZ(55,"hr",5),t.TgZ(56,"b"),t._uU(57),t.ALo(58,"translate"),t.ALo(59,"currency"),t.qZA(),t._UZ(60,"hr",5),t.TgZ(61,"span"),t._uU(62),t.ALo(63,"translate"),t.ALo(64,"currency"),t.qZA(),t._UZ(65,"br"),t.TgZ(66,"span"),t._uU(67),t.ALo(68,"translate"),t.ALo(69,"currency"),t.qZA(),t._UZ(70,"br"),t.TgZ(71,"span"),t._uU(72),t.ALo(73,"translate"),t.ALo(74,"currency"),t.qZA(),t._UZ(75,"br"),t.TgZ(76,"span"),t._uU(77),t.ALo(78,"translate"),t.ALo(79,"currency"),t.qZA(),t._UZ(80,"br"),t.TgZ(81,"span"),t._uU(82),t.ALo(83,"translate"),t.YNc(84,Pe,2,1,"span",10),t.qZA()()),2&e&&(t.xp6(1),t.Q6J("ngIf",n.shop),t.xp6(3),t.Oqu(t.lcZ(5,30,"received-note-detail.received-note-print-title")),t.xp6(3),t.AsE("",t.lcZ(8,32,"received-note-detail.code"),": #",n.receivedNote.id,""),t.xp6(4),t.AsE("",t.lcZ(12,34,"order-print.date"),": ",n.dateFormat(n.receivedNote.createdAt),""),t.xp6(4),t.AsE("",t.lcZ(16,36,"received-note-detail.contact-info"),": ",n.noteCustomer,""),t.xp6(7),t.Oqu(t.lcZ(23,38,"received-note-print.product-code")),t.xp6(4),t.Oqu(t.lcZ(27,40,"received-note-print.product-name")),t.xp6(4),t.Oqu(t.lcZ(31,42,"received-note-print.product-unit")),t.xp6(4),t.Oqu(t.lcZ(35,44,"received-note-print.product-unit-price")),t.xp6(4),t.Oqu(t.lcZ(39,46,"received-note-print.product-count")),t.xp6(4),t.Oqu(t.lcZ(43,48,"received-note-print.product-discount")),t.xp6(4),t.Oqu(t.lcZ(47,50,"received-note-print.product-total")),t.xp6(4),t.Oqu(t.lcZ(51,52,"received-note-print.product-note")),t.xp6(3),t.Q6J("ngForOf",n.receivedNote.items),t.xp6(4),t.AsE("",t.lcZ(58,54,"received-note-add.total"),": ",t.G7q(59,56,t.kEZ(96,K,n.receivedNote.total,n.currency,n.translateService.currentLang)),""),t.xp6(5),t.AsE("",t.lcZ(63,62,"received-note-add.net-value"),": ",t.G7q(64,64,t.kEZ(100,K,n.receivedNote.netValue,n.currency,n.translateService.currentLang)),""),t.xp6(5),t.AsE("",t.lcZ(68,70,"received-note-add.tax"),": ",t.G7q(69,72,t.kEZ(104,K,n.receivedNote.tax,n.currency,n.translateService.currentLang)),""),t.xp6(5),t.AsE("",t.lcZ(73,78,"received-note-add.shipping-fee"),": ",t.G7q(74,80,t.kEZ(108,K,n.receivedNote.shippingFee,n.currency,n.translateService.currentLang)),""),t.xp6(5),t.AsE("",t.lcZ(78,86,"received-note-add.paid"),": ",t.G7q(79,88,t.kEZ(112,K,n.receivedNote.paid,n.currency,n.translateService.currentLang)),""),t.xp6(5),t.AsE("",t.lcZ(83,94,"received-note-add.total-foreign"),": ",n.receivedNote.totalForeign,"\xa0"),t.xp6(2),t.Q6J("ngIf",n.receivedNote.foreignCurrency))},dependencies:[u.sg,u.O5,u.H9,y.X$],encapsulation:2}),r})();var nt=f(7060);function Le(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw(),n=e.index,o=e.$implicit;t.xp6(1),t.AsE("",n+1,". ",o.productCode,"-")}}function Je(r,s){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.note)}}const pt=function(r,s,e){return[r,s,"symbol","1.0-2",e]};function Ee(r,s){if(1&r&&(t.TgZ(0,"ion-item")(1,"ion-label",15)(2,"ion-text"),t.YNc(3,Le,2,2,"span",7),t._uU(4),t.TgZ(5,"span",16),t._UZ(6,"br"),t._uU(7),t.ALo(8,"translate"),t.ALo(9,"translate"),t.ALo(10,"translate"),t._UZ(11,"br"),t._uU(12),t.ALo(13,"translate"),t.ALo(14,"currency"),t.ALo(15,"translate"),t.ALo(16,"currency"),t.qZA()(),t.YNc(17,Je,2,1,"p",7),t.qZA()()),2&r){const e=s.$implicit,n=t.oxw(2);t.xp6(3),t.Q6J("ngIf",e.productCode),t.xp6(1),t.hij("",e.productName," "),t.xp6(3),t.gL8(" ",t.lcZ(8,13,"transfer-note-add.product-export-count"),": ",e.actualExport," - ",t.lcZ(9,15,"transfer-note-add.product-import-count"),": ",e.actualImport," - ",t.lcZ(10,17,"transfer-note-add.product-unit"),": ",e.unit," "),t.xp6(5),t.HOy(" ",t.lcZ(13,19,"transfer-note-add.product-unit-price"),": ",t.G7q(14,21,t.kEZ(35,pt,e.unitPrice,n.currency,n.translateService.currentLang))," - ",t.lcZ(15,27,"transfer-note-add.product-total"),": ",t.G7q(16,29,t.kEZ(39,pt,e.amount,n.currency,n.translateService.currentLang))," "),t.xp6(5),t.Q6J("ngIf",e.note)}}function ke(r,s){if(1&r&&(t.TgZ(0,"ion-text",2),t._uU(1),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.Oqu(e.note.exportStore.name)}}function Oe(r,s){if(1&r&&(t.TgZ(0,"ion-text",2),t._uU(1),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.Oqu(e.note.importStore.name)}}function Ye(r,s){if(1&r&&(t.TgZ(0,"div")(1,"ion-list")(2,"ion-item",9)(3,"ion-text",10),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"ion-text",2),t._uU(7),t.qZA()(),t.TgZ(8,"ion-item",9)(9,"ion-text"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"ion-text",2),t._uU(13),t.qZA()()(),t.TgZ(14,"ion-item-divider",11),t._uU(15),t.ALo(16,"translate"),t.qZA(),t.TgZ(17,"ion-list",12),t.YNc(18,Ee,18,43,"ion-item",13),t.qZA(),t.TgZ(19,"ion-list")(20,"ion-item-divider",11),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.TgZ(23,"ion-item")(24,"ion-text"),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.YNc(27,ke,2,1,"ion-text",14),t.qZA(),t.TgZ(28,"ion-item")(29,"ion-text"),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.YNc(32,Oe,2,1,"ion-text",14),t.qZA(),t.TgZ(33,"ion-item")(34,"ion-text"),t._uU(35),t.ALo(36,"translate"),t.qZA(),t.TgZ(37,"ion-text",2),t._uU(38),t.qZA()(),t.TgZ(39,"ion-item")(40,"ion-text"),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-text",2),t._uU(44),t.qZA()(),t.TgZ(45,"ion-item")(46,"ion-text"),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"ion-text",2),t._uU(50),t.qZA()(),t.TgZ(51,"ion-item")(52,"ion-text"),t._uU(53),t.ALo(54,"translate"),t.qZA(),t.TgZ(55,"ion-text",2),t._uU(56),t.qZA()()()()),2&r){const e=t.oxw();t.xp6(4),t.hij("",t.lcZ(5,20,"transfer-note-add.code"),":"),t.xp6(3),t.hij("#",e.note.id,""),t.xp6(3),t.hij("",t.lcZ(11,22,"transfer-note-add.date"),":"),t.xp6(3),t.Oqu(e.dateFormat(e.note.createdAt)),t.xp6(2),t.hij(" ",t.lcZ(16,24,"transfer-note-add.product")," "),t.xp6(2),t.Q6J("hidden",!e.note.items||0==e.note.items.length),t.xp6(1),t.Q6J("ngForOf",e.note.items),t.xp6(3),t.hij(" ",t.lcZ(22,26,"transfer-note-add.delivery-info")," "),t.xp6(4),t.hij("",t.lcZ(26,28,"transfer-note-add.export-store"),":"),t.xp6(2),t.Q6J("ngIf",e.note.exportStore),t.xp6(3),t.hij("",t.lcZ(31,30,"transfer-note-add.import-store"),":"),t.xp6(2),t.Q6J("ngIf",e.note.importStore),t.xp6(3),t.hij("",t.lcZ(36,32,"transfer-note-add.delivery-person"),":"),t.xp6(3),t.Oqu(e.note.deliverer),t.xp6(3),t.hij("",t.lcZ(42,34,"transfer-note-add.receiver"),":"),t.xp6(3),t.Oqu(e.note.receiver),t.xp6(3),t.hij("",t.lcZ(48,36,"transfer-note-add.transportation"),":"),t.xp6(3),t.Oqu(e.note.transportation),t.xp6(3),t.hij("",t.lcZ(54,38,"transfer-note-add.delivery-address"),":"),t.xp6(3),t.Oqu(e.note.deliveryAddress)}}function Qe(r,s){1&r&&(t.TgZ(0,"div",17),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"common.record-deleted-alert")," "))}let Fe=(()=>{class r{constructor(e,n,o,i,c,h,T,S,q,m,E,Y,B){var A=this;this.navCtrl=e,this.translateService=n,this.transferNoteService=o,this.contactService=i,this.userService=c,this.storeService=h,this.actionSheetCtrl=T,this.excelService=S,this.alertCtrl=q,this.analyticsService=m,this.tradeService=E,this.productService=Y,this.dataService=B,this.params=null,this.note={},this.isDisabled=!1,this.tab="info",this.stores=[],this.reload=(0,p.Z)(function*(){A.currency=yield A.userService.getAttr("current-currency"),A.mainStore=yield A.dataService.getFirstObject("shop"),A.note={};const N=A.params?A.params:A.navCtrl.getParams();if(A.params=N,N&&N.id&&N.id>0){const F=N.id,_=yield A.navCtrl.loading();A.transferNoteService.get(F).then(function(){var k=(0,p.Z)(function*(I){A.note=I,A.mainStore.isMainShop=!0,A.note.exportStore=A.note.exportStoreId&&A.stores&&A.stores.length?A.stores.find(G=>G.id==A.note.exportStoreId):A.mainStore,A.note.importStore=A.note.importStoreId&&A.stores&&A.stores.length?A.stores.find(G=>G.id==A.note.importStoreId):A.mainStore,I&&(A.note.items=I&&I.itemsJson?JSON.parse(I.itemsJson):[],yield _.dismiss())});return function(I){return k.apply(this,arguments)}}())}});const Q=N=>{this.note&&N.detail.id===this.note.id&&this.reload()};this.navCtrl.unsubscribe("reloadTransferNote",Q),this.navCtrl.subscribe("reloadTransferNote",Q)}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("transfer-note-detail")})()}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.stores=yield e.storeService.getStores(),e.reload()})()}isNotCordova(){return this.navCtrl.isNotCordova()}call(){this.saveLastActive("call"),v.W.callPhone(this.note.contact.mobile)}text(){this.saveLastActive("text"),v.W.sendSms(this.note.contact.mobile)}saveLastActive(e){return this.note.contact.lastActive=C.C.toDbString(),this.note.contact.lastAction=e,this.contactService.saveContact(this.note.contact).then(n=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.note.contact),n))}contactImageOrPlaceholder(){return v.W.contactImageOrPlaceholder(this.note.contact.avatarUrl)}dateFormat(e){return C.C.toUiLocalDateTimeString(e)}actionIcon(e){return v.W.actionIcon(e)}dateTimeFormat(e){return C.C.toUiString(e)}edit(){this.navCtrl.push("/transfer-note/add",{id:this.note.id})}presentActionSheet(){var e=this;return(0,p.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("transfer-note.delete-transfer-note"),role:"destructive",handler:()=>{e.delete()}},{text:e.translateService.instant("transfer-note-detail.share"),handler:()=>{e.share()}},{text:e.translateService.instant("transfer-note-detail.print"),handler:()=>{e.print()}},{text:e.translateService.instant("transfer-note-detail.export"),handler:()=>{e.export()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}delete(){var e=this;return(0,p.Z)(function*(){var o;yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("transfer-note.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:(o=(0,p.Z)(function*(){yield e.deleteRelated(),e.transferNoteService.delete(e.note).then((0,p.Z)(function*(){e.analyticsService.logEvent("transfer-note-detail-delete-success"),e.navCtrl.publish("reloadTransferNoteList"),e.navCtrl.publish("reloadContact",e.note.contact),e.navCtrl.pop()}))}),function(){return o.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}deleteRelated(){var e=this;return(0,p.Z)(function*(){const n=[],o=yield e.tradeService.getTradesByTransferNote(e.note.id);for(const c of o)c.debtId||n.push(e.tradeService.deleteTrade(c));const i=yield e.productService.getNotesByTransferNote(e.note.id);for(const c of i)n.push(e.productService.deleteProductNote(c));yield Promise.all(n)})()}productName(e,n){return v.W.productName(e,n)}share(){this.navCtrl.push("/transfer-note/detail-share",{note:this.note})}print(){this.navCtrl.push("/transfer-note/detail-print",{note:this.note})}export(){var e=this;return(0,p.Z)(function*(){const n=yield e.navCtrl.loading(),o="transfer-note-detail-"+e.note.id+".xlsx";e.excelService.createTransferNoteFile(o,e.note.id).then(function(){var i=(0,p.Z)(function*(c){yield n.dismiss(),e.analyticsService.logEvent("transfer-note-export-downloaded"),e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+c,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFileUrl(o,o,c))});return function(c){return i.apply(this,arguments)}}()).catch((0,p.Z)(function*(){yield n.dismiss()}))})()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(Z.G),t.Y36(y.sK),t.Y36(tt.u),t.Y36(g.y),t.Y36(b.K),t.Y36(j.d),t.Y36(a.BX),t.Y36(nt.x),t.Y36(a.Br),t.Y36(M.y),t.Y36(et.X),t.Y36(x.M),t.Y36($.D))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-detail"]],decls:17,vars:7,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","print"],["name","ellipsis-vertical"],[4,"ngIf"],["class","ion-padding",4,"ngIf"],["lines","none"],["color","primary"],["color","light"],[3,"hidden"],[4,"ngFor","ngForOf"],["slot","end",4,"ngIf"],[1,"ion-text-wrap"],[2,"font-size","0.9em"],[1,"ion-padding"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return n.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",3),t.NdJ("click",function(){return n.print()}),t._UZ(11,"ion-icon",5),t.qZA(),t.TgZ(12,"ion-button",3),t.NdJ("click",function(){return n.presentActionSheet()}),t._UZ(13,"ion-icon",6),t.qZA()()()(),t.TgZ(14,"ion-content"),t.YNc(15,Ye,57,40,"div",7),t.YNc(16,Qe,3,3,"div",8),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,5,"transfer-note-add.detail-title")),t.xp6(9),t.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.Q6J("ngIf",n.note),t.xp6(1),t.Q6J("ngIf",!n.note))},dependencies:[u.sg,u.O5,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.rH,a.Q$,a.q_,a.yW,a.wd,a.sr,a.cs,u.H9,y.X$],encapsulation:2}),r})();const De=["fileUploadInput"];function Ke(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item",13)(1,"ion-label",14),t._uU(2),t.qZA(),t.TgZ(3,"ion-buttons")(4,"ion-button",15),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.exitStore())}),t._UZ(5,"ion-icon",16),t._uU(6),t.ALo(7,"translate"),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(2),t.Oqu(e.checkStore),t.xp6(4),t.hij(" ",t.lcZ(7,2,"store.exit-store")," ")}}function Ge(r,s){1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"received-note-import.upload-received-note")))}function He(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.fileToUpload.name)}}let je=(()=>{class r{constructor(e,n,o,i,c,h,T,S,q){this.userService=e,this.excelService=n,this.navCtrl=o,this.platform=i,this.alertCtrl=c,this.translateService=h,this.storeService=T,this.staffService=S,this.analyticsService=q,this.uploadDisabled=!1,this.receivedNotesImported=[],this.isMobile=!0}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("received-note-import")})()}ngOnInit(){var e=this;return(0,p.Z)(function*(){e.isMobile=e.platform.width()<720,e.platform.resize.subscribe(()=>{e.isMobile=e.platform.width()<720}),yield e.reload()})()}reload(){var e=this;return(0,p.Z)(function*(){e.store=yield e.storeService.getCurrentStore(),e.checkStore=e.store?e.translateService.instant("store.check-store",{shop:e.store.name}):null,e.selectedStaff=e.staffService.selectedStaff})()}downloadTemplate(){var e=this;return(0,p.Z)(function*(){e.analyticsService.logEvent("received-note-import-download");const n="received-note-template.xlsx";e.excelService.downloadReceivedNoteTemplate(n).then(function(){var o=(0,p.Z)(function*(i){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+i,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFileUrl(n,n,i))});return function(i){return o.apply(this,arguments)}}())})()}rememberFile(e){this.fileToUpload=e.target.files[0],this.uploadNote()}uploadNote(){var e=this;return(0,p.Z)(function*(){e.analyticsService.logEvent("received-note-import-upload"),e.uploadDisabled=!0;const n=yield e.navCtrl.loading(6e4);e.excelService.uploadReceivedNoteFile(e.fileToUpload,e.store?e.store.id:null).then(function(){var o=(0,p.Z)(function*(i){if(yield n.dismiss(),i&&i.id)return e.analyticsService.logEvent("received-note-import-uploaded-success"),e.navCtrl.pop(),e.navCtrl.publish("reloadReceivedNoteList",null),void setTimeout(()=>{e.navCtrl.push("/received-note/detail",{id:i.id})},100);if(i&&i.error){e.analyticsService.logEvent("received-note-import-error");let c=i.error+"";c=c.replace("{","").replace("}","");const h=c.split(":");c="",c=h.length>=2?e.translateService.instant("received-note-import."+h[0])+h[1]:e.translateService.instant("received-note-import."+h[0]),alert(c)}else alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later).");e.uploadDisabled=!1,e.fileToUpload=null,e.fileUploadInput.nativeElement.value=null});return function(i){return o.apply(this,arguments)}}()).catch((0,p.Z)(function*(){yield n.dismiss(),alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later)."),e.uploadDisabled=!1,e.fileToUpload=null,e.fileUploadInput.nativeElement.value=null}))})()}exitStore(){var e=this;return(0,p.Z)(function*(){var o;yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("store.exit-store-alert",{shop:e.store.name}),buttons:[{text:e.translateService.instant("common.agree"),handler:(o=(0,p.Z)(function*(){yield e.storeService.exitStore(),yield e.reload()}),function(){return o.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(b.K),t.Y36(nt.x),t.Y36(Z.G),t.Y36(a.t4),t.Y36(a.Br),t.Y36(y.sK),t.Y36(j.d),t.Y36(l.x),t.Y36(M.y))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-import"]],viewQuery:function(e,n){if(1&e&&t.Gf(De,5),2&e){let o;t.iGM(o=t.CRH())&&(n.fileUploadInput=o.first)}},decls:27,vars:17,consts:[["slot","start"],["defaultHref","/home"],["lines","none","color","success",4,"ngIf"],[1,"ion-padding"],["expand","block","fill","outline","color","secondary",3,"click"],["slot","start","name","download"],[3,"innerHTML"],["color","primary","for","files",2,"border-radius","10px","display","block","border","1px solid #387ef5","text-transform","uppercase","text-align","center"],[2,"color","#387ef5","height","45px","display","flex","align-items","center","justify-content","center"],["name","cloud-upload","color","primary",2,"zoom","1.5"],[4,"ngIf"],["type","file","accept",".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","id","files",2,"width","0","height","0","font-size","0",3,"change"],["fileUploadInput",""],["lines","none","color","success"],[1,"ion-text-wrap"],["size","small",3,"click"],["name","exit","slot","start","size","small"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.YNc(7,Ke,8,4,"ion-item",2),t.qZA(),t.TgZ(8,"ion-content")(9,"div",3)(10,"p"),t._uU(11),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"ion-button",4),t.NdJ("click",function(){return n.downloadTemplate()}),t._UZ(14,"ion-icon",5),t._uU(15),t.ALo(16,"translate"),t.qZA(),t._UZ(17,"p",6),t.ALo(18,"translate"),t.TgZ(19,"label",7)(20,"div",8),t._UZ(21,"ion-icon",9),t._uU(22," \xa0 "),t.YNc(23,Ge,3,3,"span",10),t.YNc(24,He,2,1,"span",10),t.qZA()(),t.TgZ(25,"input",11,12),t.NdJ("change",function(i){return n.rememberFile(i)}),t.qZA()()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,9,"received-note-import.title")),t.xp6(2),t.Q6J("ngIf",n.checkStore&&(null==n.selectedStaff||n.selectedStaff.hasFullAccess&&!n.selectedStaff.storeId)),t.xp6(1),t.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(3),t.Oqu(t.lcZ(12,11,"received-note-import.template-note")),t.xp6(4),t.hij("\xa0 ",t.lcZ(16,13,"received-note-import.download-template")," "),t.xp6(2),t.Q6J("innerHTML",t.lcZ(18,15,"received-note-import.note"),t.oJD),t.xp6(6),t.Q6J("ngIf",!n.fileToUpload),t.xp6(1),t.Q6J("ngIf",n.fileToUpload))},dependencies:[u.O5,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.Q$,a.wd,a.sr,a.cs,y.X$],encapsulation:2}),r})();var W=f(7489),Be=f(4433),Ve=f(3064);function $e(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE(" - ",t.lcZ(2,2,"transfer-note-add.export-store"),": ",e.note.exportStore.name,"")}}function We(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.AsE(" - ",t.lcZ(2,2,"transfer-note-add.import-store"),": ",e.note.importStore.name,"")}}function ze(r,s){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.note.contact.fullName)}}function Re(r,s){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.note.contactName)}}function Xe(r,s){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Oqu(e.note.contactPhone)}}function tn(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw(),n=e.index,o=e.$implicit;t.xp6(1),t.AsE("",n+1,". ",o.productCode,"-")}}function en(r,s){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.note)}}const ut=function(r,s,e){return[r,s,"symbol","1.0-2",e]};function nn(r,s){if(1&r&&(t.TgZ(0,"span")(1,"ion-text"),t.YNc(2,tn,2,2,"span",2),t._uU(3),t.TgZ(4,"span",5),t._UZ(5,"br"),t._uU(6),t.ALo(7,"translate"),t.ALo(8,"translate"),t.ALo(9,"translate"),t._UZ(10,"br"),t._uU(11),t.ALo(12,"translate"),t.ALo(13,"currency"),t.ALo(14,"translate"),t.ALo(15,"currency"),t.qZA()(),t.YNc(16,en,2,1,"p",2),t._UZ(17,"br"),t.qZA()),2&r){const e=s.$implicit,n=t.oxw();t.xp6(2),t.Q6J("ngIf",e.productCode),t.xp6(1),t.hij("",e.productName," "),t.xp6(3),t.gL8(" ",t.lcZ(7,13,"transfer-note-add.product-export-count"),": ",e.actualExport," - ",t.lcZ(8,15,"transfer-note-add.product-import-count"),": ",e.actualImport," - ",t.lcZ(9,17,"transfer-note-add.product-unit"),": ",e.unit," "),t.xp6(5),t.HOy(" ",t.lcZ(12,19,"transfer-note-add.product-unit-price"),": ",t.G7q(13,21,t.kEZ(35,ut,e.unitPrice,n.currency,n.translateService.currentLang))," - ",t.lcZ(14,27,"transfer-note-add.product-total"),": ",t.G7q(15,29,t.kEZ(39,ut,e.amount,n.currency,n.translateService.currentLang))," "),t.xp6(5),t.Q6J("ngIf",e.note)}}function on(r,s){1&r&&(t.TgZ(0,"span")(1,"ion-text",6),t._uU(2,"..."),t.qZA()())}function rn(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw(2);t.xp6(1),t.hij(" - ",e.note.store.name,"")}}function an(r,s){if(1&r&&(t.TgZ(0,"p")(1,"i",7),t._uU(2),t.ALo(3,"translate"),t.YNc(4,rn,2,1,"span",2),t.qZA()()),2&r){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,3,"store.created-by")," ",e.note.staff.name,""),t.xp6(2),t.Q6J("ngIf",e.note.store)}}function cn(r,s){if(1&r&&(t.TgZ(0,"p")(1,"i",7),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&r){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"store.created-by")," ",e.note.store.name,"")}}function sn(r,s){if(1&r&&(t.TgZ(0,"ion-avatar",8),t._UZ(1,"img",9),t.qZA()),2&r){const e=t.oxw();t.xp6(1),t.Q6J("src",e.contactImageOrPlaceholder(e.note.contact),t.LSH)}}let ln=(()=>{class r{constructor(e,n){this.translateService=e,this.navCtrl=n,this.showContact=!0,this.isStaff=!1,this.onPress=new t.vpe,this.onClick=new t.vpe}dateFormat(e){return C.C.toUiLocalDateTimeString(e)}contactImageOrPlaceholder(e){return v.W.contactImageOrPlaceholder(e.avatarUrl)}limitText(e,n=200){return v.W.limitText(e,n)}press(){this.onPress.emit()}click(){this.onClick.emit()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(y.sK),t.Y36(Z.G))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note-list-item"]],inputs:{currency:"currency",showContact:"showContact",note:"note",isStaff:"isStaff"},outputs:{onPress:"onPress",onClick:"onClick"},decls:19,vars:16,consts:[[3,"press","click"],[1,"ion-text-wrap"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end",4,"ngIf"],[2,"font-size","0.9em"],[2,"font-size","12px"],[2,"font-size","11px"],["slot","end"],[3,"src"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-item",0),t.NdJ("press",function(){return n.press()})("click",function(){return n.click()}),t.TgZ(1,"ion-label",1)(2,"span"),t._uU(3),t.qZA(),t.YNc(4,$e,3,4,"span",2),t.YNc(5,We,3,4,"span",2),t._UZ(6,"br"),t.YNc(7,ze,2,1,"p",2),t.YNc(8,Re,2,1,"p",2),t.YNc(9,Xe,2,1,"p",2),t.TgZ(10,"p"),t._uU(11),t.qZA(),t.TgZ(12,"p"),t.YNc(13,nn,18,43,"span",3),t.ALo(14,"slice"),t.YNc(15,on,3,0,"span",2),t.qZA(),t.YNc(16,an,5,5,"p",2),t.YNc(17,cn,4,4,"p",2),t.qZA(),t.YNc(18,sn,2,1,"ion-avatar",4),t.qZA()),2&e&&(t.xp6(3),t.hij("#",n.note.id,""),t.xp6(1),t.Q6J("ngIf",n.note.exportStore),t.xp6(1),t.Q6J("ngIf",n.note.importStore),t.xp6(2),t.Q6J("ngIf",n.note.contactId&&0!=n.note.contactId&&n.note.contact&&n.showContact),t.xp6(1),t.Q6J("ngIf",0==n.note.contactId&&n.showContact&&n.note.contactName),t.xp6(1),t.Q6J("ngIf",0==n.note.contactId&&n.showContact&&n.note.contactPhone),t.xp6(2),t.hij(" ",n.dateFormat(n.note.createdAt)," "),t.xp6(2),t.Q6J("ngForOf",t.Dn7(14,12,n.note.items,0,2)),t.xp6(2),t.Q6J("ngIf",n.note.items.length>=3),t.xp6(1),t.Q6J("ngIf",n.note.staffId&&0!=n.note.staffId&&n.note.staff&&!n.isStaff),t.xp6(1),t.Q6J("ngIf",!(n.note.staffId&&0!=n.note.staffId&&n.note.staff&&!n.isStaff)&&n.note.store),t.xp6(1),t.Q6J("ngIf",n.note.contactId&&0!=n.note.contactId&&n.note.contact&&n.showContact))},dependencies:[u.sg,u.O5,a.BJ,a.Ie,a.Q$,a.yW,u.OU,u.H9,y.X$],encapsulation:2}),r})();function dn(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item",18)(1,"ion-label",19),t._uU(2),t.qZA(),t.TgZ(3,"ion-buttons")(4,"ion-button",20),t.NdJ("click",function(){t.CHM(e);const o=t.oxw();return t.KtG(o.exitStore())}),t._UZ(5,"ion-icon",21),t._uU(6),t.ALo(7,"translate"),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(2),t.Oqu(e.checkStore),t.xp6(4),t.hij(" ",t.lcZ(7,2,"store.exit-store")," ")}}function pn(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"transfer-note-list-item",23),t.NdJ("onPress",function(){const i=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.presentActionSheet(i))})("onClick",function(){const i=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.select(i.id))}),t.qZA()}if(2&r){const e=s.$implicit,n=t.oxw(2);t.Q6J("note",e)("currency",n.currency)("showContact",!0)}}function un(r,s){if(1&r&&(t.ynx(0),t.YNc(1,pn,1,3,"transfer-note-list-item",22),t.BQk()),2&r){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.notes)}}function _n(r,s){if(1&r&&(t.TgZ(0,"ion-text"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.importStore.name," ")}}function fn(r,s){if(1&r&&(t.TgZ(0,"ion-text"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.hij(" ",e.exportStore.name," ")}}function mn(r,s){if(1&r&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&r){const e=t.oxw(),n=e.index,o=e.$implicit;t.xp6(1),t.AsE("",n+1,". ",o.productCode,"-")}}function hn(r,s){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.note)}}const _t=function(r,s,e){return[r,s,"symbol","1.0-2",e]};function gn(r,s){if(1&r&&(t.TgZ(0,"ion-label")(1,"ion-text"),t.YNc(2,mn,2,2,"span",14),t._uU(3),t.TgZ(4,"span",29),t._UZ(5,"br"),t._uU(6),t.ALo(7,"translate"),t.ALo(8,"translate"),t.ALo(9,"translate"),t._UZ(10,"br"),t._uU(11),t.ALo(12,"translate"),t.ALo(13,"currency"),t.ALo(14,"translate"),t.ALo(15,"currency"),t.qZA()(),t.YNc(16,hn,2,1,"p",14),t._UZ(17,"br"),t.qZA()),2&r){const e=s.$implicit,n=t.oxw(3);t.xp6(2),t.Q6J("ngIf",e.productCode),t.xp6(1),t.hij("",e.productName," "),t.xp6(3),t.gL8(" ",t.lcZ(7,13,"transfer-note-add.product-export-count"),": ",e.actualExport," - ",t.lcZ(8,15,"transfer-note-add.product-import-count"),": ",e.actualImport," - ",t.lcZ(9,17,"transfer-note-add.product-unit"),": ",e.unit," "),t.xp6(5),t.HOy(" ",t.lcZ(12,19,"transfer-note-add.product-unit-price"),": ",t.G7q(13,21,t.kEZ(35,_t,e.unitPrice,n.currency,n.translateService.currentLang))," - ",t.lcZ(14,27,"transfer-note-add.product-total"),": ",t.G7q(15,29,t.kEZ(39,_t,e.amount,n.currency,n.translateService.currentLang))," "),t.xp6(5),t.Q6J("ngIf",e.note)}}function xn(r,s){1&r&&(t.TgZ(0,"span")(1,"ion-text",30),t._uU(2,"..."),t.qZA()())}function Zn(r,s){if(1&r){const e=t.EpF();t.TgZ(0,"ion-row",27),t.NdJ("press",function(){const i=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.presentActionSheet(i))})("click",function(){const i=t.CHM(e).$implicit,c=t.oxw(2);return t.KtG(c.select(i.id))}),t.TgZ(1,"ion-col",24),t._uU(2),t.qZA(),t.TgZ(3,"ion-col",24),t.YNc(4,_n,2,1,"ion-text",14),t.qZA(),t.TgZ(5,"ion-col",24),t.YNc(6,fn,2,1,"ion-text",14),t.qZA(),t.TgZ(7,"ion-col",25),t.YNc(8,gn,18,43,"ion-label",28),t.ALo(9,"slice"),t.YNc(10,xn,3,0,"span",14),t.qZA(),t.TgZ(11,"ion-col",24),t._uU(12),t.qZA(),t.TgZ(13,"ion-col",24),t._uU(14),t.qZA(),t.TgZ(15,"ion-col",24),t._uU(16),t.qZA(),t.TgZ(17,"ion-col",24),t._uU(18),t.qZA(),t.TgZ(19,"ion-col",24),t._uU(20),t.qZA()()}if(2&r){const e=s.$implicit,n=t.oxw(2);t.Udp("cursor","pointer"),t.xp6(2),t.hij("#",e.id,""),t.xp6(2),t.Q6J("ngIf",e.importStore&&e.importStore.id>0),t.xp6(2),t.Q6J("ngIf",e.exportStore&&e.exportStore.id>0),t.xp6(2),t.Q6J("ngForOf",t.Dn7(9,12,e.items,0,2)),t.xp6(2),t.Q6J("ngIf",e.items.length>=3),t.xp6(2),t.hij(" ",e.deliverer," "),t.xp6(2),t.hij(" ",e.transportation," "),t.xp6(2),t.hij(" ",e.receiver," "),t.xp6(2),t.hij(" ",e.deliveryAddress," "),t.xp6(2),t.hij(" ",n.dateFormat(e.createdAt)," ")}}function Tn(r,s){if(1&r&&(t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",24)(3,"strong"),t._uU(4),t.ALo(5,"translate"),t.qZA()(),t.TgZ(6,"ion-col",24)(7,"strong"),t._uU(8),t.ALo(9,"translate"),t.qZA()(),t.TgZ(10,"ion-col",24)(11,"strong"),t._uU(12),t.ALo(13,"translate"),t.qZA()(),t.TgZ(14,"ion-col",25)(15,"strong"),t._uU(16),t.ALo(17,"translate"),t.qZA()(),t.TgZ(18,"ion-col",24)(19,"strong"),t._uU(20),t.ALo(21,"translate"),t.qZA()(),t.TgZ(22,"ion-col",24)(23,"strong"),t._uU(24),t.ALo(25,"translate"),t.qZA()(),t.TgZ(26,"ion-col",24)(27,"strong"),t._uU(28),t.ALo(29,"translate"),t.qZA()(),t.TgZ(30,"ion-col",24)(31,"strong"),t._uU(32),t.ALo(33,"translate"),t.qZA()(),t.TgZ(34,"ion-col",24)(35,"strong"),t._uU(36),t.ALo(37,"translate"),t.qZA()()(),t.YNc(38,Zn,21,16,"ion-row",26),t.qZA()),2&r){const e=t.oxw();t.xp6(4),t.Oqu(t.lcZ(5,10,"transfer-note-add.code")),t.xp6(4),t.Oqu(t.lcZ(9,12,"transfer-note-add.export-store")),t.xp6(4),t.Oqu(t.lcZ(13,14,"transfer-note-add.import-store")),t.xp6(4),t.Oqu(t.lcZ(17,16,"transfer-note-add.product")),t.xp6(4),t.Oqu(t.lcZ(21,18,"transfer-note-add.delivery-person")),t.xp6(4),t.Oqu(t.lcZ(25,20,"transfer-note-add.transportation")),t.xp6(4),t.Oqu(t.lcZ(29,22,"transfer-note-add.receiver")),t.xp6(4),t.Oqu(t.lcZ(33,24,"transfer-note-add.delivery-address")),t.xp6(4),t.Oqu(t.lcZ(37,26,"transfer-note.created-at")),t.xp6(2),t.Q6J("ngForOf",e.notes)}}function Cn(r,s){1&r&&(t.TgZ(0,"ion-item",19),t._UZ(1,"div",31),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"transfer-note.no-transfer-note"),t.oJD))}const An=[{path:"",component:(()=>{class r{constructor(e,n,o,i,c,h,T,S,q,m,E,Y,B,A,Q,N,F){var _=this;this.platform=e,this.transferNote=n,this.translateService=o,this.userService=i,this.productService=c,this.navCtrl=h,this.modalCtrl=T,this.file=S,this.barcodeScanner=q,this.excelService=m,this.actionSheetCtrl=E,this.storeService=Y,this.alertCtrl=B,this.analyticsService=A,this.staffService=Q,this.tradeService=N,this.dataService=F,this.searchKey="",this.params=null,this.noteFilter="frequency",this.total=0,this.dateFrom="",this.dateTo="",this.isMobile=!0,this.reload=(0,p.Z)(function*(){_.isMobile=_.platform.width()<720,_.currency=yield _.userService.getAttr("current-currency"),_.params=_.navCtrl.getParams(_.params),_.mainStore=yield _.dataService.getFirstObject("shop"),_.stores=yield _.storeService.getStores(),_.store=yield _.storeService.getCurrentStore(),_.checkStore=_.store?_.translateService.instant("store.check-store",{shop:_.store.name}):null,_.selectedStaff=_.staffService.selectedStaff,_.dateFrom=_.params&&_.params.dateFrom?_.params.dateFrom:_.dateFrom?_.dateFrom:C.C.GetFirstDateOfMonth(),_.dateTo=_.params&&_.params.dateTo?_.params.dateTo:_.dateTo?_.dateTo:C.C.GetEndDateOfMonth();const k=yield _.navCtrl.loading();_.transferNote.getNotes(_.dateFrom,_.dateTo,_.store?_.store.id:0).then(function(){var I=(0,p.Z)(function*(G){yield k.dismiss();const ot=[];if(G&&G.length)for(const O of G)O.items=JSON.parse(O.itemsJson),O.importStore=O.importStoreId&&_.stores&&_.stores.length?_.stores.find(rt=>rt.id==O.importStoreId):_.mainStore,O.exportStore=O.exportStoreId&&_.stores&&_.stores.length?_.stores.find(rt=>rt.id==O.exportStoreId):_.mainStore,ot.push(O);_.originalNotes=JSON.parse(JSON.stringify(ot)),_.notes=ot,_.total=W.sumBy(_.notes,O=>O.amount),_.filter()});return function(G){return I.apply(this,arguments)}}())}),this.doEnteredBarcode=k=>{!k||this.productService.searchByBarcode(k).then(I=>{I&&this.navCtrl.push("/transfer-note/add",{product:I.id})})},this.navCtrl.unsubscribe("reloadTransferNoteList",this.reload),this.navCtrl.subscribe("reloadTransferNoteList",this.reload)}ionViewWillEnter(){var e=this;return(0,p.Z)(function*(){yield e.analyticsService.setCurrentScreen("transfer-note")})()}ngOnInit(){this.platform.resize.subscribe(()=>{this.isMobile=this.platform.width()<720}),this.reload()}onPeriodChanged(e){var n=this;return(0,p.Z)(function*(){if(e){const o=yield n.navCtrl.loading();n.dateFrom=""!=e.dateFrom?C.C.toDbString(e.dateFrom,C.C.getDbFormat()):"",n.dateTo=""!=e.dateTo?C.C.toDbString(e.dateTo,C.C.getDbFormat()):"",n.transferNote.getNotes(n.dateFrom,n.dateTo,n.store?n.store.id:0).then(function(){var i=(0,p.Z)(function*(c){const h=[];if(c&&c.length)for(const T of c)T.items=JSON.parse(T.itemsJson),T.importStore=T.importStoreId&&n.stores&&n.stores.length?n.stores.find(S=>S.id==T.importStoreId):null,T.exportStore=T.exportStoreId&&n.stores&&n.stores.length?n.stores.find(S=>S.id==T.exportStoreId):null,h.push(T);n.originalNotes=JSON.parse(JSON.stringify(h)),n.notes=h,n.total=W.sumBy(n.notes,T=>T.amount),n.filter(),yield o.dismiss()});return function(c){return i.apply(this,arguments)}}())}})()}openAdd(){this.navCtrl.push("/transfer-note/add")}search(){var e=this;return(0,p.Z)(function*(){e.analyticsService.logEvent("transfer-note-search");let n=JSON.parse(JSON.stringify(e.originalNotes));if(null!==e.searchKey&&""!==e.searchKey){const o=e.searchKey.toLowerCase();n=n.filter(i=>i.contact&&i.contact.fullName&&-1!==i.contact.fullName.toLowerCase().indexOf(o)||i.id&&-1!==i.id.toString().toLowerCase().indexOf(o)||"#"+i.id.toString()===o||i.importStore&&i.importStore.name&&-1!==i.importStore.name.toLowerCase().indexOf(o)||i.exportStore&&i.exportStore.name&&-1!==i.exportStore.name.toLowerCase().indexOf(o)||i.deliverer&&-1!==i.deliverer.toLowerCase().indexOf(o)||i.deliveryAddress&&-1!==i.deliveryAddress.toLowerCase().indexOf(o)||i.receiver&&-1!==i.receiver.toLowerCase().indexOf(o)||i.transportation&&-1!==i.transportation.toLowerCase().indexOf(o)||i.items&&i.items.length&&i.items.filter(c=>c.productCode&&-1!==c.productCode.toLowerCase().indexOf(o)||c.productName&&-1!==c.productName.toLowerCase().indexOf(o)||c.barcode&&-1!==c.barcode.toLowerCase().indexOf(o)||c.note&&-1!==c.note.toLowerCase().indexOf(o)).length>0)}e.notes=n,e.total=W.sumBy(e.notes,o=>o.amount)})()}clearSearch(){this.searchKey=null,this.reload()}filter(){let e=JSON.parse(JSON.stringify(this.originalNotes));e=this.sortByModifiedAt(e),this.notes=e}sortByModifiedAt(e){return e?W.orderBy(e,["createdAt"],["desc"]):null}dateOnlyFormat(e){return C.C.toUiDateString(e)}select(e){this.navCtrl.push("/transfer-note/detail",{id:e})}deleteNote(e){var n=this;return(0,p.Z)(function*(){var i;yield(yield n.alertCtrl.create({header:n.translateService.instant("common.confirm"),message:n.translateService.instant("transfer-note.delete-alert"),buttons:[{text:n.translateService.instant("common.agree"),handler:(i=(0,p.Z)(function*(){yield n.deleteRelated(e),n.transferNote.delete(e).then((0,p.Z)(function*(){n.analyticsService.logEvent("transfer-note-delete-success");let c=n.notes.findIndex(h=>h.id==e.id);c>=0&&(n.notes.splice(c,1),n.total=W.sumBy(n.notes,h=>h.total)),c=n.originalNotes.findIndex(h=>h.id==e.id),c>=0&&n.originalNotes.splice(c,1)}))}),function(){return i.apply(this,arguments)})},{text:n.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}deleteRelated(e){var n=this;return(0,p.Z)(function*(){const o=[],i=yield n.tradeService.getTradesByTransferNote(e.id);for(const h of i)h.debtId||o.push(n.tradeService.deleteTrade(h));const c=yield n.productService.getNotesByReceivedNote(e.id);for(const h of c)o.push(n.productService.deleteProductNote(h));yield Promise.all(o)})()}presentOtherActionSheet(){var e=this;return(0,p.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("export.export-to-excel"),handler:()=>{e.exportExcel()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}exportExcel(){var e=this;const n=[];if(n.push([this.translateService.instant("export.transfer-note-report")]),this.dateFrom&&this.dateTo){const c=this.translateService.instant("common.from"),h=this.translateService.instant("common.to"),T=c+" "+this.dateFormat(this.dateFrom)+" "+h+" "+this.dateFormat(this.dateTo);n.push([T])}n.push([this.translateService.instant("common.total")+": "+this.total+" "+this.currency]),n.push([this.translateService.instant("export.receipt-code"),this.translateService.instant("export.contact"),this.translateService.instant("export.money"),this.translateService.instant("export.unit"),this.translateService.instant("export.date")]);for(const c of this.notes)n.push([c.id,0!=c.contactId&&c.contact?c.contact.fullName:"",c.total,this.currency,this.dateFormat(c.createdAt)]);const o=this.excelService.createSheetData(n),i="transfer-note-report-"+v.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(o,i).then(function(){var c=(0,p.Z)(function*(h){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+i,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,h))});return function(h){return c.apply(this,arguments)}}())}dateFormat(e){return C.C.toUiLocalDateTimeString(e)}presentActionSheet(e){var n=this;return(0,p.Z)(function*(){yield(yield n.actionSheetCtrl.create({header:n.translateService.instant("action.action"),buttons:[{text:n.translateService.instant("transfer-note.delete"),role:"destructive",handler:()=>{n.deleteNote(e)}},{text:n.translateService.instant("transfer-note.edit"),handler:()=>{n.select(e.id)}},{text:n.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}importNote(){this.navCtrl.push("/transfer-note/import")}scan(){var e=this;return(0,p.Z)(function*(){if(e.navCtrl.isNotCordova()){const n=yield e.modalCtrl.create({component:it.k});yield n.present();const{data:o}=yield n.onDidDismiss();o&&o.barcode&&e.doEnteredBarcode(o.barcode)}else e.barcodeScanner.scan().then(n=>{!n||!n.text||e.doEnteredBarcode(n.text)})})()}exportProductNotesReport(e){this.navCtrl.push("/product/export",{reportType:e})}exitStore(){var e=this;return(0,p.Z)(function*(){var o;yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("store.exit-store-alert",{shop:e.store.name}),buttons:[{text:e.translateService.instant("common.agree"),handler:(o=(0,p.Z)(function*(){yield e.storeService.exitStore(),yield e.reload()}),function(){return o.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(a.t4),t.Y36(tt.u),t.Y36(y.sK),t.Y36(b.K),t.Y36(x.M),t.Y36(Z.G),t.Y36(a.IN),t.Y36(Be.$),t.Y36(st.m),t.Y36(nt.x),t.Y36(a.BX),t.Y36(j.d),t.Y36(a.Br),t.Y36(M.y),t.Y36(l.x),t.Y36(et.X),t.Y36($.D))},r.\u0275cmp=t.Xpm({type:r,selectors:[["transfer-note"]],decls:41,vars:24,consts:[["slot","start"],["menu","first"],["color","primary",3,"click"],["name","home"],["slot","end"],[3,"click"],["name","add-circle"],["lines","none","color","success",4,"ngIf"],["expand","block","fill","outline",3,"click"],["icon","file-excel","size","lg"],["slot","start","name","document"],["slot","start","name","newspaper"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[3,"onPeriodChanged"],[4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["lines","none","color","success"],[1,"ion-text-wrap"],["size","small",3,"click"],["name","exit","slot","start","size","small"],[3,"note","currency","showContact","onPress","onClick",4,"ngFor","ngForOf"],[3,"note","currency","showContact","onPress","onClick"],["size","1"],["size","4"],["style","border-bottom: 1px solid #ccc;",3,"cursor","press","click",4,"ngFor","ngForOf"],[2,"border-bottom","1px solid #ccc",3,"press","click"],[4,"ngFor","ngForOf"],[2,"font-size","0.9em"],[2,"font-size","12px"],[3,"innerHTML"]],template:function(e,n){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button",1),t.TgZ(4,"ion-button",2),t.NdJ("click",function(){return n.navCtrl.home()}),t._UZ(5,"ion-icon",3),t.qZA()(),t.TgZ(6,"ion-title"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"ion-buttons",4)(10,"ion-button",5),t.NdJ("click",function(){return n.openAdd()}),t._UZ(11,"ion-icon",6),t.qZA()()(),t.YNc(12,dn,8,4,"ion-item",7),t.qZA(),t.TgZ(13,"ion-content")(14,"ion-grid")(15,"ion-row")(16,"ion-col")(17,"ion-button",8),t.NdJ("click",function(){return n.importNote()}),t._UZ(18,"fa-icon",9),t._uU(19),t.ALo(20,"translate"),t.qZA()(),t.TgZ(21,"ion-col")(22,"ion-button",8),t.NdJ("click",function(){return n.exportProductNotesReport(0)}),t._UZ(23,"ion-icon",10),t._uU(24),t.ALo(25,"translate"),t.qZA()(),t.TgZ(26,"ion-col")(27,"ion-button",8),t.NdJ("click",function(){return n.exportProductNotesReport(1)}),t._UZ(28,"ion-icon",11),t._uU(29),t.ALo(30,"translate"),t.qZA()()()(),t.TgZ(31,"ion-searchbar",12),t.NdJ("ionClear",function(){return n.clearSearch()})("ionChange",function(){return n.search()})("ngModelChange",function(i){return n.searchKey=i}),t.ALo(32,"translate"),t.qZA(),t.TgZ(33,"period-range",13),t.NdJ("onPeriodChanged",function(i){return n.onPeriodChanged(i)}),t.qZA(),t.TgZ(34,"ion-list"),t.YNc(35,un,2,1,"ng-container",14),t.YNc(36,Tn,39,28,"ion-grid",14),t.YNc(37,Cn,3,3,"ion-item",15),t.qZA(),t.TgZ(38,"ion-fab",16)(39,"ion-fab-button",5),t.NdJ("click",function(){return n.openAdd()}),t._UZ(40,"ion-icon",17),t.qZA()()()),2&e&&(t.xp6(7),t.Oqu(t.lcZ(8,14,"transfer-note.title")),t.xp6(5),t.Q6J("ngIf",n.checkStore&&(null==n.selectedStaff||n.selectedStaff.hasFullAccess&&!n.selectedStaff.storeId)),t.xp6(1),t.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(6),t.hij("\xa0 ",t.lcZ(20,16,"transfer-note.import-note-from-excel")," "),t.xp6(5),t.hij("\xa0 ",t.lcZ(25,18,"product-note-export.report-type-summary")," "),t.xp6(5),t.hij("\xa0 ",t.lcZ(30,20,"product-note-export.report-type-detail")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(32,22,"transfer-note.search")),t.Q6J("ngModel",n.searchKey),t.xp6(4),t.Q6J("ngIf",n.isMobile),t.xp6(1),t.Q6J("ngIf",!n.isMobile&&n.notes&&n.notes.length),t.xp6(1),t.Q6J("ngIf",!n.originalNotes||0===n.originalNotes.length),t.xp6(1),t.Akn(n.navCtrl.hasAds()?"margin-bottom: 60px":""))},dependencies:[u.sg,u.O5,d.JJ,d.On,a.YG,a.Sm,a.wI,a.W2,a.IJ,a.W4,a.jY,a.Gu,a.gu,a.Ie,a.Q$,a.q_,a.fG,a.Nd,a.VI,a.yW,a.wd,a.sr,a.j9,Ve.M,ln,P.BN,u.OU,u.H9,y.X$],encapsulation:2}),r})()},{path:"detail",component:Fe},{path:"add",component:ce},{path:"detail-print",component:ve},{path:"detail-share",component:we},{path:"transfer-product-selector",component:Mt},{path:"import",component:je}];let vn=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[U.Bz.forChild(An),U.Bz]}),r})(),yn=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[u.ez,d.u5,a.Pc,vn,J.m,P.uH,y.aw.forChild({loader:{provide:y.Zw,useFactory:J.x,deps:[L.eN]}})]}),r})()},6026:(V,w,f)=>{f.d(w,{k:()=>P});var u=f(6738),d=f(191),a=f(6961),y=f(4006),L=f(3306);const J=["barcodeInput"];let P=(()=>{class U{constructor(C,v){this.viewCtrl=C,this.productService=v}ngOnInit(){this.barcodeFocus()}ionViewLoaded(){this.barcodeFocus()}barcodeFocus(){setTimeout(()=>{this.barcodeInput.setFocus()},600)}barcodeChanged(){!this.barcode||this.barcode.length<5||this.productService.searchByBarcode(this.barcode).then(C=>{!C||this.ok()})}dismiss(){this.viewCtrl.dismiss()}ok(){this.viewCtrl.dismiss({barcode:this.barcode})}}return U.\u0275fac=function(C){return new(C||U)(u.Y36(d.IN),u.Y36(a.M))},U.\u0275cmp=u.Xpm({type:U,selectors:[["barcode-input"]],viewQuery:function(C,v){if(1&C&&u.Gf(J,7),2&C){let t;u.iGM(t=u.CRH())&&(v.barcodeInput=t.first)}},decls:22,vars:13,consts:[["slot","start"],[3,"click"],["name","close"],[1,"ion-padding"],["clearInput","","autofocus","true","type","text",3,"placeholder","ngModel","ngModelChange"],["barcodeInput",""],["color","primary","expand","block",3,"click"],["color","secondary","expand","block",3,"click"]],template:function(C,v){1&C&&(u.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),u.NdJ("click",function(){return v.dismiss()}),u._UZ(4,"ion-icon",2),u.qZA()(),u.TgZ(5,"ion-title"),u._uU(6),u.ALo(7,"translate"),u.qZA()()(),u.TgZ(8,"ion-content",3)(9,"ion-input",4,5),u.NdJ("ngModelChange",function(Z){return v.barcode=Z})("ngModelChange",function(){return v.barcodeChanged()}),u.ALo(11,"translate"),u.qZA(),u.TgZ(12,"ion-grid")(13,"ion-row")(14,"ion-col")(15,"ion-button",6),u.NdJ("click",function(){return v.ok()}),u._uU(16),u.ALo(17,"translate"),u.qZA()(),u.TgZ(18,"ion-col")(19,"ion-button",7),u.NdJ("click",function(){return v.dismiss()}),u._uU(20),u.ALo(21,"translate"),u.qZA()()()()()),2&C&&(u.xp6(6),u.hij(" ",u.lcZ(7,5,"order-add.enter-barcode")," "),u.xp6(3),u.s9C("placeholder",u.lcZ(11,7,"order-add.enter-barcode-placeholder")),u.Q6J("ngModel",v.barcode),u.xp6(7),u.Oqu(u.lcZ(17,9,"common.agree")),u.xp6(4),u.hij("",u.lcZ(21,11,"common.cancel")," "))},dependencies:[y.JJ,y.On,d.YG,d.Sm,d.wI,d.W2,d.jY,d.Gu,d.gu,d.pK,d.Nd,d.wd,d.sr,d.j9,L.X$],encapsulation:2}),U})()},7613:(V,w,f)=>{f.d(w,{F:()=>t});var u=f(5861),d=f(6738),a=f(6895),y=f(4006),L=f(191);const J=["template"],P=["input1"],U=["input2"];function p(Z,b){if(1&Z){const l=d.EpF();d.TgZ(0,"ion-input",4,5),d.NdJ("ngModelChange",function(g){d.CHM(l);const M=d.oxw(2);return d.KtG(M.moneyValueString=g)})("ionBlur",function(){d.CHM(l);const g=d.oxw(2);return d.KtG(g.ionBlur())})("ionFocus",function(){d.CHM(l);const g=d.oxw(2);return d.KtG(g.ionFocus())})("keyup.enter",function(){d.CHM(l);const g=d.oxw(2);return d.KtG(g.onEnter())}),d.qZA()}if(2&Z){const l=d.oxw(2);d.Q6J("placeholder",l.placeholder)("disabled",l.disabled)("ngModel",l.moneyValueString)}}function C(Z,b){if(1&Z){const l=d.EpF();d.TgZ(0,"ion-input",6,7),d.NdJ("ngModelChange",function(g){d.CHM(l);const M=d.oxw(2);return d.KtG(M.moneyValueString=g)})("ionBlur",function(){d.CHM(l);const g=d.oxw(2);return d.KtG(g.ionBlur())})("ionFocus",function(){d.CHM(l);const g=d.oxw(2);return d.KtG(g.ionFocus())})("keyup.enter",function(){d.CHM(l);const g=d.oxw(2);return d.KtG(g.onEnter())}),d.qZA()}if(2&Z){const l=d.oxw(2);d.Q6J("disabled",l.disabled)("placeholder",l.placeholder)("ngModel",l.moneyValueString)}}function v(Z,b){if(1&Z){const l=d.EpF();d.YNc(0,p,2,3,"ion-input",1),d.YNc(1,C,2,3,"ion-input",2),d.TgZ(2,"ion-input",3),d.NdJ("ngModelChange",function(g){d.CHM(l);const M=d.oxw();return d.KtG(M.moneyValue=g)})("ngModelChange",function(g){d.CHM(l);const M=d.oxw();return d.KtG(M.change(g))})("ionChange",function(){d.CHM(l);const g=d.oxw();return d.KtG(g.change(g.moneyValue))}),d.qZA()}if(2&Z){const l=d.oxw();d.Q6J("ngIf",l.clear),d.xp6(1),d.Q6J("ngIf",!l.clear),d.xp6(1),d.Q6J("hidden",!0)("ngModel",l.moneyValue)}}let t=(()=>{class Z{constructor(l){this.viewContainerRef=l,this.moneyValueChange=new d.vpe,this.clear=!1,this.decimal=".",this.thousands=",",this.decimalCount=2,this.changing=!1}ngOnInit(){var l=this;return(0,u.Z)(function*(){l.thousands=l.thousandsSeparator(),l.decimal="."===l.thousands?",":".",setTimeout(()=>{l.moneyValueString=l.moneyValue?l.formatMoney(l.moneyValue):l.moneyValue},1e3),l.viewContainerRef.createEmbeddedView(l.template)})()}getMoneyValueStringToNumber(l){if(l){let x=l.split(this.decimal).join("");return x=x.split(this.thousands).join(this.thousandsSeparator()),+x}return l}change(l){this.moneyValue=l,l?(this.moneyValueString=this.formatMoney(l),this.oldValue=this.moneyValueString):(this.moneyValueString=l,this.oldValue=l)}ionFocus(){return(0,u.Z)(function*(){})()}ionBlur(){if(this.moneyValueString){let l=this.moneyValueString.split(this.decimal).join("");l=l.split(this.thousands).join(this.thousandsSeparator()),this.moneyValue=+l,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(+l),this.oldValue=this.moneyValueString)}else this.moneyValue=this.moneyValueString,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(this.moneyValueString),this.oldValue=this.moneyValueString);this.moneyValueString=this.formatMoney(this.moneyValue),setTimeout(()=>{this.changing=!1},300)}formatMoney(l){if(!l)return l;const x=this.decimalCount,M=this.decimal,z=this.thousands;try{const H="\\d(?=(\\d{3})+"+(x>0?"\\D":"$")+")",R=l.toFixed(Math.max(0,~~x));let D=(z?R.replace(".",z):R).replace(new RegExp(H,"g"),"$&"+(M||","));return D&&(D.indexOf(this.thousands+"00")&&(D=D.split(this.thousands+"00").join("")),D)}catch(H){console.error(H)}}thousandsSeparator(){return parseFloat(.55.toString()).toLocaleString().indexOf(",55")>=0?",":"."}select(l){this.moneyValueString=l,this.ionBlur()}onEnter(){var l=this;return(0,u.Z)(function*(){const x=l.input1?l.input1:l.input2;if(!x)return;const g=yield x.getInputElement();!g||g.blur()})()}}return Z.\u0275fac=function(l){return new(l||Z)(d.Y36(d.s_b))},Z.\u0275cmp=d.Xpm({type:Z,selectors:[["money-input"]],viewQuery:function(l,x){if(1&l&&(d.Gf(J,7),d.Gf(P,5),d.Gf(U,5)),2&l){let g;d.iGM(g=d.CRH())&&(x.template=g.first),d.iGM(g=d.CRH())&&(x.input1=g.first),d.iGM(g=d.CRH())&&(x.input2=g.first)}},inputs:{moneyValue:"moneyValue",placeholder:"placeholder",disabled:"disabled",clear:"clear"},outputs:{moneyValueChange:"moneyValueChange"},decls:2,vars:0,consts:[["template",""],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],["inputmode","numeric","style","background-color: #efefef; border-radius: 5px; color: #000; margin-bottom: 5px;","type","text",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],[3,"hidden","ngModel","ngModelChange","ionChange"],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input1",""],["inputmode","numeric","type","text",2,"background-color","#efefef","border-radius","5px","color","#000","margin-bottom","5px",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input2",""]],template:function(l,x){1&l&&d.YNc(0,v,3,4,"ng-template",null,0,d.W1O)},dependencies:[a.O5,y.JJ,y.On,L.pK,L.j9],encapsulation:2}),Z})()},360:(V,w,f)=>{f.d(w,{Y:()=>t});var u=f(5861),d=f(6723),a=f(6738),y=f(5851),L=f(323),J=f(7852),P=f(3306),U=f(6895),p=f(191);function C(Z,b){if(1&Z){const l=a.EpF();a.TgZ(0,"ion-button",13),a.NdJ("click",function(){a.CHM(l);const g=a.oxw(2);return a.KtG(g.hideSupport())}),a._UZ(1,"ion-icon",14),a.qZA()}}function v(Z,b){if(1&Z){const l=a.EpF();a.TgZ(0,"div",1)(1,"ion-item",2),a.NdJ("click",function(){a.CHM(l);const g=a.oxw();return a.KtG(g.callPhone("+84869366606"))}),a.TgZ(2,"ion-label",3)(3,"h2")(4,"strong"),a._uU(5),a.ALo(6,"translate"),a.qZA()()(),a.YNc(7,C,2,0,"ion-button",4),a.qZA(),a.TgZ(8,"p")(9,"i"),a._uU(10),a.ALo(11,"translate"),a.qZA()(),a.TgZ(12,"ion-button",5),a.NdJ("click",function(){a.CHM(l);const g=a.oxw();return a.KtG(g.sendTicket())}),a._UZ(13,"ion-icon",6),a._uU(14),a.ALo(15,"translate"),a.qZA(),a.TgZ(16,"ion-grid")(17,"ion-row")(18,"ion-col",7)(19,"ion-item",8),a.NdJ("click",function(){a.CHM(l);const g=a.oxw();return a.KtG(g.callPhone("+84869366606"))}),a._UZ(20,"ion-icon",9),a.TgZ(21,"ion-label",10),a._uU(22),a.ALo(23,"translate"),a.qZA()()(),a.TgZ(24,"ion-col",7)(25,"ion-item",8),a.NdJ("click",function(){a.CHM(l);const g=a.oxw();return a.KtG(g.sendEmail("dlv.isale.app@gmail.com"))}),a._UZ(26,"ion-icon",11),a.TgZ(27,"ion-label",12),a._uU(28),a.ALo(29,"translate"),a.qZA()()()()()()}if(2&Z){const l=a.oxw();a.xp6(5),a.hij("",a.lcZ(6,6,"common.contact"),":"),a.xp6(2),a.Q6J("ngIf",!l.neverHide),a.xp6(3),a.Oqu(a.lcZ(11,8,"ticket-add.send-ticket-note")),a.xp6(4),a.hij("\xa0 ",a.lcZ(15,10,"ticket-add.title")," "),a.xp6(8),a.hij(" ",a.lcZ(23,12,"common.hotline"),": (+84) 0383.838.394 "),a.xp6(6),a.hij(" ",a.lcZ(29,14,"common.email"),": dlv.isale.app@gmail.com ")}}let t=(()=>{class Z{constructor(l,x,g,M){this.navCtrl=l,this.analyticsService=x,this.storage=g,this.translate=M,this.neverHide=!1,this.isHide=!1}ngOnInit(){var l=this;return(0,u.Z)(function*(){l.isHide=!!(yield l.storage.get("hide-support"))})()}callPhone(l){!l||(this.analyticsService.logEvent("support-call-hotline"),d.W.callPhone(l))}sendEmail(l){!l||(this.analyticsService.logEvent("support-email"),d.W.sendEmail(l))}sendTicket(){this.navCtrl.push("/ticket/add",null)}hideSupport(){var l=this;return(0,u.Z)(function*(){l.analyticsService.logEvent("support-hide"),l.isHide=!0,alert(l.translate.instant("support.alert")),yield l.storage.set("hide-support","1")})()}}return Z.\u0275fac=function(l){return new(l||Z)(a.Y36(y.G),a.Y36(L.y),a.Y36(J.V),a.Y36(P.sK))},Z.\u0275cmp=a.Xpm({type:Z,selectors:[["support"]],inputs:{neverHide:"neverHide"},decls:1,vars:1,consts:[["style","padding: 5px; border: 1px solid #D3679D; border-radius: 10px; margin-top: 10px;",4,"ngIf"],[2,"padding","5px","border","1px solid #D3679D","border-radius","10px","margin-top","10px"],["lines","none",1,"ion-no-padding",2,"padding-top","10px !important","min-height","0 !important","--min-height","0 !important",3,"click"],[2,"margin","0 !important","padding","0 !important"],["slot","end","size","small","fill","clear",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","mail"],[2,"padding","0 !important","margin","0 !important"],[1,"ion-no-padding",2,"padding-top","0px !important","cursor","pointer",3,"click"],["name","call","slot","start","color","tertiary"],[1,"ion-text-wrap"],["name","mail","slot","start","color","danger"],["color","danger",1,"ion-text-wrap"],["slot","end","size","small","fill","clear",3,"click"],["name","close","slot","icon-only"]],template:function(l,x){1&l&&a.YNc(0,v,30,16,"div",0),2&l&&a.Q6J("ngIf",!x.isHide||x.neverHide)},dependencies:[U.O5,p.YG,p.wI,p.jY,p.gu,p.Ie,p.Q$,p.Nd,P.X$],encapsulation:2}),Z})()}}]);