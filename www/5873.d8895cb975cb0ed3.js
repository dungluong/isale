"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5873],{5873:(R,q,d)=>{d.r(q),d.d(q,{PromotionModule:()=>ft});var y=d(6895),c=d(4006),s=d(191),Q=d(2216),L=d(529),T=d(3306),U=d(3093),F=d(3196),m=d(5861),I=d(6723),o=d(6738),N=d(5851),h=d(580),P=d(7488),l=d(323),g=d(7613),p=d(8851);function v(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",23),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.delete())}),o._UZ(1,"ion-icon",24),o.qZA()}}function H(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.showSearchContact())}),o._uU(1),o.qZA()}if(2&n){const t=o.oxw(2);o.xp6(1),o.hij(" ",t.contactSelected.fullName," ")}}function w(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",26),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.showSearchContact())}),o._uU(1),o.ALo(2,"translate"),o.qZA()}2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"promotion-add.select-contact")," "))}function Y(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",27),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.removeContact())}),o._UZ(1,"ion-icon",28),o.qZA()}}function b(n,a){if(1&n&&(o.TgZ(0,"ion-item")(1,"ion-label"),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,H,2,1,"ion-text",19),o.YNc(5,w,3,3,"ion-text",20),o.TgZ(6,"ion-buttons",3),o.YNc(7,Y,2,0,"ion-button",21),o.qZA()()),2&n){const t=o.oxw();o.xp6(2),o.hij("",o.lcZ(3,4,"promotion-add.contact"),": \xa0"),o.xp6(2),o.Q6J("ngIf",t.contactSelected&&t.contactSelected.id>0),o.xp6(1),o.Q6J("ngIf",!t.contactSelected||0===t.contactSelected.id),o.xp6(2),o.Q6J("ngIf",t.contactSelected&&t.contactSelected.id>0)}}function X(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.showSearchProduct())}),o._uU(1),o.qZA()}if(2&n){const t=o.oxw(2);o.xp6(1),o.hij(" ",t.productSelected.title," ")}}function z(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",26),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.showSearchProduct())}),o._uU(1),o.ALo(2,"translate"),o.qZA()}2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"promotion-add.select-product")," "))}function oo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",27),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.removeProduct())}),o._UZ(1,"ion-icon",28),o.qZA()}}function to(n,a){if(1&n&&(o.TgZ(0,"ion-item")(1,"ion-label",18),o._uU(2),o.ALo(3,"translate"),o.ALo(4,"translate"),o.qZA(),o.YNc(5,X,2,1,"ion-text",19),o.YNc(6,z,3,3,"ion-text",20),o.TgZ(7,"ion-buttons",3),o.YNc(8,oo,2,0,"ion-button",21),o.qZA()()),2&n){const t=o.oxw();o.xp6(2),o.AsE("",o.lcZ(3,5,"promotion-add.product")," (",o.lcZ(4,7,"promotion-add.optional"),"): \xa0"),o.xp6(3),o.Q6J("ngIf",t.productSelected&&t.productSelected.id>0),o.xp6(1),o.Q6J("ngIf",!t.productSelected||0===t.productSelected.id),o.xp6(2),o.Q6J("ngIf",t.productSelected&&t.productSelected.id>0)}}function no(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.showSearchCategory())}),o._uU(1),o.qZA()}if(2&n){const t=o.oxw(2);o.xp6(1),o.hij(" ",t.categorySelected.title," ")}}function eo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",26),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.showSearchCategory())}),o._uU(1),o.ALo(2,"translate"),o.qZA()}2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"promotion-add.select-category")," "))}function io(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",27),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(2);return o.KtG(i.removeCategory())}),o._UZ(1,"ion-icon",28),o.qZA()}}function ro(n,a){if(1&n&&(o.TgZ(0,"ion-item")(1,"ion-label",18),o._uU(2),o.ALo(3,"translate"),o.ALo(4,"translate"),o.qZA(),o.YNc(5,no,2,1,"ion-text",19),o.YNc(6,eo,3,3,"ion-text",20),o.TgZ(7,"ion-buttons",3),o.YNc(8,io,2,0,"ion-button",21),o.qZA()()),2&n){const t=o.oxw();o.xp6(2),o.AsE("",o.lcZ(3,5,"promotion-add.category")," (",o.lcZ(4,7,"promotion-add.optional"),"): \xa0"),o.xp6(3),o.Q6J("ngIf",t.categorySelected&&t.categorySelected.id>0),o.xp6(1),o.Q6J("ngIf",!t.categorySelected||0===t.categorySelected.id),o.xp6(2),o.Q6J("ngIf",t.categorySelected&&t.categorySelected.id>0)}}function ao(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.showSearchStore())}),o._uU(1),o.qZA()}if(2&n){const t=o.oxw();o.xp6(1),o.hij(" ",t.storeSelected.name," ")}}function co(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",26),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.showSearchStore())}),o._uU(1),o.ALo(2,"translate"),o.qZA()}2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"staff-add.select-store")," "))}function lo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",27),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.removeStore())}),o._UZ(1,"ion-icon",2),o.qZA()}}function so(n,a){1&n&&(o.TgZ(0,"ion-item-divider",7),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"promotion-add.payment")," "))}function mo(n,a){1&n&&(o.TgZ(0,"ion-text"),o._uU(1,"(%)"),o.qZA())}function po(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"money-input",13),o.NdJ("moneyValueChange",function(i){o.CHM(t);const r=o.oxw(2);return o.KtG(r.config.promotionValue=i)}),o.ALo(1,"translate"),o.qZA()}if(2&n){const t=o.oxw(2);o.s9C("placeholder",o.lcZ(1,2,"promotion-add.enter-promotion-value")),o.Q6J("moneyValue",t.config.promotionValue)}}function _o(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-input",15),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw(2);return o.KtG(r.config.promotionValue=i)}),o.ALo(1,"translate"),o.qZA()}if(2&n){const t=o.oxw(2);o.s9C("placeholder",o.lcZ(1,2,"promotion-add.enter-promotion-percent")),o.Q6J("ngModel",t.config.promotionValue)}}function uo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",8),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"div")(6,"ion-toggle",10),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.config.isPercent=i)}),o.qZA()()(),o.TgZ(7,"ion-col")(8,"ion-label",29),o._uU(9),o.ALo(10,"translate"),o.YNc(11,mo,2,0,"ion-text",17),o.qZA(),o.TgZ(12,"div"),o.YNc(13,po,2,4,"money-input",30),o.YNc(14,_o,2,4,"ion-input",31),o.qZA()()()}if(2&n){const t=o.oxw();o.xp6(3),o.hij("",o.lcZ(4,6,"promotion-add.is-percent")," "),o.xp6(3),o.Q6J("ngModel",t.config.isPercent),o.xp6(3),o.hij("",o.lcZ(10,8,"promotion-add.promotion-value")," "),o.xp6(2),o.Q6J("ngIf",t.config.isPercent),o.xp6(2),o.Q6J("ngIf",!t.config.isPercent),o.xp6(1),o.Q6J("ngIf",t.config.isPercent)}}function go(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",29),o._uU(3),o.ALo(4,"translate"),o.qZA(),o.TgZ(5,"div")(6,"money-input",13),o.NdJ("moneyValueChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.config.promotionMaxValue=i)}),o.ALo(7,"translate"),o.qZA()()()()}if(2&n){const t=o.oxw();o.xp6(3),o.hij("",o.lcZ(4,3,"promotion-add.promotion-max-value")," "),o.xp6(3),o.s9C("placeholder",o.lcZ(7,5,"promotion-add.enter-promotion-max-value")),o.Q6J("moneyValue",t.config.promotionMaxValue)}}function fo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(3);return o.KtG(i.showSearchPromotionProduct())}),o._uU(1),o.qZA()}if(2&n){const t=o.oxw(3);o.xp6(1),o.hij(" ",t.promotionProductSelected.title," ")}}function ho(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",26),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(3);return o.KtG(i.showSearchPromotionProduct())}),o._uU(1),o.ALo(2,"translate"),o.qZA()}2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"promotion-add.select-product")," "))}function xo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",27),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(3);return o.KtG(i.removePromotionProduct())}),o._UZ(1,"ion-icon",28),o.qZA()}}function Co(n,a){if(1&n&&(o.TgZ(0,"ion-item")(1,"ion-label",18),o._uU(2),o.ALo(3,"translate"),o.ALo(4,"translate"),o.qZA(),o.YNc(5,fo,2,1,"ion-text",19),o.YNc(6,ho,3,3,"ion-text",20),o.TgZ(7,"ion-buttons",3),o.YNc(8,xo,2,0,"ion-button",21),o.qZA()()),2&n){const t=o.oxw(2);o.xp6(2),o.AsE("",o.lcZ(3,5,"promotion-add.product")," (",o.lcZ(4,7,"promotion-add.optional"),"): \xa0"),o.xp6(3),o.Q6J("ngIf",t.promotionProductSelected&&t.promotionProductSelected.id>0),o.xp6(1),o.Q6J("ngIf",!t.promotionProductSelected||0===t.promotionProductSelected.id),o.xp6(2),o.Q6J("ngIf",t.promotionProductSelected&&t.promotionProductSelected.id>0)}}function Zo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",25),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(3);return o.KtG(i.showSearchPromotionCategory())}),o._uU(1),o.qZA()}if(2&n){const t=o.oxw(3);o.xp6(1),o.hij(" ",t.promotionCategorySelected.title," ")}}function Ao(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-text",26),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(3);return o.KtG(i.showSearchPromotionCategory())}),o._uU(1),o.ALo(2,"translate"),o.qZA()}2&n&&(o.xp6(1),o.hij(" ",o.lcZ(2,1,"promotion-add.select-category")," "))}function yo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",27),o.NdJ("click",function(){o.CHM(t);const i=o.oxw(3);return o.KtG(i.removePromotionCategory())}),o._UZ(1,"ion-icon",28),o.qZA()}}function vo(n,a){if(1&n&&(o.TgZ(0,"ion-item")(1,"ion-label",18),o._uU(2),o.ALo(3,"translate"),o.ALo(4,"translate"),o.qZA(),o.YNc(5,Zo,2,1,"ion-text",19),o.YNc(6,Ao,3,3,"ion-text",20),o.TgZ(7,"ion-buttons",3),o.YNc(8,yo,2,0,"ion-button",21),o.qZA()()),2&n){const t=o.oxw(2);o.xp6(2),o.AsE("",o.lcZ(3,5,"promotion-add.category")," (",o.lcZ(4,7,"promotion-add.optional"),"): \xa0"),o.xp6(3),o.Q6J("ngIf",t.promotionCategorySelected&&t.promotionCategorySelected.id>0),o.xp6(1),o.Q6J("ngIf",!t.promotionCategorySelected||0===t.promotionCategorySelected.id),o.xp6(2),o.Q6J("ngIf",t.promotionCategorySelected&&t.promotionCategorySelected.id>0)}}function To(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-list")(1,"ion-item-divider",7),o._uU(2),o.ALo(3,"translate"),o.qZA(),o.YNc(4,Co,9,9,"ion-item",17),o.YNc(5,vo,9,9,"ion-item",17),o.TgZ(6,"ion-item")(7,"ion-label",8),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"ion-input",32),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.config.maxPromotionQuantity=i)}),o.qZA(),o.TgZ(11,"p",14),o._uU(12),o.ALo(13,"translate"),o.qZA()()()}if(2&n){const t=o.oxw();o.xp6(2),o.hij(" ",o.lcZ(3,6,"promotion-add.promotion-products")," "),o.xp6(2),o.Q6J("ngIf",!t.promotionCategorySelected),o.xp6(1),o.Q6J("ngIf",!t.promotionProductSelected),o.xp6(3),o.Oqu(o.lcZ(9,8,"promotion-add.max-promotion-quantity")),o.xp6(2),o.Q6J("ngModel",t.config.maxPromotionQuantity),o.xp6(2),o.hij(" ",o.lcZ(13,10,"promotion-add.max-promotion-quantity-description")," ")}}let Po=(()=>{class n{constructor(t,e,i,r,Z,M){this.navCtrl=t,this.translateService=e,this.promotionService=i,this.userService=r,this.analyticsService=Z,this.alertCtrl=M,this.params=null,this.config={isPercent:!1,promotionMaxValue:0,conditionTotalAmount:0,conditionTotalQuantity:0,promotionValue:0,forAllCustomer:!0,isActive:!0,isDiscount:!0,isGift:!0},this.fromSearch=!1,this.saveDisabled=!1,this.onKeyPress=J=>{!J.target||"body"!==J.target.localName||("s"===J.key||"S"===J.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var t=this;return(0,m.Z)(function*(){yield t.analyticsService.setCurrentScreen("promotion-add")})()}ngOnInit(){var t=this;return(0,m.Z)(function*(){t.currency=yield t.userService.getAttr("current-currency"),t.config={isPercent:!1,romotionMaxValue:0,conditionTotalAmount:0,conditionTotalQuantity:0,promotionValue:0,forAllCustomer:!0,isActive:!0,isDiscount:!0,isGift:!0};let e=0;t.params=t.navCtrl.getParams(t.params),t.fromSearch=t.params&&t.params.fromSearch,t.params&&t.params.id&&(e=t.params.id),e&&e>0&&t.promotionService.getConfig(e).then(i=>{i.maxPromotionQuantity&&(i.promotionCategory||i.promotionProduct)&&(i.isGift=!0),i.promotionValue&&i.promotionMaxValue&&(i.isDiscount=!0),t.config=i,t.contactSelected=t.config.contact,t.productSelected=t.config.product,t.categorySelected=t.config.category,t.storeSelected=t.config.store,t.promotionProductSelected=t.config.promotionProduct,t.promotionCategorySelected=t.config.promotionCategory})})()}showSearchContact(){var t=this;return(0,m.Z)(function*(){t.analyticsService.logEvent("promotion-add-search-contact"),t.navCtrl.push("/contact",{callback:i=>{const r=i;r&&(t.contactSelected=r,t.config.contactId=r.id)},searchMode:!0})})()}showSearchProduct(){var t=this;return(0,m.Z)(function*(){t.analyticsService.logEvent("promotion-add-search-product"),t.navCtrl.push("/product",{callback:i=>{const r=i;r&&(t.productSelected=r,t.config.productId=r.id)},searchMode:!0})})()}showSearchCategory(){var t=this;return(0,m.Z)(function*(){t.analyticsService.logEvent("promotion-add-search-category"),t.navCtrl.push("/trade-category",{callback:i=>{const r=i;r&&(t.categorySelected=r,t.config.categoryId=r.id)},searchMode:!0})})()}showSearchPromotionProduct(){var t=this;return(0,m.Z)(function*(){t.analyticsService.logEvent("promotion-add-search-promotion-product"),t.navCtrl.push("/product",{callback:i=>{const r=i;r&&(t.promotionProductSelected=r,t.config.promotionProductId=r.id)},searchMode:!0})})()}showSearchPromotionCategory(){var t=this;return(0,m.Z)(function*(){t.analyticsService.logEvent("promotion-add-search-promotion-category"),t.navCtrl.push("/trade-category",{callback:i=>{const r=i;r&&(t.promotionCategorySelected=r,t.config.promotionCategoryId=r.id)},searchMode:!0})})()}validate(){return this.config.name?this.config.name?this.config.startDate?this.config.endDate?this.config.isDiscount||this.config.isGift?this.config.isDiscount&&!this.config.promotionValue?(alert(this.translateService.instant("promotion-add.no-promotion-value-alert")),!1):!(!this.config.forAllCustomer&&!this.contactSelected&&(alert(this.translateService.instant("promotion-add.no-contact-alert")),1)):(alert(this.translateService.instant("promotion-add.must-select-at-least-one-type")),!1):(alert(this.translateService.instant("promotion-add.no-end-date-alert")),!1):(alert(this.translateService.instant("promotion-add.no-start-date-alert")),!1):(alert(this.translateService.instant("promotion-add.no-code-alert")),!1):(alert(this.translateService.instant("promotion-add.no-name-alert")),!1)}save(){var t=this;return(0,m.Z)(function*(){if(!t.validate())return;t.saveDisabled=!0;const e=yield t.navCtrl.loading();t.promotionService.saveConfig(t.config).then((0,m.Z)(function*(){t.analyticsService.logEvent("config-save-successfully"),t.saveDisabled=!1,yield e.dismiss(),t.exitPage()})).catch((0,m.Z)(function*(){t.saveDisabled=!1,yield e.dismiss()}))})()}removeContact(){this.contactSelected=null,this.config.contactId=0}removePromotionProduct(){this.promotionProductSelected=null,this.config.promotionProductId=0}removePromotionCategory(){this.promotionCategorySelected=null,this.config.promotionCategoryId=0}removeProduct(){this.productSelected=null,this.config.productId=0}removeCategory(){this.categorySelected=null,this.config.categoryId=0}dismiss(){var t=this;return(0,m.Z)(function*(){t.fromSearch?yield t.navCtrl.pop():yield t.navCtrl.popOnly()})()}exitPage(){var t=this;return(0,m.Z)(function*(){t.fromSearch?yield t.navCtrl.pop():yield t.navCtrl.popOnly(),t.navCtrl.publish("reloadPromotionList",null),t.navCtrl.publish("reloadPromotion",t.config)})()}isNotCordova(){return this.navCtrl.isNotCordova()}contactImageOrPlaceholder(t){return I.W.contactImageOrPlaceholder(t.iconUrl)}delete(){var t=this;return(0,m.Z)(function*(){yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("promotion.delete-alert"),buttons:[{text:t.translateService.instant("common.cancel"),handler:()=>{}},{text:t.translateService.instant("common.agree"),handler:()=>{t.promotionService.deleteConfig(t.config).then((0,m.Z)(function*(){t.analyticsService.logEvent("promotion-config-delete-success"),t.navCtrl.pop(),t.navCtrl.publish("reloadPromotionList",null)}))}}]})).present()})()}showSearchStore(){var t=this;return(0,m.Z)(function*(){t.navCtrl.push("/store",{callback:i=>{const r=i;r&&(t.storeSelected=r,t.config.storeId=r.id)},searchMode:!0})})()}removeStore(){this.storeSelected=null,this.config.storeId=0}}return n.\u0275fac=function(t){return new(t||n)(o.Y36(N.G),o.Y36(T.sK),o.Y36(h.q),o.Y36(P.K),o.Y36(l.y),o.Y36(s.Br))},n.\u0275cmp=o.Xpm({type:n,selectors:[["promotion-add"]],decls:121,vars:98,consts:[["slot","start"],["ion-button","",3,"click"],["name","close"],["slot","end"],["color","danger",3,"click",4,"ngIf"],["color","primary",3,"click"],["name","checkmark"],["color","light",2,"--padding-top","5px","--padding-bottom","5px"],["position","stacked","color","primary"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["type","date","pickerId","promotionStartDate","min","2015-01-01","max","2025-12-31",3,"date","dateChange"],["type","date","pickerId","promotionEndDate","min","2015-01-01","max","2025-12-31",3,"date","dateChange"],[3,"placeholder","moneyValue","moneyValueChange"],[2,"font-size","0.8em"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange"],["color","primary",3,"ngModel","ngModelChange"],[4,"ngIf"],["color","primary"],["slot","end","color","dark",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["fill","clear",3,"click",4,"ngIf"],["color","light","style","--padding-top: 5px; --padding-bottom: 5px;",4,"ngIf"],["color","danger",3,"click"],["name","trash","slot","icon-only"],["slot","end","color","dark",3,"click"],["slot","end",3,"click"],["fill","clear",3,"click"],["name","close","slot","icon-only"],["position","stacked","color","danger"],[3,"placeholder","moneyValue","moneyValueChange",4,"ngIf"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange",4,"ngIf"],["clearInput","","type","number",3,"ngModel","ngModelChange"]],template:function(t,e){1&t&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),o.NdJ("click",function(){return e.dismiss()}),o._UZ(4,"ion-icon",2),o._uU(5),o.ALo(6,"translate"),o.qZA()(),o.TgZ(7,"ion-title"),o._uU(8),o.ALo(9,"translate"),o.qZA(),o.TgZ(10,"ion-buttons",3),o.YNc(11,v,2,0,"ion-button",4),o.TgZ(12,"ion-button",5),o.NdJ("click",function(){return e.save()}),o._UZ(13,"ion-icon",6),o._uU(14),o.ALo(15,"translate"),o.qZA()()()(),o.TgZ(16,"ion-content")(17,"ion-grid")(18,"ion-item-divider",7),o._uU(19),o.ALo(20,"translate"),o.qZA(),o.TgZ(21,"ion-row")(22,"ion-col")(23,"ion-label",8),o._uU(24),o.ALo(25,"translate"),o.qZA(),o.TgZ(26,"div")(27,"ion-input",9),o.NdJ("ngModelChange",function(r){return e.config.name=r}),o.ALo(28,"translate"),o.qZA()()()(),o.TgZ(29,"ion-row")(30,"ion-col")(31,"ion-label",8),o._uU(32),o.ALo(33,"translate"),o.qZA(),o.TgZ(34,"div")(35,"ion-input",9),o.NdJ("ngModelChange",function(r){return e.config.code=r}),o.ALo(36,"translate"),o.qZA()()(),o.TgZ(37,"ion-col")(38,"ion-label",8),o._uU(39),o.ALo(40,"translate"),o.qZA(),o.TgZ(41,"div")(42,"ion-toggle",10),o.NdJ("ngModelChange",function(r){return e.config.isActive=r}),o.qZA()()()(),o.TgZ(43,"ion-row")(44,"ion-col")(45,"ion-label",8),o._uU(46),o.ALo(47,"translate"),o.qZA(),o.TgZ(48,"div")(49,"date-picker",11),o.NdJ("dateChange",function(r){return e.config.startDate=r}),o.qZA()()(),o.TgZ(50,"ion-col")(51,"ion-label",8),o._uU(52),o.ALo(53,"translate"),o.qZA(),o.TgZ(54,"div")(55,"date-picker",12),o.NdJ("dateChange",function(r){return e.config.endDate=r}),o.qZA()()()(),o.TgZ(56,"ion-item-divider",7),o._uU(57),o.ALo(58,"translate"),o.qZA(),o.TgZ(59,"ion-row")(60,"ion-col")(61,"ion-label",8),o._uU(62),o.ALo(63,"translate"),o.qZA(),o.TgZ(64,"div")(65,"money-input",13),o.NdJ("moneyValueChange",function(r){return e.config.conditionTotalAmount=r}),o.ALo(66,"translate"),o.qZA(),o.TgZ(67,"p",14),o._uU(68),o.ALo(69,"translate"),o.qZA()()(),o.TgZ(70,"ion-col")(71,"ion-label",8),o._uU(72),o.ALo(73,"translate"),o.qZA(),o.TgZ(74,"div")(75,"ion-input",15),o.NdJ("ngModelChange",function(r){return e.config.conditionTotalQuantity=r}),o.ALo(76,"translate"),o.qZA(),o.TgZ(77,"p",14),o._uU(78),o.ALo(79,"translate"),o.qZA()()()(),o.TgZ(80,"ion-list")(81,"ion-item-divider",7),o._uU(82),o.ALo(83,"translate"),o.qZA(),o.TgZ(84,"ion-item")(85,"ion-label",8),o._uU(86),o.ALo(87,"translate"),o.qZA(),o.TgZ(88,"ion-toggle",16),o.NdJ("ngModelChange",function(r){return e.config.forAllCustomer=r}),o.qZA()(),o.YNc(89,b,8,6,"ion-item",17),o.YNc(90,to,9,9,"ion-item",17),o.YNc(91,ro,9,9,"ion-item",17),o.TgZ(92,"ion-item")(93,"ion-text",18),o._uU(94),o.ALo(95,"translate"),o.ALo(96,"translate"),o.qZA(),o.YNc(97,ao,2,1,"ion-text",19),o.YNc(98,co,3,3,"ion-text",20),o.TgZ(99,"ion-buttons",3),o.YNc(100,lo,2,0,"ion-button",21),o.qZA()()(),o.TgZ(101,"ion-item-divider",7),o._uU(102),o.ALo(103,"translate"),o.qZA(),o.TgZ(104,"ion-row")(105,"ion-col")(106,"ion-label",8),o._uU(107),o.ALo(108,"translate"),o.qZA(),o.TgZ(109,"div")(110,"ion-toggle",10),o.NdJ("ngModelChange",function(r){return e.config.isDiscount=r}),o.qZA()()(),o.TgZ(111,"ion-col")(112,"ion-label",8),o._uU(113),o.ALo(114,"translate"),o.qZA(),o.TgZ(115,"div")(116,"ion-toggle",10),o.NdJ("ngModelChange",function(r){return e.config.isGift=r}),o.qZA()()()(),o.YNc(117,so,3,3,"ion-item-divider",22),o.YNc(118,uo,15,10,"ion-row",17),o.YNc(119,go,8,7,"ion-row",17),o.qZA(),o.YNc(120,To,14,12,"ion-list",17),o.qZA()),2&t&&(o.xp6(5),o.hij(" \xa0",o.lcZ(6,48,"common.cancel")," "),o.xp6(3),o.Oqu(o.lcZ(9,50,"promotion-add.title")),o.xp6(3),o.Q6J("ngIf",e.config&&e.config.id),o.xp6(3),o.hij(" \xa0",o.lcZ(15,52,"action.save")," "),o.xp6(2),o.Akn(e.navCtrl.hasAds()?"--padding-bottom: 60px":""),o.xp6(3),o.hij(" ",o.lcZ(20,54,"promotion-add.info")," "),o.xp6(5),o.hij("",o.lcZ(25,56,"promotion-add.name")," "),o.xp6(3),o.s9C("placeholder",o.lcZ(28,58,"promotion-add.enter-name")),o.Q6J("ngModel",e.config.name),o.xp6(5),o.hij("",o.lcZ(33,60,"promotion-add.code")," "),o.xp6(3),o.s9C("placeholder",o.lcZ(36,62,"promotion-add.enter-code")),o.Q6J("ngModel",e.config.code),o.xp6(4),o.hij("",o.lcZ(40,64,"promotion-add.is-active")," "),o.xp6(3),o.Q6J("ngModel",e.config.isActive),o.xp6(4),o.hij("",o.lcZ(47,66,"promotion-add.start-date")," "),o.xp6(3),o.Q6J("date",e.config.startDate),o.xp6(3),o.hij("",o.lcZ(53,68,"promotion-add.end-date")," "),o.xp6(3),o.Q6J("date",e.config.endDate),o.xp6(2),o.hij(" ",o.lcZ(58,70,"promotion-add.conditions")," "),o.xp6(5),o.hij("",o.lcZ(63,72,"promotion-add.condition-total-amount")," "),o.xp6(3),o.s9C("placeholder",o.lcZ(66,74,"promotion-add.enter-condition-total-amount")),o.Q6J("moneyValue",e.config.conditionTotalAmount),o.xp6(3),o.Oqu(o.lcZ(69,76,"promotion-add.condition-total-amount-description")),o.xp6(4),o.hij("",o.lcZ(73,78,"promotion-add.condition-total-quantity")," "),o.xp6(3),o.s9C("placeholder",o.lcZ(76,80,"promotion-add.enter-condition-total-quantity")),o.Q6J("ngModel",e.config.conditionTotalQuantity),o.xp6(3),o.Oqu(o.lcZ(79,82,"promotion-add.condition-total-quantity-description")),o.xp6(4),o.hij(" ",o.lcZ(83,84,"promotion-add.apply-for")," "),o.xp6(4),o.Oqu(o.lcZ(87,86,"promotion-add.for-all-customer")),o.xp6(2),o.Q6J("ngModel",e.config.forAllCustomer),o.xp6(1),o.Q6J("ngIf",!e.config.forAllCustomer),o.xp6(1),o.Q6J("ngIf",!e.categorySelected),o.xp6(1),o.Q6J("ngIf",!e.productSelected),o.xp6(3),o.AsE("",o.lcZ(95,88,"staff-add.store")," (",o.lcZ(96,90,"promotion-add.optional"),"): \xa0"),o.xp6(3),o.Q6J("ngIf",e.storeSelected&&e.storeSelected.id>0),o.xp6(1),o.Q6J("ngIf",!e.storeSelected||0===e.storeSelected.id),o.xp6(2),o.Q6J("ngIf",e.storeSelected&&e.storeSelected.id>0),o.xp6(2),o.hij(" ",o.lcZ(103,92,"promotion-add.type")," "),o.xp6(5),o.hij("",o.lcZ(108,94,"promotion-add.discount")," "),o.xp6(3),o.Q6J("ngModel",e.config.isDiscount),o.xp6(3),o.hij("",o.lcZ(114,96,"promotion-add.gift")," "),o.xp6(3),o.Q6J("ngModel",e.config.isGift),o.xp6(1),o.Q6J("ngIf",e.config.isDiscount),o.xp6(1),o.Q6J("ngIf",e.config.isDiscount),o.xp6(1),o.Q6J("ngIf",e.config.isDiscount),o.xp6(1),o.Q6J("ngIf",e.config.isGift))},dependencies:[y.O5,c.JJ,c.On,s.YG,s.Sm,s.wI,s.W2,s.jY,s.Gu,s.gu,s.pK,s.Ie,s.rH,s.Q$,s.q_,s.Nd,s.yW,s.wd,s.ho,s.sr,s.w,s.as,s.j9,g.F,p.L,T.X$],encapsulation:2}),n})();var S=d(1914),So=d(9854),Mo=d(9921),W=d(667);const bo=["barcode"];function Jo(n,a){1&n&&(o.TgZ(0,"p")(1,"b"),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&n&&(o.xp6(2),o.hij("",o.lcZ(3,1,"promotion-add.apply-for"),":"))}function Io(n,a){1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n&&(o.xp6(1),o.Oqu(o.lcZ(2,1,"promotion-add.for-all-customer")))}function No(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.contact"),": ",t.promotion.contact.fullName,"")}}function wo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.product"),": ",t.promotion.product.title,"")}}function qo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.category"),": ",t.promotion.category.title,"")}}function Qo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"staff-add.store"),": ",t.promotion.store.name,"")}}function Lo(n,a){1&n&&(o.TgZ(0,"p")(1,"b"),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&n&&(o.xp6(2),o.hij("",o.lcZ(3,1,"promotion-add.conditions"),":"))}const k=function(n,a,t){return[n,a,"symbol","1.0-2",t]};function Uo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"currency"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE(" ",o.lcZ(2,2,"promotion-add.condition-total-amount"),": ",o.G7q(3,4,o.kEZ(10,k,t.promotion.conditionTotalAmount,t.currency,t.translateService.currentLang))," ")}}function Fo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE(" ",o.lcZ(2,2,"promotion-add.condition-total-quantity"),": ",t.promotion.conditionTotalQuantity," ")}}function Ho(n,a){if(1&n&&(o.TgZ(0,"span"),o._uU(1),o.ALo(2,"currency"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.Oqu(o.G7q(2,1,o.kEZ(7,k,t.promotion.promotionValue,t.currency,t.translateService.currentLang)))}}function Yo(n,a){if(1&n&&(o.TgZ(0,"span"),o._uU(1),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.hij("",t.promotion.promotionValue,"%")}}function Eo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"currency"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE(" ",o.lcZ(2,2,"promotion-add.promotion-max-value"),": ",o.G7q(3,4,o.kEZ(10,k,t.promotion.promotionMaxValue,t.currency,t.translateService.currentLang))," ")}}function ko(n,a){1&n&&(o.TgZ(0,"p")(1,"b"),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&n&&(o.xp6(2),o.hij("",o.lcZ(3,1,"promotion-add.promotion-products"),":"))}function Go(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.product"),": ",t.promotion.promotionProduct.title,"")}}function Do(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.category"),": ",t.promotion.promotionCategory.title,"")}}function Vo(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.max-promotion-quantity"),": ",t.promotion.maxPromotionQuantity,"")}}function Ko(n,a){if(1&n&&(o.TgZ(0,"ion-thumbnail",2),o._UZ(1,"img",17),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.Q6J("src",t.promotion.product.avatarUrl,o.LSH)}}function jo(n,a){if(1&n&&(o.TgZ(0,"ion-avatar",2),o._UZ(1,"img",17),o.qZA()),2&n){const t=o.oxw(2);o.xp6(1),o.Q6J("src",t.contactImageOrPlaceholder(t.promotion.contact),o.LSH)}}function Oo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-content")(1,"ion-list",7)(2,"ion-list")(3,"ion-item")(4,"ion-label",8),o._uU(5),o.TgZ(6,"p"),o._uU(7),o.ALo(8,"translate"),o.qZA(),o.TgZ(9,"p"),o._uU(10),o.ALo(11,"translate"),o.qZA(),o.YNc(12,Jo,4,3,"p",6),o.YNc(13,Io,3,3,"p",6),o.YNc(14,No,3,4,"p",6),o.YNc(15,wo,3,4,"p",6),o.YNc(16,qo,3,4,"p",6),o.YNc(17,Qo,3,4,"p",6),o.YNc(18,Lo,4,3,"p",6),o.YNc(19,Uo,4,14,"p",6),o.YNc(20,Fo,3,4,"p",6),o.TgZ(21,"p")(22,"b"),o._uU(23),o.ALo(24,"translate"),o.qZA()(),o.TgZ(25,"p"),o._uU(26),o.ALo(27,"translate"),o.YNc(28,Ho,3,11,"span",6),o.YNc(29,Yo,2,1,"span",6),o.qZA(),o.YNc(30,Eo,4,14,"p",6),o.YNc(31,ko,4,3,"p",6),o.YNc(32,Go,3,4,"p",6),o.YNc(33,Do,3,4,"p",6),o.YNc(34,Vo,3,4,"p",6),o.qZA(),o.YNc(35,Ko,2,1,"ion-thumbnail",9),o.YNc(36,jo,2,1,"ion-avatar",9),o.TgZ(37,"ion-toggle",10),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.promotion.isActive=i)})("ionChange",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.changeActive())}),o.qZA()()()(),o.TgZ(38,"ion-list")(39,"ion-item-divider",11),o._uU(40),o.ALo(41,"translate"),o.TgZ(42,"ion-button",12),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.printBarcode())}),o._UZ(43,"ion-icon",13),o.qZA()(),o.TgZ(44,"ion-item")(45,"div",14),o._uU(46),o.ALo(47,"translate"),o.TgZ(48,"ion-icon",15),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.copy(i.promotion.code))}),o.qZA()()(),o.TgZ(49,"ion-item",16)(50,"ion-label"),o._UZ(51,"img",17),o.qZA()()()()}if(2&n){const t=o.oxw();o.xp6(5),o.hij(" ",t.promotion.name," "),o.xp6(2),o.AsE(" ",o.lcZ(8,31,"promotion-add.start-date"),": ",t.dateFormat(t.promotion.startDate)," "),o.xp6(3),o.AsE(" ",o.lcZ(11,33,"promotion-add.end-date"),": ",t.dateFormat(t.promotion.endDate)," "),o.xp6(2),o.Q6J("ngIf",t.promotion.contact||t.promotion.product||t.promotion.category||t.promotion.store),o.xp6(1),o.Q6J("ngIf",t.promotion.forAllCustomer),o.xp6(1),o.Q6J("ngIf",t.promotion.contact),o.xp6(1),o.Q6J("ngIf",t.promotion.product),o.xp6(1),o.Q6J("ngIf",t.promotion.category),o.xp6(1),o.Q6J("ngIf",t.promotion.store),o.xp6(1),o.Q6J("ngIf",t.promotion.conditionTotalAmount||t.promotion.conditionTotalQuantity),o.xp6(1),o.Q6J("ngIf",t.promotion.conditionTotalAmount),o.xp6(1),o.Q6J("ngIf",t.promotion.conditionTotalQuantity),o.xp6(3),o.hij("",o.lcZ(24,35,"promotion-add.payment"),":"),o.xp6(3),o.hij(" ",o.lcZ(27,37,"promotion-add.promotion-value"),": "),o.xp6(2),o.Q6J("ngIf",!t.promotion.isPercent),o.xp6(1),o.Q6J("ngIf",t.promotion.isPercent),o.xp6(1),o.Q6J("ngIf",t.promotion.promotionMaxValue),o.xp6(1),o.Q6J("ngIf",(t.promotion.promotionProduct||t.promotion.promotionCategory)&&t.promotion.maxPromotionQuantity),o.xp6(1),o.Q6J("ngIf",t.promotion.promotionProduct),o.xp6(1),o.Q6J("ngIf",t.promotion.promotionCategory),o.xp6(1),o.Q6J("ngIf",t.promotion.maxPromotionQuantity),o.xp6(1),o.Q6J("ngIf",t.promotion.product),o.xp6(1),o.Q6J("ngIf",t.promotion.contact),o.xp6(1),o.Q6J("ngModel",t.promotion.isActive),o.xp6(3),o.hij(" ",o.lcZ(41,39,"promotion-add.qr-code")," "),o.xp6(6),o.AsE(" ",o.lcZ(47,41,"promotion-add.code"),": ",t.promotion.code," "),o.xp6(5),o.hYB("src","",t.userService.apiUrl,"/qrcode?text=",t.promotion.code,"",o.LSH)}}let Bo=(()=>{class n{constructor(t,e,i,r,Z,M,J,D,V,K,j){var C=this;this.navCtrl=t,this.printer=e,this.staffService=i,this.translateService=r,this.promotionService=Z,this.actionSheetCtrl=M,this.userService=J,this.alertCtrl=D,this.platform=V,this.toastController=K,this.analyticsService=j,this.params=null,this.tab="info",this.isShowBarcode=!1,this.bypassActiveChange=!0,this.reload=(0,m.Z)(function*(){C.bypassActiveChange=!0;const _=yield C.navCtrl.loading();C.currency=yield C.userService.getAttr("current-currency");const f=C.params?C.params:C.navCtrl.getParams();if(C.params=f,f&&f.id&&f.id>0){C.params=f;const A=f.id;f.tab&&""!=f.tab&&(C.tab=f.tab);const x=yield C.promotionService.getConfig(A);x.maxPromotionQuantity&&(x.promotionCategory||x.promotionProduct)&&(x.isGift=!0),x.promotionValue&&x.promotionMaxValue&&(x.isDiscout=!0),C.promotion=x}yield _.dismiss(),C.bypassActiveChange=!1});const u=_=>{const f=_.detail;f&&this.promotion&&f.id===this.promotion.id&&this.reload()};this.navCtrl.unsubscribe("reloadPromotion",u),this.navCtrl.subscribe("reloadPromotion",u)}ionViewWillEnter(){var t=this;return(0,m.Z)(function*(){yield t.analyticsService.setCurrentScreen("contact-detail")})()}ngOnInit(){this.reload()}edit(){this.navCtrl.push("/promotion/add",{id:this.promotion.id})}dateTimeFormat(t){return S.C.toUiString(t)}dateFormat(t){return S.C.toUiDateString(t)}limitText(t,e=200){return I.W.limitText(t,e)}delete(){var t=this;return(0,m.Z)(function*(){yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("promotion.delete-alert"),buttons:[{text:t.translateService.instant("common.cancel"),handler:()=>{}},{text:t.translateService.instant("common.agree"),handler:()=>{t.promotionService.deleteConfig(t.promotion).then((0,m.Z)(function*(){t.analyticsService.logEvent("promotion-detail-delete-success"),t.navCtrl.pop(),t.navCtrl.publish("reloadPromotionList",null)}))}}]})).present()})()}presentActionSheet(){var t=this;return(0,m.Z)(function*(){const e=[{text:t.translateService.instant("promotion.delete"),role:"destructive",handler:()=>{t.delete()}},{text:t.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}];yield(yield t.actionSheetCtrl.create({header:t.translateService.instant("action.action"),buttons:e})).present()})()}showBarcode(){this.isShowBarcode=!this.isShowBarcode}printBarcode(){const t=`<div style='text-align: center;'><img src='${this.userService.apiUrl}/qrcode?text=${this.promotion.code}'/></div>`;this.navCtrl.isNotCordova()?I.W.webPrint(t):this.printer.print(t).then(()=>{})}copy(t){var e=this;return(0,m.Z)(function*(){if(e.isCordova())return e.share(t);yield(0,So.OR)(t);const i=e.translateService.instant("request-pro.copied")+t;yield(yield e.toastController.create({message:i,duration:3e3,position:"bottom"})).present()})()}isCordova(){return this.platform.is("capacitor")||this.platform.is("cordova")}share(t){var e=this;return(0,m.Z)(function*(){yield e.userService.shareText(t)})()}changeActive(){var t=this;return(0,m.Z)(function*(){t.bypassActiveChange||(yield t.promotionService.saveConfig(t.promotion),yield t.navCtrl.publish("reloadPromotionList"),yield(yield t.toastController.create({message:t.translateService.instant("promotion-add.active-changed"),duration:3e3,position:"bottom"})).present())})()}}return n.\u0275fac=function(t){return new(t||n)(o.Y36(N.G),o.Y36(Mo.F),o.Y36(W.x),o.Y36(T.sK),o.Y36(h.q),o.Y36(s.BX),o.Y36(P.K),o.Y36(s.Br),o.Y36(s.t4),o.Y36(s.yF),o.Y36(l.y))},n.\u0275cmp=o.Xpm({type:n,selectors:[["promotion-detail"]],viewQuery:function(t,e){if(1&t&&o.Gf(bo,5),2&t){let i;o.iGM(i=o.CRH())&&(e.barcode=i.first)}},decls:15,vars:7,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","ellipsis-vertical"],[4,"ngIf"],["lines","none"],[1,"ion-text-wrap"],["slot","end",4,"ngIf"],["slot","end",3,"ngModel","ngModelChange","ionChange"],["color","light"],["fill","clear","color","primary","slot","end",3,"click"],["slot","icon-only","name","print"],[2,"text-align","center"],["name","copy",3,"click"],["lines","none",2,"text-align","center"],[3,"src"]],template:function(t,e){1&t&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o._UZ(3,"ion-back-button",1),o.qZA(),o.TgZ(4,"ion-title"),o._uU(5),o.ALo(6,"translate"),o.qZA(),o.TgZ(7,"ion-buttons",2)(8,"ion-button",3),o.NdJ("click",function(){return e.edit()}),o._UZ(9,"ion-icon",4),o._uU(10),o.ALo(11,"translate"),o.qZA(),o.TgZ(12,"ion-button",3),o.NdJ("click",function(){return e.presentActionSheet()}),o._UZ(13,"ion-icon",5),o.qZA()()()(),o.YNc(14,Oo,52,43,"ion-content",6)),2&t&&(o.xp6(5),o.Oqu(o.lcZ(6,3,"promotion-add.title-detail")),o.xp6(5),o.hij(" ",o.lcZ(11,5,"common.edit")," "),o.xp6(4),o.Q6J("ngIf",e.promotion))},dependencies:[y.O5,c.JJ,c.On,s.BJ,s.oU,s.YG,s.Sm,s.W2,s.Gu,s.gu,s.Ie,s.rH,s.Q$,s.q_,s.Bs,s.wd,s.ho,s.sr,s.w,s.cs,y.H9,T.X$],encapsulation:2}),n})();var G=d(7489),Wo=d(5439),$=d(971),$o=d(3142),Ro=d(6861),Xo=d(3064);function zo(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",20),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.dismiss())}),o._UZ(1,"ion-icon",21),o.qZA()}}function ot(n,a){1&n&&o._UZ(0,"ion-menu-button",22)}function tt(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",23),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.navCtrl.home())}),o._UZ(1,"ion-icon",24),o.qZA()}}function nt(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",20),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.reload())}),o._UZ(1,"ion-icon",25),o.qZA()}}function et(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-button",20),o.NdJ("click",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.addConfig())}),o._UZ(1,"ion-icon",26),o.qZA()}}function it(n,a){1&n&&(o.TgZ(0,"ion-segment-button",31)(1,"ion-label",30),o._uU(2),o.ALo(3,"translate"),o.qZA()()),2&n&&(o.xp6(2),o.hij(" ",o.lcZ(3,1,"promotion.config")," "))}function rt(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-segment",27),o.NdJ("ngModelChange",function(i){o.CHM(t);const r=o.oxw();return o.KtG(r.segment=i)})("ngModelChange",function(){o.CHM(t);const i=o.oxw();return o.KtG(i.tabChange())}),o.YNc(1,it,4,3,"ion-segment-button",28),o.TgZ(2,"ion-segment-button",29)(3,"ion-label",30),o._uU(4),o.ALo(5,"translate"),o.qZA()()()}if(2&n){const t=o.oxw();o.Q6J("ngModel",t.segment),o.xp6(1),o.Q6J("ngIf",!t.selectedStaff||t.selectedStaff.hasFullAccess),o.xp6(3),o.hij(" ",o.lcZ(5,3,"promotion.histories")," ")}}function at(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw().$implicit;o.xp6(1),o.AsE("",o.lcZ(2,2,"promotion-add.contact"),": ",t.contact.fullName,"")}}function ct(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.ALo(3,"translate"),o.qZA()),2&n){const t=o.oxw().$implicit;o.xp6(1),o.lnq("",o.lcZ(2,3,"promotion.history-amount"),": ",t.amount," ",o.lcZ(3,5,"promotion-add.promotion"),"")}}function lt(n,a){if(1&n&&(o.TgZ(0,"p"),o._uU(1),o.ALo(2,"translate"),o.qZA()),2&n){const t=o.oxw().$implicit,e=o.oxw();o.xp6(1),o.AsE(" ",o.lcZ(2,2,"promotion.history-created-at"),": ",e.dateFormat(t.createdAt)," ")}}function st(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"p")(1,"ion-text",35),o.NdJ("click",function(){o.CHM(t);const i=o.oxw().$implicit,r=o.oxw();return o.KtG(r.viewOrder(i.order.id))}),o._uU(2),o.ALo(3,"translate"),o.qZA()()}if(2&n){const t=o.oxw().$implicit;o.xp6(2),o.AsE("",o.lcZ(3,2,"promotion.order"),": #",t.order.orderCode,"")}}function mt(n,a){if(1&n&&(o.TgZ(0,"ion-avatar",4),o._UZ(1,"img",36),o.qZA()),2&n){const t=o.oxw().$implicit,e=o.oxw();o.xp6(1),o.Q6J("src",e.contactImageOrPlaceholder(t.contact),o.LSH)}}function dt(n,a){if(1&n){const t=o.EpF();o.TgZ(0,"ion-item",32),o.NdJ("press",function(){const r=o.CHM(t).$implicit,Z=o.oxw();return o.KtG(Z.presentActionSheet(r))}),o.TgZ(1,"ion-label",30),o.YNc(2,at,3,4,"p",33),o.YNc(3,ct,4,7,"p",33),o.YNc(4,lt,3,4,"p",33),o.YNc(5,st,4,4,"p",33),o.qZA(),o.YNc(6,mt,2,1,"ion-avatar",34),o.qZA()}if(2&n){const t=a.$implicit;o.xp6(2),o.Q6J("ngIf",t.contact),o.xp6(1),o.Q6J("ngIf",t.amount),o.xp6(1),o.Q6J("ngIf",t.createdAt),o.xp6(1),o.Q6J("ngIf",t.order),o.xp6(1),o.Q6J("ngIf",t.contact)}}function pt(n,a){1&n&&(o.TgZ(0,"ion-item",30),o._UZ(1,"div",37),o.ALo(2,"translate"),o.qZA()),2&n&&(o.xp6(1),o.Q6J("innerHTML",o.lcZ(2,1,"promotion.no-histories"),o.oJD))}const _t=function(n,a,t){return[n,a,"symbol","1.0-2",t]},ut=[{path:"",component:(()=>{class n{constructor(t,e,i,r,Z,M,J,D,V,K,j,C){var u=this;this.navCtrl=t,this.staffService=e,this.viewCtrl=i,this.userService=r,this.promotionService=Z,this.dataService=M,this.alertCtrl=J,this.actionSheetCtrl=D,this.translateService=V,this.planService=K,this.analyticsService=j,this.currencyPipe=C,this.params=null,this.dateFrom="",this.dateTo="",this.promotionConfigs=[],this.promotionHistories=[],this.originalPromotionHistories=[],this.originalPromotionConfigs=[],this.saveDisabled=!1,this.segment="config",this.noSave=!0,this.total=0,this.searchKeyHistories="",this.searchKeyConfigs="",this.selectedStaff=null,this.searchMode=!1,this.changeActive=function(){var _=(0,m.Z)(function*(f,A,x,E){A.stopPropagation();const O=E.find(B=>B.id===f.id);var B;O&&O.isActive!=f.isActive&&(yield(yield u.alertCtrl.create({header:u.translateService.instant("common.confirm"),message:u.translateService.instant("promotion-add.active-changed-alert"),buttons:[{text:u.translateService.instant("common.cancel"),handler:()=>{f.isActive=!f.isActive}},{text:u.translateService.instant("common.agree"),handler:(B=(0,m.Z)(function*(){O.isActive=f.isActive,yield u.promotionService.saveConfig(f)}),function(){return B.apply(this,arguments)})}]})).present())});return function(f,A,x,E){return _.apply(this,arguments)}}(),this.itemTemplate={h2:{field:"name"},pList:[{short:"code"},{short:"start-date",valueFunc:_=>this.dateFormat(_.startDate)},{short:"end-date",valueFunc:_=>this.dateFormat(_.endDate)},{bold:"store",valueFunc:()=>this.translateService.instant("promotion-add.apply-for")},{field:"for-all-customer",valueFunc:_=>_.forAllCustomer?this.translateService.instant("point-add.for-all-customer"):""},{short:"contact.full-name"},{short:"product.title"},{short:"category.title"},{short:"store.name"},{bold:"store",valueFunc:_=>_.conditionTotalAmount||_.conditionTotalQuantity?this.translateService.instant("promotion-add.conditions"):""},{short:"condition-total-amount",valueFunc:_=>this.currencyPipe.transform(_.conditionTotalAmount,this.currency,"symbol","1.0-2",this.translateService.currentLang)},{short:"condition-total-quantity"},{bold:"store",valueFunc:_=>this.translateService.instant("promotion-add.payment")},{short:"promotion-value",valueFunc:_=>_.isPercent?_.promotionValue+"%":this.currencyPipe.transform(_.promotionValue,this.currency,"symbol","1.0-2",this.translateService.currentLang)},{short:"promotion-max-value",valueFunc:_=>this.currencyPipe.transform(_.promotionMaxValue,this.currency,"symbol","1.0-2",this.translateService.currentLang)},{bold:"store",valueFunc:_=>(_.promotionProduct||_.promotionCategory)&&_.maxPromotionQuantity?this.translateService.instant("promotion-add.promotion-products"):""},{short:"promotion-product.title"},{short:"promotion-category.title"},{short:"max-promotion-quantity"}],toggleAction:{field:"is-active",func:this.changeActive},thumbnail:"product.avatarUrl"},this.searchFields=["product.title","category.title","contact.fullName","name","code","store.name"],this.getAvaliablePromotionConfigs=(0,m.Z)(function*(){let _=[];if(u.searchMode){const f=yield u.promotionService.getAvailableConfigs();if(f&&f.length&&u.orderItems&&u.orderItems.length)for(const A of f)A.conditionTotalAmount&&A.conditionTotalAmount>u.totalProductsAmount||A.conditionTotalQuantity&&A.conditionTotalQuantity>u.totalProductsQuantity||A.category&&u.orderItems.findIndex(x=>x.categories&&x.categories.length&&x.categories.findIndex(E=>E.categoryId===A.category.id)>=0)<0||A.product&&u.orderItems.findIndex(x=>x.productId==A.product.id)<0||_.push(A)}else _=yield u.promotionService.getConfigs();return _}),this.reload=(0,m.Z)(function*(){const _=yield u.navCtrl.loading();u.searchMode||(u.promotionHistories=yield u.promotionService.getHistories(u.dateFrom,u.dateTo),u.originalPromotionHistories=JSON.parse(JSON.stringify(u.promotionHistories))),u.total=G.sumBy(u.promotionHistories,f=>f.amount),yield _.dismiss()}),this.navCtrl.unsubscribe("reloadPromotionList",this.reload),this.navCtrl.subscribe("reloadPromotionList",this.reload),this.selectedStaff=this.staffService.selectedStaff}presentActionSheet(t){var e=this;return(0,m.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("promotion.delete"),role:"destructive",handler:()=>{e.delete(t)}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}delete(t){var e=this;return(0,m.Z)(function*(){var r;yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("promotion.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:(r=(0,m.Z)(function*(){e.dataService.delete("promotion_history",t).then((0,m.Z)(function*(){e.analyticsService.logEvent("promotion-delete-success");let Z=e.promotionHistories.findIndex(M=>M.id===t.id);Z>=0&&e.promotionHistories.splice(Z,1),Z=e.originalPromotionHistories.findIndex(M=>M.id===t.id),Z>=0&&e.originalPromotionHistories.splice(Z,1)}))}),function(){return r.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}searchConfigs(){var t=this;return(0,m.Z)(function*(){yield t.listConfigs.callSearch(t.searchKeyConfigs)})()}ngOnInit(){var t=this;return(0,m.Z)(function*(){t.currentPlan=yield t.planService.getCurrentPlan(),t.currency=yield t.userService.getAttr("current-currency"),t.segment="config",t.params=t.navCtrl.getParams(t.params),t.params&&t.params.callback&&(t.callback=t.params.callback),t.params&&t.params.searchMode&&(t.searchMode=t.params.searchMode),t.params&&t.params.orderItems&&(t.orderItems=t.params.orderItems),t.params&&t.params.totalProductsAmount&&(t.totalProductsAmount=t.params.totalProductsAmount),t.params&&t.params.totalProductsQuantity&&(t.totalProductsQuantity=t.params.totalProductsQuantity),t.dateFrom=t.params&&t.params.dateFrom?t.params.dateFrom:t.dateFrom?t.dateFrom:S.C.GetFirstDateOfMonth(),t.dateTo=t.params&&t.params.dateTo?t.params.dateTo:t.dateTo?t.dateTo:S.C.GetEndDateOfMonth(),yield t.reload()})()}onPeriodChanged(t){var e=this;return(0,m.Z)(function*(){if(!t)return;e.analyticsService.logEvent("promotion-period-changed");const i=yield e.navCtrl.loading();e.dateFrom=""!==t.dateFrom?S.C.toDbString(t.dateFrom,S.C.getDbFormat()):"",e.dateTo=""!==t.dateTo?S.C.toDbString(t.dateTo,S.C.getDbFormat()):"",e.params||(e.params={}),e.params.dateFrom=e.dateFrom,e.params.dateTo=e.dateTo,e.promotionHistories=yield e.promotionService.getHistories(e.dateFrom,e.dateTo),e.originalPromotionHistories=JSON.parse(JSON.stringify(e.promotionHistories)),e.total=G.sumBy(e.promotionHistories,r=>r.amount),yield i.dismiss()})()}isNotCordova(){return this.navCtrl.isNotCordova()}addConfig(){this.navCtrl.push("/promotion/add")}viewOrder(t){this.navCtrl.navigateForward("/order/detail",{id:t})}contactImageOrPlaceholder(t){return I.W.contactImageOrPlaceholder(t.avatarUrl)}dateFormat(t){let e=t;return t.indexOf(":00Z")<0&&(e=Wo(t).format(S.C.getDateTimeDbFormat())),S.C.toUiDateLocalString(e)}searchHistories(){var t=this;return(0,m.Z)(function*(){t.analyticsService.logEvent("promotion-search-histories");let e=JSON.parse(JSON.stringify(t.originalPromotionHistories));if(null!==t.searchKeyHistories&&""!==t.searchKeyHistories){const i=t.searchKeyHistories.toLowerCase();e=e.filter(r=>r.contact&&-1!==r.contact.fullName.toLowerCase().indexOf(i)||r.product&&-1!==r.product.title.toLowerCase().indexOf(i)||r.category&&-1!==r.category.title.toLowerCase().indexOf(i))}t.promotionHistories=e,t.total=G.sumBy(t.promotionHistories,i=>i.amount)})()}clearSearchHistories(){this.searchKeyHistories=null,this.reload()}dismiss(){var t=this;return(0,m.Z)(function*(){if(t.callback)return t.callback(null),void(yield t.navCtrl.back());t.viewCtrl.dismiss()})()}}return n.\u0275fac=function(t){return new(t||n)(o.Y36(N.G),o.Y36(W.x),o.Y36(s.IN),o.Y36(P.K),o.Y36(h.q),o.Y36($o.D),o.Y36(s.Br),o.Y36(s.BX),o.Y36(T.sK),o.Y36(Ro.D),o.Y36(l.y),o.Y36(y.H9))},n.\u0275cmp=o.Xpm({type:n,selectors:[["promotion"]],viewQuery:function(t,e){if(1&t&&o.Gf($.s,7),2&t){let i;o.iGM(i=o.CRH())&&(e.listConfigs=i.first)}},decls:41,vars:49,consts:[["slot","start"],[3,"click",4,"ngIf"],["menu","first",4,"ngIf"],["color","primary",3,"click",4,"ngIf"],["slot","end"],["color","primary",3,"ngModel","ngModelChange",4,"ngIf"],[3,"hidden"],["debounce","700",3,"placeholder","ngModel","ionChange","ngModelChange"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[2,"padding-left","10px","padding-right","10px"],["page","promotion",3,"modeLink","onPeriodChanged"],["list-only","","table","promotion",3,"hideSearch","itemTemplate","searchFields","fetchObjectsFunc"],["listConfigs",""],[2,"border-bottom","1px solid #ccc"],[3,"size"],["lines","none",1,"ion-text-wrap","ion-no-padding"],["color","primary"],["color","dark"],[3,"press",4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],[3,"click"],["name","close"],["menu","first"],["color","primary",3,"click"],["name","home"],["name","refresh"],["name","add"],["color","primary",3,"ngModel","ngModelChange"],["value","config",4,"ngIf"],["value","histories"],[1,"ion-text-wrap"],["value","config"],[3,"press"],[4,"ngIf"],["slot","end",4,"ngIf"],["color","secondary",3,"click"],[3,"src"],[3,"innerHTML"]],template:function(t,e){1&t&&(o.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),o.YNc(3,zo,2,0,"ion-button",1),o.YNc(4,ot,1,0,"ion-menu-button",2),o.YNc(5,tt,2,0,"ion-button",3),o.qZA(),o.TgZ(6,"ion-title"),o._uU(7),o.ALo(8,"translate"),o.qZA(),o.TgZ(9,"ion-buttons",4),o.YNc(10,nt,2,0,"ion-button",1),o.YNc(11,et,2,0,"ion-button",1),o.qZA()(),o.YNc(12,rt,6,5,"ion-segment",5),o.TgZ(13,"div",6)(14,"ion-searchbar",7),o.NdJ("ionChange",function(){return e.searchConfigs()})("ngModelChange",function(r){return e.searchKeyConfigs=r}),o.ALo(15,"translate"),o.qZA()(),o.TgZ(16,"div",6)(17,"ion-searchbar",8),o.NdJ("ionClear",function(){return e.clearSearchHistories()})("ionChange",function(){return e.searchHistories()})("ngModelChange",function(r){return e.searchKeyHistories=r}),o.ALo(18,"translate"),o.qZA(),o.TgZ(19,"div",9)(20,"period-range",10),o.NdJ("onPeriodChanged",function(r){return e.onPeriodChanged(r)}),o.qZA()()()(),o.TgZ(21,"ion-content")(22,"div",6),o._UZ(23,"div",11,12),o.qZA(),o.TgZ(25,"div",6)(26,"ion-list")(27,"ion-grid")(28,"ion-row",13)(29,"ion-col",14)(30,"ion-item",15)(31,"ion-label",16),o._uU(32),o.ALo(33,"translate"),o.ALo(34,"currency"),o.TgZ(35,"p")(36,"ion-text",17),o._uU(37),o.ALo(38,"translate"),o.qZA()()()()()()(),o.YNc(39,dt,7,5,"ion-item",18),o.YNc(40,pt,3,3,"ion-item",19),o.qZA()()()),2&t&&(o.xp6(3),o.Q6J("ngIf",e.searchMode),o.xp6(1),o.Q6J("ngIf",!e.searchMode),o.xp6(1),o.Q6J("ngIf",!e.searchMode),o.xp6(2),o.Oqu(o.lcZ(8,29,"promotion.title")),o.xp6(3),o.Q6J("ngIf","histories"===e.segment),o.xp6(1),o.Q6J("ngIf","config"===e.segment&&(!e.selectedStaff||e.selectedStaff.hasFullAccess)),o.xp6(1),o.Q6J("ngIf",!e.searchMode),o.xp6(1),o.Q6J("hidden","config"!==e.segment),o.xp6(1),o.s9C("placeholder",o.lcZ(15,31,"promotion.search-configs")),o.Q6J("ngModel",e.searchKeyConfigs),o.xp6(2),o.Q6J("hidden","histories"!==e.segment),o.xp6(1),o.s9C("placeholder",o.lcZ(18,33,"promotion.search-histories")),o.Q6J("ngModel",e.searchKeyHistories),o.xp6(3),o.Q6J("modeLink",!0),o.xp6(1),o.Akn(e.navCtrl.hasAds()?"--padding-bottom: 60px":""),o.xp6(1),o.Q6J("hidden","config"!==e.segment),o.xp6(1),o.Q6J("hideSearch",!0)("itemTemplate",e.itemTemplate)("searchFields",e.searchFields)("fetchObjectsFunc",e.getAvaliablePromotionConfigs),o.xp6(2),o.Q6J("hidden","histories"!==e.segment),o.xp6(4),o.Q6J("size",e.promotionHistories&&e.promotionHistories.length?8:12),o.xp6(3),o.AsE(" ",o.lcZ(33,35,"common.total"),": ",o.G7q(34,37,o.kEZ(45,_t,e.total,e.currency,e.translateService.currentLang))," "),o.xp6(5),o.AsE(" ",e.promotionHistories&&e.promotionHistories.length?e.promotionHistories.length:0," ",o.lcZ(38,43,"promotion.history(s)")," "),o.xp6(2),o.Q6J("ngForOf",e.promotionHistories),o.xp6(1),o.Q6J("ngIf",!e.promotionHistories||0===e.promotionHistories.length))},dependencies:[y.sg,y.O5,c.JJ,c.On,s.BJ,s.YG,s.Sm,s.wI,s.W2,s.jY,s.Gu,s.gu,s.Ie,s.Q$,s.q_,s.fG,s.Nd,s.VI,s.cJ,s.GO,s.yW,s.wd,s.sr,s.QI,s.j9,Xo.M,$.s,y.H9,T.X$],encapsulation:2}),n})()},{path:"add",component:Po},{path:"detail",component:Bo}];let gt=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[F.Bz.forChild(ut),F.Bz]}),n})(),ft=(()=>{class n{}return n.\u0275fac=function(t){return new(t||n)},n.\u0275mod=o.oAB({type:n}),n.\u0275inj=o.cJS({imports:[y.ez,c.u5,s.Pc,gt,Q.uH,U.m,T.aw.forChild({loader:{provide:T.Zw,useFactory:U.x,deps:[L.eN]}})]}),n})()},7613:(R,q,d)=>{d.d(q,{F:()=>N});var y=d(5861),c=d(6738),s=d(6895),Q=d(4006),L=d(191);const T=["template"],U=["input1"],F=["input2"];function m(h,P){if(1&h){const l=c.EpF();c.TgZ(0,"ion-input",4,5),c.NdJ("ngModelChange",function(p){c.CHM(l);const v=c.oxw(2);return c.KtG(v.moneyValueString=p)})("ionBlur",function(){c.CHM(l);const p=c.oxw(2);return c.KtG(p.ionBlur())})("ionFocus",function(){c.CHM(l);const p=c.oxw(2);return c.KtG(p.ionFocus())})("keyup.enter",function(){c.CHM(l);const p=c.oxw(2);return c.KtG(p.onEnter())}),c.qZA()}if(2&h){const l=c.oxw(2);c.Q6J("placeholder",l.placeholder)("disabled",l.disabled)("ngModel",l.moneyValueString)}}function I(h,P){if(1&h){const l=c.EpF();c.TgZ(0,"ion-input",6,7),c.NdJ("ngModelChange",function(p){c.CHM(l);const v=c.oxw(2);return c.KtG(v.moneyValueString=p)})("ionBlur",function(){c.CHM(l);const p=c.oxw(2);return c.KtG(p.ionBlur())})("ionFocus",function(){c.CHM(l);const p=c.oxw(2);return c.KtG(p.ionFocus())})("keyup.enter",function(){c.CHM(l);const p=c.oxw(2);return c.KtG(p.onEnter())}),c.qZA()}if(2&h){const l=c.oxw(2);c.Q6J("disabled",l.disabled)("placeholder",l.placeholder)("ngModel",l.moneyValueString)}}function o(h,P){if(1&h){const l=c.EpF();c.YNc(0,m,2,3,"ion-input",1),c.YNc(1,I,2,3,"ion-input",2),c.TgZ(2,"ion-input",3),c.NdJ("ngModelChange",function(p){c.CHM(l);const v=c.oxw();return c.KtG(v.moneyValue=p)})("ngModelChange",function(p){c.CHM(l);const v=c.oxw();return c.KtG(v.change(p))})("ionChange",function(){c.CHM(l);const p=c.oxw();return c.KtG(p.change(p.moneyValue))}),c.qZA()}if(2&h){const l=c.oxw();c.Q6J("ngIf",l.clear),c.xp6(1),c.Q6J("ngIf",!l.clear),c.xp6(1),c.Q6J("hidden",!0)("ngModel",l.moneyValue)}}let N=(()=>{class h{constructor(l){this.viewContainerRef=l,this.moneyValueChange=new c.vpe,this.clear=!1,this.decimal=".",this.thousands=",",this.decimalCount=2,this.changing=!1}ngOnInit(){var l=this;return(0,y.Z)(function*(){l.thousands=l.thousandsSeparator(),l.decimal="."===l.thousands?",":".",setTimeout(()=>{l.moneyValueString=l.moneyValue?l.formatMoney(l.moneyValue):l.moneyValue},1e3),l.viewContainerRef.createEmbeddedView(l.template)})()}getMoneyValueStringToNumber(l){if(l){let g=l.split(this.decimal).join("");return g=g.split(this.thousands).join(this.thousandsSeparator()),+g}return l}change(l){this.moneyValue=l,l?(this.moneyValueString=this.formatMoney(l),this.oldValue=this.moneyValueString):(this.moneyValueString=l,this.oldValue=l)}ionFocus(){return(0,y.Z)(function*(){})()}ionBlur(){if(this.moneyValueString){let l=this.moneyValueString.split(this.decimal).join("");l=l.split(this.thousands).join(this.thousandsSeparator()),this.moneyValue=+l,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(+l),this.oldValue=this.moneyValueString)}else this.moneyValue=this.moneyValueString,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(this.moneyValueString),this.oldValue=this.moneyValueString);this.moneyValueString=this.formatMoney(this.moneyValue),setTimeout(()=>{this.changing=!1},300)}formatMoney(l){if(!l)return l;const g=this.decimalCount,v=this.decimal,H=this.thousands;try{const w="\\d(?=(\\d{3})+"+(g>0?"\\D":"$")+")",Y=l.toFixed(Math.max(0,~~g));let b=(H?Y.replace(".",H):Y).replace(new RegExp(w,"g"),"$&"+(v||","));return b&&(b.indexOf(this.thousands+"00")&&(b=b.split(this.thousands+"00").join("")),b)}catch(w){console.error(w)}}thousandsSeparator(){return parseFloat(.55.toString()).toLocaleString().indexOf(",55")>=0?",":"."}select(l){this.moneyValueString=l,this.ionBlur()}onEnter(){var l=this;return(0,y.Z)(function*(){const g=l.input1?l.input1:l.input2;if(!g)return;const p=yield g.getInputElement();!p||p.blur()})()}}return h.\u0275fac=function(l){return new(l||h)(c.Y36(c.s_b))},h.\u0275cmp=c.Xpm({type:h,selectors:[["money-input"]],viewQuery:function(l,g){if(1&l&&(c.Gf(T,7),c.Gf(U,5),c.Gf(F,5)),2&l){let p;c.iGM(p=c.CRH())&&(g.template=p.first),c.iGM(p=c.CRH())&&(g.input1=p.first),c.iGM(p=c.CRH())&&(g.input2=p.first)}},inputs:{moneyValue:"moneyValue",placeholder:"placeholder",disabled:"disabled",clear:"clear"},outputs:{moneyValueChange:"moneyValueChange"},decls:2,vars:0,consts:[["template",""],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],["inputmode","numeric","style","background-color: #efefef; border-radius: 5px; color: #000; margin-bottom: 5px;","type","text",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],[3,"hidden","ngModel","ngModelChange","ionChange"],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input1",""],["inputmode","numeric","type","text",2,"background-color","#efefef","border-radius","5px","color","#000","margin-bottom","5px",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input2",""]],template:function(l,g){1&l&&c.YNc(0,o,3,4,"ng-template",null,0,c.W1O)},dependencies:[s.O5,Q.JJ,Q.On,L.pK,L.j9],encapsulation:2}),h})()}}]);