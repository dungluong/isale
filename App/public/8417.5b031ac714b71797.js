"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[8417],{6900:(U,T,c)=>{c.d(T,{O:()=>x});class x{constructor(f=0,y="",Z="",F=""){this.hourLimit=1,this.storeId=0,this.store=null,this.isCollaborator=!1,this.shiftId=0,this.shift=null,this.blockViewingQuantity=!1,this.id=0,this.avatarUrl="",this.name="",this.userName="",this.shopName="",this.createdAt="",this.hasFullAccess=!1,this.canCreateOrder=!1,this.canUpdateDeleteOrder=!1,this.canCreateNewTransaction=!1,this.canUpdateDeleteTransaction=!1,this.canCreateUpdateNote=!1,this.canCreateUpdateDebt=!1,this.canUpdateDeleteProduct=!1,this.canViewProductCostPrice=!1,this.canUpdateProductCostPrice=!1,this.canViewAllContacts=!1,this.canManageContacts=!1,this.updateStatusExceptDone=!1,this.blockEditingOrderPrice=!1,this.id=f,this.avatarUrl=y,this.name=Z,this.userName=F}}},7613:(U,T,c)=>{c.d(T,{F:()=>g});var x=c(5861),i=c(6738),f=c(6895),y=c(4006),Z=c(191);const F=["template"],b=["input1"],A=["input2"];function t(_,h){if(1&_){const a=i.EpF();i.TgZ(0,"ion-input",4,5),i.NdJ("ngModelChange",function(l){i.CHM(a);const C=i.oxw(2);return i.KtG(C.moneyValueString=l)})("ionBlur",function(){i.CHM(a);const l=i.oxw(2);return i.KtG(l.ionBlur())})("ionFocus",function(){i.CHM(a);const l=i.oxw(2);return i.KtG(l.ionFocus())})("keyup.enter",function(){i.CHM(a);const l=i.oxw(2);return i.KtG(l.onEnter())}),i.qZA()}if(2&_){const a=i.oxw(2);i.Q6J("placeholder",a.placeholder)("disabled",a.disabled)("ngModel",a.moneyValueString)}}function P(_,h){if(1&_){const a=i.EpF();i.TgZ(0,"ion-input",6,7),i.NdJ("ngModelChange",function(l){i.CHM(a);const C=i.oxw(2);return i.KtG(C.moneyValueString=l)})("ionBlur",function(){i.CHM(a);const l=i.oxw(2);return i.KtG(l.ionBlur())})("ionFocus",function(){i.CHM(a);const l=i.oxw(2);return i.KtG(l.ionFocus())})("keyup.enter",function(){i.CHM(a);const l=i.oxw(2);return i.KtG(l.onEnter())}),i.qZA()}if(2&_){const a=i.oxw(2);i.Q6J("disabled",a.disabled)("placeholder",a.placeholder)("ngModel",a.moneyValueString)}}function I(_,h){if(1&_){const a=i.EpF();i.YNc(0,t,2,3,"ion-input",1),i.YNc(1,P,2,3,"ion-input",2),i.TgZ(2,"ion-input",3),i.NdJ("ngModelChange",function(l){i.CHM(a);const C=i.oxw();return i.KtG(C.moneyValue=l)})("ngModelChange",function(l){i.CHM(a);const C=i.oxw();return i.KtG(C.change(l))})("ionChange",function(){i.CHM(a);const l=i.oxw();return i.KtG(l.change(l.moneyValue))}),i.qZA()}if(2&_){const a=i.oxw();i.Q6J("ngIf",a.clear),i.xp6(1),i.Q6J("ngIf",!a.clear),i.xp6(1),i.Q6J("hidden",!0)("ngModel",a.moneyValue)}}let g=(()=>{class _{constructor(a){this.viewContainerRef=a,this.moneyValueChange=new i.vpe,this.clear=!1,this.decimal=".",this.thousands=",",this.decimalCount=2,this.changing=!1}ngOnInit(){var a=this;return(0,x.Z)(function*(){a.thousands=a.thousandsSeparator(),a.decimal="."===a.thousands?",":".",setTimeout(()=>{a.moneyValueString=a.moneyValue?a.formatMoney(a.moneyValue):a.moneyValue},1e3),a.viewContainerRef.createEmbeddedView(a.template)})()}getMoneyValueStringToNumber(a){if(a){let d=a.split(this.decimal).join("");return d=d.split(this.thousands).join(this.thousandsSeparator()),+d}return a}change(a){this.moneyValue=a,a?(this.moneyValueString=this.formatMoney(a),this.oldValue=this.moneyValueString):(this.moneyValueString=a,this.oldValue=a)}ionFocus(){return(0,x.Z)(function*(){})()}ionBlur(){if(this.moneyValueString){let a=this.moneyValueString.split(this.decimal).join("");a=a.split(this.thousands).join(this.thousandsSeparator()),this.moneyValue=+a,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(+a),this.oldValue=this.moneyValueString)}else this.moneyValue=this.moneyValueString,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(this.moneyValueString),this.oldValue=this.moneyValueString);this.moneyValueString=this.formatMoney(this.moneyValue),setTimeout(()=>{this.changing=!1},300)}formatMoney(a){if(!a)return a;const d=this.decimalCount,C=this.decimal,D=this.thousands;try{const M="\\d(?=(\\d{3})+"+(d>0?"\\D":"$")+")",O=a.toFixed(Math.max(0,~~d));let v=(D?O.replace(".",D):O).replace(new RegExp(M,"g"),"$&"+(C||","));return v&&(v.indexOf(this.thousands+"00")&&(v=v.split(this.thousands+"00").join("")),v)}catch(M){console.error(M)}}thousandsSeparator(){return parseFloat(.55.toString()).toLocaleString().indexOf(",55")>=0?",":"."}select(a){this.moneyValueString=a,this.ionBlur()}onEnter(){var a=this;return(0,x.Z)(function*(){const d=a.input1?a.input1:a.input2;if(!d)return;const l=yield d.getInputElement();!l||l.blur()})()}}return _.\u0275fac=function(a){return new(a||_)(i.Y36(i.s_b))},_.\u0275cmp=i.Xpm({type:_,selectors:[["money-input"]],viewQuery:function(a,d){if(1&a&&(i.Gf(F,7),i.Gf(b,5),i.Gf(A,5)),2&a){let l;i.iGM(l=i.CRH())&&(d.template=l.first),i.iGM(l=i.CRH())&&(d.input1=l.first),i.iGM(l=i.CRH())&&(d.input2=l.first)}},inputs:{moneyValue:"moneyValue",placeholder:"placeholder",disabled:"disabled",clear:"clear"},outputs:{moneyValueChange:"moneyValueChange"},decls:2,vars:0,consts:[["template",""],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],["inputmode","numeric","style","background-color: #efefef; border-radius: 5px; color: #000; margin-bottom: 5px;","type","text",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],[3,"hidden","ngModel","ngModelChange","ionChange"],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input1",""],["inputmode","numeric","type","text",2,"background-color","#efefef","border-radius","5px","color","#000","margin-bottom","5px",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input2",""]],template:function(a,d){1&a&&i.YNc(0,I,3,4,"ng-template",null,0,i.W1O)},dependencies:[f.O5,y.JJ,y.On,Z.pK,Z.j9],encapsulation:2}),_})()},1704:(U,T,c)=>{c.r(T),c.d(T,{StaffModule:()=>_t});var x=c(6895),i=c(4006),f=c(191),y=c(3306),Z=c(529),F=c(3093),b=c(2216),A=c(3196),t=c(6738),P=c(2402);let I=(()=>{class n{constructor(){this.itemTemplate={h2:{field:"name"},pList:[{field:"userName"},{short:"store.name"},{short:"shift.name"}]},this.actions=[{hidden:()=>!1,path:"/shift",icon:"time",color:"tertiary",title:"shift.title"}],this.searchFields=["name","userName"],this.filterObjects={store:{field:"name"},shift:{field:"name"}}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["staff"]],decls:1,vars:5,consts:[["table","staff","iconAdd","person-add",3,"callable","itemTemplate","searchFields","filterObjects","actions"]],template:function(e,o){1&e&&t._UZ(0,"list",0),2&e&&t.Q6J("callable",!0)("itemTemplate",o.itemTemplate)("searchFields",o.searchFields)("filterObjects",o.filterObjects)("actions",o.actions)},dependencies:[P.n],encapsulation:2}),n})();var g=c(5861),_=c(6841),h=c(7489),a=c(6900),d=c(1914),l=c(6723),C=c(5851),D=c(667),M=c(2126),O=c(4433),v=c(5583),E=c(7488),V=c(7060),B=c(7696),K=c(323),L=c(3604),Q=c(280),G=c(3090),Y=c(8262);function H(n,u){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"staff-add.store"),": ",e.staff.store.name,"")}}function k(n,u){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"staff-add.shift"),": ",e.staff.shift.name,"")}}function j(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-label",2)(1,"ion-button",19),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.edit())}),t._uU(2),t.ALo(3,"translate"),t._UZ(4,"ion-icon",20),t.qZA()()}2&n&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"staff-add.add-shift"),"\xa0 "))}function q(n,u){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateTo)," ")}}function R(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"trade-item",26),t.NdJ("onClick",function(){const m=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectTrade(m.id))}),t.qZA()}if(2&n){const e=u.$implicit,o=t.oxw(2);t.Q6J("trade",e)("currency",o.currency)}}const w=function(n,u,e){return[n,u,"symbol","1.0-2",e]};function $(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",21),t.YNc(3,q,5,8,"span",7),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",22),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",23),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.selectDateRangeForTrade())}),t._UZ(10,"ion-icon",24),t.qZA()(),t.YNc(11,R,1,2,"trade-item",25),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",""!=e.dateFrom||""!=e.dateTo),t.xp6(1),t.hij(" ",t.lcZ(5,6,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.total>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.total>=0?"+":""," ",t.G7q(8,8,t.kEZ(14,w,e.total,e.currency,e.translateService.currentLang)),"."),t.xp6(4),t.Q6J("ngForOf",e.trades)}}function W(n,u){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateOrderFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateOrderTo)," ")}}function X(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"order-list-item",28),t.NdJ("onClick",function(){const m=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectOrder(m.id))}),t.qZA()}if(2&n){const e=u.$implicit,o=t.oxw(2);t.Q6J("showContact",!1)("order",e)("currency",o.currency)}}function z(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",21),t.YNc(3,W,5,8,"span",7),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",22),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",23),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.selectDateRangeForOrder())}),t._UZ(10,"ion-icon",24),t.qZA()(),t.YNc(11,X,1,3,"order-list-item",27),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",""!=e.dateOrderFrom||""!=e.dateOrderTo),t.xp6(1),t.hij(" ",t.lcZ(5,6,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.orderTotal>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.orderTotal>=0?"+":""," ",t.G7q(8,8,t.kEZ(14,w,e.orderTotal,e.currency,e.translateService.currentLang)),"."),t.xp6(4),t.Q6J("ngForOf",e.orders)}}function tt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-toggle",32),t.NdJ("ngModelChange",function(r){t.CHM(e);const m=t.oxw(2).$implicit,s=t.oxw(2);return t.KtG(s.staff[s.staffPermissionProps[m]]=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw(4);return t.KtG(r.autoSave())}),t.qZA()}if(2&n){const e=t.oxw(2).$implicit,o=t.oxw(2);t.Q6J("ngModel",o.staff[o.staffPermissionProps[e]])}}function et(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-input",33),t.NdJ("ngModelChange",function(r){t.CHM(e);const m=t.oxw(2).$implicit,s=t.oxw(2);return t.KtG(s.staff[s.staffPermissionProps[m]]=r)})("ionBlur",function(){t.CHM(e);const r=t.oxw(4);return t.KtG(r.autoSave())}),t.qZA()}if(2&n){const e=t.oxw(2).$implicit,o=t.oxw(2);t.Q6J("ngModel",o.staff[o.staffPermissionProps[e]])}}function nt(n,u){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-label",21),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,tt,1,1,"ion-toggle",30),t.YNc(5,et,1,1,"ion-input",31),t.qZA()),2&n){const e=t.oxw().$implicit,o=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,3,"staff-add."+e)),t.xp6(2),t.Q6J("ngIf","boolean"===o.typeOfPermissions[e]),t.xp6(1),t.Q6J("ngIf","number"===o.typeOfPermissions[e])}}function ot(n,u){if(1&n&&(t.ynx(0),t.YNc(1,nt,6,5,"ion-item",7),t.BQk()),2&n){const e=u.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngIf",!o.allStaffPermissions[e][1]||o.staff[o.staffPermissionProps[o.allStaffPermissions[e][1]]])}}function it(n,u){if(1&n&&(t.TgZ(0,"ion-list"),t.YNc(1,ot,2,1,"ng-container",29),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.permissionKeys)}}function at(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"customer-price-item",38),t.NdJ("onClick",function(){const m=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectCustomerPrice(m.id))}),t.qZA()}if(2&n){const e=u.$implicit,o=t.oxw(2);t.Q6J("showContact",!0)("showProduct",!0)("customerPrice",e)("currency",o.currency)}}function st(n,u){1&n&&(t.TgZ(0,"div",39),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-prices")))}function rt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",21),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"ion-text",34),t._uU(6),t.qZA()(),t.TgZ(7,"ion-button",23),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.addPrice())}),t._UZ(8,"ion-icon",35),t.qZA()(),t.YNc(9,at,1,4,"customer-price-item",36),t.YNc(10,st,3,3,"div",37),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,4,"common.total"),":\xa0 "),t.xp6(3),t.hij("",e.customerPrices&&e.customerPrices.length?e.customerPrices.length:0," "),t.xp6(3),t.Q6J("ngForOf",e.customerPrices),t.xp6(1),t.Q6J("ngIf",!e.customerPrices||!e.customerPrices.length)}}function lt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"customer-discount-item",41),t.NdJ("onClick",function(){const m=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectCustomerDiscount(m.id))}),t.qZA()}if(2&n){const e=u.$implicit,o=t.oxw(2);t.Q6J("showContact",!1)("showStaff",!1)("showProduct",!0)("customerDiscount",e)("currency",o.currency)}}function ct(n,u){1&n&&(t.TgZ(0,"div",39),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-discounts")))}function dt(n,u){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",21),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"ion-text",34),t._uU(6),t.qZA()(),t.TgZ(7,"ion-button",23),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.addDiscount())}),t._UZ(8,"ion-icon",35),t.qZA()(),t.YNc(9,lt,1,5,"customer-discount-item",40),t.YNc(10,ct,3,3,"div",37),t.qZA()}if(2&n){const e=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,4,"common.total"),":\xa0 "),t.xp6(3),t.Oqu(e.customerDiscounts&&e.customerDiscounts.length?e.customerDiscounts.length:0),t.xp6(3),t.Q6J("ngForOf",e.customerDiscounts),t.xp6(1),t.Q6J("ngIf",!e.customerDiscounts||!e.customerDiscounts.length)}}let ut=(()=>{class n{constructor(e,o,r,m,s,p,S,ht,gt,Ct,xt,yt,St,vt){this.navCtrl=e,this.translateService=o,this.modalCtrl=r,this.staffService=m,this.tradeService=s,this.file=p,this.orderService=S,this.actionSheetCtrl=ht,this.userService=gt,this.excelService=Ct,this.alertCtrl=xt,this.contactService=yt,this.toastCtrl=St,this.analyticsService=vt,this.params=null,this.staff=new a.O,this.notes=[],this.trades=[],this.orders=[],this.customerPrices=[],this.customerDiscounts=[],this.tab="order",this.dateFrom="",this.dateTo="",this.total=0,this.debts=[],this.dateDebtFrom="",this.dateDebtTo="",this.totalDebt=0,this.orderTotal=0,this.dateOrderFrom="",this.dateOrderTo="",this.allStaffPermissions={},this.permissionKeys=[],this.staffPermissionProps={},this.typeOfPermissions={},this.permissionKeys=this.staffService.getPermissionsKey(),this.staffPermissionProps=this.staffService.getAllStaffPermissionProps(),this.typeOfPermissions=this.staffService.getAllTypesOfStaffPermissions(),this.allStaffPermissions=this.staffService.getAllStaffPermissions();const N=Tt=>{const J=Tt.detail;J&&this.staff&&J.id===this.staff.id&&this.reload()};this.navCtrl.unsubscribe("reloadStaff",N),this.navCtrl.subscribe("reloadStaff",N)}ionViewWillEnter(){var e=this;return(0,g.Z)(function*(){yield e.analyticsService.setCurrentScreen("staff-detail")})()}selectOrder(e){this.navCtrl.push("/order/detail",{id:e})}reload(){var e=this;return(0,g.Z)(function*(){const o=yield e.navCtrl.loading();if(e.currency=yield e.userService.getAttr("current-currency"),e.params=e.navCtrl.getParams(e.params),e.params&&e.params.id&&e.params.id>0){const r=e.params.id;e.params.tab&&""!=e.params.tab&&(e.tab=e.params.tab),e.staffService.get(r).then(function(){var m=(0,g.Z)(function*(s){yield o.dismiss(),e.staff=s,e.dateFrom=e.params.dateFrom?e.params.dateFrom:e.dateFrom?e.dateFrom:d.C.GetFirstDateOfMonth(),e.dateTo=e.params.dateTo?e.params.dateTo:e.dateTo?e.dateTo:d.C.GetEndDateOfMonth(),e.tradeService.getTradesByStaff(s.id,e.dateFrom,e.dateTo).then(p=>{p&&p.length>0&&(p=h.orderBy(p,["modifiedAt"],["desc"])),e.trades=p,e.total=h.sumBy(e.trades,S=>S.value*(S.isReceived?1:-1))}),e.dateOrderFrom="",e.dateOrderTo="",e.dateOrderFrom=e.params.dateOrderFrom?e.params.dateOrderFrom:d.C.GetFirstDateOfMonth(),e.dateOrderTo=e.params.dateOrderTo?e.params.dateOrderTo:d.C.GetEndDateOfMonth(),e.orderService.getOrdersByStaff(s.id,e.dateOrderFrom,e.dateOrderTo).then(p=>{p&&p.length>0&&(p=h.orderBy(p,["modifiedAt"],["desc"])),e.orders=p,e.orderTotal=h.sumBy(e.orders,S=>S.total)}),e.contactService.getCustomerPricesByStaff(s.id).then(p=>{p&&p.length>0&&(p=h.orderBy(p,["product.title"],["asc"])),e.customerPrices=p}),e.contactService.getCustomerDiscountsByStaff(s.id).then(p=>{p&&p.length>0&&(p=h.orderBy(p,["createdAt"],["desc"])),e.customerDiscounts=p})});return function(s){return m.apply(this,arguments)}}())}else yield o.dismiss()})()}ngOnInit(){this.reload()}edit(){this.navCtrl.push("/staff/add",{id:this.staff.id})}staffImageOrPlaceholder(){return null!==this.staff.avatarUrl&&""!==this.staff.avatarUrl?this.staff.avatarUrl:"assets/person-placeholder.jpg"}actionIcon(e){return l.W.actionIcon(e)}dateTimeFormat(e){return d.C.toUiString(e)}dateFormat(e){return d.C.toUiDateString(e)}openEmail(){l.W.sendEmail(this.staff.userName)}isNotCordova(){return this.navCtrl.isNotCordova()}call(){l.W.callPhone(this.staff.userName)}text(){l.W.sendSms(this.staff.userName)}selectTrade(e){this.navCtrl.push("/trade/detail",{id:e})}limitText(e,o=200){return l.W.limitText(e,o)}delete(){var e=this;return(0,g.Z)(function*(){yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("staff-detail.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{e.staffService.deleteStaff(e.staff).then((0,g.Z)(function*(){e.analyticsService.logEvent("staff-detail-delete-success"),e.navCtrl.pop(),e.navCtrl.publish("reloadStaffList")}))}},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}presentActionSheet(){var e=this;return(0,g.Z)(function*(){const o=[{text:e.translateService.instant("export.export-trade"),handler:()=>{e.exportTradeToExcel()}},{text:e.translateService.instant("staff-detail.delete"),role:"destructive",handler:()=>{e.delete()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}];yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:o})).present()})()}exportTradeToExcel(){var e=this;const o=[];if(o.push([this.translateService.instant("export.customer-transaction-report")]),o.push([this.translateService.instant("export.staff")+": "+this.staff.name]),this.dateFrom&&this.dateTo){const s=this.translateService.instant("common.from"),p=this.translateService.instant("common.to"),S=s+" "+this.dateFormat(this.dateFrom)+" "+p+" "+this.dateFormat(this.dateTo);o.push([S])}o.push([this.translateService.instant("common.total")+": "+this.total+" "+this.currency]),o.push([this.translateService.instant("export.staff"),this.translateService.instant("export.contact"),this.translateService.instant("export.product"),this.translateService.instant("export.product-count"),this.translateService.instant("export.money"),this.translateService.instant("export.unit"),this.translateService.instant("export.date")]);for(const s of this.trades)o.push([0!=s.staffId&&s.staff?s.staff.name:"",0!=s.contactId&&s.contact?s.contact.fullName:"",0!=s.productId&&s.product?l.W.productName(s.product.code,s.product.title):"",0!=s.productId&&s.product&&s.isPurchase?s.productCount?s.productCount:0:" ",s.isReceived?s.value:-1*s.value,this.currency,this.dateFormat(s.createdAt)]);const r=this.excelService.createSheetData(o),m="staff-transations-"+this.staff.id+"-"+l.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(r,m).then(function(){var s=(0,g.Z)(function*(p){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+m,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,p))});return function(p){return s.apply(this,arguments)}}())}selectDateRangeForTrade(){var e=this;return(0,g.Z)(function*(){const o=yield e.modalCtrl.create({component:_.S,componentProps:{dateFromInput:e.dateFrom,dateToInput:e.dateTo}});yield o.present();const{data:r}=yield o.onDidDismiss();r&&(e.dateFrom=""!=r.dateFrom?d.C.toDbString(r.dateFrom,d.C.getDbFormat()):"",e.dateTo=""!=r.dateTo?d.C.toDbString(r.dateTo,d.C.getDbFormat()):"",e.tradeService.getTradesByStaff(e.staff.id,e.dateFrom,e.dateTo).then(m=>{m&&m.length>0&&(m=h.orderBy(m,["modifiedAt"],["desc"])),e.trades=m,e.total=h.sumBy(e.trades,s=>s.value*(s.isReceived?1:-1))}))})()}selectDateRangeForOrder(){var e=this;return(0,g.Z)(function*(){const o=yield e.modalCtrl.create({component:_.S,componentProps:{dateFromInput:e.dateOrderFrom,dateToInput:e.dateOrderTo}});yield o.present();const{data:r}=yield o.onDidDismiss();r&&(e.dateOrderFrom=""!=r.dateFrom?d.C.toDbString(r.dateFrom,d.C.getDbFormat()):"",e.dateOrderTo=""!=r.dateTo?d.C.toDbString(r.dateTo,d.C.getDbFormat()):"",e.orderService.getOrdersByStaff(e.staff.id,e.dateOrderFrom,e.dateOrderTo).then(m=>{m&&m.length>0&&(m=h.orderBy(m,["modifiedAt"],["desc"])),e.orders=m,e.orderTotal=h.sumBy(e.orders,s=>s.total)}))})()}addPrice(){this.navCtrl.push("/contact/add-price",{collaborator:this.staff.id})}selectCustomerPrice(e){this.navCtrl.push("/contact/add-price",{id:e})}autoSave(){var e=this;return(0,g.Z)(function*(){const o=yield e.navCtrl.loading();e.staffService.saveStaff(e.staff).then((0,g.Z)(function*(){e.analyticsService.logEvent("staff-add-save-success");const r=e.translateService.instant("staff-detail.saved-alert");e.presentToast(r),yield o.dismiss()}))})()}presentToast(e){var o=this;return(0,g.Z)(function*(){yield(yield o.toastCtrl.create({message:e,duration:3e3,position:"bottom"})).present()})()}addDiscount(){this.navCtrl.push("/contact/add-discount",{staff:this.staff.id})}selectCustomerDiscount(e){this.navCtrl.push("/contact/add-discount",{id:e})}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(C.G),t.Y36(y.sK),t.Y36(f.IN),t.Y36(D.x),t.Y36(M.X),t.Y36(O.$),t.Y36(v.p),t.Y36(f.BX),t.Y36(E.K),t.Y36(V.x),t.Y36(f.Br),t.Y36(B.y),t.Y36(f.yF),t.Y36(K.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["staff-detail"]],decls:57,vars:39,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","ellipsis-vertical"],[3,"src"],[4,"ngIf"],["slot","end",4,"ngIf"],["side","end"],["name","text"],["color","secondary",3,"click"],["name","call"],[1,"ion-text-wrap",3,"ngModel","scrollable","ngModelChange"],["value","order",1,"ion-text-wrap"],["value","trade",1,"ion-text-wrap"],["value","permissions",1,"ion-text-wrap"],["value","prices",1,"ion-text-wrap"],["value","discounts",1,"ion-text-wrap"],["color","primary","size","small",3,"click"],["name","time"],[1,"ion-text-wrap"],[3,"color"],["fill","clear","color","primary","slot","end",3,"click"],["name","funnel"],[3,"trade","currency","onClick",4,"ngFor","ngForOf"],[3,"trade","currency","onClick"],[3,"showContact","order","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","order","currency","onClick"],[4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange",4,"ngIf"],["type","number","class","ion-text-right",3,"ngModel","ngModelChange","ionBlur",4,"ngIf"],[3,"ngModel","ngModelChange"],["type","number",1,"ion-text-right",3,"ngModel","ngModelChange","ionBlur"],["color","primary"],["slot","icon-only","name","add"],[3,"showContact","showProduct","customerPrice","currency","onClick",4,"ngFor","ngForOf"],["class","ion-padding",4,"ngIf"],[3,"showContact","showProduct","customerPrice","currency","onClick"],[1,"ion-padding"],[3,"showContact","showStaff","showProduct","customerDiscount","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","showStaff","showProduct","customerDiscount","currency","onClick"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",3),t.NdJ("click",function(){return o.presentActionSheet()}),t._UZ(11,"ion-icon",5),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item-sliding")(15,"ion-item")(16,"ion-avatar",0),t._UZ(17,"img",6),t.qZA(),t.TgZ(18,"ion-label")(19,"h2")(20,"b"),t._uU(21),t.qZA()(),t.TgZ(22,"p"),t._uU(23),t.qZA(),t.YNc(24,H,3,4,"p",7),t.YNc(25,k,3,4,"p",7),t.qZA(),t.YNc(26,j,5,3,"ion-label",8),t.qZA(),t.TgZ(27,"ion-item-options",9)(28,"ion-item-option",3),t.NdJ("click",function(){return o.text()}),t._UZ(29,"ion-icon",10),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"ion-item-option",11),t.NdJ("click",function(){return o.call()}),t._UZ(33,"ion-icon",12),t._uU(34),t.ALo(35,"translate"),t.qZA()()()(),t.TgZ(36,"ion-segment",13),t.NdJ("ngModelChange",function(m){return o.tab=m}),t.TgZ(37,"ion-segment-button",14),t._uU(38),t.ALo(39,"translate"),t.qZA(),t.TgZ(40,"ion-segment-button",15),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-segment-button",16),t._uU(44),t.ALo(45,"translate"),t.qZA(),t.TgZ(46,"ion-segment-button",17),t._uU(47),t.ALo(48,"translate"),t.qZA(),t.TgZ(49,"ion-segment-button",18),t._uU(50),t.ALo(51,"translate"),t.qZA()(),t.YNc(52,$,12,18,"ion-list",7),t.YNc(53,z,12,18,"ion-list",7),t.YNc(54,it,2,1,"ion-list",7),t.YNc(55,rt,11,6,"ion-list",7),t.YNc(56,dt,11,6,"ion-list",7),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,23,"staff-detail.title")),t.xp6(7),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(5),t.Q6J("src",o.staffImageOrPlaceholder(),t.LSH),t.xp6(4),t.Oqu(o.staff.name),t.xp6(2),t.Oqu(o.staff.userName),t.xp6(1),t.Q6J("ngIf",o.staff.store),t.xp6(1),t.Q6J("ngIf",o.staff.shift),t.xp6(1),t.Q6J("ngIf",!o.staff.shiftId),t.xp6(4),t.hij(" ",t.lcZ(31,25,"action.text")," "),t.xp6(4),t.hij(" ",t.lcZ(35,27,"action.call")," "),t.xp6(2),t.Q6J("ngModel",o.tab)("scrollable",!0),t.xp6(2),t.hij(" ",t.lcZ(39,29,"contact-detail.order")," "),t.xp6(3),t.hij(" ",t.lcZ(42,31,"contact-detail.trade")," "),t.xp6(3),t.hij(" ",t.lcZ(45,33,"staff-detail.permissions")," "),t.xp6(3),t.hij(" ",t.lcZ(48,35,"staff-detail.prices")," "),t.xp6(3),t.hij(" ",t.lcZ(51,37,"contact.discounts")," "),t.xp6(2),t.Q6J("ngIf","trade"===o.tab),t.xp6(1),t.Q6J("ngIf","order"===o.tab),t.xp6(1),t.Q6J("ngIf","permissions"===o.tab&&o.allStaffPermissions),t.xp6(1),t.Q6J("ngIf","prices"===o.tab),t.xp6(1),t.Q6J("ngIf","discounts"===o.tab))},dependencies:[x.sg,x.O5,i.JJ,i.On,f.BJ,f.oU,f.YG,f.Sm,f.W2,f.Gu,f.gu,f.pK,f.Ie,f.u8,f.IK,f.td,f.Q$,f.q_,f.cJ,f.GO,f.yW,f.wd,f.ho,f.sr,f.w,f.as,f.QI,f.cs,L._,Q.e,G.X,Y.v,x.H9,y.X$],encapsulation:2}),n})();var ft=c(316);const mt=[{path:"",component:I},{path:"detail",component:ut},{path:"add",component:(()=>{class n{constructor(){this.table="staff",this.fieldsList=["name","userName","storeId","shiftId","isCollaborator","avatarUrl","hasFullAccess","canCreateOrder","hourLimit","canUpdateDeleteOrder","updateStatusExceptDone","canCreateUpdateDebt","canCreateUpdateNote","canViewProductCostPrice","canUpdateProductCostPrice","canCreateNewTransaction","canUpdateDeleteTransaction","canViewAllContacts","canManageContacts","blockViewingQuantity","blockEditingOrderPrice"],this.validateFields=["name","userName"],this.fieldInstructions={storeId:{lookup:"store",lookupField:"name"},shiftId:{lookup:"shift",lookupField:"name"},hourLimit:{type:"number",depend:"canCreateOrder"},avatarUrl:{type:"image"},isCollaborator:{type:"toggle"},hasFullAccess:{type:"toggle"},canCreateOrder:{type:"toggle"},canUpdateDeleteOrder:{type:"toggle"},updateStatusExceptDone:{type:"toggle"},canCreateUpdateDebt:{type:"toggle"},canCreateUpdateNote:{type:"toggle"},canViewProductCostPrice:{type:"toggle"},canUpdateProductCostPrice:{type:"toggle"},canCreateNewTransaction:{type:"toggle"},canUpdateDeleteTransaction:{type:"toggle"},canViewAllContacts:{type:"toggle"},canManageContacts:{type:"toggle"},blockViewingQuantity:{type:"toggle"},blockEditingOrderPrice:{type:"toggle"}}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["staff-add"]],inputs:{table:"table",fieldsList:"fieldsList",validateFields:"validateFields",fieldInstructions:"fieldInstructions"},decls:1,vars:3,consts:[["table","staff",3,"fieldsList","validateFields","fieldInstructions"]],template:function(e,o){1&e&&t._UZ(0,"form-add",0),2&e&&t.Q6J("fieldsList",o.fieldsList)("validateFields",o.validateFields)("fieldInstructions",o.fieldInstructions)},dependencies:[ft.D],encapsulation:2}),n})()}];let pt=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[A.Bz.forChild(mt),A.Bz]}),n})(),_t=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[x.ez,i.u5,f.Pc,pt,F.m,b.uH,y.aw.forChild({loader:{provide:y.Zw,useFactory:F.x,deps:[Z.eN]}})]}),n})()}}]);