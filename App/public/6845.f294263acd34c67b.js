"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[6845],{6845:(To,j,_)=>{_.r(j),_.d(j,{ContactModule:()=>vo});var v=_(6895),I=_(4006),r=_(191),B=_(3196),l=_(5861);const O=(0,_(7423).fo)("Contacts",{web:()=>_.e(627).then(_.bind(_,627)).then(n=>new n.ContactsPluginWeb)});var Z=_(6723),C=_(1914),t=_(6738),D=_(5851),b=_(3306),F=_(7488),E=_(7060),w=_(323),lt=_(2402);let dt=(()=>{class n{constructor(e,o,i,c,s,m,f){var u=this;this.navCtrl=e,this.translateService=o,this.platform=i,this.userService=c,this.excelService=s,this.analyticsService=m,this.alertCtrl=f,this.presentItemActions={"contact.new-note":["/note/add",p=>{this.navCtrl.navigateForward("/note/add",{contact:p.id})}],"contact.new-trade":["/trade/add",p=>{this.navCtrl.navigateForward("/trade/add",{contact:p.id})}]},this.segmentValues=[["all",["icon","people"],["filter",["fullName","asc"]]],["important",["icon","star"],["filter",["isImportant","true"],["fullName","asc"]]],["recent",["icon","time"],["filter",["lastActive","not null and empty"],["limit",50],["lastActive","desc"]]]],this.itemTemplate={h2:{valueFunc:"fullname and code"},pList:[{field:"mobile"},{short:"level.title"},{short:"point",valueFunc:p=>p.point+" "+this.translateService.instant("point-add.point")},{field:"address"},{short:"staff.name",icon:{name:"person-outline",slot:"start"}},{short:"business-type.title"},{short:"sales-line.title"},{field:"last-action",filterValue:"recent",style:"font-size: 0.8em;",icon:{nameFunc:p=>this.actionIcon(p.lastAction)},valueFunc:p=>this.dateFormat(p.lastActive)}]},this.searchFields=["fullName","code","mobile","address","staff.name","businessType.title","salesLine.title"],this.filterObjects={staff:{field:"name"},"business-type":{field:"title"},"sales-line":{field:"title"}},this.import=function(){var p=(0,l.Z)(function*(x){if((u.platform.is("capacitor")||u.platform.is("cordova"))&&(yield O.getPermissions()),(u.platform.is("capacitor")||u.platform.is("cordova"))&&!(yield O.getPermissions()))return;const y=u.platform.is("capacitor")?yield O.getContacts():{contacts:[]};if(!y||!y.contacts||!y.contacts.length)return void alert(u.translateService.instant("contact.no-contacts-to-load"));const q=[];for(const N of y.contacts){let Y=!1;for(const Q of x){if(Q.email&&N.emails&&N.emails.length&&Q.email===N.emails[0].address){Y=!0;break}if(Q.mobile&&N.phoneNumbers&&N.phoneNumbers.length&&Q.mobile===N.phoneNumbers[0].number){Y=!0;break}}Y||q.push(N)}u.navCtrl.push("/contact/mobile-import",{contacts:q})});return function(x){return p.apply(this,arguments)}}(),this.exportContacts=(0,l.Z)(function*(){const p="contacts-export.xlsx",x=yield u.navCtrl.loading();u.excelService.downloadContactsReport(p).then(function(){var k=(0,l.Z)(function*(A){u.analyticsService.logEvent("product-export-to-excel-success"),yield x.dismiss(),u.navCtrl.isNotCordova()||(yield(yield u.alertCtrl.create({header:u.translateService.instant("common.confirm"),message:u.translateService.instant("report.file-save-alert")+A,buttons:[{text:u.translateService.instant("common.agree"),handler:()=>{}}]})).present(),u.userService.shareFileUrl(p,p,A))});return function(A){return k.apply(this,arguments)}}())}),this.actions=[{hidden:()=>!1,path:"/contact/import",icon:"document-attach",color:"danger",title:"contact.import-from-excel"},{hidden:()=>!1,click:this.exportContacts,isFaIcon:!0,icon:"file-excel",color:"#3880ff",title:"contact.export-to-excel"},{hidden:()=>!1,click:this.import,icon:"cloud-upload",color:"success",title:"contact.import-from-device"}]}dateFormat(e){return C.C.toUiString(e)}actionIcon(e){return Z.W.actionIcon(e)}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(b.sK),t.Y36(r.t4),t.Y36(F.K),t.Y36(E.x),t.Y36(w.y),t.Y36(r.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["contact"]],decls:1,vars:8,consts:[["table","contact","iconAdd","person-add","defaultSegmentValue","recent",3,"isQuickAdd","callable","presentItemActions","segmentValues","itemTemplate","searchFields","filterObjects","actions"]],template:function(e,o){1&e&&t._UZ(0,"list",0),2&e&&t.Q6J("isQuickAdd",!0)("callable",!0)("presentItemActions",o.presentItemActions)("segmentValues",o.segmentValues)("itemTemplate",o.itemTemplate)("searchFields",o.searchFields)("filterObjects",o.filterObjects)("actions",o.actions)},dependencies:[lt.n],encapsulation:2}),n})();var _t=_(316);let ut=(()=>{class n{constructor(){this.table="contact",this.fieldsList=["code","fullName","mobile","gender","email","address","dateOfBirth","isImportant","staffId","businessTypeId","salesLineId","avatarUrl"],this.validateFields=["fullName"],this.fieldInstructions={gender:{type:"gender"},avatarUrl:{type:"image"},dateOfBirth:{type:"date"},isImportant:{type:"toggle"},staffId:{lookup:"staff",lookupField:"name"},businessTypeId:{lookup:"business_type",lookupField:"title"},salesLineId:{lookup:"sales_line",lookupField:"title"}}}}return n.\u0275fac=function(e){return new(e||n)},n.\u0275cmp=t.Xpm({type:n,selectors:[["contact-add"]],inputs:{table:"table",fieldsList:"fieldsList",validateFields:"validateFields",fieldInstructions:"fieldInstructions"},decls:1,vars:3,consts:[["table","contact",3,"fieldsList","validateFields","fieldInstructions"]],template:function(e,o){1&e&&t._UZ(0,"form-add",0),2&e&&t.Q6J("fieldsList",o.fieldsList)("validateFields",o.validateFields)("fieldInstructions",o.fieldInstructions)},dependencies:[_t.D],encapsulation:2}),n})();var G=_(6841),L=_(8257),T=_(7489),pt=_(2035),mt=_(9854),ft=_(9921),P=_(667),U=_(7696),ht=_(510),$=_(2126),Ct=_(5583),gt=_(7833),V=_(4433),xt=_(6391),Zt=_(3604),vt=_(280),bt=_(3090),At=_(8262);const Tt=["barcode"];function St(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.hij(" | ",e.contact.code,"")}}function yt(n,a){if(1&n&&t._UZ(0,"ion-icon",32),2&n){const e=t.oxw(2);t.s9C("name",e.actionIcon(e.contact.lastAction))}}function It(n,a){1&n&&(t.TgZ(0,"span"),t._uU(1,"\xa0"),t.qZA())}function kt(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"contact.level"),": ",e.contact.level.title," ")}}function Nt(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.lnq(" ",t.lcZ(2,3,"contact.point"),": ",e.contact.point," ",t.lcZ(3,5,"point-add.point")," ")}}function Dt(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.contact.address)}}function wt(n,a){if(1&n&&(t.TgZ(0,"p"),t._UZ(1,"ion-icon",33),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.AsE(" ",t.lcZ(3,2,"contact-add.staff"),": ",e.contact.staff.name," ")}}function Jt(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"contact-add.business-type-short"),": ",e.contact.businessType.title," ")}}function Ut(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"contact-add.sales-line"),": ",e.contact.salesLine.title," ")}}function qt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-label",34)(1,"ion-button",35),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showEditPoint())}),t._UZ(2,"ion-icon",4),t._uU(3),t.ALo(4,"translate"),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"ion-button",36),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showBarcode())}),t._UZ(7,"ion-icon",37),t._uU(8),t.ALo(9,"translate"),t.qZA()()}2&n&&(t.xp6(3),t.hij(" ",t.lcZ(4,2,"contact-add.edit-point-level")," "),t.xp6(5),t.hij(" ",t.lcZ(9,4,"contact-add.show-barcode")," "))}function Qt(n,a){1&n&&(t.TgZ(0,"ion-segment-button",38),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"contact.prices")," "))}function Mt(n,a){1&n&&(t.TgZ(0,"ion-segment-button",39),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"contact.discounts")," "))}function Ft(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item",35),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.openEmail())}),t._UZ(1,"ion-icon",44),t._uU(2),t.TgZ(3,"ion-icon",12),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.copy(i.contact.email))}),t.qZA()()}if(2&n){const e=t.oxw(3);t.xp6(2),t.hij(" ",e.contact.email,"\xa0 ")}}function Pt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item"),t._UZ(1,"ion-icon",45),t._uU(2),t.TgZ(3,"ion-icon",12),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.copy(i.contact.address))}),t.qZA()()}if(2&n){const e=t.oxw(3);t.xp6(2),t.hij(" ",e.contact.address,"\xa0 ")}}function Yt(n,a){if(1&n&&t._UZ(0,"ion-icon",48),2&n){const e=t.oxw(4);t.s9C("name","male"===e.contact.gender?"male":"female")}}function Lt(n,a){if(1&n&&(t.TgZ(0,"ion-item"),t._UZ(1,"ion-icon",46),t._uU(2),t.YNc(3,Yt,1,1,"ion-icon",47),t.qZA()),2&n){const e=t.oxw(3);t.xp6(2),t.hij(" ",e.dateFormat(e.contact.dateOfBirth)," "),t.xp6(1),t.Q6J("ngIf",e.contact.gender)}}function Ot(n,a){1&n&&(t.TgZ(0,"ion-item"),t._UZ(1,"ion-icon",49),t._uU(2),t.ALo(3,"translate"),t.qZA()),2&n&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"contact-add.VIP")," "))}function Et(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item-divider",40),t._uU(2),t.ALo(3,"translate"),t.TgZ(4,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.printBarcode())}),t._UZ(5,"ion-icon",42),t.qZA()(),t.YNc(6,Ft,4,1,"ion-item",43),t.YNc(7,Pt,4,1,"ion-item",6),t.YNc(8,Lt,4,2,"ion-item",6),t.YNc(9,Ot,4,3,"ion-item",6),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.Q6J("hidden",!e.isShowBarcode||!e.barcode64base),t.xp6(1),t.hij(" ",t.lcZ(3,6,"product-detail.barcode")," "),t.xp6(4),t.Q6J("ngIf",e.contact.email),t.xp6(1),t.Q6J("ngIf",e.contact.address),t.xp6(1),t.Q6J("ngIf",e.contact.dateOfBirth),t.xp6(1),t.Q6J("ngIf",e.contact.isImportant)}}function Gt(n,a){if(1&n&&(t.TgZ(0,"p")(1,"i",57),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n){const e=t.oxw().$implicit;t.xp6(2),t.AsE("",t.lcZ(3,2,"trade.staff")," ",e.staff.name,"")}}function Ht(n,a){if(1&n&&(t.TgZ(0,"ion-thumbnail",2),t._UZ(1,"img",58),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function Kt(n,a){1&n&&t._UZ(0,"ion-icon",59)}function jt(n,a){1&n&&t._UZ(0,"ion-icon",60)}function Bt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item",35),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectNote(c.id))}),t.TgZ(1,"ion-label",9)(2,"span",53),t._uU(3),t.qZA(),t.TgZ(4,"p"),t._uU(5),t.qZA(),t.YNc(6,Gt,4,4,"p",6),t.qZA(),t.YNc(7,Ht,2,1,"ion-thumbnail",54),t.YNc(8,Kt,1,0,"ion-icon",55),t.YNc(9,jt,1,0,"ion-icon",56),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.xp6(3),t.Oqu(o.limitText(e.content)),t.xp6(2),t.hij(" ",o.dateTimeFormat(e.modifiedAt)," "),t.xp6(1),t.Q6J("ngIf",e.staffId&&0!==e.staffId&&e.staff),t.xp6(1),t.Q6J("ngIf",e.avatarUrl),t.xp6(1),t.Q6J("ngIf",e.frequency),t.xp6(1),t.Q6J("ngIf",e.important)}}function $t(n,a){1&n&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-notes")))}function Vt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",9),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.addNote())}),t._UZ(6,"ion-icon",50),t.qZA()(),t.YNc(7,Bt,10,6,"ion-item",51),t.YNc(8,$t,3,3,"div",52),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.AsE(" ",e.notes&&e.notes.length?e.notes.length:0," ",t.lcZ(4,4,"note.note(s)")," "),t.xp6(4),t.Q6J("ngForOf",e.notes),t.xp6(1),t.Q6J("ngIf",!e.notes||!e.notes.length)}}function zt(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateTo)," ")}}function Wt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"trade-item",64),t.NdJ("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectTrade(c.id))}),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.Q6J("showContact",!1)("trade",e)("currency",o.currency)}}function Rt(n,a){1&n&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-trades")))}const H=function(n,a,e){return[n,a,"symbol","1.0-2",e]};function Xt(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",9),t.YNc(3,zt,5,8,"span",6),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",61),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.selectDateRangeForTrade())}),t._UZ(10,"ion-icon",62),t.qZA()(),t.YNc(11,Wt,1,3,"trade-item",63),t.YNc(12,Rt,3,3,"div",52),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",""!=e.dateFrom||""!=e.dateTo),t.xp6(1),t.hij(" ",t.lcZ(5,7,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.total>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.total>=0?"+":""," ",t.G7q(8,9,t.kEZ(15,H,e.total,e.currency,e.translateService.currentLang)),"."),t.xp6(4),t.Q6J("ngForOf",e.trades),t.xp6(1),t.Q6J("ngIf",!e.trades||!e.trades.length)}}function te(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateOrderFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateOrderTo)," ")}}function ee(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"order-list-item",66),t.NdJ("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectOrder(c.id))}),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.Q6J("showContact",!1)("order",e)("currency",o.currency)}}function ne(n,a){1&n&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-orders")))}function oe(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",9),t.YNc(3,te,5,8,"span",6),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",61),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.selectDateRangeForOrder())}),t._UZ(10,"ion-icon",62),t.qZA()(),t.YNc(11,ee,1,3,"order-list-item",65),t.YNc(12,ne,3,3,"div",52),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",""!=e.dateOrderFrom||""!=e.dateOrderTo),t.xp6(1),t.hij(" ",t.lcZ(5,7,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.orderTotal>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.orderTotal>=0?"+":""," ",t.G7q(8,9,t.kEZ(15,H,e.orderTotal,e.currency,e.translateService.currentLang)),"."),t.xp6(4),t.Q6J("ngForOf",e.orders),t.xp6(1),t.Q6J("ngIf",!e.orders||!e.orders.length)}}function ie(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&n){const e=t.oxw(3);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateDebtFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateDebtTo)," ")}}function ce(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"debt-item",69),t.NdJ("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectDebt(c.id))}),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.Q6J("showContact",!1)("debt",e)("currency",o.currency)}}function ae(n,a){1&n&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-debts")))}function re(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",9),t.YNc(3,ie,5,8,"span",6),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",67),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.selectDateRangeForDebt())}),t._UZ(10,"ion-icon",62),t.qZA()(),t.YNc(11,ce,1,3,"debt-item",68),t.YNc(12,ae,3,3,"div",52),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.Q6J("ngIf",""!=e.dateDebtFrom||""!=e.dateDebtTo),t.xp6(1),t.hij(" ",t.lcZ(5,5,"common.total"),":\xa0 "),t.xp6(3),t.hij("",t.G7q(8,7,t.kEZ(13,H,e.totalDebt,e.currency,e.translateService.currentLang))," "),t.xp6(4),t.Q6J("ngForOf",e.debts),t.xp6(1),t.Q6J("ngIf",!e.debts||!e.debts.length)}}function se(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"customer-price-item",72),t.NdJ("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectCustomerPrice(c.id))}),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.Q6J("showContact",!1)("showProduct",!0)("customerPrice",e)("currency",o.currency)}}function le(n,a){1&n&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-prices")))}function de(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",9),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"ion-text",70),t._uU(6),t.qZA()(),t.TgZ(7,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.addPrice())}),t._UZ(8,"ion-icon",50),t.qZA()(),t.YNc(9,se,1,4,"customer-price-item",71),t.YNc(10,le,3,3,"div",52),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.hij(" ",t.lcZ(4,4,"common.total"),":\xa0 "),t.xp6(3),t.hij("",e.customerPrices&&e.customerPrices.length?e.customerPrices.length:0," "),t.xp6(3),t.Q6J("ngForOf",e.customerPrices),t.xp6(1),t.Q6J("ngIf",!e.customerPrices||!e.customerPrices.length)}}function _e(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"customer-discount-item",74),t.NdJ("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectCustomerDiscount(c.id))}),t.qZA()}if(2&n){const e=a.$implicit,o=t.oxw(3);t.Q6J("showContact",!1)("showProduct",!0)("customerDiscount",e)("currency",o.currency)}}function ue(n,a){1&n&&(t.TgZ(0,"div",23),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-discounts")))}function pe(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",9),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"ion-text",70),t._uU(6),t.qZA()(),t.TgZ(7,"ion-button",41),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.addDiscount())}),t._UZ(8,"ion-icon",50),t.qZA()(),t.YNc(9,_e,1,4,"customer-discount-item",73),t.YNc(10,ue,3,3,"div",52),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(3),t.hij(" ",t.lcZ(4,4,"common.total"),":\xa0 "),t.xp6(3),t.Oqu(e.customerDiscounts&&e.customerDiscounts.length?e.customerDiscounts.length:0),t.xp6(3),t.Q6J("ngForOf",e.customerDiscounts),t.xp6(1),t.Q6J("ngIf",!e.customerDiscounts||!e.customerDiscounts.length)}}function me(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-content")(1,"ion-list",7)(2,"ion-item-sliding")(3,"ion-item")(4,"ion-avatar",0),t._UZ(5,"img",8),t.qZA(),t.TgZ(6,"ion-label",9)(7,"h2")(8,"b"),t._uU(9),t.YNc(10,St,2,1,"span",6),t.qZA()(),t.TgZ(11,"p"),t._uU(12),t.qZA(),t.TgZ(13,"p",10),t.YNc(14,yt,1,1,"ion-icon",11),t.YNc(15,It,2,0,"span",6),t._uU(16),t.qZA()(),t.TgZ(17,"ion-icon",12),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.copy(i.contact.fullName+"\n"+i.contact.mobile))}),t.qZA()(),t.TgZ(18,"ion-item-options",13)(19,"ion-item-option",3),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.text())}),t._UZ(20,"ion-icon",14),t._uU(21),t.ALo(22,"translate"),t.qZA(),t.TgZ(23,"ion-item-option",15),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.call())}),t._UZ(24,"ion-icon",16),t._uU(25),t.ALo(26,"translate"),t.qZA()()(),t.TgZ(27,"ion-item",17)(28,"ion-label",18),t.YNc(29,kt,3,4,"p",6),t.YNc(30,Nt,4,7,"p",6),t.YNc(31,Dt,2,1,"p",6),t.YNc(32,wt,4,4,"p",6),t.YNc(33,Jt,3,4,"p",6),t.YNc(34,Ut,3,4,"p",6),t.qZA(),t.YNc(35,qt,10,6,"ion-label",19),t.qZA(),t.TgZ(36,"ion-item",20)(37,"ion-label"),t._UZ(38,"canvas",21,22),t.qZA()()(),t.TgZ(40,"div",23)(41,"ion-segment",24),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.tab=i)}),t.TgZ(42,"ion-segment-button",25),t._uU(43),t.ALo(44,"translate"),t.qZA(),t.TgZ(45,"ion-segment-button",26),t._uU(46),t.ALo(47,"translate"),t.qZA(),t.TgZ(48,"ion-segment-button",27),t._uU(49),t.ALo(50,"translate"),t.qZA(),t.TgZ(51,"ion-segment-button",28),t._uU(52),t.ALo(53,"translate"),t.qZA(),t.TgZ(54,"ion-segment-button",29),t._uU(55),t.ALo(56,"translate"),t.qZA(),t.YNc(57,Qt,3,3,"ion-segment-button",30),t.YNc(58,Mt,3,3,"ion-segment-button",31),t.qZA()(),t.YNc(59,Et,10,8,"ion-list",6),t.YNc(60,Vt,9,6,"ion-list",6),t.YNc(61,Xt,13,19,"ion-list",6),t.YNc(62,oe,13,19,"ion-list",6),t.YNc(63,re,13,17,"ion-list",6),t.YNc(64,de,11,6,"ion-list",6),t.YNc(65,pe,11,6,"ion-list",6),t.qZA()}if(2&n){const e=t.oxw();t.xp6(5),t.Q6J("src",e.contactImageOrPlaceholder(),t.LSH),t.xp6(4),t.Oqu(e.contact.fullName),t.xp6(1),t.Q6J("ngIf",e.contact&&e.contact.code),t.xp6(2),t.Oqu(e.contact.mobile),t.xp6(2),t.Q6J("ngIf",e.contact.lastAction),t.xp6(1),t.Q6J("ngIf",e.contact.lastAction),t.xp6(1),t.hij("",e.dateTimeFormat(e.contact.lastActive)," "),t.xp6(5),t.hij(" ",t.lcZ(22,33,"action.text")," "),t.xp6(4),t.hij(" ",t.lcZ(26,35,"action.call")," "),t.xp6(4),t.Q6J("ngIf",e.contact.level),t.xp6(1),t.Q6J("ngIf",e.contact.point),t.xp6(1),t.Q6J("ngIf",e.contact.address),t.xp6(1),t.Q6J("ngIf",e.contact.staff),t.xp6(1),t.Q6J("ngIf",e.contact.businessType),t.xp6(1),t.Q6J("ngIf",e.contact.salesLine),t.xp6(1),t.Q6J("ngIf",!e.staffService.selectedStaff||e.staffService.selectedStaff.hasFullAccess),t.xp6(1),t.Q6J("hidden",!e.isShowBarcode||!e.barcode64base),t.xp6(5),t.Q6J("ngModel",e.tab)("scrollable",!0),t.xp6(2),t.hij(" ",t.lcZ(44,37,"contact-detail.info")," "),t.xp6(3),t.hij(" ",t.lcZ(47,39,"contact-detail.order")," "),t.xp6(3),t.hij(" ",t.lcZ(50,41,"contact-detail.trade")," "),t.xp6(3),t.hij(" ",t.lcZ(53,43,"contact-detail.note")," "),t.xp6(3),t.hij(" ",t.lcZ(56,45,"contact-detail.debt-loan")," "),t.xp6(2),t.Q6J("ngIf",null===e.staffService.selectedStaff||e.staffService.selectedStaff.hasFullAccess),t.xp6(1),t.Q6J("ngIf",null===e.staffService.selectedStaff||e.staffService.selectedStaff.hasFullAccess),t.xp6(1),t.Q6J("ngIf","info"===e.tab),t.xp6(1),t.Q6J("ngIf","note"===e.tab),t.xp6(1),t.Q6J("ngIf","trade"===e.tab),t.xp6(1),t.Q6J("ngIf","order"===e.tab),t.xp6(1),t.Q6J("ngIf","debt"===e.tab),t.xp6(1),t.Q6J("ngIf","prices"===e.tab),t.xp6(1),t.Q6J("ngIf","discounts"===e.tab)}}let fe=(()=>{class n{constructor(e,o,i,c,s,m,f,u,p,x,k,A,y,q,N,Y,Q,bo){var d=this;this.navCtrl=e,this.printer=o,this.staffService=i,this.translateService=c,this.modalCtrl=s,this.contactService=m,this.noteService=f,this.tradeService=u,this.orderService=p,this.debtService=x,this.actionSheetCtrl=k,this.userService=A,this.excelService=y,this.file=q,this.alertCtrl=N,this.platform=Y,this.toastController=Q,this.analyticsService=bo,this.params=null,this.contact=new L.r,this.notes=[],this.trades=[],this.orders=[],this.customerPrices=[],this.customerDiscounts=[],this.tab="info",this.dateOrderFrom="",this.dateFrom="",this.dateOrderTo="",this.dateTo="",this.total=0,this.orderTotal=0,this.debts=[],this.dateDebtFrom="",this.dateDebtTo="",this.totalDebt=0,this.isShowBarcode=!1,this.reload=(0,l.Z)(function*(){const S=yield d.navCtrl.loading();d.currency=yield d.userService.getAttr("current-currency");const g=d.params?d.params:d.navCtrl.getParams();if(d.params=g,g&&g.id&&g.id>0){d.params=g;const Ao=g.id;g.tab&&""!=g.tab&&(d.tab=g.tab);const J=yield d.contactService.get(Ao);d.contact=J,d.noteService.getNotesByContact(J.id).then(h=>{h&&h.length>0&&(h=T.orderBy(h,["modifiedAt"],["desc"])),d.notes=h}),d.dateFrom=g.dateFrom?g.dateFrom:d.dateFrom?d.dateFrom:C.C.GetFirstDateOfMonth(),d.dateTo=g.dateTo?g.dateTo:d.dateTo?d.dateTo:C.C.GetEndDateOfMonth(),d.tradeService.getTradesByContact(J.id,d.dateFrom,d.dateTo).then(h=>{h&&h.length>0&&(h=T.orderBy(h,["modifiedAt"],["desc"])),d.trades=h,d.total=T.sumBy(d.trades,M=>M.value*(M.isReceived?1:-1))}),d.dateOrderFrom="",d.dateOrderTo="",d.dateOrderFrom=g.dateOrderFrom?g.dateOrderFrom:C.C.GetFirstDateOfMonth(),d.dateOrderTo=g.dateOrderTo?g.dateOrderTo:C.C.GetEndDateOfMonth(),d.orderService.getOrdersByContact(J.id,d.dateOrderFrom,d.dateOrderTo).then(h=>{h&&h.length>0&&(h=T.orderBy(h,["modifiedAt"],["desc"])),d.orders=h,d.orderTotal=T.sumBy(d.orders,M=>M.total)}),d.dateDebtFrom="",d.dateDebtTo="",d.dateDebtFrom=g.dateDebtFrom?g.dateDebtFrom:C.C.GetFirstDateOfMonth(),d.dateDebtTo=g.dateDebtTo?g.dateDebtTo:C.C.GetEndDateOfMonth(),d.debtService.getDebtsByContact(J.id,d.dateDebtFrom,d.dateDebtTo).then(h=>{h&&h.length>0&&(h=T.orderBy(h,["modifiedAt"],["desc"])),d.debts=h,d.totalDebt=T.sumBy(d.debts,M=>M.value)}),d.contactService.getCustomerPricesByContact(J.id).then(h=>{h&&h.length>0&&(h=T.orderBy(h,["createdAt"],["desc"])),d.customerPrices=h}),d.contactService.getCustomerDiscountsByContact(J.id).then(h=>{h&&h.length>0&&(h=T.orderBy(h,["createdAt"],["desc"])),d.customerDiscounts=h})}setTimeout(()=>{pt(d.barcode.nativeElement,d.contact.id.toString(),{displayValue:!0,fontSize:12.5,textMargin:0,height:50,margin:3}),d.barcode64base=d.barcode.nativeElement.toDataURL("image/png")},1e3),yield S.dismiss()});const et=S=>{const g=S.detail;g&&this.contact&&g.id===this.contact.id&&this.reload()};this.navCtrl.unsubscribe("reloadContact",et),this.navCtrl.subscribe("reloadContact",et);const nt=S=>{S.detail===this.contact.id&&(this.tab="trade")};this.navCtrl.unsubscribe("reloadContactTrade",nt),this.navCtrl.subscribe("reloadContactTrade",nt);const ot=S=>{S.detail===this.contact.id&&(this.tab="order")};this.navCtrl.unsubscribe("reloadContactOrder",ot),this.navCtrl.subscribe("reloadContactOrder",ot);const it=S=>{S.detail===this.contact.id&&(this.tab="debt")};this.navCtrl.unsubscribe("reloadContactDebt",it),this.navCtrl.subscribe("reloadContactDebt",it);const ct=S=>{S.detail===this.contact.id&&(this.tab="debt")};this.navCtrl.unsubscribe("reloadContactNote",ct),this.navCtrl.subscribe("reloadContactNote",ct);const at=S=>{S.detail===this.contact.id&&(this.tab="prices")};this.navCtrl.unsubscribe("reloadContactPrice",at),this.navCtrl.subscribe("reloadContactPrice",at);const rt=S=>{S.detail===this.contact.id&&(this.tab="discounts")};this.navCtrl.unsubscribe("reloadContactDiscount",rt),this.navCtrl.subscribe("reloadContactDiscount",rt)}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("contact-detail")})()}ngOnInit(){this.reload()}edit(){this.navCtrl.push("/contact/add",{id:this.contact.id})}showEditPoint(){this.navCtrl.push("/contact/edit-point",{id:this.contact.id})}contactImageOrPlaceholder(){return Z.W.contactImageOrPlaceholder(this.contact.avatarUrl)}actionIcon(e){return Z.W.actionIcon(e)}dateTimeFormat(e){return C.C.toUiString(e)}dateFormat(e){return C.C.toUiDateString(e)}openEmail(){Z.W.sendEmail(this.contact.email)}call(){this.saveLastActive("call"),Z.W.callPhone(this.contact.mobile)}text(){this.saveLastActive("text"),Z.W.sendSms(this.contact.mobile)}saveLastActive(e){return this.contact.lastActive=C.C.toDbString(),this.contact.lastAction=e,this.contactService.saveContact(this.contact).then(o=>(this.navCtrl.publish("reloadContactList",null),this.navCtrl.publish("reloadContact",this.contact),o))}selectNote(e){this.navCtrl.push("/note/detail",{id:e})}selectTrade(e){this.navCtrl.push("/trade/detail",{id:e})}selectOrder(e){this.navCtrl.push("/order/detail",{id:e})}selectDebt(e){this.navCtrl.push("/debt/detail",{id:e})}limitText(e,o=200){return Z.W.limitText(e,o)}delete(){var e=this;return(0,l.Z)(function*(){yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("contact-detail.delete-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.contactService.deleteContact(e.contact).then((0,l.Z)(function*(){e.analyticsService.logEvent("contact-detail-delete-success"),e.navCtrl.pop(),e.navCtrl.publish("reloadContactList",null)}))}}]})).present()})()}addNote(){this.navCtrl.push("/note/add",{contact:this.contact.id})}addTrade(){this.navCtrl.push("/trade/add",{contact:this.contact.id})}addOrder(){this.navCtrl.push("/order/add",{contact:this.contact.id})}addDebt(){this.navCtrl.push("/debt/add",{contact:this.contact.id})}presentActionSheet(){var e=this;return(0,l.Z)(function*(){const o=[{text:e.translateService.instant("contact.new-trade"),handler:()=>{e.addTrade()}},{text:e.translateService.instant("export.export-trade"),handler:()=>{e.exportTradeToExcel()}},{text:e.translateService.instant("contact.new-debts"),handler:()=>{e.addDebt()}},{text:e.translateService.instant("contact.new-order"),handler:()=>{e.addOrder()}},{text:e.translateService.instant("contact-detail.delete"),role:"destructive",handler:()=>{e.delete()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}];o.push({text:e.translateService.instant("contact.new-note"),handler:()=>{e.addNote()}}),yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:o})).present()})()}exportTradeToExcel(){var e=this;const o=[];if(o.push([this.translateService.instant("export.customer-transaction-report")]),o.push([this.translateService.instant("export.contact")+": "+this.contact.fullName]),this.dateFrom&&this.dateTo){const s=this.translateService.instant("common.from"),m=this.translateService.instant("common.to"),f=s+" "+this.dateFormat(this.dateFrom)+" "+m+" "+this.dateFormat(this.dateTo);o.push([f])}o.push([this.translateService.instant("common.total")+": "+this.total+" "+this.currency]),o.push([this.translateService.instant("export.contact"),this.translateService.instant("export.product"),this.translateService.instant("export.product-count"),this.translateService.instant("export.money"),this.translateService.instant("export.unit"),this.translateService.instant("export.date")]);for(const s of this.trades)o.push([0!=s.contactId&&s.contact?s.contact.fullName:"",0!=s.productId&&s.product?Z.W.productName(s.product.code,s.product.title):0!=s.orderId&&s.order?this.getProductNamesFromOrder(s.order):"",0!=s.productId&&s.product&&s.isPurchase?s.productCount?s.productCount:0:" ",s.isReceived?s.value:-1*s.value,this.currency,this.dateFormat(s.createdAt)]);const i=this.excelService.createSheetData(o),c="customer-transations-"+this.contact.id+"-"+Z.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(i,c).then(function(){var s=(0,l.Z)(function*(m){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+c,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,m))});return function(m){return s.apply(this,arguments)}}())}getProductNamesFromOrder(e){const o=JSON.parse(e.itemsJson);if(!o||!o.length)return"";let i="";for(const c of o)i+=Z.W.productName(c.productCode,c.productName)+"\r\n";return i}selectDateRangeForTrade(){var e=this;return(0,l.Z)(function*(){const o=yield e.modalCtrl.create({component:G.S,componentProps:{dateFromInput:e.dateFrom,dateToInput:e.dateTo}});yield o.present();const{data:i}=yield o.onDidDismiss();i&&(e.dateFrom=""!=i.dateFrom?C.C.toDbString(i.dateFrom,C.C.getDbFormat()):"",e.dateTo=""!=i.dateTo?C.C.toDbString(i.dateTo,C.C.getDbFormat()):"",e.tradeService.getTradesByContact(e.contact.id,e.dateFrom,e.dateTo).then(c=>{c&&c.length>0&&(c=T.orderBy(c,["modifiedAt"],["desc"])),e.trades=c,e.total=T.sumBy(e.trades,s=>s.value*(s.isReceived?1:-1))}))})()}selectDateRangeForOrder(){var e=this;return(0,l.Z)(function*(){const o=yield e.modalCtrl.create({component:G.S,componentProps:{dateFromInput:e.dateOrderFrom,dateToInput:e.dateOrderTo}});yield o.present();const{data:i}=yield o.onDidDismiss();i&&(e.dateOrderFrom=""!=i.dateFrom?C.C.toDbString(i.dateFrom,C.C.getDbFormat()):"",e.dateOrderTo=""!=i.dateTo?C.C.toDbString(i.dateTo,C.C.getDbFormat()):"",e.orderService.getOrdersByContact(e.contact.id,e.dateOrderFrom,e.dateOrderTo).then(c=>{c&&c.length>0&&(c=T.orderBy(c,["modifiedAt"],["desc"])),e.orders=c,e.orderTotal=T.sumBy(e.orders,s=>s.total)}))})()}selectDateRangeForDebt(){var e=this;return(0,l.Z)(function*(){const o=yield e.modalCtrl.create({component:G.S,componentProps:{dateFromInput:e.dateDebtFrom,dateToInput:e.dateDebtTo}});yield o.present();const{data:i}=yield o.onDidDismiss();i&&(e.dateDebtFrom=""!=i.dateFrom?C.C.toDbString(i.dateFrom,C.C.getDbFormat()):"",e.dateDebtTo=""!=i.dateTo?C.C.toDbString(i.dateTo,C.C.getDbFormat()):"",e.debtService.getDebtsByContact(e.contact.id,e.dateDebtFrom,e.dateDebtTo).then(c=>{c&&c.length>0&&(c=T.orderBy(c,["modifiedAt"],["desc"])),e.debts=c,e.totalDebt=T.sumBy(e.debts,s=>s.value)}))})()}addPrice(){this.navCtrl.push("/contact/add-price",{contact:this.contact.id})}selectCustomerPrice(e){this.navCtrl.push("/contact/add-price",{id:e})}addDiscount(){this.navCtrl.push("/contact/add-discount",{contact:this.contact.id})}selectCustomerDiscount(e){this.navCtrl.push("/contact/add-discount",{id:e})}showBarcode(){this.isShowBarcode=!this.isShowBarcode}printBarcode(){const e=`<div style='text-align: center;'><img src='${this.barcode64base}'/></div>`;this.navCtrl.isNotCordova()?Z.W.webPrint(e):this.printer.print(e).then(()=>{})}copy(e){var o=this;return(0,l.Z)(function*(){if(o.isCordova())return o.share(e);yield(0,mt.OR)(e);const i=o.translateService.instant("request-pro.copied")+e;yield(yield o.toastController.create({message:i,duration:3e3,position:"bottom"})).present()})()}isCordova(){return this.platform.is("capacitor")||this.platform.is("cordova")}share(e){var o=this;return(0,l.Z)(function*(){yield o.userService.shareText(e)})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(ft.F),t.Y36(P.x),t.Y36(b.sK),t.Y36(r.IN),t.Y36(U.y),t.Y36(ht.Y),t.Y36($.X),t.Y36(Ct.p),t.Y36(gt.E),t.Y36(r.BX),t.Y36(F.K),t.Y36(E.x),t.Y36(V.$),t.Y36(r.Br),t.Y36(r.t4),t.Y36(r.yF),t.Y36(w.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["contact-detail"]],viewQuery:function(e,o){if(1&e&&t.Gf(Tt,5),2&e){let i;t.iGM(i=t.CRH())&&(o.barcode=i.first)}},decls:15,vars:7,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","ellipsis-vertical"],[4,"ngIf"],["lines","none"],[2,"max-width","150px",3,"src"],[1,"ion-text-wrap"],[1,"ion-text-wrap",2,"font-size","0.8em"],[3,"name",4,"ngIf"],["name","copy",3,"click"],["side","end"],["slot","start","name","send"],["ion-button","","color","secondary",3,"click"],["slot","start","name","call"],[2,"margin","0","padding","0"],[1,"ion-text-wrap",2,"margin","0","padding","0"],["style","text-align: right;","slot","end",4,"ngIf"],["lines","none",2,"text-align","center",3,"hidden"],["id","barcode"],["barcode",""],[1,"ion-padding"],["scrollable","",1,"ion-text-wrap",3,"ngModel","scrollable","ngModelChange"],["value","info",1,"ion-text-wrap"],["value","order",1,"ion-text-wrap"],["value","trade",1,"ion-text-wrap"],["value","note",1,"ion-text-wrap"],["value","debt",1,"ion-text-wrap"],["value","prices","class","ion-text-wrap",4,"ngIf"],["value","discounts","class","ion-text-wrap",4,"ngIf"],[3,"name"],["name","person-outline","slot","start"],["slot","end",2,"text-align","right"],[3,"click"],["color","secondary",3,"click"],["name","barcode"],["value","prices",1,"ion-text-wrap"],["value","discounts",1,"ion-text-wrap"],["color","light",3,"hidden"],["fill","clear","color","primary","slot","end",3,"click"],["slot","icon-only","name","print"],[3,"click",4,"ngIf"],["name","mail","slot","start"],["name","pin","slot","start"],["name","calendar","slot","start"],["item-right","",3,"name",4,"ngIf"],["item-right","",3,"name"],["name","star","slot","start"],["slot","icon-only","name","add"],[3,"click",4,"ngFor","ngForOf"],["class","ion-padding",4,"ngIf"],[2,"white-space","pre-wrap"],["slot","end",4,"ngIf"],["name","bookmark","slot","end",4,"ngIf"],["name","star","slot","end",4,"ngIf"],[2,"font-size","11px"],[3,"src"],["name","bookmark","slot","end"],["name","star","slot","end"],[3,"color"],["slot","icon-only","name","funnel"],[3,"showContact","trade","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","trade","currency","onClick"],[3,"showContact","order","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","order","currency","onClick"],["color","danger"],[3,"showContact","debt","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","debt","currency","onClick"],["color","primary"],[3,"showContact","showProduct","customerPrice","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","showProduct","customerPrice","currency","onClick"],[3,"showContact","showProduct","customerDiscount","currency","onClick",4,"ngFor","ngForOf"],[3,"showContact","showProduct","customerDiscount","currency","onClick"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.edit()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"ion-button",3),t.NdJ("click",function(){return o.presentActionSheet()}),t._UZ(13,"ion-icon",5),t.qZA()()()(),t.YNc(14,me,66,47,"ion-content",6)),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,3,"contact-detail.title")),t.xp6(5),t.hij(" ",t.lcZ(11,5,"common.edit")," "),t.xp6(4),t.Q6J("ngIf",o.contact))},dependencies:[v.sg,v.O5,I.JJ,I.On,r.BJ,r.oU,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.Ie,r.rH,r.u8,r.IK,r.td,r.Q$,r.q_,r.cJ,r.GO,r.yW,r.Bs,r.wd,r.sr,r.QI,r.cs,xt.A,Zt._,vt.e,bt.X,At.v,v.H9,b.X$],encapsulation:2}),n})();const he=["fileUploadInput"];function Ce(n,a){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-import.upload-file")))}function ge(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Oqu(e.fileToUpload.name)}}function xe(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" | ",e.code,"")}}function Ze(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.mobile)}}function ve(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.email)}}function be(n,a){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-label",14)(2,"h2"),t._uU(3),t.YNc(4,xe,2,1,"span",9),t.qZA(),t.YNc(5,Ze,2,1,"p",9),t.YNc(6,ve,2,1,"p",9),t.qZA()()),2&n){const e=a.$implicit;t.xp6(3),t.hij("",e.fullName," "),t.xp6(1),t.Q6J("ngIf",e.code),t.xp6(1),t.Q6J("ngIf",e.mobile),t.xp6(1),t.Q6J("ngIf",e.email)}}function Ae(n,a){if(1&n&&(t.TgZ(0,"ion-list")(1,"ion-list-header")(2,"ion-label"),t._uU(3),t.ALo(4,"translate"),t.qZA()(),t.YNc(5,be,7,4,"ion-item",13),t.qZA()),2&n){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,2,"contact-import.imported-contacts")),t.xp6(2),t.Q6J("ngForOf",e.contactsImported)}}function Te(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"div",2)(1,"ion-button",15),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.navCtrl.back())}),t._UZ(2,"ion-icon",16),t._uU(3),t.ALo(4,"translate"),t.qZA()()}2&n&&(t.xp6(3),t.hij("\xa0 ",t.lcZ(4,1,"product-add.close")," "))}let Se=(()=>{class n{constructor(e,o,i,c,s,m){this.userService=e,this.excelService=o,this.navCtrl=i,this.alertCtrl=c,this.translateService=s,this.analyticsService=m,this.uploadDisabled=!1,this.contactsImported=[]}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("contact-import")})()}downloadTemplate(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("contact-import-download");const o="contact-template.xlsx",i=yield e.navCtrl.loading();e.excelService.downloadContactsTemplate(o).then(function(){var c=(0,l.Z)(function*(s){e.analyticsService.logEvent("contact-import-download-successfully"),yield i.dismiss(),e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+s,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFileUrl(o,o,s))});return function(s){return c.apply(this,arguments)}}())})()}rememberFile(e){this.fileToUpload=e.target.files[0],this.uploadContacts()}uploadContacts(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("contact-import-upload"),e.uploadDisabled=!0;const o=yield e.navCtrl.loading();e.excelService.uploadContactsFile(e.fileToUpload,0).then(function(){var i=(0,l.Z)(function*(c){if(e.analyticsService.logEvent("contact-import-upload-successfully"),yield o.dismiss(),c&&c.count)e.analyticsService.logEvent("contact-import-uploaded-success"),e.contactsImported=c.contacts,e.navCtrl.publish("reloadContactList",null),alert(e.translateService.instant("contact-import.done"));else if(c&&c.error){e.analyticsService.logEvent("contact-import-upload-failed");let s=c.error+"";s=s.replace("{","").replace("}","");const m=s.split(":");s="",s=m.length>=2?e.translateService.instant("contact-import."+m[0])+m[1]:e.translateService.instant("contact-import."+m[0]),alert(s)}else e.analyticsService.logEvent("contact-import-upload-failed"),alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later).");e.uploadDisabled=!1,e.fileToUpload=null,e.fileUploadInput.nativeElement.value=null});return function(c){return i.apply(this,arguments)}}()).catch((0,l.Z)(function*(){yield o.dismiss(),alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later)."),e.uploadDisabled=!1,e.fileToUpload=null,e.fileUploadInput.nativeElement.value=null}))})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(F.K),t.Y36(E.x),t.Y36(D.G),t.Y36(r.Br),t.Y36(b.sK),t.Y36(w.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["contact-import"]],viewQuery:function(e,o){if(1&e&&t.Gf(he,5),2&e){let i;t.iGM(i=t.CRH())&&(o.fileUploadInput=i.first)}},decls:28,vars:18,consts:[["slot","start"],["defaultHref","/home"],[1,"ion-padding"],["expand","block","fill","outline","color","secondary",3,"click"],["slot","start","name","download"],[3,"innerHTML"],["color","primary","for","files",2,"border-radius","10px","display","block","border","1px solid #387ef5","text-transform","uppercase","text-align","center"],[2,"color","#387ef5","height","45px","display","flex","align-items","center","justify-content","center"],["name","cloud-upload","color","primary",2,"zoom","1.5"],[4,"ngIf"],["type","file","accept",".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","id","files",2,"width","0","height","0","font-size","0",3,"change"],["fileUploadInput",""],["class","ion-padding",4,"ngIf"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap"],[3,"click"],["name","close"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA()()(),t.TgZ(7,"ion-content")(8,"div",2)(9,"p"),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.TgZ(12,"ion-button",3),t.NdJ("click",function(){return o.downloadTemplate()}),t._UZ(13,"ion-icon",4),t._uU(14),t.ALo(15,"translate"),t.qZA(),t._UZ(16,"p",5),t.ALo(17,"translate"),t.TgZ(18,"label",6)(19,"div",7),t._UZ(20,"ion-icon",8),t._uU(21," \xa0 "),t.YNc(22,Ce,3,3,"span",9),t.YNc(23,ge,2,1,"span",9),t.qZA()(),t.TgZ(24,"input",10,11),t.NdJ("change",function(c){return o.rememberFile(c)}),t.qZA()(),t.YNc(26,Ae,6,4,"ion-list",9),t.YNc(27,Te,5,3,"div",12),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,10,"contact-import.title")),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(3),t.Oqu(t.lcZ(11,12,"contact-import.template-note")),t.xp6(4),t.hij("\xa0 ",t.lcZ(15,14,"contact-import.download-template")," "),t.xp6(2),t.Q6J("innerHTML",t.lcZ(17,16,"contact-import.note"),t.oJD),t.xp6(6),t.Q6J("ngIf",!o.fileToUpload),t.xp6(1),t.Q6J("ngIf",o.fileToUpload),t.xp6(3),t.Q6J("ngIf",o.contactsImported&&o.contactsImported.length),t.xp6(1),t.Q6J("ngIf",o.contactsImported&&o.contactsImported.length))},dependencies:[v.sg,v.O5,r.oU,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.Ie,r.Q$,r.q_,r.yh,r.wd,r.sr,r.cs,b.X$],encapsulation:2}),n})();var K=_(5439),ye=_(5129),Ie=_(1582),ke=_(3142),Ne=_(8851);const De=["fileUploadInput"];function we(n,a){if(1&n&&(t.TgZ(0,"span",22),t._UZ(1,"br")(2,"img",23),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("src",e.contactImageOrPlaceholder(e.contact),t.LSH)}}function Je(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",24),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.upload())}),t._UZ(1,"ion-icon",25),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&n&&(t.xp6(2),t.hij("\xa0",t.lcZ(3,1,"note-add.select-photo")," "))}function Ue(n,a){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"note-add.select-photo")))}function qe(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw(2);t.xp6(1),t.Oqu(e.fileToUpload.name)}}function Qe(n,a){if(1&n&&(t.TgZ(0,"label",26),t._uU(1,"["),t.YNc(2,Ue,3,3,"span",15),t.YNc(3,qe,2,1,"span",15),t._uU(4,"]"),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",!e.fileToUpload),t.xp6(1),t.Q6J("ngIf",e.fileToUpload)}}function Me(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"input",27,28),t.NdJ("change",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.rememberFile(i))}),t.qZA()}}function Fe(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-col",5)(1,"ion-label",6),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",29),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.contact.email=i)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"contact-add.email")),t.xp6(2),t.Q6J("ngModel",e.contact.email)}}function Pe(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.showSearchStaff())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(3);t.xp6(1),t.hij(" ",e.staffSelected.name," ")}}function Ye(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",44),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.showSearchStaff())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"order-add.select-collaborator")," "))}function Le(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(3);return t.KtG(i.removeStaff())}),t._UZ(1,"ion-icon",46),t.qZA()}}function Oe(n,a){if(1&n&&(t.TgZ(0,"ion-col",31)(1,"ion-text",36),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"br"),t.YNc(5,Pe,2,1,"ion-text",40),t.YNc(6,Ye,3,3,"ion-button",41),t.YNc(7,Le,2,0,"ion-button",42),t.qZA()),2&n){const e=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,4,"contact-add.staff")),t.xp6(3),t.Q6J("ngIf",e.staffSelected&&e.staffSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.staffSelected||0==e.staffSelected.id),t.xp6(1),t.Q6J("ngIf",e.staffSelected&&e.staffSelected.id>0)}}function Ee(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"date-picker",47),t.NdJ("dateChange",function(i){t.CHM(e);const c=t.oxw(2);return t.KtG(c.contact.dateOfBirth=i)}),t.qZA()}if(2&n){const e=t.oxw(2);t.Q6J("date",e.contact.dateOfBirth)}}function Ge(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",48),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showDatePopup())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"common.select-date")," "))}function He(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",49),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeDate())}),t._UZ(1,"ion-icon",46),t.qZA()}}function Ke(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showBusinessTypes())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.businessTypeSelected.title," ")}}function je(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",44),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showBusinessTypes())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"contact-add.select-business-type")," "))}function Be(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeBusinessType())}),t._UZ(1,"ion-icon",46),t.qZA()}}function $e(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",43),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSalesLines())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.salesLineSelected.title," ")}}function Ve(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",44),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSalesLines())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"contact-add.select-sales-line")," "))}function ze(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",45),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeSalesLine())}),t._UZ(1,"ion-icon",46),t.qZA()}}function We(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row"),t.YNc(2,Oe,8,6,"ion-col",30),t.TgZ(3,"ion-col",31)(4,"ion-label",6),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-select",32),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.contact.gender=i)}),t.TgZ(8,"ion-select-option",33),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"ion-select-option",34),t._uU(12),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"ion-select-option",35),t._uU(15),t.ALo(16,"translate"),t.qZA()()(),t.TgZ(17,"ion-col",31)(18,"ion-label",36),t._uU(19),t.ALo(20,"translate"),t.qZA(),t._UZ(21,"br"),t.YNc(22,Ee,1,1,"date-picker",37),t.YNc(23,Ge,3,3,"ion-text",38),t.YNc(24,He,2,0,"ion-button",39),t.qZA(),t.TgZ(25,"ion-col",31)(26,"ion-label",6),t._uU(27),t.ALo(28,"translate"),t.qZA(),t._UZ(29,"br"),t.TgZ(30,"ion-toggle",32),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.contact.isImportant=i)}),t.qZA()()(),t.TgZ(31,"ion-row")(32,"ion-col",31)(33,"ion-text",36),t._uU(34),t.ALo(35,"translate"),t.qZA(),t._UZ(36,"br"),t.YNc(37,Ke,2,1,"ion-text",40),t.YNc(38,je,3,3,"ion-button",41),t.YNc(39,Be,2,0,"ion-button",42),t.qZA(),t.TgZ(40,"ion-col",31)(41,"ion-text",36),t._uU(42),t.ALo(43,"translate"),t.qZA(),t._UZ(44,"br"),t.YNc(45,$e,2,1,"ion-text",40),t.YNc(46,Ve,3,3,"ion-button",41),t.YNc(47,ze,2,0,"ion-button",42),t.qZA()()()}if(2&n){const e=t.oxw();t.xp6(2),t.Q6J("ngIf",!e.staffService.isStaff()||e.staffService.selectedStaff.hasFullAccess||e.staffService.selectedStaff.canViewAllContacts),t.xp6(3),t.Oqu(t.lcZ(6,20,"contact-add.gender")),t.xp6(2),t.Q6J("ngModel",e.contact.gender),t.xp6(2),t.Oqu(t.lcZ(10,22,"contact-add.gender-na")),t.xp6(3),t.Oqu(t.lcZ(13,24,"contact-add.gender-male")),t.xp6(3),t.Oqu(t.lcZ(16,26,"contact-add.gender-female")),t.xp6(4),t.Oqu(t.lcZ(20,28,"contact-add.DOB")),t.xp6(3),t.Q6J("ngIf",e.contact.dateOfBirth),t.xp6(1),t.Q6J("ngIf",!e.contact.dateOfBirth),t.xp6(1),t.Q6J("ngIf",e.contact.dateOfBirth),t.xp6(3),t.Oqu(t.lcZ(28,30,"contact-add.VIP")),t.xp6(3),t.Q6J("ngModel",e.contact.isImportant),t.xp6(4),t.Oqu(t.lcZ(35,32,"contact-add.business-type")),t.xp6(3),t.Q6J("ngIf",e.businessTypeSelected&&e.businessTypeSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.businessTypeSelected||0==e.businessTypeSelected.id),t.xp6(1),t.Q6J("ngIf",e.businessTypeSelected&&e.businessTypeSelected.id>0),t.xp6(3),t.Oqu(t.lcZ(43,34,"contact-add.sales-line")),t.xp6(3),t.Q6J("ngIf",e.salesLineSelected&&e.salesLineSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.salesLineSelected||0==e.salesLineSelected.id),t.xp6(1),t.Q6J("ngIf",e.salesLineSelected&&e.salesLineSelected.id>0)}}function Re(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.hij(" | ",e.code,"")}}function Xe(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=t.oxw().$implicit;t.xp6(1),t.Oqu(e.address)}}function tn(n,a){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-avatar",0),t._UZ(2,"img",50),t.qZA(),t.TgZ(3,"ion-label")(4,"h2"),t._uU(5),t.YNc(6,Re,2,1,"span",15),t.qZA(),t.TgZ(7,"p"),t._uU(8),t.qZA(),t.YNc(9,Xe,2,1,"p",15),t.qZA()()),2&n){const e=a.$implicit,o=t.oxw();t.xp6(2),t.Q6J("src",o.contactImageOrPlaceholder(e),t.LSH),t.xp6(3),t.hij("",e.fullName," "),t.xp6(1),t.Q6J("ngIf",e.code),t.xp6(2),t.Oqu(e.mobile),t.xp6(1),t.Q6J("ngIf",e.address)}}let en=(()=>{class n{constructor(e,o,i,c,s,m,f,u,p,x,k,A,y){this.navCtrl=e,this.camera=o,this.file=i,this.transfer=c,this.contactService=s,this.translateService=m,this.dataService=f,this.staffService=u,this.actionSheetController=p,this.platform=x,this.toastCtrl=k,this.analyticsService=A,this.alertCtrl=y,this.gender="male",this.params=null,this.storageDirectory="",this.isNew=!0,this.saveDisabled=!1,this.uploadDisabled=!1,this.contactsAdded=[],this.isExtend=!1,this.isMobile=!1,this.addCount=0,this.platform.ready().then(()=>{if(!this.platform.is("capacitor")&&!this.platform.is("cordova"))return!1;if(this.platform.is("ios"))this.storageDirectory=this.file.documentsDirectory;else{if(!this.platform.is("android"))return!1;this.storageDirectory=this.file.dataDirectory}},q=>{alert(q)})}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("contact-quick-add")})()}ngOnInit(){if(this.isMobile=this.platform.width()<720,this.platform.resize.subscribe(()=>{this.isMobile=this.platform.width()<720}),this.contact=new L.r,this.contact.dateOfBirth=K(new Date).format(C.C.getDbFormat()),this.params=this.navCtrl.getParams(this.params),this.params&&this.params.id&&this.params.id>0){const e=this.params.id;this.isNew=!1,this.contactService.get(e).then(o=>{this.contact=o})}else this.params&&this.params.number&&(this.contact.mobile=this.params.number),this.params&&this.params.cachedName&&(this.contact.fullName=this.params.cachedName)}save(e,o){var i=this;return(0,l.Z)(function*(){if(i.saveDisabled)return;if(!i.contact.fullName)return void alert(i.translateService.instant("contact-add.no-fullname-alert"));i.analyticsService.logEvent("contact-quick-add-save-"+(e?"on-toolbar":"on-page")),i.saveDisabled=!0,i.staffService.isStaff()&&0===i.contact.staffId&&(i.contact.staffId=i.staffService.selectedStaff.id);const c=yield i.navCtrl.loading();i.contactService.saveContact(i.contact).then((0,l.Z)(function*(){i.analyticsService.logEvent("contact-quick-add-save-success");const s=JSON.parse(JSON.stringify(i.contact));i.contactsAdded.unshift(s);const m=i.translateService.instant("contact-add.added-contact",{contact:s.fullName});yield i.presentToast(m),i.contact=new L.r,i.contact.dateOfBirth=K(new Date).format(C.C.getDbFormat()),i.navCtrl.publish("reloadContactList",{filter:i.contact.isImportant?"important":"all"}),i.saveDisabled=!1,yield c.dismiss(),i.addCount>0&&i.analyticsService.logEvent("product-quick-add-save-multi"),o&&i.addCount>0||(i.addCount++,yield(yield i.alertCtrl.create({header:i.translateService.instant("common.confirm"),message:i.translateService.instant("contact-add.continue-or-close",{contact:s.fullName}),buttons:[{text:i.translateService.instant("contact-add.finish-adding"),handler:()=>{i.navCtrl.back()}},{text:i.translateService.instant("contact-add.continue-to-add"),handler:()=>{}}]})).present())})).catch((0,l.Z)(function*(){yield c.dismiss(),i.saveDisabled=!1}))})()}takePicture(){!this.platform.is("capacitor")&&!this.platform.is("cordova")||this.camera.getPicture({destinationType:this.camera.DestinationType.FILE_URI,correctOrientation:!0,saveToPhotoAlbum:!1,sourceType:this.camera.PictureSourceType.CAMERA}).then(e=>{const o=e.substr(e.lastIndexOf("/")+1);this.downloadImage("contact_image_"+o,e)},e=>{console.error(e)})}contactImageOrPlaceholder(e){return e?Z.W.contactImageOrPlaceholder(e.avatarUrl):"./assets/person-placeholder.jpg"}downloadImage(e,o){var i=this;this.platform.ready().then((0,l.Z)(function*(){const c=i.transfer.create(),s=yield i.navCtrl.loading();c.download(o,i.storageDirectory+e).then(function(){var m=(0,l.Z)(function*(f){const u=f.toURL();i.contact.avatarUrl=u,yield s.dismiss()});return function(f){return m.apply(this,arguments)}}(),(0,l.Z)(function*(){yield s.dismiss()}))}))}showDatePopup(){this.contact.dateOfBirth=K().startOf("day").format("YYYY-MM-DD")}dateFormat(e){return C.C.toUiDateString(e)}presentToast(e){var o=this;return(0,l.Z)(function*(){yield(yield o.toastCtrl.create({message:e,duration:3e3,position:"top"})).present()})()}removeDate(){this.contact.dateOfBirth=""}rememberFile(e){this.fileToUpload=e.target.files[0],this.browsePicture()}browsePicture(){this.fileToUpload?(this.uploadDisabled=!0,this.dataService.uploadPicture(this.fileToUpload).then(e=>{e&&e.url?this.contact.avatarUrl=e.url:e&&e.error&&alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later)."),this.uploadDisabled=!1,this.fileToUpload=null,this.fileUploadInput.nativeElement.value=null}).catch(()=>{alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later)."),this.uploadDisabled=!1,this.fileToUpload=null,this.fileUploadInput.nativeElement.value=null})):alert(this.translateService.instant("note-add.no-picture-selected"))}isNotCordova(){return this.navCtrl.isNotCordova()}upload(){var e=this;return(0,l.Z)(function*(){yield(yield e.actionSheetController.create({header:e.translateService.instant("common.select-image-source"),buttons:[{text:e.translateService.instant("common.load-from-gallery"),handler:()=>{e.doUpload(e.camera.PictureSourceType.PHOTOLIBRARY)}},{text:e.translateService.instant("common.use-camera"),handler:()=>{e.doUpload(e.camera.PictureSourceType.CAMERA)}},{text:e.translateService.instant("common.cancel"),role:"cancel"}]})).present()})()}doUpload(e){var o=this;return(0,l.Z)(function*(){o.uploadDisabled=!0,o.camera.getPicture({quality:100,sourceType:e,destinationType:o.camera.DestinationType.DATA_URL,encodingType:o.camera.EncodingType.JPEG,mediaType:o.camera.MediaType.PICTURE}).then(function(){var c=(0,l.Z)(function*(s){const m=s,f=yield o.navCtrl.loading();o.dataService.uploadPictureBase64(m).then(function(){var u=(0,l.Z)(function*(p){yield f.dismiss(),p&&p.url?(o.contact.avatarUrl=p.url,o.uploadDisabled=!1,o.fileToUpload=null,o.fileUploadInput.nativeElement.value=null):p&&p.error&&alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later)."),o.uploadDisabled=!1});return function(p){return u.apply(this,arguments)}}()).catch(function(){var u=(0,l.Z)(function*(p){yield f.dismiss(),console.error(p)});return function(p){return u.apply(this,arguments)}}())});return function(s){return c.apply(this,arguments)}}())})()}showSearchStaff(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("contact-add-search-staff");const o=function(){var i=(0,l.Z)(function*(c){const s=c;s&&(e.staffSelected=s,e.contact.staffId=s.id)});return function(s){return i.apply(this,arguments)}}();e.navCtrl.push("/staff",{callback:o,searchMode:!0})})()}showBusinessTypes(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("contact-add-search-business-type");const o=function(){var i=(0,l.Z)(function*(c){const s=c;s&&(e.businessTypeSelected=s,e.contact.businessTypeId=s.id)});return function(s){return i.apply(this,arguments)}}();e.navCtrl.push("/business-type",{callback:o,searchMode:!0})})()}showSalesLines(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("contact-add-search-sales-line");const o=function(){var i=(0,l.Z)(function*(c){const s=c;s&&(e.salesLineSelected=s,e.contact.salesLineId=s.id)});return function(s){return i.apply(this,arguments)}}();e.navCtrl.push("/sales-line",{callback:o,searchMode:!0})})()}removeStaff(){this.staffSelected=null,this.contact.staffId=0}removeSalesLine(){this.salesLineSelected=null,this.contact.salesLineId=0}removeBusinessType(){this.businessTypeSelected=null,this.contact.businessTypeId=0}changePhone(){var e=this;return(0,l.Z)(function*(){if(!e.contact.mobile)return;const o=yield e.contactService.searchContactByPhone(e.contact.mobile);if(o){const i=e.translateService.instant("contact-add.found-phone",{contact:o.fullName,mobile:o.mobile});alert(i)}})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(ye.V1),t.Y36(V.$),t.Y36(Ie.K),t.Y36(U.y),t.Y36(b.sK),t.Y36(ke.D),t.Y36(P.x),t.Y36(r.BX),t.Y36(r.t4),t.Y36(r.yF),t.Y36(w.y),t.Y36(r.Br))},n.\u0275cmp=t.Xpm({type:n,selectors:[["contact-quick-add"]],viewQuery:function(e,o){if(1&e&&t.Gf(De,5),2&e){let i;t.iGM(i=t.CRH())&&(o.fileUploadInput=i.first)}},decls:60,vars:41,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],["size","12","size-md",""],["position","stacked","color","primary"],["clearInput","","type","text","placeholder","Vd: John London",2,"background-color","#efefef","border-radius","5px","color","#000",3,"ngModel","ngModelChange"],["clearInput","","type","tel","placeholder","Vd: 09123456789",2,"background-color","#efefef","border-radius","5px","color","#000",3,"ngModel","ngModelChange"],["style","padding-top: 10px",4,"ngIf"],["color","secondary","style","padding-top: 10px",3,"click",4,"ngIf"],["color","primary","for","files","style","padding-top: 10px",4,"ngIf"],["type","file","accept","image/*","id","files","style","width: 0; height: 0; font-size: 0;",3,"change",4,"ngIf"],["clearInput","","type","text","placeholder","Vd: Ha Noi",2,"background-color","#efefef","border-radius","5px","color","#000",3,"ngModel","ngModelChange"],["size","12","size-md","",4,"ngIf"],[4,"ngIf"],["fill","outline","expand","block","color","secondary",3,"click"],["name","ellipsis-horizontal"],["fill","outline","expand","block","color","primary","tabindex","5",3,"disabled","click"],["fill","outline","expand","block","tabindex","6",3,"click"],["name","close"],[4,"ngFor","ngForOf"],[2,"padding-top","10px"],[2,"max-width","150px",3,"src"],["color","secondary",2,"padding-top","10px",3,"click"],["name","camera"],["color","primary","for","files",2,"padding-top","10px"],["type","file","accept","image/*","id","files",2,"width","0","height","0","font-size","0",3,"change"],["fileUploadInput",""],["clearInput","","type","email","placeholder","abc@email.com",2,"background-color","#efefef","border-radius","5px","color","#000",3,"ngModel","ngModelChange"],["size","4","size-md","",4,"ngIf"],["size","4","size-md",""],[3,"ngModel","ngModelChange"],["value",""],["value","male"],["value","female"],["color","primary"],["pickerId","contactBd2Picker",3,"date","dateChange",4,"ngIf"],[3,"click",4,"ngIf"],["fill","outline",3,"click",4,"ngIf"],["ion-text","","color","dark",3,"click",4,"ngIf"],["size","small",3,"click",4,"ngIf"],["size","small","fill","clear",3,"click",4,"ngIf"],["ion-text","","color","dark",3,"click"],["size","small",3,"click"],["size","small","fill","clear",3,"click"],["slot","icon-only","name","close"],["pickerId","contactBd2Picker",3,"date","dateChange"],[3,"click"],["fill","outline",3,"click"],[3,"src"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save(!0,!1)}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-grid")(14,"ion-row")(15,"ion-col",5)(16,"ion-label",6),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"ion-input",7),t.NdJ("ngModelChange",function(c){return o.contact.fullName=c}),t.qZA()(),t.TgZ(20,"ion-col",5)(21,"ion-label",6),t._uU(22),t.ALo(23,"translate"),t.qZA(),t.TgZ(24,"ion-input",8),t.NdJ("ngModelChange",function(c){return o.contact.mobile=c})("ngModelChange",function(){return o.changePhone()}),t.qZA()(),t.TgZ(25,"ion-col",5)(26,"ion-label",6),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.YNc(29,we,3,1,"span",9),t._UZ(30,"br"),t.YNc(31,Je,4,3,"ion-button",10),t.YNc(32,Qe,5,2,"label",11),t.YNc(33,Me,2,0,"input",12),t.qZA(),t.TgZ(34,"ion-col",5)(35,"ion-label",6),t._uU(36),t.ALo(37,"translate"),t.qZA(),t.TgZ(38,"ion-input",13),t.NdJ("ngModelChange",function(c){return o.contact.address=c}),t.qZA()(),t.YNc(39,Fe,5,4,"ion-col",14),t.qZA()(),t.YNc(40,We,48,36,"ion-grid",15),t.TgZ(41,"ion-grid")(42,"ion-row")(43,"ion-col")(44,"ion-button",16),t.NdJ("click",function(){return o.isExtend=!o.isExtend}),t._UZ(45,"ion-icon",17),t._uU(46),t.ALo(47,"translate"),t.qZA()(),t.TgZ(48,"ion-col")(49,"ion-button",18),t.NdJ("click",function(){return o.save(!1,!0)}),t._UZ(50,"ion-icon",4),t._uU(51),t.ALo(52,"translate"),t.qZA()(),t.TgZ(53,"ion-col")(54,"ion-button",19),t.NdJ("click",function(){return o.navCtrl.back()}),t._UZ(55,"ion-icon",20),t._uU(56),t.ALo(57,"translate"),t.qZA()()()(),t.TgZ(58,"ion-list"),t.YNc(59,tn,10,5,"ion-item",21),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,23,"contact-add.title")),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij(" ",t.lcZ(11,25,"action.save")," "),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(5),t.Oqu(t.lcZ(18,27,"contact-add.full-name")),t.xp6(2),t.Q6J("ngModel",o.contact.fullName),t.xp6(3),t.Oqu(t.lcZ(23,29,"contact-add.phone")),t.xp6(2),t.Q6J("ngModel",o.contact.mobile),t.xp6(3),t.Oqu(t.lcZ(28,31,"contact-add.photo")),t.xp6(2),t.Q6J("ngIf",o.contact.avatarUrl),t.xp6(2),t.Q6J("ngIf",!o.isNotCordova()),t.xp6(1),t.Q6J("ngIf",o.isNotCordova()),t.xp6(1),t.Q6J("ngIf",o.isNotCordova()),t.xp6(3),t.Oqu(t.lcZ(37,33,"contact-add.address")),t.xp6(2),t.Q6J("ngModel",o.contact.address),t.xp6(1),t.Q6J("ngIf",o.isExtend),t.xp6(1),t.Q6J("ngIf",o.isExtend),t.xp6(6),t.hij("\xa0 ",t.lcZ(47,35,"product-add.extend")," "),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij("\xa0 ",t.lcZ(52,37,"product-add.save-continue")," "),t.xp6(5),t.hij("\xa0 ",t.lcZ(57,39,"product-add.close")," "),t.xp6(3),t.Q6J("ngForOf",o.contactsAdded))},dependencies:[v.sg,v.O5,I.JJ,I.On,r.BJ,r.oU,r.YG,r.Sm,r.wI,r.W2,r.jY,r.Gu,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.Nd,r.t9,r.n0,r.yW,r.wd,r.ho,r.sr,r.w,r.QI,r.j9,r.cs,Ne.L,b.X$],encapsulation:2}),n})();var z=_(6026),W=_(9645),R=_(6961),X=_(7613);function nn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",17),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.presentActionSheet())}),t._UZ(1,"ion-icon",18),t.qZA()}}function on(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item",19)(1,"ion-label",9),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-toggle",20),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.customerPrice.isCollaboratorPrice=i)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"customer-price-add.is-collaborator-price")),t.xp6(2),t.Q6J("ngModel",e.customerPrice.isCollaboratorPrice)}}function cn(n,a){1&n&&(t.TgZ(0,"ion-item")(1,"p",21),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n&&(t.xp6(2),t.hij(" *",t.lcZ(3,1,"customer-price-add.collaborator-price-description")," "))}function an(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchStaff())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.staffSelected.name," ")}}function rn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchStaff())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-price-add.select-staff")," "))}function sn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",27),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeStaff())}),t._UZ(1,"ion-icon",28),t.qZA()}}function ln(n,a){if(1&n&&(t.TgZ(0,"ion-item",19)(1,"ion-text",9),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,an,2,1,"ion-text",22),t.YNc(5,rn,3,3,"ion-text",23),t.YNc(6,sn,2,0,"ion-button",24),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"customer-price-add.staff")),t.xp6(2),t.Q6J("ngIf",e.staffSelected&&e.staffSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.staffSelected||0==e.staffSelected.id),t.xp6(1),t.Q6J("ngIf",e.staffSelected&&e.staffSelected.id>0)}}function dn(n,a){1&n&&(t.TgZ(0,"ion-item")(1,"p",21),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n&&(t.xp6(2),t.hij(" *",t.lcZ(3,1,"customer-price-add.staff-price-description")," "))}function _n(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",25),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchContact())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.contactSelected.fullName," ")}}function un(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",26),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchContact())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-price-add.select-contact")," "))}function pn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",27),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeContact())}),t._UZ(1,"ion-icon",28),t.qZA()}}function mn(n,a){if(1&n&&(t.TgZ(0,"ion-item",19)(1,"ion-text",9),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,_n,2,1,"ion-text",22),t.YNc(5,un,3,3,"ion-text",23),t.YNc(6,pn,2,0,"ion-button",24),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"customer-price-add.contact")),t.xp6(2),t.Q6J("ngIf",e.contactSelected&&e.contactSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.contactSelected||0==e.contactSelected.id),t.xp6(1),t.Q6J("ngIf",e.contactSelected&&e.contactSelected.id>0)}}function fn(n,a){1&n&&(t.TgZ(0,"ion-item")(1,"p",21),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n&&(t.xp6(2),t.hij(" *",t.lcZ(3,1,"customer-price-add.contact-price-description")," "))}function hn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.showSearchProduct())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.productName(e.productSelected.code,e.productSelected.title)," ")}}function Cn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.showSearchProduct())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-price-add.select-product")," "))}function gn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.removeProduct())}),t._UZ(1,"ion-icon",28),t.qZA()}}const xn=function(n,a,e){return[n,a,"symbol","1.0-2",e]};function Zn(n,a){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-label",31),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"currency"),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"customer-price-add.original-price"),": ",t.G7q(4,4,t.kEZ(10,xn,e.productSelected.price,e.currency,e.translateService.currentLang))," ")}}function vn(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.hij("(",e.currency,")")}}function An(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.presentActionSheet())}),t._UZ(1,"ion-icon",14),t.qZA()}}function Tn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item",15)(1,"ion-label",16),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-toggle",9),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.customerDiscount.isCollaboratorPrice=i)}),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"customer-discount-add.is-collaborator-discount")),t.xp6(2),t.Q6J("ngModel",e.customerDiscount.isCollaboratorPrice)}}function Sn(n,a){1&n&&(t.TgZ(0,"ion-item")(1,"p",17),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n&&(t.xp6(2),t.hij(" *",t.lcZ(3,1,"customer-discount-add.collaborator-discount-description")," "))}function yn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchStaff())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.staffSelected.name," ")}}function In(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",22),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchStaff())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-discount-add.select-staff")," "))}function kn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",23),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeStaff())}),t._UZ(1,"ion-icon",24),t.qZA()}}function Nn(n,a){if(1&n&&(t.TgZ(0,"ion-item",15)(1,"ion-text",16),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,yn,2,1,"ion-text",18),t.YNc(5,In,3,3,"ion-text",19),t.YNc(6,kn,2,0,"ion-button",20),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"customer-discount-add.staff")),t.xp6(2),t.Q6J("ngIf",e.staffSelected&&e.staffSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.staffSelected||0==e.staffSelected.id),t.xp6(1),t.Q6J("ngIf",e.staffSelected&&e.staffSelected.id>0)}}function Dn(n,a){1&n&&(t.TgZ(0,"ion-item")(1,"p",17),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&n&&(t.xp6(2),t.hij(" *",t.lcZ(3,1,"customer-discount-add.staff-discount-description")," "))}function wn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchContact())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.contactSelected.fullName," ")}}function Jn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",22),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchContact())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-discount-add.select-contact")," "))}function Un(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",23),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeContact())}),t._UZ(1,"ion-icon",24),t.qZA()}}function qn(n,a){if(1&n&&(t.TgZ(0,"ion-item")(1,"ion-text",16),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,wn,2,1,"ion-text",18),t.YNc(5,Jn,3,3,"ion-text",19),t.YNc(6,Un,2,0,"ion-button",20),t.qZA()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"customer-discount-add.contact")),t.xp6(2),t.Q6J("ngIf",e.contactSelected&&e.contactSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.contactSelected||0==e.contactSelected.id),t.xp6(1),t.Q6J("ngIf",e.contactSelected&&e.contactSelected.id>0&&e.isNew)}}function Qn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",28),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchProduct())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.productName(e.productSelected.code,e.productSelected.title)," ")}}function Mn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchProduct())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-discount-add.select-product")," "))}function Fn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeProduct())}),t._UZ(1,"ion-icon",24),t.qZA()}}function Pn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.scan())}),t._UZ(1,"ion-icon",31),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&n&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"product.scan-barcode")," "))}function Yn(n,a){if(1&n&&(t.TgZ(0,"ion-item",15)(1,"ion-text",16),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,Qn,2,1,"ion-text",25),t.YNc(5,Mn,3,3,"ion-text",26),t.TgZ(6,"ion-buttons",2),t.YNc(7,Fn,2,0,"ion-button",27),t.YNc(8,Pn,4,3,"ion-button",27),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"customer-discount-add.product")),t.xp6(2),t.Q6J("ngIf",e.productSelected&&e.productSelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.productSelected||0==e.productSelected.id),t.xp6(2),t.Q6J("ngIf",e.productSelected&&e.productSelected.id>0),t.xp6(1),t.Q6J("ngIf",e.isNew)}}const Ln=function(n,a,e){return[n,a,"symbol","1.0-2",e]};function On(n,a){if(1&n&&(t.TgZ(0,"ion-item",15)(1,"ion-label",32),t._uU(2),t.ALo(3,"translate"),t.ALo(4,"currency"),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"customer-discount-add.original-price"),": ",t.G7q(4,4,t.kEZ(10,Ln,e.productSelected.price,e.currency.code,e.translateService.currentLang))," ")}}function En(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",28),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchCategory())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw(2);t.xp6(1),t.hij(" ",e.categorySelected.title," ")}}function Gn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-text",29),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.showSearchCategory())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"customer-discount-add.select-category")," "))}function Hn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",30),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.removeCategory())}),t._UZ(1,"ion-icon",24),t.qZA()}}function Kn(n,a){if(1&n&&(t.TgZ(0,"ion-item",15)(1,"ion-text",16),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,En,2,1,"ion-text",25),t.YNc(5,Gn,3,3,"ion-text",26),t.TgZ(6,"ion-buttons",2),t.YNc(7,Hn,2,0,"ion-button",27),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,4,"customer-discount-add.category")),t.xp6(2),t.Q6J("ngIf",e.categorySelected&&e.categorySelected.id>0),t.xp6(1),t.Q6J("ngIf",!e.categorySelected||0==e.categorySelected.id),t.xp6(2),t.Q6J("ngIf",e.categorySelected&&e.categorySelected.id>0)}}function jn(n,a){if(1&n&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.AsE("(",e.currency.symbol_native," - ",e.currency.code,")")}}function Bn(n,a){1&n&&(t.TgZ(0,"span"),t._uU(1,"(%)"),t.qZA())}function $n(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"money-input",33),t.NdJ("moneyValueChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.customerDiscount.discountValue=i)}),t.ALo(1,"translate"),t.qZA()}if(2&n){const e=t.oxw();t.s9C("placeholder",t.lcZ(1,3,"customer-discount-add.enter-discount")),t.Q6J("clear",!0)("moneyValue",e.customerDiscount.discountValue)}}function Vn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-input",34),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.customerDiscount.discountValue=i)})("focus",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.selectAll(i))}),t.ALo(1,"translate"),t.qZA()}if(2&n){const e=t.oxw();t.s9C("placeholder",t.lcZ(1,2,"customer-discount-add.enter-discount-percent")),t.Q6J("ngModel",e.customerDiscount.discountValue)}}function zn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",8),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",34),t.NdJ("ngModelChange",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.customerDiscount.conditionQuantity=i)})("focus",function(i){t.CHM(e);const c=t.oxw();return t.KtG(c.selectAll(i))}),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"p",17),t._uU(7),t.ALo(8,"translate"),t.qZA()()}if(2&n){const e=t.oxw();t.xp6(2),t.hij(" ",t.lcZ(3,4,"customer-discount-add.quantity-condition")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(5,6,"customer-discount-add.enter-quantity-condition")),t.Q6J("ngModel",e.customerDiscount.conditionQuantity),t.xp6(3),t.hij(" *",t.lcZ(8,8,"customer-discount-add.quantity-condition-description")," ")}}function Rn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",12),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.showLevels())}),t._uU(1),t.qZA()}if(2&n){const e=t.oxw();t.xp6(1),t.hij(" ",e.levelSelected.title," ")}}function Xn(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.showLevels())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&n&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"contact-add.select-level")," "))}function to(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const i=t.oxw();return t.KtG(i.removeLevel())}),t._UZ(1,"ion-icon",15),t.qZA()}}function no(n,a){1&n&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-add.selected")))}function oo(n,a){if(1&n&&(t.TgZ(0,"ion-text",13),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.AsE("",t.lcZ(2,2,"contact-add.selected")," (",e.totalSelected,")")}}function io(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-col",18)(1,"ion-label",19),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"br"),t.TgZ(5,"ion-buttons",20)(6,"ion-button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.previousPage())}),t._UZ(7,"ion-icon",22),t.qZA(),t.TgZ(8,"ion-button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.nextPage())}),t._UZ(9,"ion-icon",23),t.qZA()()()}if(2&n){const e=t.oxw(2);t.xp6(2),t.AsE("",t.lcZ(3,2,"common.page")," ",e.currentPage+1," ")}}function co(n,a){if(1&n&&(t.TgZ(0,"ion-grid")(1,"ion-row",14)(2,"ion-col",15)(3,"ion-item",16),t._uU(4),t.ALo(5,"translate"),t.ALo(6,"translate"),t.qZA()(),t.YNc(7,io,10,4,"ion-col",17),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("size",e.isShowPaging&&e.contacts&&e.contacts.length?8:12),t.xp6(2),t.lnq(" ",t.lcZ(5,5,"common.total"),": ",e.contacts&&e.contacts.length?e.contacts.length:0," ",t.lcZ(6,7,"contact.contact(s)")," "),t.xp6(3),t.Q6J("ngIf",e.isShowPaging&&e.contacts&&e.contacts.length)}}function ao(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.label,": ",e.number," ")}}function ro(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.label,": ",e.address," ")}}function so(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-checkbox",7),t.NdJ("ngModelChange",function(i){const s=t.CHM(e).$implicit;return t.KtG(s.selected=i)})("ngModelChange",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectContact(c))}),t.qZA(),t.TgZ(2,"ion-avatar",0),t._UZ(3,"img",25),t.qZA(),t.TgZ(4,"ion-label",26)(5,"h2"),t._uU(6),t.qZA(),t.TgZ(7,"p")(8,"b"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._uU(11),t.qZA(),t.TgZ(12,"p")(13,"b"),t._uU(14),t.ALo(15,"translate"),t.qZA()(),t.YNc(16,ao,2,2,"p",24),t.TgZ(17,"p")(18,"b"),t._uU(19),t.ALo(20,"translate"),t.qZA()(),t.YNc(21,ro,2,2,"p",24),t.qZA()()}if(2&n){const e=a.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngModel",e.selected),t.xp6(2),t.Q6J("src",o.contactImageOrPlaceholder(e.photoThumbnail),t.LSH),t.xp6(3),t.Oqu(e.displayName),t.xp6(3),t.hij("",t.lcZ(10,9,"contact-add.DOB"),":"),t.xp6(2),t.hij(" ",o.dateFormat(e.birthday),""),t.xp6(3),t.hij("",t.lcZ(15,11,"contact-add.phone"),":"),t.xp6(2),t.Q6J("ngForOf",e.phoneNumbers),t.xp6(3),t.hij("",t.lcZ(20,13,"contact-add.email"),":"),t.xp6(2),t.Q6J("ngForOf",e.emails)}}function lo(n,a){if(1&n&&(t.TgZ(0,"ion-list"),t.YNc(1,so,22,15,"ion-item",24),t.ALo(2,"slice"),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",t.Dn7(2,1,e.contacts,e.start,e.end+1))}}function _o(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-col",18)(1,"ion-label",19),t._uU(2),t.ALo(3,"translate"),t.qZA(),t._UZ(4,"br"),t.TgZ(5,"ion-buttons",20)(6,"ion-button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.previousPage())}),t._UZ(7,"ion-icon",22),t.qZA(),t.TgZ(8,"ion-button",21),t.NdJ("click",function(){t.CHM(e);const i=t.oxw(2);return t.KtG(i.nextPage())}),t._UZ(9,"ion-icon",23),t.qZA()()()}if(2&n){const e=t.oxw(2);t.xp6(2),t.AsE("",t.lcZ(3,2,"common.page")," ",e.currentPage+1," ")}}function uo(n,a){if(1&n&&(t.TgZ(0,"ion-grid")(1,"ion-row",14)(2,"ion-col",15)(3,"ion-item",16),t._uU(4),t.ALo(5,"translate"),t.ALo(6,"translate"),t.qZA()(),t.YNc(7,_o,10,4,"ion-col",17),t.qZA()()),2&n){const e=t.oxw();t.xp6(2),t.Q6J("size",e.isShowPaging&&e.contacts&&e.contacts.length?8:12),t.xp6(2),t.lnq(" ",t.lcZ(5,5,"common.total"),": ",e.contacts&&e.contacts.length?e.contacts.length:0," ",t.lcZ(6,7,"contact.contact(s)")," "),t.xp6(3),t.Q6J("ngIf",e.isShowPaging&&e.contacts&&e.contacts.length)}}function po(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.label,": ",e.number," ")}}function mo(n,a){if(1&n&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&n){const e=a.$implicit;t.xp6(1),t.AsE(" ",e.label,": ",e.address," ")}}function fo(n,a){if(1&n){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-checkbox",7),t.NdJ("ngModelChange",function(i){const s=t.CHM(e).$implicit;return t.KtG(s.selected=i)})("ngModelChange",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.deSelectContact(c))}),t.qZA(),t.TgZ(2,"ion-avatar",0),t._UZ(3,"img",25),t.qZA(),t.TgZ(4,"ion-label",26)(5,"h2"),t._uU(6),t.qZA(),t.TgZ(7,"p")(8,"b"),t._uU(9),t.ALo(10,"translate"),t.qZA(),t._uU(11),t.qZA(),t.TgZ(12,"p")(13,"b"),t._uU(14),t.ALo(15,"translate"),t.qZA()(),t.YNc(16,po,2,2,"p",24),t.TgZ(17,"p")(18,"b"),t._uU(19),t.ALo(20,"translate"),t.qZA()(),t.YNc(21,mo,2,2,"p",24),t.qZA()()}if(2&n){const e=a.$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("ngModel",e.selected),t.xp6(2),t.Q6J("src",o.contactImageOrPlaceholder(e.photoThumbnail),t.LSH),t.xp6(3),t.Oqu(e.displayName),t.xp6(3),t.hij("",t.lcZ(10,9,"contact-add.DOB"),":"),t.xp6(2),t.hij(" ",o.dateFormat(e.birthday),""),t.xp6(3),t.hij("",t.lcZ(15,11,"contact-add.phone"),":"),t.xp6(2),t.Q6J("ngForOf",e.phoneNumbers),t.xp6(3),t.hij("",t.lcZ(20,13,"contact-add.email"),":"),t.xp6(2),t.Q6J("ngForOf",e.emails)}}function ho(n,a){if(1&n&&(t.TgZ(0,"ion-list"),t.YNc(1,fo,22,15,"ion-item",24),t.qZA()),2&n){const e=t.oxw();t.xp6(1),t.Q6J("ngForOf",e.selectedContacts)}}const Co=[{path:"",component:dt},{path:"add",component:ut},{path:"quick-add",component:en},{path:"detail",component:fe},{path:"import",component:Se},{path:"add-price",component:(()=>{class n{constructor(e,o,i,c,s,m,f,u,p,x,k){this.navCtrl=e,this.barcodeScanner=o,this.actionSheetCtrl=i,this.modalCtrl=c,this.staffService=s,this.contactService=m,this.productService=f,this.analyticsService=u,this.translateService=p,this.alertCtrl=x,this.userService=k,this.params=null,this.customerPrice={isCollaboratorPrice:!1},this.oldCustomerPrice=null,this.isNew=!0,this.saveDisabled=!1,this.onKeyPress=A=>{!A.target||"body"!==A.target.localName||("s"===A.key||"S"===A.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ngOnInit(){var e=this;return(0,l.Z)(function*(){e.currency=yield e.userService.getAttr("current-currency"),e.customerPrice={isCollaboratorPrice:!1};const o=e.params?e.params:e.navCtrl.getParams();e.params=o;let i=0,c=0,s=0,m=0;if(o&&(o&&o.id?(i=o.id,e.isNew=!1):o&&o.contact?c=+o.contact:o&&o.product?s=+o.product:o&&o.collaborator&&(m=+o.collaborator)),i&&i>0){const f=yield e.navCtrl.loading();e.contactService.getCustomerPrice(i).then(function(){var u=(0,l.Z)(function*(p){yield f.dismiss(),e.contactSelected=p.contact,e.productSelected=p.product,e.staffSelected=p.staff,e.customerPrice=p,e.oldCustomerPrice=JSON.parse(JSON.stringify(p))});return function(p){return u.apply(this,arguments)}}())}else c&&c>0?e.contactService.get(c).then(f=>{e.contactSelected=f,e.customerPrice.contactId=f.id}):s&&s>0?e.productService.get(s,0).then(f=>{e.productSelected=f,e.customerPrice.productId=f.id,e.customerPrice.value=f.price}):m&&m>0&&e.staffService.get(m).then(f=>{e.staffSelected=f,e.customerPrice.collaboratorId=f.id})})()}showSearchStaff(){var e=this;return(0,l.Z)(function*(){e.navCtrl.push("/staff",{callback:i=>{const c=i;c&&(e.staffSelected=c,e.customerPrice.collaboratorId=c.id)},searchMode:!0})})()}showSearchContact(){var e=this;return(0,l.Z)(function*(){e.navCtrl.push("/contact",{callback:i=>{const c=i;c&&(e.contactSelected=c,e.customerPrice.contactId=c.id)},searchMode:!0})})()}showSearchProduct(){var e=this;return(0,l.Z)(function*(){e.navCtrl.push("/product",{callback:i=>{const c=i;c&&(e.productSelected=c,e.customerPrice.productId=c.id,e.customerPrice.price=c.price)},searchMode:!0})})()}save(){var e=this;return(0,l.Z)(function*(){e.doSave()})()}doSave(){var e=this;return(0,l.Z)(function*(){if(!e.staffSelected&&!e.contactSelected&&!e.customerPrice.isCollaboratorPrice)return void alert(e.translateService.instant("customer-price-add.no-owner-alert"));if(!e.productSelected)return void alert(e.translateService.instant("customer-price-add.no-product-alert"));if(e.customerPrice&&!e.customerPrice.price)return void alert(e.translateService.instant("customer-price-add.no-price-alert"));e.saveDisabled=!0;const o=yield e.navCtrl.loading();e.contactService.saveCustomerPrice(e.customerPrice).then((0,l.Z)(function*(){e.analyticsService.logEvent("customer-price-add-save-success");const i=[Promise.resolve(1)];if(e.contactSelected){const c=e.saveLastActive();i.push(c)}Promise.all(i).then((0,l.Z)(function*(){yield o.dismiss(),e.exitPage()}))}))})()}saveLastActive(){if(this.contactSelected)return this.contactSelected.lastActive=C.C.toDbString(),this.contactSelected.lastAction="note",this.contactService.saveContact(this.contactSelected).then(o=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.contactSelected),this.navCtrl.publish("reloadContactPrice",this.contactSelected.id),o))}exitPage(){var e=this;return(0,l.Z)(function*(){e.customerPrice.contact&&0!=e.customerPrice.contact.id&&e.navCtrl.publish("reloadContact",e.contactSelected),e.staffSelected&&e.navCtrl.publish("reloadStaff",e.staffSelected),e.productSelected&&e.navCtrl.publish("reloadProduct",e.productSelected),yield e.navCtrl.popOnly()})()}removeContact(){this.contactSelected=null,this.customerPrice.contactId=0}removeStaff(){this.staffSelected=null,this.customerPrice.collaboratorId=0}removeProduct(){this.productSelected=null,this.customerPrice.productId=0,this.customerPrice.price=0}dateFormat(e){return C.C.toUiDateString(e)}productName(e,o){return Z.W.productName(e,o)}selectAll(e){Z.W.selectAll(e)}scan(){var e=this;return(0,l.Z)(function*(){if(e.analyticsService.logEvent("customer-price-add-scan-barcode"),e.navCtrl.isNotCordova()){const o=yield e.modalCtrl.create({component:z.k});yield o.present();const{data:i}=yield o.onDidDismiss();i&&i.barcode&&e.checkBarcodeScaned(i.barcode)}else e.barcodeScanner.scan().then(o=>{!o||!o.text||e.checkBarcodeScaned(o.text)})})()}checkBarcodeScaned(e){var o=this;this.productService.searchByBarcode(e).then(function(){var i=(0,l.Z)(function*(c){!c||(o.productSelected=c,o.customerPrice.productId=c.id)});return function(c){return i.apply(this,arguments)}}())}addZerosToNumber(e){let o="";for(let i=0;i<e;i++)o+="0";if(this.customerPrice&&this.customerPrice.value){let i=this.customerPrice.price.toString();i+=o,this.customerPrice.price=Number(i)}}presentActionSheet(){var e=this;return(0,l.Z)(function*(){const o=[{text:e.translateService.instant("customer-price-add.delete"),role:"destructive",handler:()=>{e.delete()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}];yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:o})).present()})()}delete(){var e=this;return(0,l.Z)(function*(){e.isNew||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("customer-price-add.delete-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.contactService.deleteCustomerPrice(e.customerPrice).then((0,l.Z)(function*(){e.analyticsService.logEvent("customer-price-delete-success"),e.navCtrl.pop(),e.navCtrl.publish("reloadContactList"),e.navCtrl.publish("reloadContact",e.contactSelected),e.navCtrl.publish("reloadContactPrice",e.contactSelected.id)}))}}]})).present())})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(W.m),t.Y36(r.BX),t.Y36(r.IN),t.Y36(P.x),t.Y36(U.y),t.Y36(R.M),t.Y36(w.y),t.Y36(b.sK),t.Y36(r.Br),t.Y36(F.K))},n.\u0275cmp=t.Xpm({type:n,selectors:[["customer-price-add"]],decls:41,vars:36,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],["color","primary",3,"click",4,"ngIf"],["lines","none",4,"ngIf"],[4,"ngIf"],[3,"lines"],["color","primary"],["color","dark","slot","end","class","ion-text-wrap",3,"click",4,"ngIf"],["slot","end","class","ion-text-wrap",3,"click",4,"ngIf"],["fill","outline",3,"click",4,"ngIf"],["fill","outline",3,"click"],["name","barcode"],["position","stacked","color","primary"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["color","primary",3,"click"],["name","ellipsis-vertical"],["lines","none"],[3,"ngModel","ngModelChange"],[2,"font-size","0.8em"],["color","dark","slot","end",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["fill","outline","slot","end",3,"click",4,"ngIf"],["color","dark","slot","end",3,"click"],["slot","end",3,"click"],["fill","outline","slot","end",3,"click"],["name","close"],["color","dark","slot","end",1,"ion-text-wrap",3,"click"],["slot","end",1,"ion-text-wrap",3,"click"],[1,"ion-text-wrap"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.YNc(12,nn,2,0,"ion-button",5),t.qZA()()(),t.TgZ(13,"ion-content")(14,"ion-list"),t.YNc(15,on,5,4,"ion-item",6),t.YNc(16,cn,4,3,"ion-item",7),t.YNc(17,ln,7,6,"ion-item",6),t.YNc(18,dn,4,3,"ion-item",7),t.YNc(19,mn,7,6,"ion-item",6),t.YNc(20,fn,4,3,"ion-item",7),t.TgZ(21,"ion-item",8)(22,"ion-text",9),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.YNc(25,hn,2,1,"ion-text",10),t.YNc(26,Cn,3,3,"ion-text",11),t.TgZ(27,"ion-buttons",2),t.YNc(28,gn,2,0,"ion-button",12),t.TgZ(29,"ion-button",13),t.NdJ("click",function(){return o.scan()}),t._UZ(30,"ion-icon",14),t._uU(31),t.ALo(32,"translate"),t.qZA()()(),t.YNc(33,Zn,5,14,"ion-item",7),t.TgZ(34,"ion-item")(35,"ion-label",15),t._uU(36),t.ALo(37,"translate"),t.YNc(38,vn,2,1,"span",7),t.qZA(),t.TgZ(39,"money-input",16),t.NdJ("moneyValueChange",function(c){return o.customerPrice.price=c}),t.ALo(40,"translate"),t.qZA()()()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,24,"customer-price-add.title")),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij(" \xa0",t.lcZ(11,26,"action.save")," "),t.xp6(2),t.Q6J("ngIf",!o.isNew),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(2),t.Q6J("ngIf",!o.staffSelected&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.staffSelected&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.customerPrice.isCollaboratorPrice&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.customerPrice.isCollaboratorPrice&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.customerPrice.isCollaboratorPrice&&!o.staffSelected),t.xp6(1),t.Q6J("ngIf",!o.customerPrice.isCollaboratorPrice&&!o.staffSelected),t.xp6(1),t.Q6J("lines",o.productSelected?"none":"inset"),t.xp6(2),t.Oqu(t.lcZ(24,28,"customer-price-add.product")),t.xp6(2),t.Q6J("ngIf",o.productSelected&&o.productSelected.id>0),t.xp6(1),t.Q6J("ngIf",!o.productSelected||0==o.productSelected.id),t.xp6(2),t.Q6J("ngIf",o.productSelected&&o.productSelected.id>0),t.xp6(3),t.hij(" ",t.lcZ(32,30,"product.scan-barcode")," "),t.xp6(2),t.Q6J("ngIf",o.productSelected),t.xp6(3),t.hij("",t.lcZ(37,32,"customer-price-add.price")," "),t.xp6(2),t.Q6J("ngIf",o.currency),t.xp6(1),t.s9C("placeholder",t.lcZ(40,34,"customer-price-add.enter-price")),t.Q6J("clear",!0)("moneyValue",o.customerPrice.price))},dependencies:[v.O5,I.JJ,I.On,r.oU,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.Ie,r.Q$,r.q_,r.yW,r.wd,r.ho,r.sr,r.w,r.cs,X.F,v.H9,b.X$],encapsulation:2}),n})()},{path:"add-discount",component:(()=>{class n{constructor(e,o,i,c,s,m,f,u,p,x,k,A){this.navCtrl=e,this.barcodeScanner=o,this.actionSheetCtrl=i,this.modalCtrl=c,this.staffService=s,this.contactService=m,this.productService=f,this.tradeService=u,this.analyticsService=p,this.translateService=x,this.alertCtrl=k,this.userService=A,this.params=null,this.customerDiscount={type:0,conditionQuantity:0},this.oldCustomerDiscount=null,this.isNew=!0,this.saveDisabled=!1,this.onKeyPress=y=>{!y.target||"body"!==y.target.localName||("s"===y.key||"S"===y.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ngOnInit(){var e=this;return(0,l.Z)(function*(){e.userService.getAttr("current-currency").then(u=>{e.currency=Z.W.getCurrencyByCode(u)}),e.customerDiscount={type:0,conditionQuantity:0};const o=e.params?e.params:e.navCtrl.getParams();e.params=o;let i=0,c=0,s=0,m=0,f=0;if(o&&(o&&o.id?(i=o.id,e.isNew=!1):o&&o.contact?c=+o.contact:o&&o.product?s=+o.product:o&&o.category?m=+o.category:o&&o.staff&&(f=+o.staff)),i&&i>0){const u=yield e.navCtrl.loading();e.contactService.getCustomerDiscount(i).then(function(){var p=(0,l.Z)(function*(x){yield u.dismiss(),e.contactSelected=x.contact,e.productSelected=x.product,e.staffSelected=x.staff,e.categorySelected=x.category,e.customerDiscount=x,e.oldCustomerDiscount=JSON.parse(JSON.stringify(x))});return function(x){return p.apply(this,arguments)}}())}else c&&c>0?e.contactService.get(c).then(u=>{e.contactSelected=u,e.customerDiscount.contactId=u.id}):s&&s>0?e.productService.get(s,0).then(u=>{e.productSelected=u,e.customerDiscount.productId=u.id}):m&&m>0?e.tradeService.getCategory(m).then(u=>{e.categorySelected=u,e.customerDiscount.categoryId=u.id}):f&&f>0&&e.staffService.get(f).then(u=>{e.staffSelected=u,e.customerDiscount.collaboratorId=u.id})})()}showSearchStaff(){var e=this;return(0,l.Z)(function*(){e.navCtrl.push("/staff",{callback:i=>{const c=i;c&&(e.staffSelected=c,e.customerDiscount.collaboratorId=c.id)},searchMode:!0})})()}showSearchCategory(){var e=this;return(0,l.Z)(function*(){const o=function(){var i=(0,l.Z)(function*(c){const s=c;s&&(e.categorySelected=s,e.customerDiscount.categoryId=s.id)});return function(s){return i.apply(this,arguments)}}();e.navCtrl.push("/trade-category",{callback:o,searchMode:!0})})()}showSearchContact(){var e=this;return(0,l.Z)(function*(){e.navCtrl.push("/contact",{callback:i=>{const c=i;c&&(e.contactSelected=c,e.customerDiscount.contactId=c.id)},searchMode:!0})})()}showSearchProduct(){var e=this;return(0,l.Z)(function*(){e.navCtrl.push("/product",{callback:i=>{const c=i;c&&(e.productSelected=c,e.customerDiscount.productId=c.id)},searchMode:!0})})()}save(){var e=this;return(0,l.Z)(function*(){e.doSave()})()}doSave(){var e=this;return(0,l.Z)(function*(){if(e.customerDiscount&&!e.customerDiscount.discountValue)return void alert(e.translateService.instant("customer-discount-add.no-discount-alert"));e.saveDisabled=!0;const o=yield e.navCtrl.loading();e.customerDiscount.categoryId=e.categorySelected?e.categorySelected.id:0,e.contactService.saveCustomerDiscount(e.customerDiscount).then((0,l.Z)(function*(){e.analyticsService.logEvent("customer-discount-add-save-success"),yield e.saveLastActive(),yield o.dismiss(),e.exitPage()}))})()}saveLastActive(){if(this.contactSelected)return this.contactSelected.lastActive=C.C.toDbString(),this.contactSelected.lastAction="note",this.contactService.saveContact(this.contactSelected).then(o=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.contactSelected),this.navCtrl.publish("reloadContactDiscount",this.contactSelected.id),this.navCtrl.publish("reloadProduct",this.productSelected),o))}exitPage(){var e=this;return(0,l.Z)(function*(){e.contactSelected&&e.navCtrl.publish("reloadContact",e.contactSelected),e.categorySelected&&e.navCtrl.publish("reloadCategory",e.categorySelected),e.productSelected&&e.navCtrl.publish("reloadProduct",e.productSelected),e.staffSelected&&e.navCtrl.publish("reloadStaff",e.staffSelected),yield e.navCtrl.popOnly()})()}removeContact(){this.contactSelected=null,this.customerDiscount.contactId=0}removeProduct(){this.productSelected=null,this.customerDiscount.productId=0}removeCategory(){this.categorySelected=null,this.customerDiscount.categoryId=0}removeStaff(){this.staffSelected=null,this.customerDiscount.collaboratorId=0}dateFormat(e){return C.C.toUiDateString(e)}productName(e,o){return Z.W.productName(e,o)}selectAll(e){Z.W.selectAll(e)}scan(){var e=this;return(0,l.Z)(function*(){if(e.analyticsService.logEvent("customer-discount-add-scan-barcode"),e.navCtrl.isNotCordova()){const o=yield e.modalCtrl.create({component:z.k});yield o.present();const{data:i}=yield o.onDidDismiss();i&&i.barcode&&e.checkBarcodeScaned(i.barcode)}else e.barcodeScanner.scan().then(o=>{!o||!o.text||e.checkBarcodeScaned(o.text)})})()}checkBarcodeScaned(e){var o=this;this.productService.searchByBarcode(e).then(function(){var i=(0,l.Z)(function*(c){!c||(o.productSelected=c,o.customerDiscount.productId=c.id)});return function(c){return i.apply(this,arguments)}}())}addZerosToNumber(e){let o="";for(let i=0;i<e;i++)o+="0";if(this.customerDiscount&&this.customerDiscount.value){let i=this.customerDiscount.discountValue.toString();i+=o,this.customerDiscount.discountValue=Number(i)}}presentActionSheet(){var e=this;return(0,l.Z)(function*(){const o=[{text:e.translateService.instant("customer-discount-add.delete"),role:"destructive",handler:()=>{e.delete()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}];yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:o})).present()})()}delete(){var e=this;return(0,l.Z)(function*(){e.isNew||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("customer-discount-add.delete-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.contactService.deleteCustomerDiscount(e.customerDiscount).then((0,l.Z)(function*(){e.analyticsService.logEvent("customer-discount-delete-success"),e.navCtrl.pop(),e.navCtrl.publish("reloadContactList"),e.navCtrl.publish("reloadContact",e.contactSelected),e.navCtrl.publish("reloadContactDiscount",e.contactSelected.id),e.navCtrl.publish("reloadProduct",e.productSelected)}))}}]})).present())})()}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(W.m),t.Y36(r.BX),t.Y36(r.IN),t.Y36(P.x),t.Y36(U.y),t.Y36(R.M),t.Y36($.X),t.Y36(w.y),t.Y36(b.sK),t.Y36(r.Br),t.Y36(F.K))},n.\u0275cmp=t.Xpm({type:n,selectors:[["customer-discount-add"]],decls:43,vars:38,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],["color","primary",3,"click",4,"ngIf"],["lines","none",4,"ngIf"],[4,"ngIf"],["position","stacked","color","primary"],[3,"ngModel","ngModelChange"],[3,"value"],[3,"clear","placeholder","moneyValue","moneyValueChange",4,"ngIf"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus",4,"ngIf"],["color","primary",3,"click"],["name","ellipsis-vertical"],["lines","none"],["color","primary"],[2,"font-size","0.8em"],["color","dark","slot","end",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["fill","outline","slot","end",3,"click",4,"ngIf"],["color","dark","slot","end",3,"click"],["slot","end",3,"click"],["fill","outline","slot","end",3,"click"],["name","close"],["color","dark","slot","end","class","ion-text-wrap",3,"click",4,"ngIf"],["slot","end","class","ion-text-wrap",3,"click",4,"ngIf"],["fill","outline",3,"click",4,"ngIf"],["color","dark","slot","end",1,"ion-text-wrap",3,"click"],["slot","end",1,"ion-text-wrap",3,"click"],["fill","outline",3,"click"],["name","barcode"],[1,"ion-text-wrap"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA(),t.YNc(12,An,2,0,"ion-button",5),t.qZA()()(),t.TgZ(13,"ion-content")(14,"ion-list"),t.YNc(15,Tn,5,4,"ion-item",6),t.YNc(16,Sn,4,3,"ion-item",7),t.YNc(17,Nn,7,6,"ion-item",6),t.YNc(18,Dn,4,3,"ion-item",7),t.YNc(19,qn,7,6,"ion-item",7),t.YNc(20,Yn,9,7,"ion-item",6),t.YNc(21,On,5,14,"ion-item",6),t.YNc(22,Kn,8,6,"ion-item",6),t.TgZ(23,"ion-item")(24,"ion-label",8),t._uU(25),t.ALo(26,"translate"),t.qZA(),t.TgZ(27,"ion-select",9),t.NdJ("ngModelChange",function(c){return o.customerDiscount.type=c}),t.TgZ(28,"ion-select-option",10),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-select-option",10),t._uU(32),t.ALo(33,"translate"),t.qZA()()(),t.TgZ(34,"ion-item")(35,"ion-label",8),t._uU(36),t.ALo(37,"translate"),t.YNc(38,jn,2,2,"span",7),t.YNc(39,Bn,2,0,"span",7),t.qZA(),t.YNc(40,$n,2,5,"money-input",11),t.YNc(41,Vn,2,4,"ion-input",12),t.qZA(),t.YNc(42,zn,9,10,"ion-item",7),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,26,"customer-discount-add.title")),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij(" \xa0",t.lcZ(11,28,"action.save")," "),t.xp6(2),t.Q6J("ngIf",!o.isNew),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(2),t.Q6J("ngIf",!o.staffSelected&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.staffSelected&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.customerDiscount.isCollaboratorPrice&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.customerDiscount.isCollaboratorPrice&&!o.contactSelected),t.xp6(1),t.Q6J("ngIf",!o.customerDiscount.isCollaboratorPrice&&!o.staffSelected),t.xp6(1),t.Q6J("ngIf",!o.categorySelected),t.xp6(1),t.Q6J("ngIf",o.productSelected),t.xp6(1),t.Q6J("ngIf",!o.productSelected),t.xp6(3),t.hij("",t.lcZ(26,30,"customer-discount-add.discount-type")," "),t.xp6(2),t.Q6J("ngModel",o.customerDiscount.type),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.hij("",t.lcZ(30,32,"customer-discount-add.discount-type-money")," "),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.hij("",t.lcZ(33,34,"customer-discount-add.discount-type-percent")," "),t.xp6(4),t.hij("",t.lcZ(37,36,"customer-discount-add.discount")," "),t.xp6(2),t.Q6J("ngIf",o.currency&&0===o.customerDiscount.type),t.xp6(1),t.Q6J("ngIf",1===o.customerDiscount.type),t.xp6(1),t.Q6J("ngIf",0===o.customerDiscount.type),t.xp6(1),t.Q6J("ngIf",1===o.customerDiscount.type),t.xp6(1),t.Q6J("ngIf",o.productSelected))},dependencies:[v.O5,I.JJ,I.On,r.oU,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.t9,r.n0,r.yW,r.wd,r.ho,r.sr,r.w,r.as,r.QI,r.cs,X.F,v.H9,b.X$],encapsulation:2}),n})()},{path:"edit-point",component:(()=>{class n{constructor(e,o,i,c){this.navCtrl=e,this.contactService=o,this.staffService=i,this.analyticsService=c,this.params=null,this.contactPoint={id:0,point:0,levelId:0},this.storageDirectory="",this.isNew=!0,this.saveDisabled=!1,this.onKeyPress=s=>{!s.target||"body"!==s.target.localName||("s"===s.key||"S"===s.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("edit-point")})()}ngOnInit(){var e=this;return(0,l.Z)(function*(){if(e.contactPoint={id:0,point:0,levelId:0},e.params=e.navCtrl.getParams(e.params),e.params&&e.params.id&&e.params.id>0){const o=e.params.id;e.isNew=!1;const i=yield e.navCtrl.loading();e.contactService.get(o).then(function(){var c=(0,l.Z)(function*(s){yield i.dismiss(),e.contactPoint={id:s.id,point:s.point,levelId:s.levelId,staffId:s.staffId},e.levelSelected=s.level});return function(s){return c.apply(this,arguments)}}())}})()}save(){var e=this;return(0,l.Z)(function*(){const o=yield e.navCtrl.loading();e.saveDisabled=!0,e.staffService.isStaff()&&0===e.contactPoint.staffId&&(e.contactPoint.staffId=e.staffService.selectedStaff.id),e.contactService.updatePoint(e.contactPoint).then((0,l.Z)(function*(){e.analyticsService.logEvent("edit-point-save-success"),yield o.dismiss(),e.exitPage()}))})()}dismiss(){var e=this;return(0,l.Z)(function*(){yield e.navCtrl.popOnly()})()}exitPage(){var e=this;return(0,l.Z)(function*(){yield e.navCtrl.popOnly(),e.navCtrl.publish("reloadContactList",{filter:"all"}),e.navCtrl.publish("reloadContact",e.contactPoint)})()}showLevels(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("edit-point-search-level");const o=function(){var i=(0,l.Z)(function*(c){const s=c;s&&(e.levelSelected=s,e.contactPoint.levelId=s.id)});return function(s){return i.apply(this,arguments)}}();e.navCtrl.push("/level-config",{callback:o,searchMode:!0})})()}removeLevel(){this.levelSelected=null,this.contactPoint.levelId=0}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(U.y),t.Y36(P.x),t.Y36(w.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["edit-point"]],decls:29,vars:22,consts:[["slot","start"],["ion-button","",3,"click"],["name","close"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],["position","stacked","color","primary"],["clearInput","","type","text",3,"ngModel","ngModelChange"],["color","primary"],["slot","end","ion-text","","color","dark",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["slot","end","fill","clear",3,"click",4,"ngIf"],["slot","end","ion-text","","color","dark",3,"click"],["slot","end",3,"click"],["slot","end","fill","clear",3,"click"],["slot","icon-only","name","close"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return o.dismiss()}),t._UZ(4,"ion-icon",2),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"ion-title"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"ion-buttons",3)(11,"ion-button",4),t.NdJ("click",function(){return o.save()}),t._UZ(12,"ion-icon",5),t._uU(13),t.ALo(14,"translate"),t.qZA()()()(),t.TgZ(15,"ion-content")(16,"ion-list")(17,"ion-item")(18,"ion-label",6),t._uU(19),t.ALo(20,"translate"),t.qZA(),t.TgZ(21,"ion-input",7),t.NdJ("ngModelChange",function(c){return o.contactPoint.point=c}),t.qZA()(),t.TgZ(22,"ion-item")(23,"ion-text",8),t._uU(24),t.ALo(25,"translate"),t.qZA(),t.YNc(26,Rn,2,1,"ion-button",9),t.YNc(27,Xn,3,3,"ion-button",10),t.YNc(28,to,2,0,"ion-button",11),t.qZA()()()),2&e&&(t.xp6(5),t.hij(" \xa0",t.lcZ(6,12,"common.cancel")," "),t.xp6(3),t.Oqu(t.lcZ(9,14,"contact-add.edit-point-title")),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij(" ",t.lcZ(14,16,"action.save")," "),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(4),t.Oqu(t.lcZ(20,18,"contact.point")),t.xp6(2),t.Q6J("ngModel",o.contactPoint.point),t.xp6(3),t.Oqu(t.lcZ(25,20,"contact.level")),t.xp6(2),t.Q6J("ngIf",o.levelSelected&&o.levelSelected.id>0),t.xp6(1),t.Q6J("ngIf",!o.levelSelected||0==o.levelSelected.id),t.xp6(1),t.Q6J("ngIf",o.levelSelected&&o.levelSelected.id>0))},dependencies:[v.O5,I.JJ,I.On,r.YG,r.Sm,r.W2,r.Gu,r.gu,r.pK,r.Ie,r.Q$,r.q_,r.yW,r.wd,r.sr,r.j9,b.X$],encapsulation:2}),n})()},{path:"mobile-import",component:(()=>{class n{constructor(e,o,i,c){this.navCtrl=e,this.contactService=o,this.translateService=i,this.analyticsService=c,this.params=null,this.isaleContacts=[],this.originalContacts=[],this.contacts=[],this.selectedContacts=[],this.isSelecteAll=!1,this.saveDisabled=!1,this.total=0,this.totalSelected=0,this.searchKey="",this.tab="all",this.start=0,this.pageSize=10,this.end=39,this.currentPage=0,this.reload()}reload(){var e=this;return(0,l.Z)(function*(){const o=yield e.navCtrl.loading();e.params=e.navCtrl.getParams(e.params),e.contacts=e.params&&e.params.contacts&&e.params.contacts.length?e.params.contacts:[],e.originalContacts=JSON.parse(JSON.stringify(e.contacts)),e.total=e.contacts.length,e.totalSelected=0,yield o.dismiss()})()}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("contact-mobile-import")})()}dateFormat(e){return C.C.toUiDateString(e)}contactImageOrPlaceholder(e){return null!==e&&""!==e?e:"assets/person-placeholder.jpg"}select(){this.isSelecteAll&&(this.searchKey=null),this.selectedContacts=[],this.contacts=JSON.parse(JSON.stringify(this.originalContacts));for(const e of this.contacts)e.selected=this.isSelecteAll,this.isSelecteAll&&this.selectedContacts.push(e);this.countSelected()}selectContact(e){e.selected?this.selectedContacts.find(i=>i.contactId===e.contactId)||this.selectedContacts.push(e):this.selectedContacts=this.selectedContacts.filter(o=>o.contactId!==e.contactId),this.countSelected()}deSelectContact(e){e.selected||(this.selectedContacts=this.selectedContacts.filter(i=>i.contactId!==e.contactId),this.contacts.find(i=>i.contactId===e.contactId).selected=!1),this.countSelected()}countSelected(){this.totalSelected=this.selectedContacts?this.selectedContacts.length:0}save(){var e=this;return(0,l.Z)(function*(){e.saveDisabled=!0;const o=yield e.navCtrl.loading();let i=0;for(const c of e.selectedContacts){const s=new L.r;s.fullName=c.displayName,s.dateOfBirth=c.birthday,s.email=c.emails&&c.emails.length?c.emails[0].address:"",s.mobile=c.phoneNumbers&&c.phoneNumbers.length?c.phoneNumbers[0].number:"",yield e.contactService.saveContact(s),i++}e.navCtrl.publish("reloadContactList"),yield o.dismiss(),e.saveDisabled=!1,alert(e.translateService.instant("contact-add.import-done",{contact:i})),e.navCtrl.pop()})()}search(){this.analyticsService.logEvent("contact-mobile-import-search");let e=JSON.parse(JSON.stringify(this.originalContacts));if(null!==this.searchKey&&""!==this.searchKey){const o=this.searchKey.toLowerCase();e=e.filter(i=>i.displayName&&-1!==i.displayName.toLowerCase().indexOf(o)||i.emails&&i.emails.length&&i.emails.filter(c=>c.address&&-1!==c.address.toLowerCase().indexOf(o)).length>0||i.phoneNumbers&&i.phoneNumbers.length&&i.phoneNumbers.filter(c=>c.number&&-1!==c.number.toLowerCase().indexOf(o)).length>0)}for(const o of e)!this.selectedContacts.find(c=>c.contactId===o.contactId)||(o.selected=!0);this.contacts=e}clearSearch(){this.searchKey=null,this.analyticsService.logEvent("contact-mobile-import-search");const e=JSON.parse(JSON.stringify(this.originalContacts));for(const o of e)!this.selectedContacts.find(c=>c.contactId===o.contactId)||(o.selected=!0);this.contacts=e}get isShowPaging(){return!!(this.contacts&&this.contacts.length>this.pageSize)}previousPage(){this.currentPage<=0?this.currentPage=0:(this.currentPage--,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1,this.content.scrollToTop())}nextPage(){(this.currentPage+1)*this.pageSize>=this.contacts.length||(this.currentPage++,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1,window.scrollTo({top:0,left:0,behavior:"smooth"}),this.content.scrollToTop())}}return n.\u0275fac=function(e){return new(e||n)(t.Y36(D.G),t.Y36(U.y),t.Y36(b.sK),t.Y36(w.y))},n.\u0275cmp=t.Xpm({type:n,selectors:[["contact-mobile-import"]],viewQuery:function(e,o){if(1&e&&t.Gf(r.W2,7),2&e){let i;t.iGM(i=t.CRH())&&(o.content=i.first)}},decls:30,vars:29,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],["lines","none"],["slot","start","color","primary",3,"ngModel","ngModelChange"],[3,"ngModel","ngModelChange"],["value","all"],["value","selected"],[4,"ngIf"],["color","danger",4,"ngIf"],["color","danger"],[2,"border-bottom","1px solid #ccc"],[3,"size"],["lines","none",1,"ion-text-wrap","ion-no-padding"],["size","4","class","ion-text-right",4,"ngIf"],["size","4",1,"ion-text-right"],[1,"ion-text-wrap","ion-text-right"],[1,"ion-float-right"],["fill","solid","size","small",3,"click"],["slot","icon-only","name","arrow-back-circle"],["slot","icon-only","name","arrow-forward-circle"],[4,"ngFor","ngForOf"],[3,"src"],[1,"ion-text-wrap"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()(),t.TgZ(12,"ion-searchbar",5),t.NdJ("ionClear",function(){return o.clearSearch()})("ionChange",function(){return o.search()})("ngModelChange",function(c){return o.searchKey=c}),t.ALo(13,"translate"),t.qZA(),t.TgZ(14,"ion-item",6)(15,"ion-checkbox",7),t.NdJ("ngModelChange",function(c){return o.isSelecteAll=c})("ngModelChange",function(){return o.select()}),t.qZA(),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-segment",8),t.NdJ("ngModelChange",function(c){return o.tab=c}),t.TgZ(19,"ion-segment-button",9),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-segment-button",10),t.YNc(23,no,3,3,"span",11),t.YNc(24,oo,3,4,"ion-text",12),t.qZA()()(),t.TgZ(25,"ion-content"),t.YNc(26,co,8,9,"ion-grid",11),t.YNc(27,lo,3,5,"ion-list",11),t.YNc(28,uo,8,9,"ion-grid",11),t.YNc(29,ho,2,1,"ion-list",11),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,19,"contact-add.import-title")),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij(" ",t.lcZ(11,21,"action.save")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(13,23,"contact.search")),t.Q6J("ngModel",o.searchKey),t.xp6(3),t.Q6J("ngModel",o.isSelecteAll),t.xp6(1),t.lnq(" \xa0",t.lcZ(17,25,"contact-add.select-all")," ",o.totalSelected,"/",o.total," "),t.xp6(2),t.Q6J("ngModel",o.tab),t.xp6(2),t.hij(" ",t.lcZ(21,27,"contact-add.all-loaded-contacts")," "),t.xp6(3),t.Q6J("ngIf",!o.totalSelected),t.xp6(1),t.Q6J("ngIf",o.totalSelected),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.Q6J("ngIf","all"===o.tab),t.xp6(1),t.Q6J("ngIf","all"===o.tab),t.xp6(1),t.Q6J("ngIf","all"===o.tab),t.xp6(1),t.Q6J("ngIf","selected"===o.tab))},dependencies:[v.sg,v.O5,I.JJ,I.On,r.BJ,r.oU,r.YG,r.Sm,r.nz,r.wI,r.W2,r.jY,r.Gu,r.gu,r.Ie,r.Q$,r.q_,r.Nd,r.VI,r.cJ,r.GO,r.yW,r.wd,r.sr,r.w,r.QI,r.j9,r.cs,v.OU,b.X$],encapsulation:2}),n})()}];let go=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[B.Bz.forChild(Co),B.Bz]}),n})();var tt=_(3093),xo=_(529),Zo=_(2216);let vo=(()=>{class n{}return n.\u0275fac=function(e){return new(e||n)},n.\u0275mod=t.oAB({type:n}),n.\u0275inj=t.cJS({imports:[v.ez,I.u5,r.Pc,tt.m,Zo.uH,go,b.aw.forChild({loader:{provide:b.Zw,useFactory:tt.x,deps:[xo.eN]}})]}),n})()}}]);