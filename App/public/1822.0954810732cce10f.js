"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1822],{8851:(E,M,r)=>{r.d(M,{L:()=>v});var _=r(6738),n=r(5439),d=r(1914),x=r(4006),S=r(191);let v=(()=>{class t{constructor(){this.min=null,this.max=null,this.pickerId=null,this.date="",this.type="date",this.dateChange=new _.vpe}ionViewWillEnter(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?n(this.date.split(":00Z").join("")).format(d.C.getDateTimeDbFormat()):n(this.date.split(":00Z").join("")).format(d.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}ngOnInit(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?n(this.date.split(":00Z").join("")).format(d.C.getDateTimeDbFormat()):n(this.date.split(":00Z").join("")).format(d.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}change(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?n(this.date.split(":00Z").join("")).format(d.C.getDateTimeDbFormat()):n(this.date.split(":00Z").join("")).format(d.C.getDateDbFormat()):this.date,this.dateChange.emit(this.date)}}return t.\u0275fac=function(f){return new(f||t)},t.\u0275cmp=_.Xpm({type:t,selectors:[["date-picker"]],inputs:{min:"min",max:"max",pickerId:"pickerId",date:"date",type:"type"},outputs:{dateChange:"dateChange"},decls:1,vars:4,consts:[["color","primary",1,"ion-button",2,"font-size","0.8em",3,"type","ngModel","min","max","ngModelChange","ionChange"]],template:function(f,m){1&f&&(_.TgZ(0,"ion-input",0),_.NdJ("ngModelChange",function(u){return m.date=u})("ionChange",function(){return m.change()}),_.qZA()),2&f&&_.Q6J("type",m.type)("ngModel",m.date)("min",m.min)("max",m.max)},dependencies:[x.JJ,x.On,S.pK,S.j9],encapsulation:2}),t})()},7613:(E,M,r)=>{r.d(M,{F:()=>b});var _=r(5861),n=r(6738),p=r(6895),d=r(4006),x=r(191);const S=["template"],v=["input1"],t=["input2"];function A(u,C){if(1&u){const o=n.EpF();n.TgZ(0,"ion-input",4,5),n.NdJ("ngModelChange",function(a){n.CHM(o);const h=n.oxw(2);return n.KtG(h.moneyValueString=a)})("ionBlur",function(){n.CHM(o);const a=n.oxw(2);return n.KtG(a.ionBlur())})("ionFocus",function(){n.CHM(o);const a=n.oxw(2);return n.KtG(a.ionFocus())})("keyup.enter",function(){n.CHM(o);const a=n.oxw(2);return n.KtG(a.onEnter())}),n.qZA()}if(2&u){const o=n.oxw(2);n.Q6J("placeholder",o.placeholder)("disabled",o.disabled)("ngModel",o.moneyValueString)}}function f(u,C){if(1&u){const o=n.EpF();n.TgZ(0,"ion-input",6,7),n.NdJ("ngModelChange",function(a){n.CHM(o);const h=n.oxw(2);return n.KtG(h.moneyValueString=a)})("ionBlur",function(){n.CHM(o);const a=n.oxw(2);return n.KtG(a.ionBlur())})("ionFocus",function(){n.CHM(o);const a=n.oxw(2);return n.KtG(a.ionFocus())})("keyup.enter",function(){n.CHM(o);const a=n.oxw(2);return n.KtG(a.onEnter())}),n.qZA()}if(2&u){const o=n.oxw(2);n.Q6J("disabled",o.disabled)("placeholder",o.placeholder)("ngModel",o.moneyValueString)}}function m(u,C){if(1&u){const o=n.EpF();n.YNc(0,A,2,3,"ion-input",1),n.YNc(1,f,2,3,"ion-input",2),n.TgZ(2,"ion-input",3),n.NdJ("ngModelChange",function(a){n.CHM(o);const h=n.oxw();return n.KtG(h.moneyValue=a)})("ngModelChange",function(a){n.CHM(o);const h=n.oxw();return n.KtG(h.change(a))})("ionChange",function(){n.CHM(o);const a=n.oxw();return n.KtG(a.change(a.moneyValue))}),n.qZA()}if(2&u){const o=n.oxw();n.Q6J("ngIf",o.clear),n.xp6(1),n.Q6J("ngIf",!o.clear),n.xp6(1),n.Q6J("hidden",!0)("ngModel",o.moneyValue)}}let b=(()=>{class u{constructor(o){this.viewContainerRef=o,this.moneyValueChange=new n.vpe,this.clear=!1,this.decimal=".",this.thousands=",",this.decimalCount=2,this.changing=!1}ngOnInit(){var o=this;return(0,_.Z)(function*(){o.thousands=o.thousandsSeparator(),o.decimal="."===o.thousands?",":".",setTimeout(()=>{o.moneyValueString=o.moneyValue?o.formatMoney(o.moneyValue):o.moneyValue},1e3),o.viewContainerRef.createEmbeddedView(o.template)})()}getMoneyValueStringToNumber(o){if(o){let l=o.split(this.decimal).join("");return l=l.split(this.thousands).join(this.thousandsSeparator()),+l}return o}change(o){this.moneyValue=o,o?(this.moneyValueString=this.formatMoney(o),this.oldValue=this.moneyValueString):(this.moneyValueString=o,this.oldValue=o)}ionFocus(){return(0,_.Z)(function*(){})()}ionBlur(){if(this.moneyValueString){let o=this.moneyValueString.split(this.decimal).join("");o=o.split(this.thousands).join(this.thousandsSeparator()),this.moneyValue=+o,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(+o),this.oldValue=this.moneyValueString)}else this.moneyValue=this.moneyValueString,this.moneyValueString!=this.oldValue&&(this.moneyValueChange.emit(this.moneyValueString),this.oldValue=this.moneyValueString);this.moneyValueString=this.formatMoney(this.moneyValue),setTimeout(()=>{this.changing=!1},300)}formatMoney(o){if(!o)return o;const l=this.decimalCount,h=this.decimal,Z=this.thousands;try{const T="\\d(?=(\\d{3})+"+(l>0?"\\D":"$")+")",I=o.toFixed(Math.max(0,~~l));let y=(Z?I.replace(".",Z):I).replace(new RegExp(T,"g"),"$&"+(h||","));return y&&(y.indexOf(this.thousands+"00")&&(y=y.split(this.thousands+"00").join("")),y)}catch(T){console.error(T)}}thousandsSeparator(){return parseFloat(.55.toString()).toLocaleString().indexOf(",55")>=0?",":"."}select(o){this.moneyValueString=o,this.ionBlur()}onEnter(){var o=this;return(0,_.Z)(function*(){const l=o.input1?o.input1:o.input2;if(!l)return;const a=yield l.getInputElement();!a||a.blur()})()}}return u.\u0275fac=function(o){return new(o||u)(n.Y36(n.s_b))},u.\u0275cmp=n.Xpm({type:u,selectors:[["money-input"]],viewQuery:function(o,l){if(1&o&&(n.Gf(S,7),n.Gf(v,5),n.Gf(t,5)),2&o){let a;n.iGM(a=n.CRH())&&(l.template=a.first),n.iGM(a=n.CRH())&&(l.input1=a.first),n.iGM(a=n.CRH())&&(l.input2=a.first)}},inputs:{moneyValue:"moneyValue",placeholder:"placeholder",disabled:"disabled",clear:"clear"},outputs:{moneyValueChange:"moneyValueChange"},decls:2,vars:0,consts:[["template",""],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],["inputmode","numeric","style","background-color: #efefef; border-radius: 5px; color: #000; margin-bottom: 5px;","type","text",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter",4,"ngIf"],[3,"hidden","ngModel","ngModelChange","ionChange"],["type","text","inputmode","numeric",3,"placeholder","disabled","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input1",""],["inputmode","numeric","type","text",2,"background-color","#efefef","border-radius","5px","color","#000","margin-bottom","5px",3,"disabled","placeholder","ngModel","ngModelChange","ionBlur","ionFocus","keyup.enter"],["input2",""]],template:function(o,l){1&o&&n.YNc(0,m,3,4,"ng-template",null,0,n.W1O)},dependencies:[p.O5,d.JJ,d.On,x.pK,x.j9],encapsulation:2}),u})()},2058:(E,M,r)=>{r.r(M),r.d(M,{StoreModule:()=>K});var _=r(6895),n=r(4006),p=r(191),d=r(3306),x=r(529),S=r(3093),v=r(3196),t=r(6738),A=r(316);let f=(()=>{class i{constructor(){this.table="store",this.fieldsList=["id","name","email","phone","address","moneyAccountId","bankName","bankAccountName","bankAccountNumber","iconUrl"],this.validateFields=["name"],this.fieldInstructions={id:{disabled:!0},email:{type:"email"},phone:{type:"tel"},moneyAccountId:{lookup:"money_account",lookupField:"accountName",onchange:"store change money account"},iconUrl:{type:"image"}},this.functionsMap={"store change money account":"\n            () => {\n                const moneyAccount = this.fieldInstructions['moneyAccountId'].lookupObject;\n                this.object.bankName = moneyAccount ? moneyAccount.bankName : null;\n                this.object.bankAccountName = moneyAccount ? moneyAccount.bankAccountName : null;\n                this.object.bankAccountNumber = moneyAccount ? moneyAccount.bankNumber : null;\n            }\n        "}}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["store-add"]],inputs:{table:"table",fieldsList:"fieldsList",validateFields:"validateFields",fieldInstructions:"fieldInstructions",functionsMap:"functionsMap"},decls:1,vars:4,consts:[["table","store",3,"fieldsList","validateFields","fieldInstructions","functionsMap"]],template:function(e,s){1&e&&t._UZ(0,"form-add",0),2&e&&t.Q6J("fieldsList",s.fieldsList)("validateFields",s.validateFields)("fieldInstructions",s.fieldInstructions)("functionsMap",s.functionsMap)},dependencies:[A.D],encapsulation:2}),i})();var m=r(5861),b=r(6723),u=r(5851),C=r(667),o=r(3876),l=r(323);function a(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item",9)(1,"ion-label",10),t._uU(2),t.qZA(),t.TgZ(3,"ion-buttons")(4,"ion-button",11),t.NdJ("click",function(){t.CHM(e);const g=t.oxw();return t.KtG(g.exitStore())}),t._UZ(5,"ion-icon",12),t._uU(6),t.ALo(7,"translate"),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(e.checkStore),t.xp6(4),t.hij(" ",t.lcZ(7,2,"store.exit-store")," ")}}function h(i,c){if(1&i){const e=t.EpF();t.TgZ(0,"ion-button",18),t.NdJ("click",function(){t.CHM(e);const g=t.oxw(2);return t.KtG(g.loginAsStore())}),t._UZ(1,"ion-icon",19),t._uU(2),t.ALo(3,"translate"),t.qZA()}2&i&&(t.xp6(2),t.hij("\xa0",t.lcZ(3,1,"store.login")," "))}function Z(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.phone"),": ",e.store.phone,"")}}function T(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.email"),": ",e.store.email,"")}}function I(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.address"),": ",e.store.address,"")}}function y(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.facebook"),": ",e.store.facebook,"")}}function F(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.bank-name"),": ",e.store.bankName,"")}}function N(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.bank-account-name"),": ",e.store.bankAccountName,"")}}function V(i,c){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("",t.lcZ(2,2,"shop-add.bank-account-number"),": ",e.store.bankAccountNumber,"")}}function L(i,c){if(1&i&&(t.TgZ(0,"ion-thumbnail",2),t._UZ(1,"img",20),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("src",e.store.iconUrl,t.LSH)}}function U(i,c){if(1&i&&(t.TgZ(0,"ion-list")(1,"ion-item",13)(2,"ion-label",14),t._uU(3),t.qZA(),t.YNc(4,h,4,3,"ion-button",15),t.qZA(),t.TgZ(5,"ion-item",16)(6,"ion-label",14)(7,"p"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.YNc(10,Z,3,4,"p",8),t.YNc(11,T,3,4,"p",8),t.YNc(12,I,3,4,"p",8),t.YNc(13,y,3,4,"p",8),t.YNc(14,F,3,4,"p",8),t.YNc(15,N,3,4,"p",8),t.YNc(16,V,3,4,"p",8),t.qZA(),t.YNc(17,L,2,1,"ion-thumbnail",17),t.qZA()()),2&i){const e=t.oxw();t.xp6(3),t.hij(" ",e.limitText(e.store.name)," "),t.xp6(1),t.Q6J("ngIf",!e.storeLogined||e.storeLogined.id!==e.store.id),t.xp6(4),t.AsE("",t.lcZ(9,12,"shop-add.id"),": ",e.store.id,""),t.xp6(2),t.Q6J("ngIf",e.store.phone),t.xp6(1),t.Q6J("ngIf",e.store.email),t.xp6(1),t.Q6J("ngIf",e.store.address),t.xp6(1),t.Q6J("ngIf",e.store.facebook),t.xp6(1),t.Q6J("ngIf",e.store.bankName),t.xp6(1),t.Q6J("ngIf",e.store.bankAccountName),t.xp6(1),t.Q6J("ngIf",e.store.bankAccountNumber),t.xp6(1),t.Q6J("ngIf",e.store.iconUrl)}}let O=(()=>{class i{constructor(e,s,g,D,G,j){this.navCtrl=e,this.translateService=s,this.staffService=g,this.storeService=D,this.alertCtrl=G,this.analyticsService=j,this.store={},this.params=null,this.searchKey="";const k=w=>{this.store&&w.detail.id===this.store.id&&this.reload()};this.navCtrl.unsubscribe("reloadStore",k),this.navCtrl.subscribe("reloadStore",k)}ionViewWillEnter(){var e=this;return(0,m.Z)(function*(){yield e.analyticsService.setCurrentScreen("store-detail")})()}ngOnInit(){this.reload()}reload(){var e=this;return(0,m.Z)(function*(){e.selectedStaff=e.staffService.selectedStaff,e.storeLogined=yield e.storeService.getCurrentStore(),e.checkStore=e.storeLogined?e.translateService.instant("store.check-store",{shop:e.storeLogined.name}):null,e.store={};const s=e.params?e.params:e.navCtrl.getParams();e.params=s,s&&s.id&&s.id>0&&e.storeService.getStore(s.id).then(D=>{e.store=D})})()}limitText(e,s=200){return b.W.limitText(e,s)}edit(){this.navCtrl.push("/store/add",{id:this.store.id})}deleteStore(){var e=this;return(0,m.Z)(function*(){(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("store.delete-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.storeService.deleteStore(e.store).then((0,m.Z)(function*(){e.analyticsService.logEvent("store-detail-delete-success"),e.navCtrl.publish("reloadStoreList",null),e.navCtrl.pop()}))}}]})).present()})()}loginAsStore(){var e=this;return(0,m.Z)(function*(){e.storeService.loginAsStore(e.store),alert(e.translateService.instant("store.login-alert",{shop:e.store.name})),yield e.reload()})()}exitStore(){var e=this;return(0,m.Z)(function*(){var g;yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("store.exit-store-alert",{shop:e.storeLogined.name}),buttons:[{text:e.translateService.instant("common.agree"),handler:(g=(0,m.Z)(function*(){yield e.storeService.exitStore(),yield e.reload()}),function(){return g.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.G),t.Y36(d.sK),t.Y36(C.x),t.Y36(o.d),t.Y36(p.Br),t.Y36(l.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["store-detail"]],decls:15,vars:7,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","danger",3,"click"],["name","trash","slot","icon-only"],["color","primary",3,"click"],["name","create","slot","icon-only"],["lines","none","color","success",4,"ngIf"],[4,"ngIf"],["lines","none","color","success"],[1,"ion-text-wrap"],["size","small",3,"click"],["name","exit","slot","start","size","small"],["lines","none",2,"--padding-top","0","--inner-padding-top","0","--inner-padding-bottom","0","--min-height","0"],[1,"ion-text-wrap",2,"padding","0","margin","0"],["style","padding: 0; margin: 0;","slot","end","fill","clear",3,"click",4,"ngIf"],[2,"--padding-bottom","10px","--inner-padding-top","0","--inner-padding-bottom","10px","--min-height","0"],["slot","end",4,"ngIf"],["slot","end","fill","clear",2,"padding","0","margin","0",3,"click"],["name","enter","slot","start"],[3,"src"]],template:function(e,s){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return s.deleteStore()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",5),t.NdJ("click",function(){return s.edit()}),t._UZ(11,"ion-icon",6),t.qZA()()(),t.YNc(12,a,8,4,"ion-item",7),t.qZA(),t.TgZ(13,"ion-content"),t.YNc(14,U,18,14,"ion-list",8),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,5,"store.title-detail")),t.xp6(7),t.Q6J("ngIf",s.checkStore&&(null==s.selectedStaff||s.selectedStaff.hasFullAccess&&!s.selectedStaff.storeId)),t.xp6(1),t.Akn(s.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.Q6J("ngIf",s.store))},dependencies:[_.O5,p.oU,p.YG,p.Sm,p.W2,p.Gu,p.gu,p.Ie,p.Q$,p.q_,p.Bs,p.wd,p.sr,p.cs,d.X$],encapsulation:2}),i})();var J=r(2402);const P=[{path:"",component:(()=>{class i{constructor(e){this.navCtrl=e,this.maxTopRecent=50,this.presentItemActions={"contact.new-note":["/note/add",s=>{this.navCtrl.navigateForward("/note/add",{contact:s.id})}],"contact.new-trade":["/note/add",s=>{this.navCtrl.navigateForward("/trade/add",{contact:s.id})}]},this.itemTemplate={h2:{field:"name"},pList:[{short:"id"},{short:"phone"},{short:"email"},{short:"address"},{short:"facebook"},{short:"bank-name"},{short:"bank-account-name"},{short:"bank-account-number"}],thumbnail:"icon-url"},this.searchFields=["name","phone","email","address","facebook","bankName","bankAccountName","bankAccountNumber"]}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(u.G))},i.\u0275cmp=t.Xpm({type:i,selectors:[["store"]],decls:1,vars:3,consts:[["table","store",3,"presentItemActions","itemTemplate","searchFields"]],template:function(e,s){1&e&&t._UZ(0,"list",0),2&e&&t.Q6J("presentItemActions",s.presentItemActions)("itemTemplate",s.itemTemplate)("searchFields",s.searchFields)},dependencies:[J.n],encapsulation:2}),i})()},{path:"add",component:f},{path:"detail",component:O}];let B=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[v.Bz.forChild(P),v.Bz]}),i})(),K=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[_.ez,n.u5,p.Pc,B,S.m,d.aw.forChild({loader:{provide:d.Zw,useFactory:S.x,deps:[x.eN]}})]}),i})()}}]);