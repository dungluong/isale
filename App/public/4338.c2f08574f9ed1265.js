"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[4338],{7145:(O,A,s)=>{s.r(A),s.d(A,{ProductReportModule:()=>ct});var p=s(6895),u=s(4006),i=s(191),h=s(3306),P=s(529),Z=s(3196),l=s(5861),v=s(7489),m=s(1914),f=s(6723),t=s(6738),x=s(4518),y=s(5851),b=s(323);function I(r,c){if(1&r&&(t.TgZ(0,"p",11)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&r){const e=t.oxw().$implicit,o=t.oxw();t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",o.getFilter(e)," ")}}function q(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item-sliding",3),t.NdJ("click",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.selectReport(a.id))}),t.TgZ(1,"ion-item",8),t.NdJ("press",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.presentActionSheet(a))}),t.TgZ(2,"ion-label",9)(3,"span",10),t._uU(4),t.qZA(),t.TgZ(5,"p",11)(6,"span"),t._uU(7),t.qZA()(),t.YNc(8,I,4,4,"p",12),t.TgZ(9,"p",11),t._uU(10),t.qZA()()()()}if(2&r){const e=c.$implicit,o=t.oxw();t.xp6(4),t.Oqu(o.limitText(e.name)),t.xp6(3),t.hij(" ",o.getDateType(e)," "),t.xp6(1),t.Q6J("ngIf",o.getFilter(e)),t.xp6(2),t.hij(" ",o.dateFormat(e.modifiedAt)," ")}}function F(r,c){1&r&&(t.TgZ(0,"ion-item",9),t._UZ(1,"div",13),t.ALo(2,"translate"),t.qZA()),2&r&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"report.no-report"),t.oJD))}let N=(()=>{class r{constructor(e,o,n,a,d,C){var g=this;this.reportService=e,this.translateService=o,this.navCtrl=n,this.actionSheetCtrl=a,this.alertCtrl=d,this.analyticsService=C,this.searchKey="",this.reload=(0,l.Z)(function*(){const S=[yield g.reportService.getCustomReport(1,"product-report")];g.originalReports=JSON.parse(JSON.stringify(S)),g.reports=S,g.filter()}),this.navCtrl.unsubscribe("reloadReportList",this.reload),this.navCtrl.subscribe("reloadReportList",this.reload)}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("product-report")})()}ngOnInit(){this.reload()}openReportAdd(){this.navCtrl.push("/product-report/add")}search(){var e=this;return(0,l.Z)(function*(){e.analyticsService.logEvent("product-report-search");let o=JSON.parse(JSON.stringify(e.originalReports));if(null!==e.searchKey&&""!==e.searchKey){let n=e.searchKey.toLowerCase();o=o.filter(a=>a.name&&-1!==a.name.toLowerCase().indexOf(n))}e.reports=o})()}clearSearch(){this.searchKey=null,this.reload()}filter(){let e=JSON.parse(JSON.stringify(this.originalReports));e=this.sortByModifiedAt(e),this.reports=e}sortByModifiedAt(e){return e?v.orderBy(e,["modifiedAt"],["desc"]):null}dateFormat(e){return m.C.toUiString(e)}limitText(e,o=200){return f.W.limitText(e,o)}selectReport(e){this.navCtrl.push("/product-report/detail",{id:e})}deleteReport(e){var o=this;return(0,l.Z)(function*(){yield(yield o.alertCtrl.create({header:o.translateService.instant("common.confirm"),message:o.translateService.instant("report-detail.delete-alert"),buttons:[{text:o.translateService.instant("common.agree"),handler:()=>{o.reportService.deleteProductReport(e).then((0,l.Z)(function*(){o.analyticsService.logEvent("product-report-delete-success");let a=o.reports.findIndex(d=>d.id==e.id);a>=0&&o.reports.splice(a,1),a=o.originalReports.findIndex(d=>d.id==e.id),a>=0&&o.originalReports.splice(a,1)}))}},{text:o.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}presentActionSheet(e){var o=this;return(0,l.Z)(function*(){yield(yield o.actionSheetCtrl.create({header:o.translateService.instant("action.action"),buttons:[{text:o.translateService.instant("report-detail.delete-report"),role:"destructive",handler:()=>{o.deleteReport(e)}},{text:o.translateService.instant("report-category.view-detail"),handler:()=>{o.selectReport(e.id)}},{text:o.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}getDateType(e){return 0==e.dateType?this.translateService.instant("report-category.by-week"):1==e.dateType?this.translateService.instant("report-category.by-month"):2==e.dateType?this.translateService.instant("report-category.by-year"):3==e.dateType?this.translateService.instant("report-category.by-day"):4==e.dateType?this.translateService.instant("report-category.custom"):5==e.dateType?this.translateService.instant("report-category.by-quarter"):""}getFilter(e){let o="";return(0!=e.productListType||0!=e.ignoreProduct)&&(""!=o&&(o+="; "),o+=this.translateService.instant("report-output.product-limited")),o}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(x.r),t.Y36(h.sK),t.Y36(y.G),t.Y36(i.BX),t.Y36(i.Br),t.Y36(b.y))},r.\u0275cmp=t.Xpm({type:r,selectors:[["product-report"]],decls:16,vars:11,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],[3,"click"],["name","add-circle"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[3,"click",4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],[3,"press"],[1,"ion-text-wrap"],[2,"white-space","pre-wrap"],[2,"padding-top","5px"],["style","padding-top: 5px;",4,"ngIf"],[3,"innerHTML"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.openReportAdd()}),t._UZ(9,"ion-icon",4),t.qZA()()()(),t.TgZ(10,"ion-content")(11,"ion-searchbar",5),t.NdJ("ionClear",function(){return o.clearSearch()})("ionChange",function(){return o.search()})("ngModelChange",function(a){return o.searchKey=a}),t.ALo(12,"translate"),t.qZA(),t.TgZ(13,"ion-list"),t.YNc(14,q,11,4,"ion-item-sliding",6),t.YNc(15,F,3,3,"ion-item",7),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,7,"report-product.title")),t.xp6(5),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.s9C("placeholder",t.lcZ(12,9,"report.search")),t.Q6J("ngModel",o.searchKey),t.xp6(3),t.Q6J("ngForOf",o.reports),t.xp6(1),t.Q6J("ngIf",!o.originalReports||0===o.originalReports.length))},dependencies:[p.sg,p.O5,u.JJ,u.On,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.td,i.Q$,i.q_,i.VI,i.wd,i.sr,i.j9,i.cs,h.X$],encapsulation:2}),r})();class L{constructor(){this.id=0,this.name="",this.dateType=0,this.dateFrom="",this.dateTo="",this.productListType=0,this.productListCustom="",this.ignoreProduct=0,this.ignoredProducts="",this.createdAt="",this.modifiedAt=""}}var w=s(8007);function E(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"date-item",12),t.NdJ("dateChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.report.dateFrom=n)}),t.ALo(1,"translate"),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("date",e.report.dateFrom)("label",t.lcZ(1,2,"report-category-add.start-date"))}}function Q(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"date-item",13),t.NdJ("dateChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.report.dateTo=n)}),t.ALo(1,"translate"),t.qZA()}if(2&r){const e=t.oxw();t.Q6J("date",e.report.dateTo)("label",t.lcZ(1,2,"report-category-add.end-date"))}}function k(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.showSearchProduct())}),t._UZ(4,"ion-icon",15),t._uU(5),t.ALo(6,"translate"),t.qZA()()}2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"report-add.list"),": "),t.xp6(4),t.hij(" ",t.lcZ(6,4,"report-add.add")," "))}function Y(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.removeSelectedProduct(a))}),t._UZ(4,"ion-icon",16),t._uU(5),t.ALo(6,"translate"),t.qZA()()}if(2&r){const e=c.$implicit;t.xp6(2),t.AsE("",e.code,"-",e.title,""),t.xp6(3),t.hij(" ",t.lcZ(6,3,"report-add.remove")," ")}}function K(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item"),t._uU(1),t.ALo(2,"translate"),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){t.CHM(e);const n=t.oxw();return t.KtG(n.showSearchProduct(!1))}),t._UZ(4,"ion-icon",15),t._uU(5),t.ALo(6,"translate"),t.qZA()()}2&r&&(t.xp6(1),t.hij(" ",t.lcZ(2,2,"report-add.list"),": "),t.xp6(4),t.hij(" ",t.lcZ(6,4,"report-add.add")," "))}function $(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",14),t.NdJ("click",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.removeIgnoredProduct(a))}),t._UZ(4,"ion-icon",16),t._uU(5),t.ALo(6,"translate"),t.qZA()()}if(2&r){const e=c.$implicit;t.xp6(2),t.AsE("",e.code,"-",e.title,""),t.xp6(3),t.hij(" ",t.lcZ(6,3,"report-add.remove")," ")}}let G=(()=>{class r{constructor(e,o,n,a){this.navCtrl=e,this.modalCtrl=o,this.reportService=n,this.analyticsService=a,this.params=null,this.report=new L,this.selectedProducts=[],this.ignoredProducts=[]}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("product-report")})()}ngOnInit(){let e=0;this.params=this.params?this.params:this.navCtrl.getParams(),this.params&&this.params.id&&(e=this.params.id),e&&e>0&&this.reportService.getCustomReport(e,"product-report").then(o=>{this.report=o,o.productListCustom&&""!==o.productListCustom&&(this.selectedProducts=JSON.parse(o.productListCustom)),o.ignoredProducts&&""!==o.ignoredProducts&&(this.ignoredProducts=JSON.parse(o.ignoredProducts))})}save(){var e=this;this.reportService.saveCustomReport(this.report,"product-report").then(function(){var o=(0,l.Z)(function*(n){e.analyticsService.logEvent("product-report-add-save-success"),e.report.id=n,e.exitPage()});return function(n){return o.apply(this,arguments)}}())}exitPage(){var e=this;return(0,l.Z)(function*(){yield e.navCtrl.popOnly(),(!e.params||!e.params.id)&&(yield e.navCtrl.push("/product-report/detail",{id:e.report.id})),e.navCtrl.publish("reloadReportList"),e.navCtrl.publish("reloadProductReport",e.report)})()}showSearchProduct(e=!0){var o=this;return(0,l.Z)(function*(){o.navCtrl.push("/product",{callback:a=>{const d=a;if(d)if(e){if(o.selectedProducts.findIndex(g=>g.id===d.id)>=0)return;o.selectedProducts.push(d),o.report.productListCustom=JSON.stringify(o.selectedProducts)}else{if(o.ignoredProducts.findIndex(g=>g.id===d.id)>=0)return;o.ignoredProducts.push(d),o.report.ignoredProducts=JSON.stringify(o.ignoredProducts)}},searchMode:!0})})()}removeIgnoredProduct(e){const o=this.ignoredProducts.findIndex(n=>n.id===e.id);o>=0&&(this.ignoredProducts.splice(o,1),this.report.ignoredProducts=JSON.stringify(this.ignoredProducts))}removeSelectedProduct(e){const o=this.selectedProducts.findIndex(n=>n.id===e.id);o>=0&&(this.selectedProducts.splice(o,1),this.report.productListCustom=JSON.stringify(this.selectedProducts))}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(y.G),t.Y36(i.IN),t.Y36(x.r),t.Y36(b.y))},r.\u0275cmp=t.Xpm({type:r,selectors:[["product-report-add"]],decls:65,vars:66,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","checkmark"],["color","primary"],[3,"ngModel","ngModelChange"],[3,"value"],["pickerId","reportDateFromPicker4",3,"date","label","dateChange",4,"ngIf"],["pickerId","reportDateEndPicker4",3,"date","label","dateChange",4,"ngIf"],[4,"ngIf"],[4,"ngFor","ngForOf"],["pickerId","reportDateFromPicker4",3,"date","label","dateChange"],["pickerId","reportDateEndPicker4",3,"date","label","dateChange"],["fill","outline","slot","end",3,"click"],["name","add"],["name","remove"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item")(15,"ion-label",5),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-select",6),t.NdJ("ngModelChange",function(a){return o.report.dateType=a}),t.TgZ(19,"ion-select-option",7),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-select-option",7),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"ion-select-option",7),t._uU(26),t.ALo(27,"translate"),t.qZA(),t.TgZ(28,"ion-select-option",7),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-select-option",7),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"ion-select-option",7),t._uU(35),t.ALo(36,"translate"),t.qZA()()(),t.YNc(37,E,2,4,"date-item",8),t.YNc(38,Q,2,4,"date-item",9),t.TgZ(39,"ion-item")(40,"ion-label",5),t._uU(41),t.ALo(42,"translate"),t.qZA(),t.TgZ(43,"ion-select",6),t.NdJ("ngModelChange",function(a){return o.report.productListType=a}),t.TgZ(44,"ion-select-option",7),t._uU(45),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ion-select-option",7),t._uU(48),t.ALo(49,"translate"),t.qZA()()(),t.YNc(50,k,7,6,"ion-item",10),t.YNc(51,Y,7,5,"ion-item",11),t.TgZ(52,"ion-item")(53,"ion-label",5),t._uU(54),t.ALo(55,"translate"),t.qZA(),t.TgZ(56,"ion-select",6),t.NdJ("ngModelChange",function(a){return o.report.ignoreProduct=a}),t.TgZ(57,"ion-select-option",7),t._uU(58),t.ALo(59,"translate"),t.qZA(),t.TgZ(60,"ion-select-option",7),t._uU(61),t.ALo(62,"translate"),t.qZA()()(),t.YNc(63,K,7,6,"ion-item",10),t.YNc(64,$,7,5,"ion-item",11),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,36,"report-product-add.title")),t.xp6(5),t.hij(" \xa0",t.lcZ(11,38,"action.save")," "),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(4),t.Oqu(t.lcZ(17,40,"report-category-add.date-range")),t.xp6(2),t.Q6J("ngModel",o.report.dateType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(21,42,"report-category.by-week")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(24,44,"report-category.by-month")),t.xp6(2),t.Q6J("value",2),t.xp6(1),t.Oqu(t.lcZ(27,46,"report-category.by-year")),t.xp6(2),t.Q6J("value",3),t.xp6(1),t.Oqu(t.lcZ(30,48,"report-category.by-day")),t.xp6(2),t.Q6J("value",5),t.xp6(1),t.Oqu(t.lcZ(33,50,"report-category.by-quarter")),t.xp6(2),t.Q6J("value",4),t.xp6(1),t.Oqu(t.lcZ(36,52,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",4===o.report.dateType),t.xp6(1),t.Q6J("ngIf",4===o.report.dateType),t.xp6(3),t.Oqu(t.lcZ(42,54,"report-product-add.select-product")),t.xp6(2),t.Q6J("ngModel",o.report.productListType),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(46,56,"report-category-add.all")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(49,58,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",1===o.report.productListType),t.xp6(1),t.Q6J("ngForOf",o.selectedProducts),t.xp6(3),t.Oqu(t.lcZ(55,60,"report-product-add.ignore-product")),t.xp6(2),t.Q6J("ngModel",o.report.ignoreProduct),t.xp6(1),t.Q6J("value",0),t.xp6(1),t.Oqu(t.lcZ(59,62,"report-category-add.none")),t.xp6(2),t.Q6J("value",1),t.xp6(1),t.Oqu(t.lcZ(62,64,"report-category.custom")),t.xp6(2),t.Q6J("ngIf",1===o.report.ignoreProduct),t.xp6(1),t.Q6J("ngForOf",o.ignoredProducts))},dependencies:[p.sg,p.O5,u.JJ,u.On,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.Q$,i.q_,i.t9,i.n0,i.wd,i.sr,i.QI,i.cs,w.p,h.X$],encapsulation:2}),r})();var _=s(1464),R=s(3363),j=s(4013),H=s(3989),T=s(5439),B=s(4433),W=s(7488),V=s(7060),J=s(4155);const X=["chart"];function z(r,c){if(1&r&&(t.TgZ(0,"p",7)(1,"span"),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&r){const e=t.oxw();t.xp6(2),t.AsE(" ",t.lcZ(3,2,"common.filter"),": ",e.filter," ")}}function tt(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-select",21),t.NdJ("ngModelChange",function(n){t.CHM(e);const a=t.oxw();return t.KtG(a.barChartType=n)}),t.TgZ(5,"ion-select-option",22),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"ion-select-option",23),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"ion-select-option",24),t._uU(12),t.ALo(13,"translate"),t.qZA()()()}if(2&r){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,5,"common.chart")),t.xp6(2),t.Q6J("ngModel",e.barChartType),t.xp6(2),t.Oqu(t.lcZ(7,7,"common.bar")),t.xp6(3),t.Oqu(t.lcZ(10,9,"common.pie")),t.xp6(3),t.Oqu(t.lcZ(13,11,"common.line"))}}function et(r,c){if(1&r&&t._UZ(0,"canvas",25,26),2&r){const e=t.oxw();t.Q6J("hidden",e.isCapturing)("datasets",e.barChartData)("labels",e.barChartLabels)("options",e.barChartOptions)("legend",e.barChartLegend)("type",e.barChartType)}}function ot(r,c){if(1&r&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.HOy("",e.product.code,"-",e.product.title," / ",e.quantity," ",e.product.unit,"")}}function rt(r,c){if(1&r&&(t.TgZ(0,"ion-avatar",2),t._UZ(1,"img",29),t.qZA()),2&r){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.product.avatarUrl,t.LSH)}}const U=function(r,c,e){return[r,c,"symbol","1.0-2",e]};function nt(r,c){if(1&r){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item",27),t.NdJ("click",function(){const a=t.CHM(e).$implicit,d=t.oxw();return t.KtG(d.selectReport(a))}),t.TgZ(2,"ion-label",6)(3,"ion-text",9),t._uU(4),t.ALo(5,"currency"),t.qZA(),t.YNc(6,ot,2,4,"p",16),t.qZA(),t.YNc(7,rt,2,1,"ion-avatar",28),t.qZA()()}if(2&r){const e=c.$implicit,o=t.oxw();t.xp6(3),t.s9C("color",e.value>=0?"secondary":"danger"),t.xp6(1),t.AsE(" ",e.value>=0?"+":"","",t.G7q(5,5,t.kEZ(11,U,e.value,o.currency,o.translateService.currentLang))," "),t.xp6(2),t.Q6J("ngIf",e.product),t.xp6(1),t.Q6J("ngIf",e.product&&e.product.avatarUrl)}}const it=[{path:"",component:N},{path:"add",component:G},{path:"detail",component:(()=>{class r{constructor(e,o,n,a,d,C,g,S,dt){this.navCtrl=e,this.translateService=o,this.file=n,this.userService=a,this.reportService=d,this.actionSheetCtrl=C,this.alertCtrl=g,this.excelService=S,this.analyticsService=dt,this.params=null,this.isCapturing=!1,this.report=new L,this.productReports=[],this.totalProduct=0,this.totalValue=0,this.dateType="",this.dateFrom="",this.dateTo="",this.filter="",this.currentMoment=T(),this.isLoadingChart=!1,this.barChartOptions={scaleShowVerticalLines:!1,responsive:!0,bezierCurve:!1,onAnimationComplete:this.done},this.barChartLabels=[""],this.barChartType="bar",this.barChartLegend=!0,this.barChartData=[{data:[0]}],this.isInChartMode=!1;const D=lt=>{this.report&&lt.detail.id===this.report.id&&this.reload()};this.navCtrl.unsubscribe("reloadProductReport",D),this.navCtrl.subscribe("reloadProductReport",D)}done(){}ionViewWillEnter(){var e=this;return(0,l.Z)(function*(){yield e.analyticsService.setCurrentScreen("product-report-detail")})()}ngOnInit(){this.reload()}reload(){this.userService.getAttr("current-currency").then(e=>{this.currency=e}),this.params=this.navCtrl.getParams(this.params),this.params&&this.params.id&&this.params.id>0?this.reportService.getCustomReport(this.params.id,"product-report").then(o=>{this.report=o,this.doCalculate()}):this.params&&this.params.templateReport&&(this.report=this.params.templateReport,this.doCalculate())}doCalculate(){this.isLoadingChart=!0,this.reportService.calculateProductReport(this.report,this.currentMoment).then(e=>{this.productReports=e.reports,this.totalProduct=e.totalItem,this.totalValue=e.totalValue,this.dateType=e.dateType,this.dateFrom=e.dateFrom,this.dateTo=e.dateTo,this.filter=e.filter,this.showChart(),this.isInChartMode=!0,this.isLoadingChart=!1})}edit(){this.navCtrl.push("/product-report/add",{id:this.report.id})}presentActionSheet(){var e=this;return(0,l.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("report-detail.delete-report"),role:"destructive",handler:()=>{e.deleteReport()}},{text:e.translateService.instant("report-detail.share"),role:"destructive",handler:()=>{e.shareReport()}},{text:e.translateService.instant("export.export-to-excel"),handler:()=>{e.exportExcel()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}deleteReport(){var e=this;return(0,l.Z)(function*(){yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report-detail.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{e.reportService.deleteProductReport(e.report).then((0,l.Z)(function*(){e.analyticsService.logEvent("product-report-detail-delete-success"),e.navCtrl.publish("reloadReportList"),e.navCtrl.pop()}))}},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}showChart(){const e={label:"",data:[]},o=[];for(const n of this.productReports)o.push(f.W.productName(n.product.code,n.product.title)),e.data.push(n.value);this.barChartLabels=o,this.barChartData=[e]}enableChart(){this.isInChartMode=!this.isInChartMode}selectReport(e){this.navCtrl.push("/product/detail",{id:e.productId,tab:"trade",dateFrom:m.C.toDbString(this.dateFrom,m.C.getUiDateFormat()),dateTo:m.C.toDbString(this.dateTo,m.C.getUiDateFormat())})}previousMoment(){this.currentMoment=T(this.currentMoment).subtract(1,m.C.dateTypeToDuration(this.report.dateType)),this.doCalculate()}nextMoment(){this.currentMoment=T(this.currentMoment).add(1,m.C.dateTypeToDuration(this.report.dateType)),this.doCalculate()}viewTrend(){const e=new H.k;e.dataType=2,e.dateType=this.report.dateType,3!=e.dateType&&4!=e.dateType&&(e.dateFrom=T().startOf("year").format(m.C.getDbFormat())),e.dateTo=T().endOf("day").format(m.C.getDbFormat()),e.dataSources=JSON.stringify([this.report]),this.reportService.calculateChart(e).then(o=>{this.navCtrl.push("/chart/detail",{chart:e,data:o})})}shareReport(){this.isCapturing=!0,this.chartImg=this.chart.nativeElement.toDataURL(),this.userService.shareScreenshot().then(()=>{this.isCapturing=!1}).catch(()=>{this.isCapturing=!1})}dateFormat(e){return m.C.toUiDateString(e)}exportExcel(){var e=this;const o=new j.m;let n=new R._;if(n.addColumn(new _.d(this.translateService.instant("report-product.title"))),o.addRow(n),this.dateFrom&&this.dateTo){n=new R._;const d=this.translateService.instant("common.from"),C=this.translateService.instant("common.to");n.addColumn(new _.d(`${this.dateType} ${d} ${this.dateFrom} ${C} ${this.dateTo}`)),o.addRow(n)}n=new R._,n.addColumn(new _.d(this.translateService.instant("export.product"))),n.addColumn(new _.d(this.translateService.instant("export.money"))),n.addColumn(new _.d(this.translateService.instant("export.quantity"))),n.addColumn(new _.d(this.translateService.instant("export.unit"))),o.addRow(n);for(const d of this.productReports)n=new R._,n.addColumn(new _.d(f.W.productName(d.product.code,d.product.title))),n.addColumn(new _.d(d.value,"number")),n.addColumn(new _.d(d.quantity,"number")),n.addColumn(new _.d(this.currency)),o.addRow(n);const a="product-report-"+f.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(o,a).then(function(){var d=(0,l.Z)(function*(C){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+a,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,C))});return function(C){return d.apply(this,arguments)}}())}}return r.\u0275fac=function(e){return new(e||r)(t.Y36(y.G),t.Y36(h.sK),t.Y36(B.$),t.Y36(W.K),t.Y36(x.r),t.Y36(i.BX),t.Y36(i.Br),t.Y36(V.x),t.Y36(b.y))},r.\u0275cmp=t.Xpm({type:r,selectors:[["product-report-detail"]],viewQuery:function(e,o){if(1&e&&t.Gf(X,7),2&e){let n;t.iGM(n=t.CRH())&&(o.chart=n.first)}},decls:50,vars:53,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","more"],[1,"ion-text-wrap"],[2,"padding-top","5px"],["style","padding-top: 5px;",4,"ngIf"],[3,"color"],["ion-button","","outline","","icon-left","",3,"disabled","click"],["name","chevron-back"],["ion-button","","outline","","icon-right","",3,"disabled","click"],["name","chevron-forward"],["ion-button","","outline","","icon-left","",3,"click"],["name","trending-up"],[4,"ngIf"],[3,"hidden"],[3,"hidden","src"],["baseChart","",3,"hidden","datasets","labels","options","legend","type",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"ngModel","ngModelChange"],["value","bar"],["value","pie"],["value","line"],["baseChart","",3,"hidden","datasets","labels","options","legend","type"],["chart",""],[3,"click"],["slot","end",4,"ngIf"],[3,"src"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",3),t.NdJ("click",function(){return o.presentActionSheet()}),t._UZ(11,"ion-icon",5),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item")(15,"ion-label",6)(16,"b"),t._uU(17),t.qZA(),t.TgZ(18,"ion-text",7)(19,"span"),t._uU(20),t.ALo(21,"translate"),t.ALo(22,"translate"),t.qZA()(),t._UZ(23,"br"),t.YNc(24,z,4,4,"p",8),t.TgZ(25,"p",7)(26,"ion-text",9),t._uU(27),t.ALo(28,"translate"),t.ALo(29,"currency"),t.qZA(),t._uU(30),t.ALo(31,"translate"),t.qZA()()(),t.TgZ(32,"ion-item")(33,"ion-button",10),t.NdJ("click",function(){return o.previousMoment()}),t._UZ(34,"ion-icon",11),t._uU(35),t.ALo(36,"translate"),t.qZA(),t.TgZ(37,"ion-button",12),t.NdJ("click",function(){return o.nextMoment()}),t._uU(38),t.ALo(39,"translate"),t._UZ(40,"ion-icon",13),t.qZA(),t.TgZ(41,"ion-button",14),t.NdJ("click",function(){return o.viewTrend()}),t._UZ(42,"ion-icon",15),t._uU(43),t.ALo(44,"translate"),t.qZA()(),t.YNc(45,tt,14,13,"ion-item",16),t.TgZ(46,"div",17),t._UZ(47,"img",18),t.YNc(48,et,2,6,"canvas",19),t.qZA(),t.YNc(49,nt,8,15,"ion-item-sliding",20),t.qZA()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,27,"report-product-detail.title")),t.xp6(7),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(5),t.Oqu(o.report.name),t.xp6(3),t.xDo(" ",o.dateType," (",t.lcZ(21,29,"common.from")," ",o.dateFrom," ",t.lcZ(22,31,"common.to")," ",o.dateTo,") "),t.xp6(4),t.Q6J("ngIf",o.filter),t.xp6(2),t.s9C("color",o.totalValue>=0?"secondary":"danger"),t.xp6(1),t.lnq(" ",t.lcZ(28,33,"common.total"),": ",o.totalValue>=0?"+":"","",t.G7q(29,35,t.kEZ(49,U,o.totalValue,o.currency,o.translateService.currentLang))," "),t.xp6(3),t.AsE(" / ",o.totalProduct," ",t.lcZ(31,41,"report-product-detail.products"),". "),t.xp6(3),t.Q6J("disabled",o.isLoadingChart),t.xp6(2),t.hij("\xa0 ",t.lcZ(36,43,"report-detail.pre")," "),t.xp6(2),t.Q6J("disabled",o.isLoadingChart),t.xp6(1),t.hij(" ",t.lcZ(39,45,"report-detail.next"),"\xa0 "),t.xp6(5),t.hij(" ",t.lcZ(44,47,"report-detail.view-trend")," "),t.xp6(2),t.Q6J("ngIf",o.isInChartMode),t.xp6(1),t.Q6J("hidden",!o.isInChartMode),t.xp6(1),t.Q6J("hidden",!o.isCapturing)("src",o.chartImg,t.LSH),t.xp6(1),t.Q6J("ngIf",!o.isLoadingChart),t.xp6(1),t.Q6J("ngForOf",o.productReports))},dependencies:[p.sg,p.O5,u.JJ,u.On,i.BJ,i.oU,i.YG,i.Sm,i.W2,i.Gu,i.gu,i.Ie,i.td,i.Q$,i.q_,i.t9,i.n0,i.yW,i.wd,i.sr,i.QI,i.cs,J.jh,p.H9,h.X$],encapsulation:2}),r})()}];let at=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({imports:[Z.Bz.forChild(it),Z.Bz]}),r})();var st=s(2216),M=s(3093);let ct=(()=>{class r{}return r.\u0275fac=function(e){return new(e||r)},r.\u0275mod=t.oAB({type:r}),r.\u0275inj=t.cJS({providers:[{provide:J.$g,useValue:{generateColors:!1}}],imports:[p.ez,u.u5,i.Pc,at,M.m,J.vQ,st.uH,h.aw.forChild({loader:{provide:h.Zw,useFactory:M.x,deps:[P.eN]}})]}),r})()},8851:(O,A,s)=>{s.d(A,{L:()=>l});var p=s(6738),u=s(5439),h=s(1914),P=s(4006),Z=s(191);let l=(()=>{class v{constructor(){this.min=null,this.max=null,this.pickerId=null,this.date="",this.type="date",this.dateChange=new p.vpe}ionViewWillEnter(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?u(this.date.split(":00Z").join("")).format(h.C.getDateTimeDbFormat()):u(this.date.split(":00Z").join("")).format(h.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}ngOnInit(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?u(this.date.split(":00Z").join("")).format(h.C.getDateTimeDbFormat()):u(this.date.split(":00Z").join("")).format(h.C.getDateDbFormat()):this.date,this.min||(this.min="1900-01-01"),this.max||(this.max="2100-01-01")}change(){this.date=this.date&&this.date.length>10?"datetime-local"===this.type?u(this.date.split(":00Z").join("")).format(h.C.getDateTimeDbFormat()):u(this.date.split(":00Z").join("")).format(h.C.getDateDbFormat()):this.date,this.dateChange.emit(this.date)}}return v.\u0275fac=function(f){return new(f||v)},v.\u0275cmp=p.Xpm({type:v,selectors:[["date-picker"]],inputs:{min:"min",max:"max",pickerId:"pickerId",date:"date",type:"type"},outputs:{dateChange:"dateChange"},decls:1,vars:4,consts:[["color","primary",1,"ion-button",2,"font-size","0.8em",3,"type","ngModel","min","max","ngModelChange","ionChange"]],template:function(f,t){1&f&&(p.TgZ(0,"ion-input",0),p.NdJ("ngModelChange",function(y){return t.date=y})("ionChange",function(){return t.change()}),p.qZA()),2&f&&p.Q6J("type",t.type)("ngModel",t.date)("min",t.min)("max",t.max)},dependencies:[P.JJ,P.On,Z.pK,Z.j9],encapsulation:2}),v})()}}]);