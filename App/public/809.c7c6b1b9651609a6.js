"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[809],{809:(Y,O,c)=>{c.r(O),c.d(O,{DebtManagementPageModule:()=>Xt});var C=c(6895),T=c(4006),n=c(191),U=c(3196),b=c(5861),S=c(6841),f=c(7489),v=c(1914),t=c(6738),L=c(7833),x=c(3306),N=c(7488),Z=c(3876),A=c(5851),g=c(7852),u=c(667),h=c(323),m=c(6391),s=c(360);function k(i,d){1&i&&(t.TgZ(0,"ion-title"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt.title")))}function B(i,d){1&i&&(t.TgZ(0,"ion-title"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"loans.title")))}function W(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item",27)(1,"ion-label",16),t._uU(2),t.qZA(),t.TgZ(3,"ion-buttons")(4,"ion-button",28),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.exitStore())}),t._UZ(5,"ion-icon",29),t._uU(6),t.ALo(7,"translate"),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(e.checkStore),t.xp6(4),t.hij(" ",t.lcZ(7,2,"store.exit-store")," ")}}function R(i,d){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateOnlyFormat(e.dateFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateOnlyFormat(e.dateTo)," ")}}function $(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"debt-item",31),t.NdJ("onPress",function(){t.CHM(e);const a=t.oxw().$implicit,r=t.oxw();return t.KtG(r.presentActionSheet(a))})("onClick",function(){t.CHM(e);const a=t.oxw().$implicit,r=t.oxw();return t.KtG(r.selectDebt(a.id))}),t.qZA()}if(2&i){const e=t.oxw().$implicit,o=t.oxw();t.Q6J("debt",e)("currency",o.currency)("showContact",!0)("showProduct",!0)}}function V(i,d){if(1&i&&(t.ynx(0),t.YNc(1,$,1,4,"debt-item",30),t.BQk()),2&i){const e=d.$implicit,o=t.oxw();t.xp6(1),t.Q6J("ngIf",!o.showLeftOnly||e.value-e.valuePaid>0)}}function X(i,d){1&i&&(t.TgZ(0,"ion-item",32),t._UZ(1,"div",33),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"debt.no-debt"),t.oJD))}function z(i,d){1&i&&(t.TgZ(0,"div",34),t._UZ(1,"support"),t.qZA())}const Q=function(i,d,e){return[i,d,"symbol","1.0-2",e]};let tt=(()=>{class i{constructor(e,o,a,r,l,p,_,I,y,M,P){this.debtService=e,this.translateService=o,this.userService=a,this.modalCtrl=r,this.storeService=l,this.navCtrl=p,this.actionSheetCtrl=_,this.alertCtrl=I,this.storage=y,this.staffService=M,this.analyticsService=P,this.params=null,this.searchKey="",this.noteFilter="frequency",this.total=0,this.totalPaid=0,this.dateFrom="",this.dateTo="",this.debtType="2",this.page="debts",this.showLeftOnly=!1;const w=E=>{const J=E.detail;this.reload(),J&&(this.debtType=J.type,this.filter())};this.navCtrl.removeEventListener("reloadDebtList",w),this.navCtrl.addEventListener("reloadDebtList",w)}ionViewWillEnter(){var e=this;return(0,b.Z)(function*(){yield e.analyticsService.setCurrentScreen("debt")})()}ngOnInit(){this.reload()}reload(){var e=this;return(0,b.Z)(function*(){const o=yield e.navCtrl.loading();e.currency=yield e.userService.getAttr("current-currency"),e.stores=yield e.storeService.getStores(),e.store=yield e.storeService.getCurrentStore(),e.checkStore=e.store?e.translateService.instant("store.check-store",{shop:e.store.name}):null,e.selectedStaff=e.staffService.selectedStaff;const a=yield e.storage.get("left-only");e.showLeftOnly=a&&!0,e.params=e.navCtrl.getParams(e.params),e.params.page&&(e.page=e.params.page,e.debtType="debts"==e.page?"3":"0"),e.params.type&&(e.debtType=e.params.type),e.dateFrom=e.params.dateFrom?e.params.dateFrom:e.dateFrom?e.dateFrom:v.C.GetFirstDateOfMonth(),e.dateTo=e.params.dateTo?e.params.dateTo:e.dateTo?e.dateTo:v.C.GetEndDateOfMonth(),e.debtService.getDebts(e.dateFrom,e.dateTo,e.store?e.store.id:0).then(function(){var r=(0,b.Z)(function*(l){const p=[];if(l&&l.length)for(const _ of l)_.store=!e.checkStore&&_.storeId&&e.stores&&e.stores.length?e.stores.find(I=>I.id==_.storeId):null,p.push(_);e.originalDebts=JSON.parse(JSON.stringify(p)),e.debts=p,e.total=f.sumBy(e.debts,_=>_.value),e.totalPaid=f.sumBy(e.debts,_=>_.valuePaid),e.filter(),yield o.dismiss()});return function(l){return r.apply(this,arguments)}}())})()}changeLeftOnly(){var e=this;return(0,b.Z)(function*(){e.showLeftOnly?yield e.storage.set("left-only","1"):yield e.storage.remove("left-only")})()}openDebtAdd(){this.navCtrl.navigateForward("/debt/add",{debtType:+this.debtType})}search(){var e=this;return(0,b.Z)(function*(){e.analyticsService.logEvent("debt-search");let o=JSON.parse(JSON.stringify(e.originalDebts));if(null!==e.searchKey&&""!==e.searchKey){let a=e.searchKey.toLowerCase();o=o.filter(r=>r.note&&-1!==r.note.toLowerCase().indexOf(a)||r.contact&&r.contact.fullName&&-1!==r.contact.fullName.toLowerCase().indexOf(a)||r.contact&&r.contact.mobile&&-1!==r.contact.mobile.toLowerCase().indexOf(a)||r.product&&r.product.code&&-1!==r.product.code.toLowerCase().indexOf(a)||r.product&&r.product.title&&-1!==r.product.title.toLowerCase().indexOf(a))}e.debts=o,e.total=f.sumBy(e.debts,a=>a.value),e.totalPaid=f.sumBy(e.debts,a=>a.valuePaid)})()}clearSearch(){this.searchKey=null,this.reload()}filter(){let e=JSON.parse(JSON.stringify(this.originalDebts));e=e&&e.length?e.filter(o=>o.debtType===+this.debtType):[],e=this.sortByModifiedAt(e),this.debts=e,this.total=f.sumBy(this.debts,o=>o.value),this.totalPaid=f.sumBy(this.debts,o=>o.valuePaid)}changeDeptType(){this.filter()}sortByModifiedAt(e){return e?f.orderBy(e,["createdAt"],["desc"]):null}dateOnlyFormat(e){return v.C.toUiDateString(e)}selectDebt(e){this.navCtrl.navigateForward("/debt/detail",{id:e})}deleteDebt(e){var o=this;return(0,b.Z)(function*(){yield(yield o.alertCtrl.create({header:o.translateService.instant("common.confirm"),message:o.translateService.instant("debt.delete-alert"),buttons:[{text:o.translateService.instant("common.cancel"),handler:()=>{}},{text:o.translateService.instant("common.agree"),handler:()=>{o.debtService.deleteDebt(e).then((0,b.Z)(function*(){o.analyticsService.logEvent("debt-delete-success");let r=o.debts.findIndex(l=>l.id==e.id);r>=0&&(o.debts.splice(r,1),o.total=f.sumBy(o.debts,l=>l.value),o.totalPaid=f.sumBy(o.debts,l=>l.valuePaid)),r=o.originalDebts.findIndex(l=>l.id==e.id),r>=0&&o.originalDebts.splice(r,1)}))}}]})).present()})()}presentActionSheet(e){var o=this;return(0,b.Z)(function*(){yield(yield o.actionSheetCtrl.create({header:o.translateService.instant("action.action"),buttons:[{text:o.translateService.instant("debt.delete-debt"),role:"destructive",handler:()=>{o.deleteDebt(e)}},{text:o.translateService.instant("debt.edit-debt"),handler:()=>{o.selectDebt(e.id)}},{text:o.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}selectDateRangeForDebt(){var e=this;return(0,b.Z)(function*(){let o=yield e.modalCtrl.create({component:S.S,componentProps:{dateFromInput:e.dateFrom,dateToInput:e.dateTo}});yield o.present();const{data:a}=yield o.onDidDismiss();a&&(e.dateFrom=""!=a.dateFrom?v.C.toDbString(a.dateFrom,v.C.getDbFormat()):"",e.dateTo=""!=a.dateTo?v.C.toDbString(a.dateTo,v.C.getDbFormat()):"",e.debtService.getDebts(e.dateFrom,e.dateTo,e.store?e.store.id:0).then(r=>{const l=[];if(r&&r.length)for(const p of r)p.store=!e.checkStore&&p.storeId&&e.stores&&e.stores.length?e.stores.find(_=>_.id==p.storeId):null,l.push(p);e.originalDebts=JSON.parse(JSON.stringify(l)),e.debts=l,e.total=f.sumBy(e.debts,p=>p.value),e.totalPaid=f.sumBy(e.debts,p=>p.valuePaid),e.filter()}))})()}addReport(){this.navCtrl.navigateForward("/debt-report/add",null)}exitStore(){var e=this;return(0,b.Z)(function*(){var a;yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("store.exit-store-alert",{shop:e.store.name}),buttons:[{text:e.translateService.instant("common.agree"),handler:(a=(0,b.Z)(function*(){yield e.storeService.exitStore(),yield e.reload()}),function(){return a.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(L.E),t.Y36(x.sK),t.Y36(N.K),t.Y36(n.IN),t.Y36(Z.d),t.Y36(A.G),t.Y36(n.BX),t.Y36(n.Br),t.Y36(g.V),t.Y36(u.x),t.Y36(h.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["debt"]],decls:55,vars:64,consts:[["slot","start"],["menu","first"],["color","primary",3,"click"],["name","home"],[4,"ngIf"],["slot","end"],[3,"click"],["name","add-circle"],["lines","none","color","success",4,"ngIf"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[3,"ngModel","ngModelChange"],["value","0",3,"hidden"],["value","1",3,"hidden"],["value","3",3,"hidden"],["value","2",3,"hidden"],["text-wrap","","lines","none"],[1,"ion-text-wrap"],["color","danger"],["color","secondary"],["fill","clear","color","primary","slot","end",3,"click"],["name","funnel"],[1,"ion-text-wrap",2,"font-size","0.9em"],[4,"ngFor","ngForOf"],["text-wrap","",4,"ngIf"],["class","ion-padding","style","padding-top: 0 !important;",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["lines","none","color","success"],["size","small",3,"click"],["name","exit","slot","start","size","small"],[3,"debt","currency","showContact","showProduct","onPress","onClick",4,"ngIf"],[3,"debt","currency","showContact","showProduct","onPress","onClick"],["text-wrap",""],[3,"innerHTML"],[1,"ion-padding",2,"padding-top","0 !important"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button",1),t.TgZ(4,"ion-button",2),t.NdJ("click",function(){return o.navCtrl.home()}),t._UZ(5,"ion-icon",3),t.qZA()(),t.YNc(6,k,3,3,"ion-title",4),t.YNc(7,B,3,3,"ion-title",4),t.TgZ(8,"ion-buttons",5)(9,"ion-button",6),t.NdJ("click",function(){return o.openDebtAdd()}),t._UZ(10,"ion-icon",7),t.qZA()()(),t.YNc(11,W,8,4,"ion-item",8),t.qZA(),t.TgZ(12,"ion-content")(13,"ion-searchbar",9),t.NdJ("ionClear",function(){return o.clearSearch()})("ionChange",function(){return o.search()})("ngModelChange",function(r){return o.searchKey=r}),t.ALo(14,"translate"),t.qZA(),t.TgZ(15,"ion-segment",10),t.NdJ("ngModelChange",function(r){return o.debtType=r})("ngModelChange",function(){return o.changeDeptType()}),t.TgZ(16,"ion-segment-button",11),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"ion-segment-button",12),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-segment-button",13),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.TgZ(25,"ion-segment-button",14),t._uU(26),t.ALo(27,"translate"),t.qZA()(),t.TgZ(28,"ion-list")(29,"ion-item",15)(30,"ion-label",16),t.YNc(31,R,5,8,"span",4),t._uU(32),t.ALo(33,"translate"),t.TgZ(34,"ion-text",17),t._uU(35),t.ALo(36,"currency"),t.qZA(),t._uU(37),t.ALo(38,"translate"),t.TgZ(39,"ion-text",18),t._uU(40),t.ALo(41,"currency"),t.qZA()(),t.TgZ(42,"ion-button",19),t.NdJ("click",function(){return o.selectDateRangeForDebt()}),t._UZ(43,"ion-icon",20),t.qZA()(),t.TgZ(44,"ion-item")(45,"ion-checkbox",10),t.NdJ("ngModelChange",function(r){return o.showLeftOnly=r})("ngModelChange",function(){return o.changeLeftOnly()}),t.qZA(),t.TgZ(46,"ion-label",21),t._uU(47),t.ALo(48,"translate"),t.qZA()(),t.YNc(49,V,2,1,"ng-container",22),t.YNc(50,X,3,3,"ion-item",23),t.qZA(),t.YNc(51,z,2,0,"div",24),t.TgZ(52,"ion-fab",25)(53,"ion-fab-button",6),t.NdJ("click",function(){return o.openDebtAdd()}),t._UZ(54,"ion-icon",26),t.qZA()()()),2&e&&(t.xp6(6),t.Q6J("ngIf","debts"==o.page),t.xp6(1),t.Q6J("ngIf","loans"==o.page),t.xp6(4),t.Q6J("ngIf",o.checkStore&&(null==o.selectedStaff||o.selectedStaff.hasFullAccess&&!o.selectedStaff.storeId)),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.s9C("placeholder",t.lcZ(14,28,"debt.search")),t.Q6J("ngModel",o.searchKey),t.xp6(2),t.Q6J("ngModel",o.debtType),t.xp6(1),t.Q6J("hidden","loans"!==o.page),t.xp6(1),t.hij(" ",t.lcZ(18,30,"debt-add.you-borrowed")," "),t.xp6(2),t.Q6J("hidden","loans"!==o.page),t.xp6(1),t.hij(" ",t.lcZ(21,32,"debt-add.borrowed-you")," "),t.xp6(2),t.Q6J("hidden","debts"!==o.page),t.xp6(1),t.hij(" ",t.lcZ(24,34,"debt-add.owned-you")," "),t.xp6(2),t.Q6J("hidden","debts"!==o.page),t.xp6(1),t.hij(" ",t.lcZ(27,36,"debt-add.you-owned")," "),t.xp6(5),t.Q6J("ngIf",""!=o.dateFrom||""!=o.dateTo),t.xp6(1),t.hij(" ",t.lcZ(33,38,"debt.total-amount-left"),": "),t.xp6(3),t.Oqu(t.G7q(36,40,t.kEZ(56,Q,o.total-o.totalPaid,o.currency,o.translateService.currentLang))),t.xp6(2),t.hij(" / ",t.lcZ(38,46,"debt-detail.paid"),": "),t.xp6(3),t.Oqu(t.G7q(41,48,t.kEZ(60,Q,o.totalPaid,o.currency,o.translateService.currentLang))),t.xp6(5),t.Q6J("ngModel",o.showLeftOnly),t.xp6(2),t.Oqu(t.lcZ(48,54,"debt.show-left-only")),t.xp6(2),t.Q6J("ngForOf",o.debts),t.xp6(1),t.Q6J("ngIf",!o.originalDebts||0===o.originalDebts.length),t.xp6(1),t.Q6J("ngIf",!o.originalDebts||0===o.originalDebts.length),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"margin-bottom: 60px":""))},dependencies:[C.sg,C.O5,T.JJ,T.On,n.YG,n.Sm,n.nz,n.W2,n.IJ,n.W4,n.Gu,n.gu,n.Ie,n.Q$,n.q_,n.fG,n.VI,n.cJ,n.GO,n.yW,n.wd,n.sr,n.w,n.QI,n.j9,m.A,s.Y,C.H9,x.X$],encapsulation:2}),i})();var D=c(6723),q=c(8947),et=c(5618),K=c(9250);class nt{constructor(){this.id=0,this.debtId=0,this.categoryId=0,this.onlineId=0,this.tradeCategory=new et.b,this.debt=new q.T,this.joins=[new K.N("categoryId","tradeCategory",D.W.tradeCategoryTableName),new K.N("debtId","debt",D.W.debtTableName)]}}var G=c(7696),ot=c(6961),H=c(5583),it=c(7725),at=c(8007),rt=c(7613);function dt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-text",23),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.showSearchContact())}),t._uU(1),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.contactSelected.fullName," ")}}function ct(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-text",24),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.showSearchContact())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"debt-add.select-contact")," "))}function lt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-button",25),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.removeContact())}),t._UZ(1,"ion-icon",26),t.qZA()}}function st(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-text",23),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.showSearchProduct())}),t._uU(1),t.qZA()}if(2&i){const e=t.oxw();t.xp6(1),t.hij(" ",e.productName(e.productSelected.code,e.productSelected.title)," ")}}function pt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-text",24),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.showSearchProduct())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"debt-add.select-product")," "))}function _t(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-button",25),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.removeProduct())}),t._UZ(1,"ion-icon",26),t.qZA()}}function ut(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",5),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-toggle",14),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.debt.isPurchase=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.changeIsPurchase())}),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.Oqu(t.lcZ(3,2,"debt-add.is-purchase")),t.xp6(2),t.Q6J("ngModel",e.debt.isPurchase)}}const mt=function(i,d,e){return[i,d,!0,"1.0-2",e]};function bt(i,d){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"currency"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.AsE("(",t.G7q(2,2,t.kEZ(8,mt,e.productSelected.price,e.currency.code,e.translateService.currentLang)),"/",e.productSelected.unit,")")}}function gt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",12),t._uU(2),t.ALo(3,"translate"),t.YNc(4,bt,3,12,"span",11),t.qZA(),t.TgZ(5,"money-input",13),t.NdJ("moneyValueChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.debt.productCount=a)})("moneyValueChange",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.changeProductCount())}),t.ALo(6,"translate"),t.qZA()()}if(2&i){const e=t.oxw();t.xp6(2),t.hij("",t.lcZ(3,5,"debt-add.product-count")," "),t.xp6(2),t.Q6J("ngIf",e.productSelected.unit),t.xp6(1),t.s9C("placeholder",t.lcZ(6,7,"debt-add.enter-product-count")),t.Q6J("clear",!0)("moneyValue",e.debt.productCount)}}function ht(i,d){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.AsE("(",e.currency.symbol_native," - ",e.currency.code,")")}}function ft(i,d){1&i&&(t.TgZ(0,"ion-select-option",27),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.Q6J("value",0),t.xp6(1),t.hij("",t.lcZ(2,2,"debt-add.you-borrowed")," "))}function vt(i,d){1&i&&(t.TgZ(0,"ion-select-option",27),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.Q6J("value",1),t.xp6(1),t.hij("",t.lcZ(2,2,"debt-add.borrowed-you")," "))}function Ct(i,d){1&i&&(t.TgZ(0,"ion-select-option",27),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.Q6J("value",2),t.xp6(1),t.hij("",t.lcZ(2,2,"debt-add.you-owned")," "))}function Zt(i,d){1&i&&(t.TgZ(0,"ion-select-option",27),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.Q6J("value",3),t.xp6(1),t.hij("",t.lcZ(2,2,"debt-add.owned-you")," "))}function Tt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item")(1,"span"),t._uU(2),t.qZA(),t.TgZ(3,"ion-button",25),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw();return t.KtG(l.removeCategory(r))}),t._uU(4),t.ALo(5,"translate"),t._UZ(6,"ion-icon",28),t.qZA()()}if(2&i){const e=d.$implicit;t.xp6(2),t.Oqu(e.tradeCategory.title),t.xp6(2),t.hij(" ",t.lcZ(5,2,"debt-add.remove")," ")}}let xt=(()=>{class i{constructor(e,o,a,r,l,p,_,I,y,M,P,w,E){this.navCtrl=e,this.staffService=o,this.modalCtrl=a,this.debtService=r,this.contactService=l,this.productService=p,this.orderService=_,this.receivedNoteService=I,this.alertCtrl=y,this.userService=M,this.storeService=P,this.translateService=w,this.analyticsService=E,this.params=null,this.debt=new q.T,this.noteSegment="content",this.categories=[],this.categoriesToRemove=[],this.page="debts",this.isNew=!0,this.saveDisabled=!1,this.onKeyPress=J=>{!J.target||"body"!==J.target.localName||("s"===J.key||"S"===J.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var e=this;return(0,b.Z)(function*(){yield e.analyticsService.setCurrentScreen("debt-add")})()}ngOnInit(){var e=this;return(0,b.Z)(function*(){e.userService.getAttr("current-currency").then(_=>{e.currency=D.W.getCurrencyByCode(_)}),e.debt=new q.T,e.params=e.navCtrl.getParams(e.params);let o=0,a=0,r=0,l=0;e.store=yield e.storeService.getCurrentStore();let p=0;if(e.params&&(e.params.id?(o=e.params.id,e.isNew=!1):e.params.contact?a=+e.params.contact:e.params.product?r=+e.params.product:e.params.order?l=+e.params.order:e.params.receivedNote&&(p=+e.params.receivedNote),e.params.debtType?(e.debt.debtType=e.params.debtType,e.page=0==e.params.debtType||1==e.params.debtType?"loans":"debts"):(e.debt.debtType=0,e.page="loans")),o&&o>0){const _=yield e.navCtrl.loading();e.debtService.get(o).then(function(){var I=(0,b.Z)(function*(y){yield _.dismiss(),e.contactSelected=y.contact,e.productSelected=y.product,e.orderSelected=y.order,e.debt=y,e.debtService.getCategoriesToDebt(o).then(M=>{e.categories=M})});return function(y){return I.apply(this,arguments)}}())}else a&&a>0?e.contactService.get(a).then(_=>{e.contactSelected=_,e.debt.contactId=_.id}):r&&r>0?e.productService.get(r,e.store?e.store.id:0).then(_=>{e.productSelected=_,e.debt.productId=_.id}):l&&l>0?e.orderService.get(l).then(_=>{e.orderSelected=_,e.contactSelected=_.contact,e.debt.contact=_.contact,e.debt.contactId=_.contact?_.contactId:0,e.debt.order=_,e.debt.orderId=_.id,e.debt.debtType=3,e.debt.value=e.orderSelected.total,e.page="debts"}):p&&p>0&&e.receivedNoteService.get(p).then(_=>{e.receivedNoteSelected=_,e.contactSelected=_.contact,e.debt.contact=_.contact,e.debt.contactId=_.contact?_.contactId:0,e.debt.receivedNote=_,e.debt.receivedNoteId=_.id,e.debt.debtType=2,e.debt.value=e.receivedNoteSelected.total,e.page="debts"})})()}showSearchContact(){var e=this;return(0,b.Z)(function*(){e.navCtrl.push("/contact",{callback:a=>{const r=a;r&&(e.contactSelected=r,e.debt.contactId=r.id,e.debt.contact=r)},searchMode:!0})})()}showSearchProduct(){var e=this;return(0,b.Z)(function*(){e.navCtrl.push("/product",{callback:a=>{const r=a;r&&(e.productSelected=r,e.debt.productId=r.id,e.debt.product=r)},searchMode:!0})})()}save(){var e=this;return(0,b.Z)(function*(){e.saveDisabled=!0,e.staffService.isStaff()&&(e.debt.staffId=e.staffService.selectedStaff.id);const o=yield e.navCtrl.loading();e.debt.storeId=e.store?e.store.id:0,e.debtService.saveDebt(e.debt).then(function(){var a=(0,b.Z)(function*(r){e.analyticsService.logEvent("debt-add-save-success");const l=[];if(e.contactSelected){const p=e.saveLastActive();l.push(p)}if(e.categories&&e.categories.length>0){const p=e.debtService.saveCategoriesToDebt(e.categories,+r);l.push(p)}if(e.categoriesToRemove&&e.categoriesToRemove.length>0){const p=e.debtService.deleteCategoriesToDebt(e.categoriesToRemove);l.push(p)}Promise.all(l).then((0,b.Z)(function*(){yield o.dismiss(),e.navCtrl.publish("reloadDebtList",{type:e.debt.debtType.toString()}),e.navCtrl.publish("reloadDebt",e.debt),e.debt.contact&&0!=e.debt.contact.id&&(e.navCtrl.publish("reloadContact",e.debt.contact),e.navCtrl.publish("reloadContactDebt",e.debt.contact.id)),e.debt.order&&0!=e.debt.order.id&&(e.debt.order.status=5,e.orderService.saveOrder(e.debt.order).then(()=>{e.navCtrl.publish("reloadOrder",e.debt.order),e.navCtrl.publish("reloadOrderList",null)})),e.debt.receivedNote&&0!=e.debt.receivedNote.id&&(e.navCtrl.publish("reloadReceivedNoteList"),e.navCtrl.publish("reloadReceivedNote",e.debt.receivedNote)),e.exitPage()}))});return function(r){return a.apply(this,arguments)}}())})()}saveLastActive(){return this.contactSelected.lastActive=v.C.toDbString(),this.contactSelected.lastAction="trade",this.contactService.saveContact(this.contactSelected).then(o=>(this.navCtrl.publish("reloadContactList",null),this.navCtrl.publish("reloadContact",this.contactSelected),this.navCtrl.publish("reloadContactDebt",this.contactSelected.id),o))}exitPage(){var e=this;return(0,b.Z)(function*(){var a;yield e.navCtrl.popOnly(),e.navCtrl.publish("reloadDebtList",{type:e.debt.debtType.toString()}),e.navCtrl.publish("reloadDebt",e.debt),e.isNew&&(yield e.navCtrl.push("/debt/detail",{id:e.debt.id})),(0==e.debt.debtType||1==e.debt.debtType)&&(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("debt.loan-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:(a=(0,b.Z)(function*(){e.debtService.saveDebt(e.debt),yield e.navCtrl.push("/trade/add",{loan:e.debt.id})}),function(){return a.apply(this,arguments)})}]})).present()})()}removeCategory(e){0!==e.id&&this.categoriesToRemove.push(e),f.remove(this.categories,o=>o.categoryId===e.categoryId)}showSearchCategory(){var e=this;return(0,b.Z)(function*(){const o=function(){var a=(0,b.Z)(function*(r){const l=r;if(l)if(e.categories.findIndex(p=>p.categoryId===l.id)>=0)(yield e.alertCtrl.create({header:"Ch\xfa \xfd",subHeader:"B\u1ea1n \u0111\xe3 th\xeam Danh m\u1ee5c n\xe0y r\u1ed3i.",buttons:["OK"]})).present();else{const p=new nt;p.tradeCategory=l,p.categoryId=l.id,e.categories.push(p)}});return function(l){return a.apply(this,arguments)}}();e.navCtrl.push("/trade-category",{callback:o,searchMode:!0})})()}removeContact(){this.contactSelected=null,this.debt.contactId=0}removeProduct(){this.productSelected=null,this.debt.productId=0,this.debt.productCount=0,this.debt.isPurchase=!1}changeProductCount(){!this.productSelected||!this.debt.isPurchase||(this.debt.value=this.debt.productCount*this.productSelected.price)}changeIsPurchase(){this.debt.productCount=0}productName(e,o){return D.W.productName(e,o)}selectAll(e){D.W.selectAll(e)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(A.G),t.Y36(u.x),t.Y36(n.IN),t.Y36(L.E),t.Y36(G.y),t.Y36(ot.M),t.Y36(H.p),t.Y36(it.r),t.Y36(n.Br),t.Y36(N.K),t.Y36(Z.d),t.Y36(x.sK),t.Y36(h.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["debt-add"]],decls:81,vars:76,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["ion-button","","color","primary",3,"disabled","click"],["name","checkmark"],["color","primary"],["color","dark","slot","end",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["fill","outline","slot","end",3,"click",4,"ngIf"],[3,"hidden"],["color","dark","slot","end"],[4,"ngIf"],["position","stacked","color","primary"],[3,"clear","placeholder","moneyValue","moneyValueChange"],[3,"ngModel","ngModelChange"],[3,"value",4,"ngIf"],["fill","outline",3,"click"],["name","add"],[4,"ngFor","ngForOf"],["pickerId","debtAddCreatedAt",3,"date","label","dateChange"],["pickerId","debtAddMaturityDate",3,"date","label","dateChange"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus"],["type","text","rows","6",3,"placeholder","ngModel","ngModelChange"],["color","dark","slot","end",3,"click"],["slot","end",3,"click"],["fill","outline","slot","end",3,"click"],["slot","icon-only","name","close"],[3,"value"],["name","remove"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.save()}),t._UZ(9,"ion-icon",4),t._uU(10),t.ALo(11,"translate"),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item")(15,"ion-text",5),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.YNc(18,dt,2,1,"ion-text",6),t.YNc(19,ct,3,3,"ion-text",7),t.YNc(20,lt,2,0,"ion-button",8),t.qZA(),t.TgZ(21,"ion-item",9)(22,"ion-text",5),t._uU(23),t.ALo(24,"translate"),t.qZA(),t.YNc(25,st,2,1,"ion-text",6),t.YNc(26,pt,3,3,"ion-text",7),t.YNc(27,_t,2,0,"ion-button",8),t.qZA(),t.TgZ(28,"ion-item",9)(29,"ion-text",5),t._uU(30),t.ALo(31,"translate"),t.qZA(),t.TgZ(32,"ion-text",10),t._uU(33),t.qZA()(),t.YNc(34,ut,5,4,"ion-item",11),t.YNc(35,gt,7,9,"ion-item",11),t.TgZ(36,"ion-item")(37,"ion-label",12),t._uU(38),t.ALo(39,"translate"),t.YNc(40,ht,2,2,"span",11),t.qZA(),t.TgZ(41,"money-input",13),t.NdJ("moneyValueChange",function(r){return o.debt.value=r}),t.ALo(42,"translate"),t.qZA()(),t.TgZ(43,"ion-item")(44,"ion-label",5),t._uU(45),t.ALo(46,"translate"),t.qZA(),t.TgZ(47,"ion-select",14),t.NdJ("ngModelChange",function(r){return o.debt.debtType=r}),t.YNc(48,ft,3,4,"ion-select-option",15),t.YNc(49,vt,3,4,"ion-select-option",15),t.YNc(50,Ct,3,4,"ion-select-option",15),t.YNc(51,Zt,3,4,"ion-select-option",15),t.qZA()()(),t.TgZ(52,"ion-list")(53,"ion-list-header")(54,"ion-label"),t._uU(55),t.ALo(56,"translate"),t.qZA(),t.TgZ(57,"ion-button",16),t.NdJ("click",function(){return o.showSearchCategory()}),t._UZ(58,"ion-icon",17),t._uU(59),t.ALo(60,"translate"),t.qZA()(),t.YNc(61,Tt,7,4,"ion-item",18),t.TgZ(62,"date-item",19),t.NdJ("dateChange",function(r){return o.debt.createdAt=r}),t.ALo(63,"translate"),t.qZA(),t.TgZ(64,"date-item",20),t.NdJ("dateChange",function(r){return o.debt.maturityDate=r}),t.ALo(65,"translate"),t.qZA(),t.TgZ(66,"ion-item")(67,"ion-label",12),t._uU(68),t.ALo(69,"translate"),t.qZA(),t.TgZ(70,"ion-input",21),t.NdJ("ngModelChange",function(r){return o.debt.interestRate=r})("focus",function(r){return o.selectAll(r)}),t.ALo(71,"translate"),t.qZA()(),t.TgZ(72,"ion-item")(73,"ion-label"),t._uU(74),t.ALo(75,"translate"),t.qZA(),t.TgZ(76,"ion-toggle",14),t.NdJ("ngModelChange",function(r){return o.debt.isPaid=r}),t.qZA()()(),t.TgZ(77,"ion-list")(78,"ion-list-header")(79,"ion-textarea",22),t.NdJ("ngModelChange",function(r){return o.debt.note=r}),t.ALo(80,"translate"),t.qZA()()()()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,44,"debt-add.title")),t.xp6(3),t.Q6J("disabled",o.saveDisabled),t.xp6(2),t.hij(" \xa0",t.lcZ(11,46,"action.save")," "),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(4),t.Oqu(t.lcZ(17,48,"debt-add.contact")),t.xp6(2),t.Q6J("ngIf",o.contactSelected&&o.contactSelected.id>0),t.xp6(1),t.Q6J("ngIf",!o.contactSelected||0==o.contactSelected.id),t.xp6(1),t.Q6J("ngIf",o.contactSelected&&o.contactSelected.id>0),t.xp6(1),t.Q6J("hidden",o.orderSelected&&0!=o.orderSelected.id),t.xp6(2),t.Oqu(t.lcZ(24,50,"debt-add.product")),t.xp6(2),t.Q6J("ngIf",o.productSelected&&o.productSelected.id>0),t.xp6(1),t.Q6J("ngIf",!o.productSelected||0==o.productSelected.id),t.xp6(1),t.Q6J("ngIf",o.productSelected&&o.productSelected.id>0),t.xp6(1),t.Q6J("hidden",!o.orderSelected||0==o.orderSelected.id),t.xp6(2),t.Oqu(t.lcZ(31,52,"debt-add.order")),t.xp6(3),t.hij(" ",o.orderSelected?o.orderSelected.orderCode:""," "),t.xp6(1),t.Q6J("ngIf",o.productSelected),t.xp6(1),t.Q6J("ngIf",o.productSelected&&o.debt.isPurchase),t.xp6(3),t.hij("",t.lcZ(39,54,"debt-add.money")," "),t.xp6(2),t.Q6J("ngIf",o.currency),t.xp6(1),t.s9C("placeholder",t.lcZ(42,56,"debt-add.enter-money")),t.Q6J("clear",!0)("moneyValue",o.debt.value),t.xp6(4),t.Oqu(t.lcZ(46,58,"debt-add.debt-type")),t.xp6(2),t.Q6J("ngModel",o.debt.debtType),t.xp6(1),t.Q6J("ngIf","loans"===o.page),t.xp6(1),t.Q6J("ngIf","loans"===o.page),t.xp6(1),t.Q6J("ngIf","debts"===o.page),t.xp6(1),t.Q6J("ngIf","debts"===o.page),t.xp6(4),t.hij(" ",t.lcZ(56,60,"debt-add.categories")," "),t.xp6(4),t.hij(" ",t.lcZ(60,62,"debt-add.add")," "),t.xp6(2),t.Q6J("ngForOf",o.categories),t.xp6(1),t.Q6J("date",o.debt.createdAt)("label",t.lcZ(63,64,"debt-add.created-at")),t.xp6(2),t.Q6J("date",o.debt.maturityDate)("label",t.lcZ(65,66,"debt-add.maturity-date")),t.xp6(4),t.hij("",t.lcZ(69,68,"debt-add.interest-rate")," (%)"),t.xp6(2),t.s9C("placeholder",t.lcZ(71,70,"debt-add.enter-interest-rate")),t.Q6J("ngModel",o.debt.interestRate),t.xp6(4),t.Oqu(t.lcZ(75,72,"debt-add.is-paid")),t.xp6(2),t.Q6J("ngModel",o.debt.isPaid),t.xp6(3),t.s9C("placeholder",t.lcZ(80,74,"debt-add.short-description")),t.Q6J("ngModel",o.debt.note))},dependencies:[C.sg,C.O5,T.JJ,T.On,n.oU,n.YG,n.Sm,n.W2,n.Gu,n.gu,n.pK,n.Ie,n.Q$,n.q_,n.yh,n.t9,n.n0,n.yW,n.g2,n.wd,n.ho,n.sr,n.w,n.as,n.QI,n.j9,n.cs,at.p,rt.F,C.H9,x.X$],encapsulation:2}),i})();var yt=c(2126),At=c(3604);function Dt(i,d){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Oqu(e.debt.contact.address)}}function St(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-avatar",0),t._UZ(3,"img",19),t.qZA(),t.TgZ(4,"ion-label")(5,"h2")(6,"b"),t._uU(7),t.qZA()(),t.TgZ(8,"p"),t._uU(9),t.qZA(),t.YNc(10,Dt,2,1,"p",7),t.qZA()(),t.TgZ(11,"ion-item-options",20)(12,"ion-item-option",3),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.text())}),t._UZ(13,"ion-icon",21),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.TgZ(16,"ion-item-option",22),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.call())}),t._UZ(17,"ion-icon",23),t._uU(18),t.ALo(19,"translate"),t.qZA()()()}if(2&i){const e=t.oxw(2);t.xp6(3),t.Q6J("src",e.contactImageOrPlaceholder(),t.LSH),t.xp6(4),t.Oqu(e.debt.contact.fullName),t.xp6(2),t.Oqu(e.debt.contact.mobile),t.xp6(1),t.Q6J("ngIf",e.debt.contact.address),t.xp6(4),t.hij(" ",t.lcZ(15,6,"action.text")," "),t.xp6(4),t.hij(" ",t.lcZ(19,8,"action.call")," ")}}function It(i,d){if(1&i&&(t.TgZ(0,"ion-avatar",0),t._UZ(1,"img",19),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("src",e.debt.product.avatarUrl,t.LSH)}}const F=function(i,d,e){return[i,d,"symbol","1.0-2",e]};function Jt(i,d){if(1&i&&(t.TgZ(0,"ion-item"),t.YNc(1,It,2,1,"ion-avatar",24),t.TgZ(2,"ion-label",25)(3,"span",26)(4,"b"),t._uU(5),t.qZA()(),t._UZ(6,"br"),t.TgZ(7,"span",27),t._UZ(8,"ion-icon",28),t._uU(9),t.ALo(10,"currency"),t.qZA(),t._UZ(11,"br"),t.TgZ(12,"span"),t._uU(13),t.qZA()()()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.debt.product.avatarUrl),t.xp6(4),t.Oqu(e.productName(e.debt.product.code,e.debt.product.title)),t.xp6(4),t.hij("\xa0",t.G7q(10,5,t.kEZ(11,F,e.debt.product.price,e.currency,e.translateService.currentLang))," "),t.xp6(4),t.AsE("",e.debt.productCount," ",e.debt.product.unit,"")}}function Ut(i,d){1&i&&(t.TgZ(0,"ion-label",9),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt-detail.paid")))}function Lt(i,d){1&i&&(t.TgZ(0,"ion-label",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt-detail.not-yet-paid")))}function Nt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item"),t.YNc(1,Ut,3,3,"ion-label",29),t.YNc(2,Lt,3,3,"ion-label",30),t.TgZ(3,"ion-toggle",31),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw(2);return t.KtG(r.debt.isPaid=a)})("ngModelChange",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.isPaidChange())}),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.debt.isPaid),t.xp6(1),t.Q6J("ngIf",!e.debt.isPaid),t.xp6(1),t.Q6J("ngModel",e.debt.isPaid)}}function Mt(i,d){1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt-add.you-borrowed")))}function wt(i,d){1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt-add.borrowed-you")))}function Ot(i,d){1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt-add.you-owned")))}function qt(i,d){1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"debt-add.owned-you")))}function Pt(i,d){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"debt-add.created-at"),": ",e.dateFormat(e.debt.createdAt)," ")}}function Et(i,d){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"debt-add.maturity-date"),": ",e.dateFormat(e.debt.maturityDate)," ")}}function Ft(i,d){if(1&i&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"debt-add.interest-rate"),": ",e.debt.interestRate,"% ")}}function kt(i,d){if(1&i&&(t.TgZ(0,"ion-item",33)(1,"ion-label",25),t.YNc(2,Mt,3,3,"span",7),t.YNc(3,wt,3,3,"span",7),t.YNc(4,Ot,3,3,"span",7),t.YNc(5,qt,3,3,"span",7),t._UZ(6,"br"),t._uU(7),t.ALo(8,"translate"),t.TgZ(9,"ion-text",32),t._uU(10),t.ALo(11,"currency"),t.qZA(),t._uU(12),t.ALo(13,"translate"),t.TgZ(14,"ion-text",27),t._uU(15),t.ALo(16,"currency"),t.qZA(),t.YNc(17,Pt,3,4,"p",7),t.YNc(18,Et,3,4,"p",7),t.YNc(19,Ft,3,4,"p",7),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(2),t.Q6J("ngIf",0===e.debt.debtType),t.xp6(1),t.Q6J("ngIf",1===e.debt.debtType),t.xp6(1),t.Q6J("ngIf",2===e.debt.debtType),t.xp6(1),t.Q6J("ngIf",3===e.debt.debtType),t.xp6(2),t.hij(" ",t.lcZ(8,11,"common.total"),": "),t.xp6(3),t.hij(" ",t.G7q(11,13,t.kEZ(27,F,e.debt.value,e.currency,e.translateService.currentLang)),""),t.xp6(2),t.hij(" / ",t.lcZ(13,19,"debt-detail.paid"),": "),t.xp6(3),t.hij(" ",t.G7q(16,21,t.kEZ(31,F,e.debt.valuePaid,e.currency,e.translateService.currentLang)),""),t.xp6(2),t.Q6J("ngIf",e.debt.createdAt),t.xp6(1),t.Q6J("ngIf",e.debt.maturityDate),t.xp6(1),t.Q6J("ngIf",e.debt.interestRate)}}function Yt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-button",35),t.NdJ("click",function(){const r=t.CHM(e).$implicit,l=t.oxw(3);return t.KtG(l.moveToCategory(r))}),t._uU(1),t.qZA()}if(2&i){const e=d.$implicit;t.xp6(1),t.hij(" ",e.tradeCategory.title," ")}}function Qt(i,d){if(1&i&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,Yt,2,1,"ion-button",34),t.qZA()),2&i){const e=t.oxw(2);t.xp6(2),t.hij(" ",t.lcZ(3,2,"debt-detail.categories"),": "),t.xp6(2),t.Q6J("ngForOf",e.categories)}}function Kt(i,d){if(1&i&&(t.TgZ(0,"ion-item")(1,"ion-label",25),t._uU(2),t.qZA()()),2&i){const e=t.oxw(2);t.xp6(2),t.Oqu(e.debt.note)}}function Gt(i,d){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&i){const e=t.oxw(3);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateTo)," ")}}function Ht(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item",33)(1,"ion-label",25),t.YNc(2,Gt,5,8,"span",7),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"ion-text",36),t._uU(6),t.ALo(7,"currency"),t.qZA()(),t.TgZ(8,"ion-button",37),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.selectDateRangeForTrade())}),t._UZ(9,"ion-icon",38),t.qZA(),t.TgZ(10,"ion-button",39),t.NdJ("click",function(){t.CHM(e);const a=t.oxw(2);return t.KtG(a.pay())}),t._UZ(11,"ion-icon",40),t.qZA()()}if(2&i){const e=t.oxw(2);t.xp6(2),t.Q6J("ngIf",""!=e.dateFrom||""!=e.dateTo),t.xp6(1),t.hij(" ",t.lcZ(4,5,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.total>=0?"danger":"secondary"),t.xp6(1),t.AsE(" ",e.total>=0?"+":""," ",t.G7q(7,7,t.kEZ(13,F,e.total,e.currency,e.translateService.currentLang)),". ")}}function jt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"trade-item",41),t.NdJ("onClick",function(){const r=t.CHM(e).$implicit,l=t.oxw(2);return t.KtG(l.selectTrade(r.id))}),t.qZA()}if(2&i){const e=d.$implicit,o=t.oxw(2);t.Q6J("hidden","trade"!==o.tab)("showContact",!1)("trade",e)("currency",o.currency)}}function Bt(i,d){if(1&i&&(t.TgZ(0,"ion-item",42),t._UZ(1,"div",43),t.ALo(2,"translate"),t.qZA()),2&i){const e=t.oxw(2);t.Q6J("hidden","trade"!==e.tab),t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,2,"debt-detail.no-payment"),t.oJD)}}function Wt(i,d){if(1&i){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item",8)(2,"ion-text",9),t._uU(3),t.ALo(4,"translate"),t.qZA(),t.TgZ(5,"ion-text",10),t._uU(6),t.qZA()(),t.TgZ(7,"ion-segment",11),t.NdJ("ngModelChange",function(a){t.CHM(e);const r=t.oxw();return t.KtG(r.tab=a)}),t.TgZ(8,"ion-segment-button",12),t._uU(9),t.ALo(10,"translate"),t.qZA(),t.TgZ(11,"ion-segment-button",13),t._uU(12),t.ALo(13,"translate"),t.qZA()(),t.TgZ(14,"ion-item",14)(15,"ion-text",9),t._uU(16),t.ALo(17,"translate"),t.qZA(),t.TgZ(18,"ion-text",15),t.NdJ("click",function(){t.CHM(e);const a=t.oxw();return t.KtG(a.selectOrder())}),t._uU(19),t.qZA()(),t.YNc(20,St,20,10,"ion-item-sliding",7),t.YNc(21,Jt,14,15,"ion-item",7),t.YNc(22,Nt,4,3,"ion-item",7),t.YNc(23,kt,20,35,"ion-item",16),t.YNc(24,Qt,5,4,"ion-item",7),t.YNc(25,Kt,3,1,"ion-item",7),t.YNc(26,Ht,12,17,"ion-item",16),t.YNc(27,jt,1,4,"trade-item",17),t.YNc(28,Bt,3,4,"ion-item",18),t.qZA()}if(2&i){const e=t.oxw();t.xp6(3),t.Oqu(t.lcZ(4,17,"trade-add.debt-no")),t.xp6(3),t.hij(" ",e.debt?"#"+e.debt.id:""," "),t.xp6(1),t.Q6J("ngModel",e.tab),t.xp6(2),t.hij(" ",t.lcZ(10,19,"order-detail.information")," "),t.xp6(3),t.hij(" ",t.lcZ(13,21,"debt-detail.debt-payments")," "),t.xp6(2),t.Q6J("hidden","info"!=e.tab||!e.debt.order||0==e.debt.order.id),t.xp6(2),t.Oqu(t.lcZ(17,23,"debt-add.order")),t.xp6(3),t.hij(" ",e.debt.order?"#"+e.debt.order.orderCode:""," "),t.xp6(1),t.Q6J("ngIf",e.debt&&0!==e.debt.contactId&&"info"==e.tab&&e.debt.contact),t.xp6(1),t.Q6J("ngIf",e.debt&&0!==e.debt.productId&&e.debt.product&&"info"==e.tab),t.xp6(1),t.Q6J("ngIf","info"==e.tab),t.xp6(1),t.Q6J("ngIf","info"==e.tab),t.xp6(1),t.Q6J("ngIf",e.categories.length>0&&"info"==e.tab),t.xp6(1),t.Q6J("ngIf","info"==e.tab&&e.debt.note),t.xp6(1),t.Q6J("ngIf","trade"==e.tab),t.xp6(1),t.Q6J("ngForOf",e.trades),t.xp6(1),t.Q6J("ngIf",!e.trades||0===e.trades.length)}}const Rt=[{path:"",component:tt},{path:"add",component:xt},{path:"detail",component:(()=>{class i{constructor(e,o,a,r,l,p,_,I,y,M,P){this.navCtrl=e,this.translateService=o,this.modalCtrl=a,this.debtService=r,this.contactService=l,this.userService=p,this.tradeService=_,this.actionSheetCtrl=I,this.alertCtrl=y,this.analyticsService=M,this.orderService=P,this.debt=new q.T,this.params=null,this.categories=[],this.tab="info",this.dateFrom="",this.dateTo="",this.total=0,this.trades=[];const w=E=>{this.debt&&E.detail.id===this.debt.id&&this.reload()};this.navCtrl.removeEventListener("reloadDebt",w),this.navCtrl.addEventListener("reloadDebt",w)}ionViewWillEnter(){var e=this;return(0,b.Z)(function*(){yield e.analyticsService.setCurrentScreen("debt-detail")})()}ngOnInit(){this.reload()}selectOrder(){this.navCtrl.navigateForward("/order/detail",{id:this.debt.order.id})}reload(){var e=this;return(0,b.Z)(function*(){const o=yield e.navCtrl.loading();if(e.currency=yield e.userService.getAttr("current-currency"),e.debt=new q.T,e.params=e.navCtrl.getParams(e.params),e.params&&e.params.id&&e.params.id>0){const a=e.params.id;e.debtService.get(a).then(function(){var r=(0,b.Z)(function*(l){yield o.dismiss(),e.debt=l,e.debtService.getCategoriesToDebt(a).then(p=>{e.categories=p}),e.dateFrom=e.params.dateFrom?e.params.dateFrom:e.dateFrom?e.dateFrom:v.C.GetFirstDateOfMonth(),e.dateTo=e.params.dateTo?e.params.dateTo:e.dateTo?e.dateTo:v.C.GetEndDateOfMonth(),e.tradeService.getTradesByDebt(l.id,e.dateFrom,e.dateTo).then(p=>{p&&p.length>0&&(p=f.orderBy(p,["modifiedAt"],["desc"])),e.trades=p,e.total=f.sumBy(e.trades,_=>_.value*(_.isReceived?1:-1))})});return function(l){return r.apply(this,arguments)}}())}else yield o.dismiss()})()}isNotCordova(){return this.navCtrl.isNotCordova()}call(){this.saveLastActive("call"),D.W.callPhone(this.debt.contact.mobile)}text(){this.saveLastActive("text"),D.W.sendSms(this.debt.contact.mobile)}saveLastActive(e){return this.debt.contact.lastActive=v.C.toDbString(),this.debt.contact.lastAction=e,this.contactService.saveContact(this.debt.contact).then(o=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.debt.contact),o))}contactImageOrPlaceholder(){return D.W.contactImageOrPlaceholder(this.debt.contact.avatarUrl)}dateFormat(e){return v.C.toUiDateString(e)}actionIcon(e){return D.W.actionIcon(e)}dateTimeFormat(e){return v.C.toUiString(e)}edit(){this.navCtrl.navigateForward("/debt/add",{id:this.debt.id})}pay(){var e=this;return(0,b.Z)(function*(){+e.debt.value-+e.debt.valuePaid?e.navCtrl.navigateForward("/trade/add",{debt:e.debt.id}):(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("debt-detail.paid-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.navCtrl.navigateForward("/trade/add",{debt:e.debt.id})}}]})).present()})()}presentActionSheet(){var e=this;return(0,b.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("debt.delete-debt"),role:"destructive",handler:()=>{e.deleteDebt()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}isPaidChange(){var e=this;return(0,b.Z)(function*(){let o=e.translateService.instant("debt.confirm-paid");const a=e.translateService.instant(e.debt.isPaid?"debt-detail.paid":"debt-detail.not-yet-paid");if(o=o.replace("{paid}",a),!confirm(o))return void setTimeout(()=>{e.debt.isPaid=!e.debt.isPaid},200);const r=yield e.debtService.getDebtsByOrder(e.debt.order.id,null,null);let l=!0;for(const p of r)if(!p.isPaid&&p.id!==e.debt.id){l=!1;break}if(l&&e.debt.isPaid&&(e.debt.order.status=3,yield e.orderService.saveOrder(e.debt.order)),!e.debt.isPaid||e.trades&&e.trades.length)return yield e.debtService.saveDebt(e.debt),e.debt.contact&&0!=e.debt.contact.id&&(e.navCtrl.publish("reloadContact",e.debt.contact),e.navCtrl.publish("reloadContactDebt",e.debt.contact.id)),e.navCtrl.publish("reloadDebtList",{type:e.debt.debtType.toString()}),void(e.debt.order&&0!=e.debt.order.id&&e.navCtrl.publish("reloadOrder",e.debt.order));e.debtService.saveDebt(e.debt).then((0,b.Z)(function*(){e.navCtrl.publish("reloadDebtList",{type:e.debt.debtType.toString()}),e.debt.contact&&0!=e.debt.contact.id&&(e.navCtrl.publish("reloadContact",e.debt.contact),e.navCtrl.publish("reloadContactDebt",e.debt.contact.id)),e.debt.order&&0!=e.debt.order.id&&e.navCtrl.publish("reloadOrder",e.debt.order),(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("debt.paid-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.debtService.saveDebt(e.debt),e.navCtrl.push("/trade/add",{debt:e.debt.id})}}]})).present()}))})()}deleteDebt(){var e=this;return(0,b.Z)(function*(){(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("debt.delete-alert"),buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{e.debtService.deleteDebt(e.debt).then((0,b.Z)(function*(){e.analyticsService.logEvent("debt-detail-delete-success"),e.navCtrl.publish("reloadDebtList",null),e.debt.contact&&e.navCtrl.publish("reloadContact",e.debt.contact),e.debt.product&&e.navCtrl.publish("reloadProduct",e.debt.product),e.navCtrl.pop()}))}},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}moveToCategory(e){this.navCtrl.push("/cagegory/detail",{id:e.categoryId,tab:"debt"})}productName(e,o){return D.W.productName(e,o)}selectTrade(e){this.navCtrl.push("/trade/detail",{id:e})}selectDateRangeForTrade(){var e=this;return(0,b.Z)(function*(){const o=yield e.modalCtrl.create({component:S.S,componentProps:{dateFromInput:e.dateFrom,dateToInput:e.dateTo}});yield o.present();const{data:a}=yield o.onDidDismiss();a&&(e.dateFrom=""!=a.dateFrom?v.C.toDbString(a.dateFrom,v.C.getDbFormat()):"",e.dateTo=""!=a.dateTo?v.C.toDbString(a.dateTo,v.C.getDbFormat()):"",e.tradeService.getTradesByDebt(e.debt.id,e.dateFrom,e.dateTo).then(r=>{r&&r.length>0&&(r=f.orderBy(r,["modifiedAt"],["desc"])),e.trades=r,e.total=f.sumBy(e.trades,l=>l.value*(l.isReceived?1:-1))}))})()}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(A.G),t.Y36(x.sK),t.Y36(n.IN),t.Y36(L.E),t.Y36(G.y),t.Y36(N.K),t.Y36(yt.X),t.Y36(n.BX),t.Y36(n.Br),t.Y36(h.y),t.Y36(H.p))},i.\u0275cmp=t.Xpm({type:i,selectors:[["debt-detail"]],decls:16,vars:6,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","cash"],["name","ellipsis-vertical"],[4,"ngIf"],["lines","none"],["color","primary"],["color","dark","slot","end"],[3,"ngModel","ngModelChange"],["value","info"],["value","trade"],[3,"hidden"],["color","dark","slot","end",3,"click"],["text-wrap","",4,"ngIf"],[3,"hidden","showContact","trade","currency","onClick",4,"ngFor","ngForOf"],["class","ion-text-wrap",3,"hidden",4,"ngIf"],[3,"src"],["side","end"],["slot","start","name","send"],["color","secondary",3,"click"],["slot","start","name","call"],["slot","start",4,"ngIf"],[1,"ion-text-wrap"],[2,"white-space","pre-wrap"],["color","secondary"],["name","pricetag"],["color","primary",4,"ngIf"],["color","danger",4,"ngIf"],["slot","end",3,"ngModel","ngModelChange"],["color","danger"],["text-wrap",""],["fill","outline","slot","end","icon-left","",3,"click",4,"ngFor","ngForOf"],["fill","outline","slot","end","icon-left","",3,"click"],[3,"color"],["fill","clear","color","secondary","slot","end",3,"click"],["name","funnel",1,"icon-only"],["fill","clear","color","primary","slot","end",3,"click"],["name","add",1,"icon-only"],[3,"hidden","showContact","trade","currency","onClick"],[1,"ion-text-wrap",3,"hidden"],[3,"innerHTML"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",3),t.NdJ("click",function(){return o.pay()}),t._UZ(11,"ion-icon",5),t.qZA(),t.TgZ(12,"ion-button",3),t.NdJ("click",function(){return o.presentActionSheet()}),t._UZ(13,"ion-icon",6),t.qZA()()()(),t.TgZ(14,"ion-content"),t.YNc(15,Wt,29,25,"ion-list",7),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,4,"debt-detail.title")),t.xp6(9),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.Q6J("ngIf",o.debt))},dependencies:[C.sg,C.O5,T.JJ,T.On,n.BJ,n.oU,n.YG,n.Sm,n.W2,n.Gu,n.gu,n.Ie,n.u8,n.IK,n.td,n.Q$,n.q_,n.cJ,n.GO,n.yW,n.wd,n.ho,n.sr,n.w,n.QI,n.cs,At._,C.H9,x.X$],encapsulation:2}),i})()}];let $t=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[U.Bz.forChild(Rt),U.Bz]}),i})();var Vt=c(529),j=c(3093);let Xt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[C.ez,T.u5,n.Pc,$t,j.m,x.aw.forChild({loader:{provide:x.Zw,useFactory:j.x,deps:[Vt.eN]}})]}),i})()},360:(Y,O,c)=>{c.d(O,{Y:()=>N});var C=c(5861),T=c(6723),n=c(6738),U=c(5851),b=c(323),S=c(7852),f=c(3306),v=c(6895),t=c(191);function L(Z,A){if(1&Z){const g=n.EpF();n.TgZ(0,"ion-button",13),n.NdJ("click",function(){n.CHM(g);const h=n.oxw(2);return n.KtG(h.hideSupport())}),n._UZ(1,"ion-icon",14),n.qZA()}}function x(Z,A){if(1&Z){const g=n.EpF();n.TgZ(0,"div",1)(1,"ion-item",2),n.NdJ("click",function(){n.CHM(g);const h=n.oxw();return n.KtG(h.callPhone("+84869366606"))}),n.TgZ(2,"ion-label",3)(3,"h2")(4,"strong"),n._uU(5),n.ALo(6,"translate"),n.qZA()()(),n.YNc(7,L,2,0,"ion-button",4),n.qZA(),n.TgZ(8,"p")(9,"i"),n._uU(10),n.ALo(11,"translate"),n.qZA()(),n.TgZ(12,"ion-button",5),n.NdJ("click",function(){n.CHM(g);const h=n.oxw();return n.KtG(h.sendTicket())}),n._UZ(13,"ion-icon",6),n._uU(14),n.ALo(15,"translate"),n.qZA(),n.TgZ(16,"ion-grid")(17,"ion-row")(18,"ion-col",7)(19,"ion-item",8),n.NdJ("click",function(){n.CHM(g);const h=n.oxw();return n.KtG(h.callPhone("+84869366606"))}),n._UZ(20,"ion-icon",9),n.TgZ(21,"ion-label",10),n._uU(22),n.ALo(23,"translate"),n.qZA()()(),n.TgZ(24,"ion-col",7)(25,"ion-item",8),n.NdJ("click",function(){n.CHM(g);const h=n.oxw();return n.KtG(h.sendEmail("dlv.isale.app@gmail.com"))}),n._UZ(26,"ion-icon",11),n.TgZ(27,"ion-label",12),n._uU(28),n.ALo(29,"translate"),n.qZA()()()()()()}if(2&Z){const g=n.oxw();n.xp6(5),n.hij("",n.lcZ(6,6,"common.contact"),":"),n.xp6(2),n.Q6J("ngIf",!g.neverHide),n.xp6(3),n.Oqu(n.lcZ(11,8,"ticket-add.send-ticket-note")),n.xp6(4),n.hij("\xa0 ",n.lcZ(15,10,"ticket-add.title")," "),n.xp6(8),n.hij(" ",n.lcZ(23,12,"common.hotline"),": (+84) 0383.838.394 "),n.xp6(6),n.hij(" ",n.lcZ(29,14,"common.email"),": dlv.isale.app@gmail.com ")}}let N=(()=>{class Z{constructor(g,u,h,m){this.navCtrl=g,this.analyticsService=u,this.storage=h,this.translate=m,this.neverHide=!1,this.isHide=!1}ngOnInit(){var g=this;return(0,C.Z)(function*(){g.isHide=!!(yield g.storage.get("hide-support"))})()}callPhone(g){!g||(this.analyticsService.logEvent("support-call-hotline"),T.W.callPhone(g))}sendEmail(g){!g||(this.analyticsService.logEvent("support-email"),T.W.sendEmail(g))}sendTicket(){this.navCtrl.push("/ticket/add",null)}hideSupport(){var g=this;return(0,C.Z)(function*(){g.analyticsService.logEvent("support-hide"),g.isHide=!0,alert(g.translate.instant("support.alert")),yield g.storage.set("hide-support","1")})()}}return Z.\u0275fac=function(g){return new(g||Z)(n.Y36(U.G),n.Y36(b.y),n.Y36(S.V),n.Y36(f.sK))},Z.\u0275cmp=n.Xpm({type:Z,selectors:[["support"]],inputs:{neverHide:"neverHide"},decls:1,vars:1,consts:[["style","padding: 5px; border: 1px solid #D3679D; border-radius: 10px; margin-top: 10px;",4,"ngIf"],[2,"padding","5px","border","1px solid #D3679D","border-radius","10px","margin-top","10px"],["lines","none",1,"ion-no-padding",2,"padding-top","10px !important","min-height","0 !important","--min-height","0 !important",3,"click"],[2,"margin","0 !important","padding","0 !important"],["slot","end","size","small","fill","clear",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","mail"],[2,"padding","0 !important","margin","0 !important"],[1,"ion-no-padding",2,"padding-top","0px !important","cursor","pointer",3,"click"],["name","call","slot","start","color","tertiary"],[1,"ion-text-wrap"],["name","mail","slot","start","color","danger"],["color","danger",1,"ion-text-wrap"],["slot","end","size","small","fill","clear",3,"click"],["name","close","slot","icon-only"]],template:function(g,u){1&g&&n.YNc(0,x,30,16,"div",0),2&g&&n.Q6J("ngIf",!u.isHide||u.neverHide)},dependencies:[v.O5,t.YG,t.wI,t.jY,t.gu,t.Ie,t.Q$,t.Nd,f.X$],encapsulation:2}),Z})()},3604:(Y,O,c)=>{c.d(O,{_:()=>g});var C=c(6723),T=c(1914),n=c(6738),U=c(3306),b=c(6895),S=c(191);function f(u,h){if(1&u&&(n.TgZ(0,"p"),n._uU(1),n.qZA()),2&u){const m=n.oxw();n.xp6(1),n.Oqu(m.trade.contact.fullName)}}function v(u,h){if(1&u&&(n.TgZ(0,"p",3)(1,"b"),n._uU(2),n.qZA()()),2&u){const m=n.oxw();n.xp6(2),n.Oqu(m.productName(m.trade.product.code,m.trade.product.title))}}function t(u,h){if(1&u&&(n.TgZ(0,"p"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&u){const m=n.oxw();n.xp6(1),n.lnq(" ",n.lcZ(2,3,"trade.buy")," ",m.trade.productCount," ",m.trade.product.unit?"("+m.trade.product.unit+")":""," ")}}function L(u,h){if(1&u&&(n.TgZ(0,"p"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&u){const m=n.oxw();n.xp6(1),n.lnq(" ",n.lcZ(2,3,"trade.sale")," ",m.trade.productCount," ",m.trade.product.unit?"("+m.trade.product.unit+")":""," ")}}function x(u,h){if(1&u&&(n.TgZ(0,"p")(1,"i",7),n._uU(2),n.ALo(3,"translate"),n.qZA()()),2&u){const m=n.oxw();n.xp6(2),n.AsE("",n.lcZ(3,2,"trade.staff")," ",m.trade.staff.name,"")}}function N(u,h){if(1&u&&(n.TgZ(0,"ion-avatar",8),n._UZ(1,"img",9),n.qZA()),2&u){const m=n.oxw();n.xp6(1),n.Q6J("src",m.contactImageOrPlaceholder(m.trade.contact),n.LSH)}}function Z(u,h){if(1&u&&(n.TgZ(0,"ion-avatar",8),n._UZ(1,"img",9),n.qZA()),2&u){const m=n.oxw();n.xp6(1),n.Q6J("src",m.trade.product.avatarUrl,n.LSH)}}const A=function(u,h,m){return[u,h,"symbol","1.0-2",m]};let g=(()=>{class u{constructor(m){this.translateService=m,this.isStaff=!1,this.showProduct=!0,this.onPress=new n.vpe,this.onClick=new n.vpe}dateFormat(m){return T.C.toUiDateString(m)}contactImageOrPlaceholder(m){return C.W.contactImageOrPlaceholder(m.avatarUrl)}productName(m,s){return C.W.productName(m,s)}limitText(m,s=200){return C.W.limitText(m,s)}press(){this.onPress.emit()}click(){this.onClick.emit()}}return u.\u0275fac=function(m){return new(m||u)(n.Y36(U.sK))},u.\u0275cmp=n.Xpm({type:u,selectors:[["trade-item"]],inputs:{currency:"currency",showContact:"showContact",isStaff:"isStaff",showProduct:"showProduct",trade:"trade"},outputs:{onPress:"onPress",onClick:"onClick"},decls:17,vars:22,consts:[[3,"press","click"],[1,"ion-text-wrap"],[3,"color"],[2,"white-space","pre-wrap"],[4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["slot","end",4,"ngIf"],[2,"font-size","11px"],["slot","end"],[3,"src"]],template:function(m,s){1&m&&(n.TgZ(0,"ion-item",0),n.NdJ("press",function(){return s.press()})("click",function(){return s.click()}),n.TgZ(1,"ion-label",1)(2,"ion-text",2),n._uU(3),n.ALo(4,"currency"),n.qZA(),n._UZ(5,"br"),n.TgZ(6,"ion-text",3),n._uU(7),n.qZA(),n.YNc(8,f,2,1,"p",4),n.YNc(9,v,3,1,"p",5),n.YNc(10,t,3,5,"p",4),n.YNc(11,L,3,5,"p",4),n.TgZ(12,"p"),n._uU(13),n.qZA(),n.YNc(14,x,4,4,"p",4),n.qZA(),n.YNc(15,N,2,1,"ion-avatar",6),n.YNc(16,Z,2,1,"ion-avatar",6),n.qZA()),2&m&&(n.xp6(2),n.s9C("color",(s.trade.isReceived?1:-1)*s.trade.value>=0?"secondary":"danger"),n.xp6(1),n.AsE("",s.trade.isReceived&&s.trade.value>0?"+":s.trade.isReceived?"":"-","",n.G7q(4,12,n.kEZ(18,A,s.trade.value,s.currency,s.translateService.currentLang)),""),n.xp6(4),n.Oqu(s.limitText(s.trade.note)),n.xp6(1),n.Q6J("ngIf",s.trade.contactId&&0!=s.trade.contactId&&s.trade.contact&&s.showContact),n.xp6(1),n.Q6J("ngIf",s.trade.productId&&0!=s.trade.productId&&s.trade.product&&s.showProduct),n.xp6(1),n.Q6J("ngIf",s.trade.productId&&0!=s.trade.productId&&s.trade.product&&s.trade.isPurchase&&!s.trade.isReceived),n.xp6(1),n.Q6J("ngIf",s.trade.productId&&0!=s.trade.productId&&s.trade.product&&s.trade.isPurchase&&s.trade.isReceived),n.xp6(2),n.hij(" ",s.dateFormat(s.trade.createdAt)," "),n.xp6(1),n.Q6J("ngIf",s.trade.staffId&&0!=s.trade.staffId&&s.trade.staff&&!s.isStaff),n.xp6(1),n.Q6J("ngIf",s.trade.contactId&&0!=s.trade.contactId&&s.trade.contact&&s.showContact),n.xp6(1),n.Q6J("ngIf",s.trade.productId&&0!=s.trade.productId&&s.trade.product&&s.trade.product.avatarUrl&&s.showProduct))},dependencies:[b.O5,S.BJ,S.Ie,S.Q$,S.yW,b.H9,U.X$],encapsulation:2}),u})()}}]);