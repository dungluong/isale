"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[1997],{1997:(G,J,_)=>{_.r(J),_.d(J,{CategoryModule:()=>Gt});var T=_(6895),D=_(4006),n=_(191),P=_(3196),m=_(5861),A=_(2402),t=_(6738),U=_(2126),N=_(667),I=_(5851),w=_(323);let O=(()=>{class i{constructor(e,o,r,c){var s=this;this.tradeService=e,this.staffService=o,this.navCtrl=r,this.analyticsService=c,this.up=function(){var h=(0,m.Z)(function*(f,b,x){const u=yield s.navCtrl.loading(),S=[];x[f].orderIndex=f-1,S.push(s.tradeService.saveCategory(x[f])),x[f-1].orderIndex=f,S.push(s.tradeService.saveCategory(x[f-1]));for(let Z=f+1;Z<x.length;Z++)x[Z].orderIndex=Z,S.push(s.tradeService.saveCategory(x[Z]));yield Promise.all(S),yield s.listComponent.callReload(),yield u.dismiss()});return function(f,b,x){return h.apply(this,arguments)}}(),this.down=function(){var h=(0,m.Z)(function*(f,b,x){const u=yield s.navCtrl.loading(),S=[];x[f].orderIndex=f+1,S.push(s.tradeService.saveCategory(x[f])),x[f+1].orderIndex=f,S.push(s.tradeService.saveCategory(x[f+1]));for(let Z=f+2;Z<x.length;Z++)x[Z].orderIndex=Z,S.push(s.tradeService.saveCategory(x[Z]));yield Promise.all(S),yield s.listComponent.callReload(),yield u.dismiss()});return function(f,b,x){return h.apply(this,arguments)}}(),this.itemTemplate={h2:{field:"title"},reorderButtons:{upFunc:this.up,downFunc:this.down}},this.searchFields=["title"]}ionViewWillEnter(){var e=this;return(0,m.Z)(function*(){yield e.analyticsService.setCurrentScreen("category")})()}ngOnInit(){}addReport(){this.navCtrl.push("/category-report/add",null)}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(U.X),t.Y36(N.x),t.Y36(I.G),t.Y36(w.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["category"]],viewQuery:function(e,o){if(1&e&&t.Gf(A.n,5),2&e){let r;t.iGM(r=t.CRH())&&(o.listComponent=r.first)}},decls:2,vars:2,consts:[["table","trade_category","orderBy","orderIndex",3,"itemTemplate","searchFields"],["listComponent",""]],template:function(e,o){1&e&&t._UZ(0,"list",0,1),2&e&&t.Q6J("itemTemplate",o.itemTemplate)("searchFields",o.searchFields)},dependencies:[A.n],encapsulation:2}),i})();var k=_(316);let E=(()=>{class i{constructor(){this.table="store",this.fieldsList=["title"],this.validateFields=["title"]}}return i.\u0275fac=function(e){return new(e||i)},i.\u0275cmp=t.Xpm({type:i,selectors:[["category-add"]],inputs:{table:"table",fieldsList:"fieldsList",validateFields:"validateFields"},decls:1,vars:2,consts:[["table","trade_category",3,"fieldsList","validateFields"]],template:function(e,o){1&e&&t._UZ(0,"form-add",0),2&e&&t.Q6J("fieldsList",o.fieldsList)("validateFields",o.validateFields)},dependencies:[k.D],encapsulation:2}),i})();var F=_(6841),C=_(5618),y=_(7489),d=_(1914),a=_(6723),v=_(2694),p=_(3306),g=_(7488),Q=_(7833),W=_(4433),R=_(7060),H=_(6961),j=_(7696),z=_(6391),X=_(3604),V=_(8262);function tt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-searchbar",16),t.NdJ("ionClear",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.clearSearch())})("ionChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.search())})("ngModelChange",function(r){t.CHM(e);const c=t.oxw();return t.KtG(c.searchKey=r)}),t.ALo(1,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.s9C("placeholder",t.lcZ(1,2,"trade.search")),t.Q6J("ngModel",e.searchKey)}}function et(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-searchbar",16),t.NdJ("ionClear",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.clearSearchDebt())})("ionChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.searchDebt())})("ngModelChange",function(r){t.CHM(e);const c=t.oxw();return t.KtG(c.searchDebtKey=r)}),t.ALo(1,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.s9C("placeholder",t.lcZ(1,2,"debt.search")),t.Q6J("ngModel",e.searchDebtKey)}}function ot(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-searchbar",16),t.NdJ("ionClear",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.clearSearchProduct())})("ionChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.searchProduct())})("ngModelChange",function(r){t.CHM(e);const c=t.oxw();return t.KtG(c.searchKey=r)}),t.ALo(1,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.s9C("placeholder",t.lcZ(1,2,"product.search")),t.Q6J("ngModel",e.searchKey)}}function nt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-checkbox",18),t.NdJ("ngModelChange",function(r){t.CHM(e);const c=t.oxw(3);return t.KtG(c.isSelectAll=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.selectAll())}),t.qZA(),t.TgZ(2,"ion-buttons")(3,"ion-button",19),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.multiDelete())}),t._uU(4),t.ALo(5,"translate"),t._UZ(6,"ion-icon",20),t.qZA(),t.TgZ(7,"ion-button",21),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.exitSelectMode())}),t._uU(8),t.ALo(9,"translate"),t._UZ(10,"ion-icon",22),t.qZA()()()}if(2&i){const e=t.oxw(3);t.xp6(1),t.Q6J("ngModel",e.isSelectAll),t.xp6(3),t.hij(" ",t.lcZ(5,3,"product-detail.delete-multi")," "),t.xp6(4),t.hij(" ",t.lcZ(9,5,"product-detail.exit-select-mode")," ")}}function rt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-checkbox",27),t.NdJ("ngModelChange",function(r){t.CHM(e);const c=t.oxw().$implicit;return t.KtG(c.isSelected=r)}),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("ngModel",e.isSelected)}}const L=function(i,l,e){return[i,l,"symbol","1.0-2",e]};function it(i,l){if(1&i&&(t.TgZ(0,"span"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"currency"),t.qZA()),2&i){const e=t.oxw().$implicit,o=t.oxw(3);t.xp6(1),t.AsE(" - ",t.lcZ(2,2,"product-add.cost-price"),": ",t.G7q(3,4,t.kEZ(10,L,e.costPrice,o.currency,o.translateService.currentLang)),"")}}function ct(i,l){1&i&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.qZA())}function at(i,l){1&i&&(t.TgZ(0,"span"),t._uU(1," - "),t.qZA())}function st(i,l){if(1&i&&(t.TgZ(0,"span"),t._UZ(1,"br"),t.TgZ(2,"ion-text"),t._UZ(3,"ion-icon",28),t._uU(4),t.ALo(5,"translate"),t.qZA()()),2&i){const e=t.oxw().$implicit,o=t.oxw(3);t.xp6(4),t.AsE(" \xa0",t.lcZ(5,2,"product-add.expired-date"),": ",o.dateFormat(e.expiredAt)," ")}}function lt(i,l){if(1&i&&(t.TgZ(0,"ion-thumbnail",2),t._UZ(1,"img",29),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function dt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item",23),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectProduct(c.id))})("press",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.presentProductActionSheet(c))}),t.YNc(1,rt,1,1,"ion-checkbox",24),t.TgZ(2,"ion-label",6)(3,"span",25),t._uU(4),t.qZA(),t._UZ(5,"br"),t.TgZ(6,"ion-text"),t._uU(7),t.ALo(8,"translate"),t.ALo(9,"currency"),t.qZA(),t.YNc(10,it,4,14,"span",15),t.TgZ(11,"span"),t.YNc(12,ct,2,0,"span",15),t.YNc(13,at,2,0,"span",15),t._uU(14),t.ALo(15,"translate"),t.qZA(),t.YNc(16,st,6,4,"span",15),t.qZA(),t.YNc(17,lt,2,1,"ion-thumbnail",26),t.qZA()}if(2&i){const e=l.$implicit,o=t.oxw(3);t.xp6(1),t.Q6J("ngIf",o.selectMode),t.xp6(3),t.hij(" ",o.limitText(o.productName(e.code,e.title))," "),t.xp6(3),t.AsE(" ",t.lcZ(8,12,"product-detail.product-unit-price"),": ",t.G7q(9,14,t.kEZ(22,L,e.price,o.currency,o.translateService.currentLang))," "),t.xp6(3),t.Q6J("ngIf",e.costPrice),t.xp6(2),t.Q6J("ngIf",e.costPrice),t.xp6(1),t.Q6J("ngIf",!e.costPrice),t.xp6(1),t.lnq("",t.lcZ(15,20,"product-detail.product-quantity"),": ",e.count," ",e.unit,""),t.xp6(2),t.Q6J("ngIf",e.expiredAt),t.xp6(1),t.Q6J("ngIf",e.avatarUrl)}}function ut(i,l){if(1&i&&(t.ynx(0),t.YNc(1,nt,11,7,"ion-item",15),t.YNc(2,dt,18,26,"ion-item",17),t.BQk()),2&i){const e=t.oxw(2);t.xp6(1),t.Q6J("ngIf",e.selectMode),t.xp6(1),t.Q6J("ngForOf",e.products)}}function _t(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-buttons")(3,"ion-button",19),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.multiDelete())}),t._uU(4),t.ALo(5,"translate"),t._UZ(6,"ion-icon",20),t.qZA(),t.TgZ(7,"ion-button",21),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.exitSelectMode())}),t._uU(8),t.ALo(9,"translate"),t._UZ(10,"ion-icon",22),t.qZA()()()()}2&i&&(t.xp6(4),t.hij(" ",t.lcZ(5,2,"product-detail.delete-multi")," "),t.xp6(4),t.hij(" ",t.lcZ(9,4,"product-detail.exit-select-mode")," "))}function pt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-checkbox",18),t.NdJ("ngModelChange",function(r){t.CHM(e);const c=t.oxw(3);return t.KtG(c.isSelectAll=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw(3);return t.KtG(r.selectAll())}),t.qZA()}if(2&i){const e=t.oxw(3);t.Q6J("ngModel",e.isSelectAll)}}function mt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-checkbox",27),t.NdJ("ngModelChange",function(r){t.CHM(e);const c=t.oxw().$implicit;return t.KtG(c.isSelected=r)}),t.qZA()}if(2&i){const e=t.oxw().$implicit;t.Q6J("ngModel",e.isSelected)}}function gt(i,l){if(1&i&&(t.TgZ(0,"ion-thumbnail",40),t._UZ(1,"img",29),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function ht(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-row",38),t.NdJ("press",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.presentProductActionSheet(c))})("click",function(){const c=t.CHM(e).$implicit,s=t.oxw(3);return t.KtG(s.selectProduct(c.id))}),t.TgZ(1,"ion-col",30)(2,"ion-item",31),t.YNc(3,mt,1,1,"ion-checkbox",24),t._uU(4),t.qZA()(),t.TgZ(5,"ion-col",35)(6,"ion-item",31),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-col",35)(10,"ion-item",31),t._uU(11),t.ALo(12,"currency"),t.qZA()(),t.TgZ(13,"ion-col",36)(14,"ion-item",31),t._uU(15),t.qZA()(),t.TgZ(16,"ion-col",36)(17,"ion-item",31),t._uU(18),t.qZA()(),t.TgZ(19,"ion-col",35)(20,"ion-item",31),t.YNc(21,gt,2,1,"ion-thumbnail",39),t.qZA()()()}if(2&i){const e=l.$implicit,o=t.oxw(3);t.Udp("cursor","pointer"),t.xp6(3),t.Q6J("ngIf",o.selectMode),t.xp6(1),t.hij(" ",o.limitText(o.productName(e.code,e.title))," "),t.xp6(3),t.hij(" ",t.G7q(8,9,t.kEZ(21,L,e.price,o.currency,o.translateService.currentLang))," "),t.xp6(4),t.hij(" ",t.G7q(12,15,t.kEZ(25,L,e.costPrice,o.currency,o.translateService.currentLang))," "),t.xp6(4),t.hij(" ",o.store?e.storeQuantity?e.storeQuantity:0:e.count," "),t.xp6(3),t.hij(" ",e.unit," "),t.xp6(3),t.Q6J("ngIf",e.avatarUrl)}}function Ct(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col",30)(3,"ion-item",31)(4,"ion-buttons")(5,"ion-button",32),t.NdJ("click",function(){t.CHM(e);const r=t.oxw(2);return t.KtG(r.showSelect())}),t._UZ(6,"ion-icon",33),t._uU(7),t.ALo(8,"translate"),t.qZA()()()()(),t.YNc(9,_t,11,6,"ion-row",15),t.TgZ(10,"ion-row")(11,"ion-col",30)(12,"ion-item",31),t.YNc(13,pt,1,1,"ion-checkbox",34),t.TgZ(14,"strong"),t._uU(15),t.ALo(16,"translate"),t.qZA()()(),t.TgZ(17,"ion-col",35)(18,"ion-item",31)(19,"strong"),t._uU(20),t.ALo(21,"translate"),t.qZA()()(),t.TgZ(22,"ion-col",35)(23,"ion-item",31)(24,"strong"),t._uU(25),t.ALo(26,"translate"),t.qZA()()(),t.TgZ(27,"ion-col",36)(28,"ion-item",31)(29,"strong"),t._uU(30),t.ALo(31,"translate"),t.qZA()()(),t.TgZ(32,"ion-col",36)(33,"ion-item",31)(34,"strong"),t._uU(35),t.ALo(36,"translate"),t.qZA()()(),t.TgZ(37,"ion-col",35)(38,"ion-item",31)(39,"strong"),t._uU(40),t.ALo(41,"translate"),t.qZA()()()(),t.YNc(42,ht,22,29,"ion-row",37),t.qZA()}if(2&i){const e=t.oxw(2);t.xp6(7),t.hij(" ",t.lcZ(8,10,"product-detail.multi-select")," "),t.xp6(2),t.Q6J("ngIf",e.selectMode),t.xp6(4),t.Q6J("ngIf",e.selectMode),t.xp6(2),t.Oqu(t.lcZ(16,12,"product-add.product-title")),t.xp6(5),t.Oqu(t.lcZ(21,14,"product-add.price")),t.xp6(5),t.Oqu(t.lcZ(26,16,"product-add.cost-price")),t.xp6(5),t.Oqu(t.lcZ(31,18,"product-add.count")),t.xp6(5),t.Oqu(t.lcZ(36,20,"product-add.unit")),t.xp6(5),t.Oqu(t.lcZ(41,22,"product-detail.photo")),t.xp6(2),t.Q6J("ngForOf",e.products)}}function ft(i,l){if(1&i&&(t.TgZ(0,"ion-list"),t.YNc(1,ut,3,2,"ng-container",15),t.YNc(2,Ct,43,24,"ion-grid",15),t.qZA()),2&i){const e=t.oxw();t.xp6(1),t.Q6J("ngIf",e.isMobile),t.xp6(1),t.Q6J("ngIf",!e.isMobile&&e.products&&e.products.length)}}function xt(i,l){if(1&i&&(t.TgZ(0,"ion-text"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateTo)," ")}}function yt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"trade-item",45),t.NdJ("onPress",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.presentTradeActionSheet(c))})("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectTrade(c.id))}),t.qZA()}if(2&i){const e=l.$implicit,o=t.oxw(2);t.Q6J("trade",e)("currency",o.currency)}}function vt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",6),t.YNc(3,xt,5,8,"ion-text",15),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",41),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",42),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.selectDateRangeForTrade())}),t._UZ(10,"ion-icon",43),t.qZA()(),t.YNc(11,yt,1,2,"trade-item",44),t.qZA()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",""!=e.dateFrom||""!=e.dateTo),t.xp6(1),t.hij(" ",t.lcZ(5,6,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.total>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.total>=0?"+":""," ",t.G7q(8,8,t.kEZ(14,L,e.total,e.currency,e.translateService.currentLang)),"."),t.xp6(4),t.Q6J("ngForOf",e.trades)}}function Zt(i,l){if(1&i&&(t.TgZ(0,"ion-text"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t._UZ(4,"br"),t.qZA()),2&i){const e=t.oxw(2);t.xp6(1),t.HOy(" ",t.lcZ(2,4,"common.from")," ",e.dateFormat(e.dateDebtFrom)," ",t.lcZ(3,6,"common.to")," ",e.dateFormat(e.dateDebtTo)," ")}}function Tt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"debt-item",48),t.NdJ("onPress",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.presentDebtActionSheet(c))})("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectDebt(c.id))}),t.qZA()}if(2&i){const e=l.$implicit,o=t.oxw(2);t.Q6J("debt",e)("currency",o.currency)}}function bt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",6),t.YNc(3,Zt,5,8,"ion-text",15),t._uU(4),t.ALo(5,"translate"),t.TgZ(6,"ion-text",41),t._uU(7),t.ALo(8,"currency"),t.qZA()(),t.TgZ(9,"ion-button",42),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.selectDateRangeForDebt())}),t._UZ(10,"ion-icon",46),t.qZA()(),t.YNc(11,Tt,1,2,"debt-item",47),t.qZA()}if(2&i){const e=t.oxw();t.xp6(3),t.Q6J("ngIf",""!=e.dateDebtFrom||""!=e.dateDebtTo),t.xp6(1),t.hij(" ",t.lcZ(5,6,"common.total"),":\xa0 "),t.xp6(2),t.s9C("color",e.totalDebt>=0?"secondary":"danger"),t.xp6(1),t.AsE("",e.totalDebt>=0?"+":""," ",t.G7q(8,8,t.kEZ(14,L,e.totalDebt,e.currency,e.translateService.currentLang)),"."),t.xp6(4),t.Q6J("ngForOf",e.debts)}}function St(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"customer-discount-item",53),t.NdJ("onClick",function(){const c=t.CHM(e).$implicit,s=t.oxw(2);return t.KtG(s.selectCustomerDiscount(c.id))}),t.qZA()}if(2&i){const e=l.$implicit,o=t.oxw(2);t.Q6J("showContact",!0)("showProduct",!0)("customerDiscount",e)("currency",o.currency)("showCategory",!1)}}function At(i,l){1&i&&(t.TgZ(0,"div",54),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Oqu(t.lcZ(2,1,"contact-detail.no-discounts")))}function Dt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",6),t._uU(3),t.ALo(4,"translate"),t.TgZ(5,"ion-text",49),t._uU(6),t.qZA()(),t.TgZ(7,"ion-button",42),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.addDiscount())}),t._UZ(8,"ion-icon",50),t.qZA()(),t.YNc(9,St,1,5,"customer-discount-item",51),t.YNc(10,At,3,3,"div",52),t.qZA()}if(2&i){const e=t.oxw();t.xp6(3),t.hij(" ",t.lcZ(4,4,"common.total"),":\xa0 "),t.xp6(3),t.Oqu(e.customerDiscounts&&e.customerDiscounts.length?e.customerDiscounts.length:0),t.xp6(3),t.Q6J("ngForOf",e.customerDiscounts),t.xp6(1),t.Q6J("ngIf",!e.customerDiscounts||!e.customerDiscounts.length)}}let Pt=(()=>{class i{constructor(e,o,r,c,s,h,f,b,x,u,S,Z,$,K){this.navCtrl=e,this.translateService=o,this.userService=r,this.modalCtrl=c,this.tradeService=s,this.debtService=h,this.file=f,this.platform=b,this.excelService=x,this.actionSheetCtrl=u,this.productService=S,this.alertCtrl=Z,this.contactService=$,this.analyticsService=K,this.category=new C.b,this.params=null,this.originalTrades=[],this.trades=[],this.isMobile=!0,this.customerDiscounts=[],this.searchKey="",this.dateFrom="",this.dateTo="",this.total=0,this.tab="product",this.originalDebts=[],this.debts=[],this.dateDebtFrom="",this.dateDebtTo="",this.totalDebt=0,this.searchDebtKey="",this.selectMode=!1,this.isSelectAll=!1;const q=M=>{this.category&&M.detail.id===this.category.id&&this.reload()};this.navCtrl.unsubscribe("reloadTradeCategory",q),this.navCtrl.subscribe("reloadTradeCategory",q),this.navCtrl.unsubscribe("reloadTradeList",this.reload),this.navCtrl.subscribe("reloadTradeList",this.reload),this.navCtrl.unsubscribe("reloadDebtList",this.reload),this.navCtrl.subscribe("reloadDebtList",this.reload)}ionViewWillEnter(){var e=this;return(0,m.Z)(function*(){yield e.analyticsService.setCurrentScreen("category-detail")})()}ngOnInit(){this.platform.resize.subscribe(()=>{this.isMobile=this.platform.width()<720}),this.reload()}reload(){var e=this;this.isMobile=this.platform.width()<720,this.category=new C.b,this.userService.getAttr("current-currency").then(r=>{this.currency=r});const o=this.params?this.params:this.navCtrl.getParams();if(this.params=o,o&&o.tab&&(this.tab=o.tab),o&&o.id&&o.id>0){const r=o.id;this.tradeService.getCategory(r).then(function(){var c=(0,m.Z)(function*(s){e.category=s,e.dateFrom=o.dateFrom?o.dateFrom:e.dateFrom?e.dateFrom:d.C.GetFirstDateOfMonth(),e.dateTo=o.dateTo?o.dateTo:e.dateTo?e.dateTo:d.C.GetEndDateOfMonth(),e.tradeService.getTradesByCategory(r,e.dateFrom,e.dateTo).then(h=>{e.originalTrades=JSON.parse(JSON.stringify(h)),h=e.sortByModifiedAt(h),e.trades=h,e.total=y.sumBy(e.trades,f=>f.value*(f.isReceived?1:-1))}),e.products=yield e.productService.getProductsByCategory(r),e.originalProducts=JSON.parse(JSON.stringify(e.products)),e.dateDebtFrom="",e.dateDebtTo="",e.dateDebtFrom=o.dateDebtFrom?o.dateDebtFrom:d.C.GetFirstDateOfMonth(),e.dateDebtTo=o.dateDebtTo?o.dateDebtTo:d.C.GetEndDateOfMonth(),e.debtService.getDebtsByCategory(r,e.dateDebtFrom,e.dateDebtTo).then(h=>{e.originalDebts=JSON.parse(JSON.stringify(h)),h=e.sortByModifiedAt(h),e.debts=h,e.totalDebt=y.sumBy(e.debts,f=>f.value)}),e.contactService.getCustomerDiscountsByCategory(r).then(h=>{h&&h.length>0&&(h=y.orderBy(h,["createdAt"],["desc"])),e.customerDiscounts=h})});return function(s){return c.apply(this,arguments)}}())}}limitText(e,o=200){return a.W.limitText(e,o)}sortByModifiedAt(e){return e?y.orderBy(e,["createdAt"],["desc"]):null}dateFormat(e){return d.C.toUiDateString(e)}actionIcon(e){return a.W.actionIcon(e)}dateTimeFormat(e){return d.C.toUiString(e)}edit(){this.navCtrl.push("/trade-category/add",{id:this.category.id})}search(){var e=this;return(0,m.Z)(function*(){e.analyticsService.logEvent("category-detail-search");let o=JSON.parse(JSON.stringify(e.originalTrades));if(null!==e.searchKey&&""!==e.searchKey){const r=e.searchKey.toLowerCase();o=o.filter(c=>c.note&&-1!==c.note.toLowerCase().indexOf(r)||c.contact&&c.contact.fullName&&-1!==c.contact.fullName.toLowerCase().indexOf(r)||c.contact&&c.contact.mobile&&-1!==c.contact.mobile.toLowerCase().indexOf(r))}e.trades=o,e.total=y.sumBy(e.trades,r=>r.value*(r.isReceived?1:-1))})()}clearSearch(){this.searchKey=null,this.reload()}searchDebt(){let e=JSON.parse(JSON.stringify(this.originalDebts));if(null!==this.searchDebtKey&&""!==this.searchDebtKey){const o=this.searchDebtKey.toLowerCase();e=e.filter(r=>r.note&&-1!==r.note.toLowerCase().indexOf(o)||r.contact&&r.contact.fullName&&-1!==r.contact.fullName.toLowerCase().indexOf(o)||r.contact&&r.contact.mobile&&-1!==r.contact.mobile.toLowerCase().indexOf(o))}this.debts=e,this.totalDebt=y.sumBy(this.debts,o=>o.value)}clearSearchDebt(){this.searchDebtKey=null,this.reload()}presentActionSheet(){var e=this;return(0,m.Z)(function*(){yield(yield e.actionSheetCtrl.create({header:e.translateService.instant("action.action"),buttons:[{text:e.translateService.instant("export.export-trade"),handler:()=>{e.exportTradeToExcel()}},{text:e.translateService.instant("trade-category.delete"),role:"destructive",handler:()=>{e.deleteCategory()}},{text:e.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}exportTradeToExcel(){var e=this;const o=[];if(o.push([this.translateService.instant("export.category-transaction-report")]),o.push([this.translateService.instant("export.category")+": "+this.category.title]),this.dateFrom&&this.dateTo){const s=this.translateService.instant("common.from"),h=this.translateService.instant("common.to"),f=s+" "+this.dateFormat(this.dateFrom)+" "+h+" "+this.dateFormat(this.dateTo);o.push([f])}o.push([this.translateService.instant("common.total")+": "+this.total+" "+this.currency]),o.push([this.translateService.instant("export.contact"),this.translateService.instant("export.product"),this.translateService.instant("export.product-count"),this.translateService.instant("export.money"),this.translateService.instant("export.unit"),this.translateService.instant("export.date")]);for(const s of this.trades)o.push([0!==s.contactId&&s.contact?s.contact.fullName:"",0!==s.productId&&s.product?a.W.productName(s.product.code,s.product.title):"",0!==s.productId&&s.product&&s.isPurchase?s.productCount?s.productCount:0:" ",s.isReceived?s.value:-1*s.value,this.currency,this.dateFormat(s.createdAt)]);const r=this.excelService.createSheetData(o),c="category-transactions-"+this.category.id+"-"+a.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(r,c).then(function(){var s=(0,m.Z)(function*(h){e.navCtrl.isNotCordova()||(yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("report.file-save-alert")+e.file.externalDataDirectory+c,buttons:[{text:e.translateService.instant("common.agree"),handler:()=>{}}]})).present(),e.userService.shareFile(null,h))});return function(h){return s.apply(this,arguments)}}())}deleteCategory(){var e=this;return(0,m.Z)(function*(){(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("trade-category.delete-alert"),buttons:[{text:e.translateService.instant("common.cancel"),handler:()=>{}},{text:e.translateService.instant("common.agree"),handler:()=>{e.tradeService.deleteCategory(e.category).then((0,m.Z)(function*(){e.analyticsService.logEvent("category-detail-delete-success"),e.navCtrl.publish("reloadTradeCategoryList",null),e.navCtrl.pop()}))}}]})).present()})()}selectTrade(e){this.navCtrl.push("/trade/detail",{id:e})}selectDebt(e){this.navCtrl.push("/debt/detail",{id:e})}deleteTrade(e){var o=this;return(0,m.Z)(function*(){yield(yield o.alertCtrl.create({header:o.translateService.instant("common.confirm"),message:o.translateService.instant("trade.delete-alert"),buttons:[{text:o.translateService.instant("common.cancel"),handler:()=>{}},{text:o.translateService.instant("common.agree"),handler:()=>{o.tradeService.deleteTrade(e).then((0,m.Z)(function*(){o.analyticsService.logEvent("category-detail-delete-trade-success");let c=o.trades.findIndex(s=>s.id===e.id);c>=0&&o.trades.splice(c,1),c=o.originalTrades.findIndex(s=>s.id===e.id),c>=0&&o.originalTrades.splice(c,1)}))}}]})).present()})()}deleteDebt(e){var o=this;return(0,m.Z)(function*(){yield(yield o.alertCtrl.create({header:o.translateService.instant("common.confirm"),message:o.translateService.instant("debt.delete-alert"),buttons:[{text:o.translateService.instant("common.cancel"),handler:()=>{}},{text:o.translateService.instant("common.agree"),handler:()=>{o.debtService.deleteDebt(e).then((0,m.Z)(function*(){o.analyticsService.logEvent("category-detail-delete-debt-success");let c=o.debts.findIndex(s=>s.id===e.id);c>=0&&o.debts.splice(c,1),c=o.originalDebts.findIndex(s=>s.id===e.id),c>=0&&o.originalDebts.splice(c,1)}))}}]})).present()})()}presentTradeActionSheet(e){var o=this;return(0,m.Z)(function*(){yield(yield o.actionSheetCtrl.create({header:o.translateService.instant("action.action"),buttons:[{text:o.translateService.instant("trade.delete-trade"),role:"destructive",handler:()=>{o.deleteTrade(e)}},{text:o.translateService.instant("trade.edit-trade"),handler:()=>{o.selectTrade(e.id)}},{text:o.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}presentDebtActionSheet(e){var o=this;return(0,m.Z)(function*(){yield(yield o.actionSheetCtrl.create({header:o.translateService.instant("action.action"),buttons:[{text:o.translateService.instant("debt.delete-debt"),role:"destructive",handler:()=>{o.deleteDebt(e)}},{text:o.translateService.instant("debt.edit-debt"),handler:()=>{o.selectDebt(e.id)}},{text:o.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}contactImageOrPlaceholder(e){return a.W.contactImageOrPlaceholder(e.avatarUrl)}selectDateRangeForTrade(){var e=this;return(0,m.Z)(function*(){const o=yield e.modalCtrl.create({component:F.S,componentProps:{dateFromInput:e.dateFrom,dateToInput:e.dateTo},backdropDismiss:!1});yield o.present();const{data:r}=yield o.onDidDismiss();r&&(e.dateFrom=""!=r.dateFrom?d.C.toDbString(r.dateFrom,d.C.getDbFormat()):"",e.dateTo=""!=r.dateTo?d.C.toDbString(r.dateTo,d.C.getDbFormat()):"",e.tradeService.getTradesByCategory(e.category.id,e.dateFrom,e.dateTo).then(c=>{e.originalTrades=JSON.parse(JSON.stringify(c)),c=e.sortByModifiedAt(c),e.trades=c,e.total=y.sumBy(e.trades,s=>s.value*(s.isReceived?1:-1))}))})()}selectDateRangeForDebt(){var e=this;return(0,m.Z)(function*(){const o=yield e.modalCtrl.create({component:F.S,componentProps:{dateFromInput:e.dateDebtFrom,dateToInput:e.dateDebtTo}});yield o.present();const{data:r}=yield o.onDidDismiss();r&&(e.dateDebtFrom=""!=r.dateFrom?d.C.toDbString(r.dateFrom,d.C.getDbFormat()):"",e.dateDebtTo=""!=r.dateTo?d.C.toDbString(r.dateTo,d.C.getDbFormat()):"",e.debtService.getDebtsByCategory(e.category.id,e.dateFrom,e.dateTo).then(c=>{e.originalTrades=JSON.parse(JSON.stringify(c)),c=e.sortByModifiedAt(c),e.debts=c,e.totalDebt=y.sumBy(e.debts,s=>s.value)}))})()}changeListOption(){this.reload()}showSelect(){this.selectMode=!0,this.isSelectAll=!1}exitSelectMode(){this.selectMode=!1,this.isSelectAll=!1;for(const e of this.products)e.isSelected=!1}productName(e,o){return a.W.productName(e,o)}selectProduct(e){if(!this.selectMode)try{this.navCtrl.navigateForward("/product/detail",{id:e})}catch(o){console.error(o),alert(o)}}presentProductActionSheet(e){var o=this;return(0,m.Z)(function*(){yield(yield o.actionSheetCtrl.create({header:o.translateService.instant("action.action"),buttons:[{text:o.translateService.instant("product-detail.delete"),role:"destructive",handler:()=>{o.deleteProduct(e)}},{text:o.translateService.instant("product-detail.view-detail"),handler:()=>{o.selectProduct(e.id)}},{text:o.translateService.instant("product-detail.multi-select"),handler:()=>{o.selectMode=!0}},{text:o.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}deleteProduct(e){var o=this;return(0,m.Z)(function*(){yield(yield o.alertCtrl.create({header:o.translateService.instant("common.confirm"),message:o.translateService.instant("product-detail.delete-alert"),buttons:[{text:o.translateService.instant("common.agree"),handler:()=>{o.productService.deleteProduct(e).then((0,m.Z)(function*(){o.analyticsService.logEvent("product-delete-success");let c=o.products.findIndex(s=>s.id===e.id);c>=0&&o.products.splice(c,1),c=o.originalProducts.findIndex(s=>s.id===e.id),c>=0&&o.originalProducts.splice(c,1)}))}},{text:o.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}multiDelete(){var e=this;return(0,m.Z)(function*(){const o=e.products?e.products.filter(c=>c.isSelected).length:0;var c;0!==o?yield(yield e.alertCtrl.create({header:e.translateService.instant("common.confirm"),message:e.translateService.instant("product-detail.multi-delete-alert",{count:o}),buttons:[{text:e.translateService.instant("common.agree"),handler:(c=(0,m.Z)(function*(){const s=yield e.navCtrl.loading(),h=[],f=[];for(const b of e.products)b.isSelected&&(h.push(b),f.push(e.productService.deleteProduct(b)));yield Promise.all(f);for(const b of h){e.analyticsService.logEvent("product-delete-success");let x=e.products.findIndex(u=>u.id===b.id);x>=0&&e.products.splice(x,1),x=e.originalProducts.findIndex(u=>u.id===b.id),x>=0&&e.originalProducts.splice(x,1)}e.selectMode=!1,yield s.dismiss()}),function(){return c.apply(this,arguments)})},{text:e.translateService.instant("common.cancel"),handler:()=>{}}]})).present():alert(e.translateService.instant("product-detail.multi-delete-no-product-alert"))})()}selectAll(){for(const e of this.products)e.isSelected=this.isSelectAll}showSearchProduct(){var e=this;return(0,m.Z)(function*(){const o=function(){var r=(0,m.Z)(function*(c){if(c&&c.length){for(const s of c)yield e.addProductFromArr(s);e.reload()}});return function(s){return r.apply(this,arguments)}}();e.navCtrl.push("/category/category-product-selector",{callback:o})})()}addProductFromArr(e){var o=this;return(0,m.Z)(function*(){const r=new v.p;r.categoryId=o.category.id;const c=yield o.tradeService.getCategoriesToTrade(e.id);yield o.tradeService.saveCategoriesToTrade([r],e.id);const s=[];for(const h of c)h.categoryId===o.category.id&&s.push(h);s&&(yield o.tradeService.deleteCategoriesToTrade(s))})()}searchProduct(){var e=this;return(0,m.Z)(function*(){e.analyticsService.logEvent("product-search");let o=JSON.parse(JSON.stringify(e.originalProducts));if(null!==e.searchKey&&""!==e.searchKey){const r=e.searchKey.toLowerCase();o=o.filter(c=>c.code&&-1!==c.code.toLowerCase().indexOf(r)||c.title&&-1!==c.title.toLowerCase().indexOf(r))}e.products=o})()}clearSearchProduct(){this.selectMode=!1,this.searchKey=null,this.reload()}addDiscount(){this.navCtrl.push("/contact/add-discount",{category:this.category.id})}selectCustomerDiscount(e){this.navCtrl.push("/contact/add-discount",{id:e})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(I.G),t.Y36(p.sK),t.Y36(g.K),t.Y36(n.IN),t.Y36(U.X),t.Y36(Q.E),t.Y36(W.$),t.Y36(n.t4),t.Y36(R.x),t.Y36(n.BX),t.Y36(H.M),t.Y36(n.Br),t.Y36(j.y),t.Y36(w.y))},i.\u0275cmp=t.Xpm({type:i,selectors:[["category-detail"]],decls:47,vars:37,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","ellipsis-vertical"],[1,"ion-text-wrap"],[2,"white-space","pre-wrap"],["name","add"],[3,"ngModel","ngModelChange"],["value","product",1,"ion-text-wrap"],["value","trade",1,"ion-text-wrap"],["value","debt",1,"ion-text-wrap"],["value","discounts",1,"ion-text-wrap"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange",4,"ngIf"],[4,"ngIf"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[3,"click","press",4,"ngFor","ngForOf"],["slot","start","color","primary",3,"ngModel","ngModelChange"],["color","danger",3,"click"],["name","trash","slot","end"],[3,"click"],["name","exit-outline","slot","end"],[3,"click","press"],["color","primary","slot","start",3,"ngModel","ngModelChange",4,"ngIf"],[2,"white-space","pre-wrap","font-weight","bold"],["slot","end",4,"ngIf"],["color","primary","slot","start",3,"ngModel","ngModelChange"],["name","calendar"],[3,"src"],["size","4",1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],["color","primary","fill","clear",3,"click"],["slot","start","name","list-outline"],["slot","start","color","primary",3,"ngModel","ngModelChange",4,"ngIf"],["size","2",1,"ion-no-padding"],["size","1",1,"ion-no-padding"],["style","border-bottom: 1px solid #ccc;",3,"cursor","press","click",4,"ngFor","ngForOf"],[2,"border-bottom","1px solid #ccc",3,"press","click"],["class","ion-item-right","size","small",4,"ngIf"],["size","small",1,"ion-item-right"],[3,"color"],["fill","clear","color","primary","slot","end",3,"click"],["slot","icon-only","name","funnel"],[3,"trade","currency","onPress","onClick",4,"ngFor","ngForOf"],[3,"trade","currency","onPress","onClick"],["name","funnel"],[3,"debt","currency","onPress","onClick",4,"ngFor","ngForOf"],[3,"debt","currency","onPress","onClick"],["color","primary"],["slot","icon-only","name","add"],[3,"showContact","showProduct","customerDiscount","currency","showCategory","onClick",4,"ngFor","ngForOf"],["class","ion-padding",4,"ngIf"],[3,"showContact","showProduct","customerDiscount","currency","showCategory","onClick"],[1,"ion-padding"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-back-button",1),t.qZA(),t.TgZ(4,"ion-title"),t._uU(5),t.ALo(6,"translate"),t.qZA(),t.TgZ(7,"ion-buttons",2)(8,"ion-button",3),t.NdJ("click",function(){return o.edit()}),t._UZ(9,"ion-icon",4),t.qZA(),t.TgZ(10,"ion-button",3),t.NdJ("click",function(){return o.presentActionSheet()}),t._UZ(11,"ion-icon",5),t.qZA()()()(),t.TgZ(12,"ion-content")(13,"ion-list")(14,"ion-item")(15,"ion-label",6)(16,"b",7),t._uU(17),t.ALo(18,"translate"),t.qZA(),t._UZ(19,"br"),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-buttons")(23,"ion-button",3),t.NdJ("click",function(){return o.showSearchProduct()}),t._UZ(24,"ion-icon",8),t._uU(25),t.ALo(26,"translate"),t.qZA()()()(),t.TgZ(27,"ion-segment",9),t.NdJ("ngModelChange",function(c){return o.tab=c}),t.TgZ(28,"ion-segment-button",10),t._uU(29),t.ALo(30,"translate"),t.qZA(),t.TgZ(31,"ion-segment-button",11),t._uU(32),t.ALo(33,"translate"),t.qZA(),t.TgZ(34,"ion-segment-button",12),t._uU(35),t.ALo(36,"translate"),t.qZA(),t.TgZ(37,"ion-segment-button",13),t._uU(38),t.ALo(39,"translate"),t.qZA()(),t.YNc(40,tt,2,4,"ion-searchbar",14),t.YNc(41,et,2,4,"ion-searchbar",14),t.YNc(42,ot,2,4,"ion-searchbar",14),t.YNc(43,ft,3,2,"ion-list",15),t.YNc(44,vt,12,18,"ion-list",15),t.YNc(45,bt,12,18,"ion-list",15),t.YNc(46,Dt,11,6,"ion-list",15),t.qZA()),2&e&&(t.xp6(5),t.Oqu(t.lcZ(6,21,"category-detail.title")),t.xp6(7),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(5),t.AsE("",t.lcZ(18,23,"category-detail.category"),": ",o.category.title,""),t.xp6(3),t.lnq(" ",t.lcZ(21,25,"category-add.order-index"),": ",o.category.orderIndex," - ",o.dateTimeFormat(o.category.modifiedAt)," "),t.xp6(5),t.hij("",t.lcZ(26,27,"category-detail.add-products")," "),t.xp6(2),t.Q6J("ngModel",o.tab),t.xp6(2),t.hij(" ",t.lcZ(30,29,"category-detail.product")," "),t.xp6(3),t.hij(" ",t.lcZ(33,31,"contact-detail.trade")," "),t.xp6(3),t.hij(" ",t.lcZ(36,33,"contact-detail.debt-loan")," "),t.xp6(3),t.hij(" ",t.lcZ(39,35,"contact.discounts")," "),t.xp6(2),t.Q6J("ngIf","trade"===o.tab),t.xp6(1),t.Q6J("ngIf","debt"===o.tab),t.xp6(1),t.Q6J("ngIf","product"===o.tab),t.xp6(1),t.Q6J("ngIf","product"===o.tab),t.xp6(1),t.Q6J("ngIf","trade"===o.tab),t.xp6(1),t.Q6J("ngIf","debt"===o.tab),t.xp6(1),t.Q6J("ngIf","discounts"===o.tab))},dependencies:[T.sg,T.O5,D.JJ,D.On,n.oU,n.YG,n.Sm,n.nz,n.wI,n.W2,n.jY,n.Gu,n.gu,n.Ie,n.Q$,n.q_,n.Nd,n.VI,n.cJ,n.GO,n.yW,n.Bs,n.wd,n.sr,n.w,n.QI,n.j9,n.cs,z.A,X._,V.v,T.H9,p.X$],encapsulation:2}),i})();var It=_(3142),wt=_(6861);const Mt=["barcodeInput"];function Jt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-searchbar",22,23),t.NdJ("ionClear",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.clearSearch())})("ionChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.search())})("ngModelChange",function(r){t.CHM(e);const c=t.oxw();return t.KtG(c.searchKey=r)})("ngModelChange",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.barcodeChanged())}),t.ALo(2,"translate"),t.qZA()}if(2&i){const e=t.oxw();t.s9C("placeholder",t.lcZ(2,2,"product-selector.filter-by-words")),t.Q6J("ngModel",e.searchKey)}}function Ut(i,l){if(1&i&&(t.TgZ(0,"ion-avatar",3),t._UZ(1,"img",31),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function Nt(i,l){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item",24)(2,"ion-label",25)(3,"ion-text",26),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.increase(c))}),t._uU(4),t.qZA()(),t.YNc(5,Ut,2,1,"ion-avatar",27),t.TgZ(6,"ion-buttons",3)(7,"ion-button",28),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.decrease(c))}),t._UZ(8,"ion-icon",29),t.qZA(),t.TgZ(9,"ion-button",28),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.increase(c))}),t._UZ(10,"ion-icon",30),t.qZA()()(),t.BQk()}if(2&i){const e=l.$implicit,o=t.oxw();t.xp6(3),t.Udp("font-weight",e.isSelected?"bold":"normal"),t.Q6J("color",e.isSelected?"primary":"normal"),t.xp6(1),t.hij(" ",o.productName(e.code,e.title)," "),t.xp6(1),t.Q6J("ngIf",e.avatarUrl)}}function Ft(i,l){1&i&&(t.TgZ(0,"ion-select-option",32),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"product.list-option-customer-price"),""))}function Lt(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item",14)(1,"ion-label",33),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-buttons",3)(5,"ion-button",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.previousPage())}),t._UZ(6,"ion-icon",35),t.qZA(),t.TgZ(7,"ion-button",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.nextPage())}),t._UZ(8,"ion-icon",36),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"common.page")," ",e.currentPage+1," ")}}function Ot(i,l){if(1&i&&(t.TgZ(0,"ion-avatar",3),t._UZ(1,"img",31),t.qZA()),2&i){const e=t.oxw().$implicit;t.xp6(1),t.Q6J("src",e.avatarUrl,t.LSH)}}function kt(i,l){if(1&i){const e=t.EpF();t.ynx(0),t.TgZ(1,"ion-item",37)(2,"ion-label",25)(3,"ion-text",26),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.increase(c))}),t._uU(4),t.qZA()(),t.YNc(5,Ot,2,1,"ion-avatar",27),t.TgZ(6,"ion-buttons",3)(7,"ion-button",28),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.decrease(c))}),t._UZ(8,"ion-icon",29),t.qZA(),t.TgZ(9,"ion-button",28),t.NdJ("click",function(){const c=t.CHM(e).$implicit,s=t.oxw();return t.KtG(s.increase(c))}),t._UZ(10,"ion-icon",30),t.qZA()()(),t.BQk()}if(2&i){const e=l.$implicit,o=t.oxw();t.xp6(3),t.Udp("font-weight",e.isSelected?"bold":"normal"),t.Q6J("color",e.isSelected?"primary":"normal"),t.xp6(1),t.hij(" ",o.productName(e.code,e.title)," "),t.xp6(1),t.Q6J("ngIf",e.avatarUrl)}}function Et(i,l){if(1&i){const e=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",33),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-buttons",3)(5,"ion-button",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.previousPage())}),t._UZ(6,"ion-icon",35),t.qZA(),t.TgZ(7,"ion-button",34),t.NdJ("click",function(){t.CHM(e);const r=t.oxw();return t.KtG(r.nextPage())}),t._UZ(8,"ion-icon",36),t.qZA()()()}if(2&i){const e=t.oxw();t.xp6(2),t.AsE("",t.lcZ(3,2,"common.page")," ",e.currentPage+1," ")}}function qt(i,l){1&i&&(t.TgZ(0,"ion-item",38),t._UZ(1,"div",39),t.ALo(2,"translate"),t.qZA()),2&i&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"product-selector.no-product"),t.oJD))}const Qt=[{path:"",component:O},{path:"add",component:E},{path:"detail",component:Pt},{path:"category-product-selector",component:(()=>{class i{constructor(e,o,r,c,s,h,f,b,x){var u=this;this.navCtrl=e,this.userService=o,this.staffService=r,this.translateService=c,this.productService=s,this.analyticsService=h,this.dataService=f,this.planService=b,this.modalCtrl=x,this.products=[],this.selectedProducts=[],this.originalProducts=[],this.searchKey="",this.tab="all",this.start=0,this.end=19,this.pageSize=20,this.currentPage=0,this.listOption="all",this.checkProduct=0,this.currentPlan=null,this.reloadProducts=(0,m.Z)(function*(){u.currentPlan=yield u.planService.getCurrentPlan(),u.currentPlan||(u.checkProduct=yield u.planService.checkProduct(),u.checkProduct>=30&&(u.isOnTrial=yield u.planService.isOnTrial(u.currentPlan))),u.params=u.navCtrl.getParams(u.params),u.params&&u.params.callback&&(u.callback=u.params.callback),u.params&&u.params.exportStore&&(u.exportStore=u.params.exportStore),u.params&&u.params.contactId&&(u.contactId=u.params.contactId),u.params&&u.params.staffId&&(u.staffId=u.params.staffId);const S=yield u.navCtrl.loading();u.currency=yield u.userService.getAttr("current-currency"),u.selectedStaff=u.staffService.selectedStaff;const Z=u.exportStore&&!u.exportStore.isMainShop?u.exportStore.id:0;("all"===u.listOption?u.productService.getProducts(Z,0):"expiry"===u.listOption?u.productService.getProductsExpiry(Z,0):"quantity"===u.listOption?u.productService.getProductsQuantity(Z,0):Promise.resolve(null)).then(function(){var K=(0,m.Z)(function*(q){const M=JSON.parse(JSON.stringify(q));if(M&&M.length)for(const Y of M)Y.isSelected=!1;u.originalProducts=M,u.products=M,yield S.dismiss()});return function(q){return K.apply(this,arguments)}}())}),this.navCtrl.removeEventListener("reloadCategoryProductSelector",this.reloadProducts),this.navCtrl.addEventListener("reloadCategoryProductSelector",this.reloadProducts)}ionViewWillEnter(){var e=this;return(0,m.Z)(function*(){yield e.analyticsService.setCurrentScreen("category-product-selector")})()}tabChanged(){}barcodeChanged(){var e=this;return(0,m.Z)(function*(){!e.searchKey||e.searchKey.length<5||(e.analyticsService.logEvent("category-product-selector-barcode-entered"),e.productService.searchByBarcode(e.searchKey).then(o=>{if(!o)return;e.analyticsService.logEvent("note-product-selector-barcode-entered-ok");let r=e.originalProducts;if(r=r.filter(c=>c.id===o.id),r&&r.length)for(const c of r)e.increase(c);e.products=r}))})()}toFixQuantity(e){return a.W.toFixQuantity(e)}increase(e){var o=this;return(0,m.Z)(function*(){o.selectedProducts.find(c=>c.id===e.id)||o.selectedProducts.push(e),e.isSelected=!0})()}decrease(e){var o=this;return(0,m.Z)(function*(){if(!e)return;e.isSelected=!1;const r=o.selectedProducts.findIndex(c=>c.id===e.id);r>=0&&o.selectedProducts.splice(r,1),(!o.selectedProducts||!o.selectedProducts.length)&&"all"!==o.tab&&(o.tab="all",o.tabChanged()),o.analyticsService.logEvent("category-product-selector-deselect")})()}ngOnInit(){this.reloadProducts()}dateFormat(e){return d.C.toUiString(e)}search(){var e=this;return(0,m.Z)(function*(){e.analyticsService.logEvent("note-product-selector-search");let o=e.originalProducts;if(null!==e.searchKey&&""!==e.searchKey){e.start=0,e.end=19,e.currentPage=0;const r=e.searchKey.toLowerCase();o=o.filter(c=>c.title&&-1!==c.title.toLowerCase().indexOf(r)||c.code&&-1!==c.code.toLowerCase().indexOf(r))}e.products=o})()}clearSearch(){var e=this;return(0,m.Z)(function*(){e.start=0,e.end=19,e.currentPage=0,e.analyticsService.logEvent("note-product-selector-clear-search"),e.searchKey=null,e.products=e.originalProducts})()}dismiss(){var e=this;return(0,m.Z)(function*(){if(e.callback)return e.callback(null),void(yield e.navCtrl.back());e.modalCtrl.dismiss()})()}ok(){var e=this;return(0,m.Z)(function*(){if(e.analyticsService.logEvent("note-product-selector-ok"),e.callback)return e.callback(e.selectedProducts),void(yield e.navCtrl.back());e.modalCtrl.dismiss(e.selectedProducts)})()}productName(e,o){let c=a.W.productName(e,o);return!c||c.length<=100||(c=c.substr(0,100),c=c.substr(0,Math.min(c.length,c.lastIndexOf(" ")))+"..."),c}get isShowPaging(){return!!(this.products&&this.products.length>this.pageSize)}previousPage(){this.currentPage<=0?this.currentPage=0:(this.currentPage--,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1)}nextPage(){(this.currentPage+1)*this.pageSize>=this.products.length||(this.currentPage++,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1)}expand(e){var o=this;return(0,m.Z)(function*(){const r=!e.isExpand;for(const c of o.products)c.isExpand=!1;e.isExpand=r,r&&o.analyticsService.logEvent("note-product-selector-expand")})()}changeListOption(){this.start=0,this.end=19,this.currentPage=0,this.reloadProducts()}add(){if(!this.currentPlan&&this.checkProduct>=30&&!this.isOnTrial)return this.analyticsService.logEvent("check-product-alert"),void alert(this.translateService.instant("product.check-product-alert",{total:this.checkProduct}));this.navCtrl.push("/product/quick-add",{fromSearch:!0})}}return i.\u0275fac=function(e){return new(e||i)(t.Y36(I.G),t.Y36(g.K),t.Y36(N.x),t.Y36(p.sK),t.Y36(H.M),t.Y36(w.y),t.Y36(It.D),t.Y36(wt.D),t.Y36(n.IN))},i.\u0275cmp=t.Xpm({type:i,selectors:[["category-product-selector"]],viewQuery:function(e,o){if(1&e&&t.Gf(Mt,5),2&e){let r;t.iGM(r=t.CRH())&&(o.barcodeInput=r.first)}},decls:52,vars:44,consts:[["slot","start"],[3,"click"],["name","close"],["slot","end"],["name","add"],["name","checkmark"],["color","primary",3,"ngModel","ngModelChange"],["value","all"],["value","selected"],["color","danger"],["autofocus","true","debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange",4,"ngIf"],[3,"hidden"],[4,"ngFor","ngForOf"],["size","6",1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],[2,"max-width","100% !important",3,"placeholder","ngModel","ngModelChange"],["value","expiry"],["value","quantity"],["value","customer-price",4,"ngIf"],["lines","none","class","ion-no-padding",4,"ngIf"],[4,"ngIf"],["text-wrap","",4,"ngIf"],["autofocus","true","debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],["barcodeInput",""],["text-wrap","",2,"--min-height","0"],[1,"ion-text-wrap"],[2,"padding","0",3,"color","click"],["slot","end",4,"ngIf"],["fill","clear","size","large",3,"click"],["slot","icon-only","size","large","name","remove"],["slot","icon-only","size","large","name","add"],[3,"src"],["value","customer-price"],[1,"ion-text-wrap","ion-text-right"],["fill","solid",3,"click"],["slot","icon-only","name","arrow-back-circle"],["slot","icon-only","name","arrow-forward-circle"],["text-wrap","","lines","none",2,"--min-height","0"],["text-wrap",""],[3,"innerHTML"]],template:function(e,o){1&e&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return o.dismiss()}),t._UZ(4,"ion-icon",2),t.qZA()(),t.TgZ(5,"ion-title"),t._uU(6),t.ALo(7,"translate"),t.qZA(),t.TgZ(8,"ion-buttons",3)(9,"ion-button",1),t.NdJ("click",function(){return o.add()}),t._UZ(10,"ion-icon",4),t.qZA(),t.TgZ(11,"ion-button",1),t.NdJ("click",function(){return o.ok()}),t._UZ(12,"ion-icon",5),t._uU(13),t.ALo(14,"translate"),t.qZA()()(),t.TgZ(15,"ion-segment",6),t.NdJ("ngModelChange",function(c){return o.tab=c})("ngModelChange",function(){return o.tabChanged()}),t.TgZ(16,"ion-segment-button",7),t._uU(17),t.ALo(18,"translate"),t.qZA(),t.TgZ(19,"ion-segment-button",8)(20,"ion-text"),t._uU(21),t.ALo(22,"translate"),t.TgZ(23,"ion-text",9),t._uU(24),t.qZA()()()(),t.YNc(25,Jt,3,4,"ion-searchbar",10),t.qZA(),t.TgZ(26,"ion-content")(27,"ion-list",11),t.YNc(28,Nt,11,5,"ng-container",12),t.qZA(),t.TgZ(29,"ion-list",11)(30,"ion-grid")(31,"ion-row")(32,"ion-col",13)(33,"ion-item",14)(34,"ion-select",15),t.NdJ("ngModelChange",function(c){return o.listOption=c})("ngModelChange",function(){return o.changeListOption()}),t.ALo(35,"translate"),t.TgZ(36,"ion-select-option",7),t._uU(37),t.ALo(38,"translate"),t.qZA(),t.TgZ(39,"ion-select-option",16),t._uU(40),t.ALo(41,"translate"),t.qZA(),t.TgZ(42,"ion-select-option",17),t._uU(43),t.ALo(44,"translate"),t.qZA(),t.YNc(45,Ft,3,3,"ion-select-option",18),t.qZA()()(),t.TgZ(46,"ion-col",13),t.YNc(47,Lt,9,4,"ion-item",19),t.qZA()()(),t.YNc(48,kt,11,5,"ng-container",12),t.ALo(49,"slice"),t.YNc(50,Et,9,4,"ion-item",20),t.YNc(51,qt,3,3,"ion-item",21),t.qZA()()),2&e&&(t.xp6(6),t.hij(" ",t.lcZ(7,24,"product-selector.title")," "),t.xp6(7),t.hij("\xa0",t.lcZ(14,26,"action.save")," "),t.xp6(2),t.Q6J("ngModel",o.tab),t.xp6(2),t.hij(" ",t.lcZ(18,28,"product-selector.filter-all")," "),t.xp6(3),t.Udp("font-weight",o.selectedProducts&&o.selectedProducts.length?"bold":"normal"),t.xp6(1),t.hij(" ",t.lcZ(22,30,"product-selector.filter-selected")," "),t.xp6(3),t.hij(" (",o.selectedProducts?o.selectedProducts.length:0,")"),t.xp6(1),t.Q6J("ngIf","all"===o.tab),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.Q6J("hidden","all"===o.tab),t.xp6(1),t.Q6J("ngForOf",o.selectedProducts),t.xp6(1),t.Q6J("hidden","selected"===o.tab),t.xp6(5),t.s9C("placeholder",t.lcZ(35,32,"product.select-option")),t.Q6J("ngModel",o.listOption),t.xp6(3),t.Oqu(t.lcZ(38,34,"product.list-option-all")),t.xp6(3),t.Oqu(t.lcZ(41,36,"product.list-option-expiry")),t.xp6(3),t.Oqu(t.lcZ(44,38,"product.list-option-quantiy")),t.xp6(2),t.Q6J("ngIf",o.contactId),t.xp6(2),t.Q6J("ngIf",o.isShowPaging&&o.products&&o.products.length),t.xp6(1),t.Q6J("ngForOf",t.Dn7(49,40,o.products,o.start,o.end+1)),t.xp6(2),t.Q6J("ngIf",o.isShowPaging&&o.products&&o.products.length),t.xp6(1),t.Q6J("ngIf",!o.originalProducts||0===o.originalProducts.length))},dependencies:[T.sg,T.O5,D.JJ,D.On,n.BJ,n.YG,n.Sm,n.wI,n.W2,n.jY,n.Gu,n.gu,n.Ie,n.Q$,n.q_,n.Nd,n.VI,n.cJ,n.GO,n.t9,n.n0,n.yW,n.wd,n.sr,n.QI,n.j9,T.OU,p.X$],encapsulation:2}),i})()}];let Kt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[P.Bz.forChild(Qt),P.Bz]}),i})();var Yt=_(529),B=_(3093);let Gt=(()=>{class i{}return i.\u0275fac=function(e){return new(e||i)},i.\u0275mod=t.oAB({type:i}),i.\u0275inj=t.cJS({imports:[T.ez,D.u5,n.Pc,Kt,B.m,p.aw.forChild({loader:{provide:p.Zw,useFactory:B.x,deps:[Yt.eN]}})]}),i})()},8262:(G,J,_)=>{_.d(J,{v:()=>d});var T=_(6723),D=_(1914),n=_(6738),P=_(3306),m=_(6895),A=_(191);const t=function(a,v,p){return[a,v,"symbol","1.0-2",p]};function U(a,v){if(1&a&&(n.TgZ(0,"ion-text",6),n._uU(1),n.ALo(2,"currency"),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.Oqu(n.G7q(2,1,n.kEZ(7,t,p.customerDiscount.discountValue,p.currency,p.translateService.currentLang)))}}function N(a,v){if(1&a&&(n.TgZ(0,"ion-text",6),n._uU(1),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.hij("",p.customerDiscount.discountValue,"%")}}function I(a,v){if(1&a&&(n.TgZ(0,"ion-text"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.AsE(" - ",n.lcZ(2,2,"customer-discount-add.quantity-condition"),": ",p.customerDiscount.conditionQuantity,"")}}function w(a,v){if(1&a&&(n.TgZ(0,"ion-text"),n._uU(1),n.ALo(2,"translate"),n._UZ(3,"br"),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.AsE("",n.lcZ(2,2,"customer-discount-add.category"),": ",p.customerDiscount.category.title,"")}}function O(a,v){if(1&a&&(n.TgZ(0,"ion-text"),n._uU(1),n.ALo(2,"translate"),n._UZ(3,"br"),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.AsE("",n.lcZ(2,2,"customer-discount-add.contact"),": ",p.customerDiscount.contact.fullName,"")}}function k(a,v){if(1&a&&(n.TgZ(0,"ion-text"),n._uU(1),n.ALo(2,"translate"),n._UZ(3,"br"),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.AsE("",n.lcZ(2,2,"customer-discount-add.staff"),": ",p.customerDiscount.staff.name,"")}}function E(a,v){if(1&a&&(n.TgZ(0,"ion-text",7)(1,"b"),n._uU(2),n.qZA()()),2&a){const p=n.oxw();n.xp6(2),n.Oqu(p.productName(p.customerDiscount.product.code,p.customerDiscount.product.title))}}function F(a,v){if(1&a&&(n.TgZ(0,"p"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.AsE(" ",n.lcZ(2,2,"customer-price-add.created-at"),": ",p.dateFormat(p.customerDiscount.createdAt)," ")}}function C(a,v){if(1&a&&(n.TgZ(0,"ion-avatar",8),n._UZ(1,"img",9),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.Q6J("src",p.contactImageOrPlaceholder(p.customerDiscount.contact),n.LSH)}}function y(a,v){if(1&a&&(n.TgZ(0,"ion-avatar",8),n._UZ(1,"img",9),n.qZA()),2&a){const p=n.oxw();n.xp6(1),n.Q6J("src",p.customerDiscount.product.avatarUrl,n.LSH)}}let d=(()=>{class a{constructor(p){this.translateService=p,this.showCategory=!0,this.showStaff=!0,this.onPress=new n.vpe,this.onClick=new n.vpe}dateFormat(p){return D.C.toUiDateString(p)}productName(p,g){return T.W.productName(p,g)}contactImageOrPlaceholder(p){return T.W.contactImageOrPlaceholder(p.avatarUrl)}limitText(p,g=200){return T.W.limitText(p,g)}press(){this.onPress.emit()}click(){this.onClick.emit()}}return a.\u0275fac=function(p){return new(p||a)(n.Y36(P.sK))},a.\u0275cmp=n.Xpm({type:a,selectors:[["customer-discount-item"]],inputs:{currency:"currency",showContact:"showContact",showProduct:"showProduct",showCategory:"showCategory",showStaff:"showStaff",customerDiscount:"customerDiscount"},outputs:{onPress:"onPress",onClick:"onClick"},decls:15,vars:13,consts:[[3,"press","click"],[1,"ion-text-wrap"],["color","primary",4,"ngIf"],[4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["slot","end",4,"ngIf"],["color","primary"],[2,"white-space","pre-wrap"],["slot","end"],[3,"src"]],template:function(p,g){1&p&&(n.TgZ(0,"ion-item",0),n.NdJ("press",function(){return g.press()})("click",function(){return g.click()}),n.TgZ(1,"ion-label",1),n._uU(2),n.ALo(3,"translate"),n.YNc(4,U,3,11,"ion-text",2),n.YNc(5,N,2,1,"ion-text",2),n.YNc(6,I,3,4,"ion-text",3),n._UZ(7,"br"),n.YNc(8,w,4,4,"ion-text",3),n.YNc(9,O,4,4,"ion-text",3),n.YNc(10,k,4,4,"ion-text",3),n.YNc(11,E,3,1,"ion-text",4),n.YNc(12,F,3,4,"p",3),n.qZA(),n.YNc(13,C,2,1,"ion-avatar",5),n.YNc(14,y,2,1,"ion-avatar",5),n.qZA()),2&p&&(n.xp6(2),n.hij(" ",n.lcZ(3,11,"customer-discount-add.discount"),": "),n.xp6(2),n.Q6J("ngIf",0===g.customerDiscount.type),n.xp6(1),n.Q6J("ngIf",1===g.customerDiscount.type),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.conditionQuantity),n.xp6(2),n.Q6J("ngIf",g.customerDiscount.categoryId&&0!=g.customerDiscount.categoryId&&g.customerDiscount.category&&g.showCategory),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.contactId&&0!=g.customerDiscount.contactId&&g.customerDiscount.contact&&g.showContact),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.collaboratorId&&0!=g.customerDiscount.collaboratorId&&g.customerDiscount.staff&&g.showStaff),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.productId&&0!=g.customerDiscount.productId&&g.customerDiscount.product&&g.showProduct),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.createdAt),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.contactId&&0!=g.customerDiscount.contactId&&g.customerDiscount.contact&&g.showContact),n.xp6(1),n.Q6J("ngIf",g.customerDiscount.productId&&0!=g.customerDiscount.productId&&g.customerDiscount.product&&g.customerDiscount.product.avatarUrl&&g.showProduct))},dependencies:[m.O5,A.BJ,A.Ie,A.Q$,A.yW,m.H9,P.X$],encapsulation:2}),a})()},3604:(G,J,_)=>{_.d(J,{_:()=>F});var T=_(6723),D=_(1914),n=_(6738),P=_(3306),m=_(6895),A=_(191);function t(C,y){if(1&C&&(n.TgZ(0,"p"),n._uU(1),n.qZA()),2&C){const d=n.oxw();n.xp6(1),n.Oqu(d.trade.contact.fullName)}}function U(C,y){if(1&C&&(n.TgZ(0,"p",3)(1,"b"),n._uU(2),n.qZA()()),2&C){const d=n.oxw();n.xp6(2),n.Oqu(d.productName(d.trade.product.code,d.trade.product.title))}}function N(C,y){if(1&C&&(n.TgZ(0,"p"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&C){const d=n.oxw();n.xp6(1),n.lnq(" ",n.lcZ(2,3,"trade.buy")," ",d.trade.productCount," ",d.trade.product.unit?"("+d.trade.product.unit+")":""," ")}}function I(C,y){if(1&C&&(n.TgZ(0,"p"),n._uU(1),n.ALo(2,"translate"),n.qZA()),2&C){const d=n.oxw();n.xp6(1),n.lnq(" ",n.lcZ(2,3,"trade.sale")," ",d.trade.productCount," ",d.trade.product.unit?"("+d.trade.product.unit+")":""," ")}}function w(C,y){if(1&C&&(n.TgZ(0,"p")(1,"i",7),n._uU(2),n.ALo(3,"translate"),n.qZA()()),2&C){const d=n.oxw();n.xp6(2),n.AsE("",n.lcZ(3,2,"trade.staff")," ",d.trade.staff.name,"")}}function O(C,y){if(1&C&&(n.TgZ(0,"ion-avatar",8),n._UZ(1,"img",9),n.qZA()),2&C){const d=n.oxw();n.xp6(1),n.Q6J("src",d.contactImageOrPlaceholder(d.trade.contact),n.LSH)}}function k(C,y){if(1&C&&(n.TgZ(0,"ion-avatar",8),n._UZ(1,"img",9),n.qZA()),2&C){const d=n.oxw();n.xp6(1),n.Q6J("src",d.trade.product.avatarUrl,n.LSH)}}const E=function(C,y,d){return[C,y,"symbol","1.0-2",d]};let F=(()=>{class C{constructor(d){this.translateService=d,this.isStaff=!1,this.showProduct=!0,this.onPress=new n.vpe,this.onClick=new n.vpe}dateFormat(d){return D.C.toUiDateString(d)}contactImageOrPlaceholder(d){return T.W.contactImageOrPlaceholder(d.avatarUrl)}productName(d,a){return T.W.productName(d,a)}limitText(d,a=200){return T.W.limitText(d,a)}press(){this.onPress.emit()}click(){this.onClick.emit()}}return C.\u0275fac=function(d){return new(d||C)(n.Y36(P.sK))},C.\u0275cmp=n.Xpm({type:C,selectors:[["trade-item"]],inputs:{currency:"currency",showContact:"showContact",isStaff:"isStaff",showProduct:"showProduct",trade:"trade"},outputs:{onPress:"onPress",onClick:"onClick"},decls:17,vars:22,consts:[[3,"press","click"],[1,"ion-text-wrap"],[3,"color"],[2,"white-space","pre-wrap"],[4,"ngIf"],["style","white-space: pre-wrap;",4,"ngIf"],["slot","end",4,"ngIf"],[2,"font-size","11px"],["slot","end"],[3,"src"]],template:function(d,a){1&d&&(n.TgZ(0,"ion-item",0),n.NdJ("press",function(){return a.press()})("click",function(){return a.click()}),n.TgZ(1,"ion-label",1)(2,"ion-text",2),n._uU(3),n.ALo(4,"currency"),n.qZA(),n._UZ(5,"br"),n.TgZ(6,"ion-text",3),n._uU(7),n.qZA(),n.YNc(8,t,2,1,"p",4),n.YNc(9,U,3,1,"p",5),n.YNc(10,N,3,5,"p",4),n.YNc(11,I,3,5,"p",4),n.TgZ(12,"p"),n._uU(13),n.qZA(),n.YNc(14,w,4,4,"p",4),n.qZA(),n.YNc(15,O,2,1,"ion-avatar",6),n.YNc(16,k,2,1,"ion-avatar",6),n.qZA()),2&d&&(n.xp6(2),n.s9C("color",(a.trade.isReceived?1:-1)*a.trade.value>=0?"secondary":"danger"),n.xp6(1),n.AsE("",a.trade.isReceived&&a.trade.value>0?"+":a.trade.isReceived?"":"-","",n.G7q(4,12,n.kEZ(18,E,a.trade.value,a.currency,a.translateService.currentLang)),""),n.xp6(4),n.Oqu(a.limitText(a.trade.note)),n.xp6(1),n.Q6J("ngIf",a.trade.contactId&&0!=a.trade.contactId&&a.trade.contact&&a.showContact),n.xp6(1),n.Q6J("ngIf",a.trade.productId&&0!=a.trade.productId&&a.trade.product&&a.showProduct),n.xp6(1),n.Q6J("ngIf",a.trade.productId&&0!=a.trade.productId&&a.trade.product&&a.trade.isPurchase&&!a.trade.isReceived),n.xp6(1),n.Q6J("ngIf",a.trade.productId&&0!=a.trade.productId&&a.trade.product&&a.trade.isPurchase&&a.trade.isReceived),n.xp6(2),n.hij(" ",a.dateFormat(a.trade.createdAt)," "),n.xp6(1),n.Q6J("ngIf",a.trade.staffId&&0!=a.trade.staffId&&a.trade.staff&&!a.isStaff),n.xp6(1),n.Q6J("ngIf",a.trade.contactId&&0!=a.trade.contactId&&a.trade.contact&&a.showContact),n.xp6(1),n.Q6J("ngIf",a.trade.productId&&0!=a.trade.productId&&a.trade.product&&a.trade.product.avatarUrl&&a.showProduct))},dependencies:[m.O5,A.BJ,A.Ie,A.Q$,A.yW,m.H9,P.X$],encapsulation:2}),C})()}}]);