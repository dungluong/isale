"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5505],{5505:(de,B,m)=>{m.r(B),m.d(B,{ReceivedNoteModule:()=>fo});var _=m(6895),N=m(4006),a=m(191),b=m(3306),ee=m(529),z=m(3196),d=m(5861),w=m(1001),k=m(6841),J=m(4220),S=m(7489),v=m(1914),Z=m(6723),e=m(6738),h=m(5851),L=m(7725),I=m(2126),te=m(7696),ue=m(7833),G=m(7488),re=m(7060),W=m(323),ne=m(6961),Ce=m(6391);function Ae(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.Oqu(t.receivedNote.contact.address)}}function ye(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item-sliding")(1,"ion-item")(2,"ion-avatar",0),e._UZ(3,"img",19),e.qZA(),e.TgZ(4,"ion-label")(5,"h2")(6,"b"),e._uU(7),e.qZA()(),e.TgZ(8,"p"),e._uU(9),e.qZA(),e.YNc(10,Ae,2,1,"p",7),e.qZA()(),e.TgZ(11,"ion-item-options",20)(12,"ion-item-option",3),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.text())}),e._UZ(13,"ion-icon",21),e._uU(14),e.ALo(15,"translate"),e.qZA(),e.TgZ(16,"ion-item-option",22),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.call())}),e._UZ(17,"ion-icon",23),e._uU(18),e.ALo(19,"translate"),e.qZA()()()}if(2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("src",t.contactImageOrPlaceholder(),e.LSH),e.xp6(4),e.Oqu(t.receivedNote.contact.fullName),e.xp6(2),e.Oqu(t.receivedNote.contact.mobile),e.xp6(1),e.Q6J("ngIf",t.receivedNote.contact.address),e.xp6(4),e.hij(" ",e.lcZ(15,6,"action.text")," "),e.xp6(4),e.hij(" ",e.lcZ(19,8,"action.call")," ")}}function Ne(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-detail.contact-info"),":"),e.xp6(3),e.Oqu(t.receivedNote.contactName)}}function Te(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.qZA()()),2&i){const t=e.oxw(2);e.xp6(2),e.hij("",e.lcZ(3,2,"contact-add.phone"),":"),e.xp6(3),e.Oqu(t.receivedNote.contactPhone)}}function be(i,l){1&i&&(e.TgZ(0,"ion-item-divider",24),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"received-note-add.product")," "))}function Se(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(),n=t.index,o=t.$implicit;e.xp6(1),e.AsE("",n+1,". ",o.productCode,"-")}}function Pe(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(4);e.xp6(1),e.hij("(",t.receivedNote.foreignCurrency,")")}}function qe(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,Pe,2,1,"span",7),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.hij(" | ",t.amountForeign,"\xa0"),e.xp6(1),e.Q6J("ngIf",n.receivedNote.foreignCurrency)}}function Ue(i,l){if(1&i&&(e.TgZ(0,"span"),e._UZ(1,"br"),e.TgZ(2,"span",27),e._uU(3),e.ALo(4,"translate"),e.qZA()()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(3),e.AsE("",e.lcZ(4,2,"received-note-add.received-date"),": ",n.dateFormat(t.receivedDate),"")}}function we(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.note)}}const O=function(i,l,t){return[i,l,"symbol","1.0-2",t]};function Je(i,l){if(1&i&&(e.TgZ(0,"span",28),e._UZ(1,"br"),e._uU(2),e.ALo(3,"translate"),e.ALo(4,"currency"),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(2),e.AsE("",e.lcZ(3,2,"order-add.product-discount-short"),": -",e.G7q(4,4,e.kEZ(10,O,t.discount,n.currency,n.translateService.currentLang)),"")}}function Le(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-label",25)(2,"ion-text"),e.YNc(3,Se,2,2,"span",7),e._uU(4),e.ALo(5,"currency"),e.YNc(6,qe,3,2,"span",7),e.YNc(7,Ue,5,4,"span",7),e.qZA(),e.YNc(8,we,2,1,"p",7),e.qZA(),e.TgZ(9,"ion-text",18),e._uU(10),e.ALo(11,"currency"),e.YNc(12,Je,5,14,"span",26),e.qZA()()),2&i){const t=l.$implicit,n=e.oxw(2);e.xp6(3),e.Q6J("ngIf",t.productCode),e.xp6(1),e.HOy("",t.productName," | ",t.quantity," ",t.unit," \xd7 ",e.G7q(5,10,e.kEZ(22,O,t.costPrice?t.costPrice:t.unitPrice,n.currency,n.translateService.currentLang))," "),e.xp6(2),e.Q6J("ngIf",t.amountForeign),e.xp6(1),e.Q6J("ngIf",t.receivedDate),e.xp6(1),e.Q6J("ngIf",t.note),e.xp6(2),e.Oqu(e.G7q(11,16,e.kEZ(26,O,t.amount,n.currency,n.translateService.currentLang))),e.xp6(2),e.Q6J("ngIf",t.discount)}}function Ie(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",30),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"span",2),e._uU(5),e.ALo(6,"currency"),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-add.discount"),":"),e.xp6(3),e.hij("-",e.G7q(6,4,e.kEZ(10,O,t.receivedNote.discountOnTotal,t.currency,t.translateService.currentLang)),"")}}function Me(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.ALo(6,"currency"),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-add.tax"),":"),e.xp6(3),e.hij("+",e.G7q(6,4,e.kEZ(10,O,t.receivedNote.tax,t.currency,t.translateService.currentLang)),"")}}function ke(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.ALo(6,"currency"),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-add.shipping-fee"),":"),e.xp6(3),e.hij("+",e.G7q(6,4,e.kEZ(10,O,t.receivedNote.shippingFee,t.currency,t.translateService.currentLang)),"")}}function Re(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.ALo(6,"currency"),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-add.paid"),":"),e.xp6(3),e.Oqu(e.G7q(6,4,e.kEZ(10,O,t.receivedNote.paid,t.currency,t.translateService.currentLang)))}}function Ee(i,l){if(1&i&&(e.TgZ(0,"ion-text",2),e._uU(1),e.qZA()),2&i){const t=e.oxw(4);e.xp6(1),e.hij(" (",t.receivedNote.foreignCurrency,")")}}function Oe(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.qZA(),e.YNc(6,Ee,2,1,"ion-text",31),e.qZA()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,3,"received-note-add.total-foreign"),":"),e.xp6(3),e.Oqu(t.receivedNote.totalForeign),e.xp6(1),e.Q6J("ngIf",t.receivedNote.foreignCurrency)}}function Fe(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-add.delivery-person"),":"),e.xp6(3),e.Oqu(t.receivedNote.deliveryPerson)}}function Qe(i,l){if(1&i&&(e.TgZ(0,"ion-item")(1,"ion-text",10),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-text",2),e._uU(5),e.qZA()()),2&i){const t=e.oxw(3);e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-add.receiver"),":"),e.xp6(3),e.Oqu(t.receivedNote.receiver)}}function Ye(i,l){if(1&i&&(e.TgZ(0,"ion-list")(1,"ion-item-divider",24),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.YNc(4,Ie,7,14,"ion-item",7),e.TgZ(5,"ion-item")(6,"ion-text",29),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"ion-text",2),e._uU(10),e.ALo(11,"currency"),e.qZA()(),e.YNc(12,Me,7,14,"ion-item",7),e.YNc(13,ke,7,14,"ion-item",7),e.TgZ(14,"ion-item")(15,"ion-text",30)(16,"b"),e._uU(17),e.ALo(18,"translate"),e.qZA()(),e.TgZ(19,"ion-text",2)(20,"b"),e._uU(21),e.ALo(22,"currency"),e.qZA()()(),e.YNc(23,Re,7,14,"ion-item",7),e.YNc(24,Oe,7,5,"ion-item",7),e.YNc(25,Fe,6,4,"ion-item",7),e.YNc(26,Qe,6,4,"ion-item",7),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.hij(" ",e.lcZ(3,12,"received-note-add.payment")," "),e.xp6(2),e.Q6J("ngIf",t.receivedNote.discountOnTotal),e.xp6(3),e.hij("",e.lcZ(8,14,"received-note-add.net-value"),":"),e.xp6(3),e.Oqu(e.G7q(11,16,e.kEZ(30,O,t.receivedNote.netValue,t.currency,t.translateService.currentLang))),e.xp6(2),e.Q6J("ngIf",t.receivedNote.tax),e.xp6(1),e.Q6J("ngIf",t.receivedNote.shippingFee),e.xp6(4),e.hij("",e.lcZ(18,22,"received-note-add.total"),":"),e.xp6(4),e.Oqu(e.G7q(22,24,e.kEZ(34,O,t.receivedNote.total,t.currency,t.translateService.currentLang))),e.xp6(2),e.Q6J("ngIf",null!==t.receivedNote.paid),e.xp6(1),e.Q6J("ngIf",t.receivedNote.totalForeign),e.xp6(1),e.Q6J("ngIf",t.receivedNote.deliveryPerson),e.xp6(1),e.Q6J("ngIf",t.receivedNote.receiver)}}function De(i,l){if(1&i&&(e.TgZ(0,"ion-text"),e._uU(1),e.ALo(2,"translate"),e.ALo(3,"translate"),e._UZ(4,"br"),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.HOy(" ",e.lcZ(2,4,"common.from")," ",t.dateFormat(t.dateDebtFrom)," ",e.lcZ(3,6,"common.to")," ",t.dateFormat(t.dateDebtTo)," ")}}function Ge(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"debt-item",38),e.NdJ("onClick",function(){const r=e.CHM(t).$implicit,c=e.oxw(3);return e.KtG(c.selectDebt(r.id))}),e.qZA()}if(2&i){const t=l.$implicit,n=e.oxw(3);e.Q6J("showContact",!1)("debt",t)("currency",n.currency)}}function Ve(i,l){1&i&&(e.TgZ(0,"ion-item",25),e._UZ(1,"div",39),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,1,"received-note-detail.no-debt"),e.oJD))}function je(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-list")(1,"ion-item")(2,"ion-label",25),e.YNc(3,De,5,8,"ion-text",7),e._uU(4),e.ALo(5,"translate"),e.TgZ(6,"ion-text",30),e._uU(7),e.ALo(8,"currency"),e.qZA(),e._uU(9),e.ALo(10,"translate"),e.TgZ(11,"ion-text",29),e._uU(12),e.ALo(13,"currency"),e.qZA()(),e.TgZ(14,"ion-buttons",2)(15,"ion-button",32),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.selectDateRangeForDebt())}),e._UZ(16,"ion-icon",33),e.qZA(),e.TgZ(17,"ion-button",34),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.addDebt())}),e._UZ(18,"ion-icon",35),e.qZA()()(),e.YNc(19,Ge,1,3,"debt-item",36),e.YNc(20,Ve,3,3,"ion-item",37),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(3),e.Q6J("ngIf",""!=t.dateDebtFrom||""!=t.dateDebtTo),e.xp6(1),e.hij(" ",e.lcZ(5,7,"common.total"),":\xa0 "),e.xp6(3),e.Oqu(e.G7q(8,9,e.kEZ(23,O,t.totalDebt,t.currency,t.translateService.currentLang))),e.xp6(2),e.hij(" / ",e.lcZ(10,15,"debt-detail.paid"),":\xa0 "),e.xp6(3),e.Oqu(e.G7q(13,17,e.kEZ(27,O,t.totalDebtPaid,t.currency,t.translateService.currentLang))),e.xp6(7),e.Q6J("ngForOf",t.debts),e.xp6(1),e.Q6J("ngIf",!t.debts||0===t.debts.length)}}function Ke(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"div")(1,"ion-list")(2,"ion-item",9)(3,"ion-text",10),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"ion-text",2),e._uU(7),e.qZA()(),e.TgZ(8,"ion-item",9)(9,"ion-text"),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"ion-text",2),e._uU(13),e.qZA()(),e.TgZ(14,"ion-segment",11),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.tab=o)}),e.TgZ(15,"ion-segment-button",12),e._uU(16),e.ALo(17,"translate"),e.qZA(),e.TgZ(18,"ion-segment-button",13),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.YNc(21,ye,20,10,"ion-item-sliding",7),e.YNc(22,Ne,6,4,"ion-item",7),e.YNc(23,Te,6,4,"ion-item",7),e.qZA(),e.YNc(24,be,3,3,"ion-item-divider",14),e.TgZ(25,"ion-list",15),e.YNc(26,Le,13,30,"ion-item",16),e.TgZ(27,"ion-item")(28,"ion-text",17)(29,"strong"),e._uU(30),e.ALo(31,"translate"),e.qZA()(),e.TgZ(32,"ion-text",18),e._uU(33),e.ALo(34,"currency"),e.qZA()()(),e.YNc(35,Ye,27,38,"ion-list",7),e.YNc(36,je,21,31,"ion-list",7),e.qZA()}if(2&i){const t=e.oxw();e.xp6(4),e.hij("",e.lcZ(5,17,"received-note-detail.code"),":"),e.xp6(3),e.hij("#",t.receivedNote.id,""),e.xp6(3),e.hij("",e.lcZ(11,19,"received-note-add.created-at"),":"),e.xp6(3),e.Oqu(t.dateFormat(t.receivedNote.createdAt)),e.xp6(1),e.Q6J("ngModel",t.tab),e.xp6(2),e.hij(" ",e.lcZ(17,21,"received-note-detail.information")," "),e.xp6(3),e.hij(" ",e.lcZ(20,23,"received-note-detail.debt-loan")," "),e.xp6(2),e.Q6J("ngIf",0!==t.receivedNote.contactId&&"info"==t.tab),e.xp6(1),e.Q6J("ngIf",0==t.receivedNote.contactId&&t.receivedNote.contactName&&"info"==t.tab),e.xp6(1),e.Q6J("ngIf",0==t.receivedNote.contactId&&t.receivedNote.contactPhone&&"info"==t.tab),e.xp6(1),e.Q6J("ngIf","info"==t.tab),e.xp6(1),e.Q6J("hidden",!t.receivedNote.items||0==t.receivedNote.items.length||"info"!==t.tab),e.xp6(1),e.Q6J("ngForOf",t.receivedNote.items),e.xp6(4),e.Oqu(e.lcZ(31,25,"order-detail.total-amount")),e.xp6(3),e.hij(" ",e.G7q(34,27,e.kEZ(33,O,t.totalProductsAmount,t.currency,t.translateService.currentLang))," "),e.xp6(2),e.Q6J("ngIf","info"==t.tab),e.xp6(1),e.Q6J("ngIf","debt"===t.tab)}}function He(i,l){1&i&&(e.TgZ(0,"div",40),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"common.record-deleted-alert")," "))}let $e=(()=>{class i{constructor(t,n,o,r,c,p,x,A,y,R,q,s,D){var f=this;this.navCtrl=t,this.modalCtrl=n,this.translateService=o,this.receivedNoteService=r,this.tradeService=c,this.contactService=p,this.debtService=x,this.userService=A,this.actionSheetCtrl=y,this.excelService=R,this.alertCtrl=q,this.analyticsService=s,this.productService=D,this.params=null,this.receivedNote=new w.Y,this.isDisabled=!1,this.tab="info",this.debts=[],this.dateDebtFrom="",this.dateDebtTo="",this.totalDebt=0,this.totalDebtPaid=0,this.totalProductsAmount=0,this.reload=(0,d.Z)(function*(){f.currency=yield f.userService.getAttr("current-currency"),f.receivedNote=new w.Y;const U=f.params?f.params:f.navCtrl.getParams();if(f.params=U,U&&U.id&&U.id>0){const g=U.id,F=yield f.navCtrl.loading();f.receivedNoteService.get(g).then(T=>{f.receivedNote=T,T&&(f.receivedNote.items=T&&T.itemsJson?JSON.parse(T.itemsJson):[],f.getProductsAmount(),f.dateDebtFrom="",f.dateDebtTo="",f.dateDebtFrom=U.dateDebtFrom?U.dateDebtFrom:v.C.GetFirstDateOfMonth(),f.dateDebtTo=U.dateDebtTo?U.dateDebtTo:v.C.GetEndDateOfMonth(),f.debtService.getDebtsByReceivedNote(T.id,f.dateDebtFrom,f.dateDebtTo).then(function(){var M=(0,d.Z)(function*(u){yield F.dismiss(),f.originalDebts=JSON.parse(JSON.stringify(u)),u&&u.length>0&&(u=S.orderBy(u,["modifiedAt"],["desc"])),f.debts=u,f.totalDebt=S.sumBy(f.debts,C=>C.value),f.totalDebtPaid=S.sumBy(f.debts,C=>C.valuePaid)});return function(u){return M.apply(this,arguments)}}()))})}});const V=U=>{this.receivedNote&&U.detail.id===this.receivedNote.id&&this.reload()};this.navCtrl.unsubscribe("reloadReceivedNote",V),this.navCtrl.subscribe("reloadReceivedNote",V)}ionViewWillEnter(){var t=this;return(0,d.Z)(function*(){yield t.analyticsService.setCurrentScreen("received-note-detail")})()}ngOnInit(){this.reload()}selectDateRangeForDebt(){var t=this;return(0,d.Z)(function*(){const n=yield t.modalCtrl.create({component:k.S,componentProps:{dateFromInput:t.dateDebtFrom,dateToInput:t.dateDebtTo}});yield n.present();const{data:o}=yield n.onDidDismiss();o&&(t.dateDebtFrom=""!=o.dateFrom?v.C.toDbString(o.dateFrom,v.C.getDbFormat()):"",t.dateDebtTo=""!=o.dateTo?v.C.toDbString(o.dateTo,v.C.getDbFormat()):"",t.debtService.getDebtsByReceivedNote(t.receivedNote.id,t.dateDebtFrom,t.dateDebtTo).then(r=>{r&&r.length>0&&(r=S.orderBy(r,["modifiedAt"],["desc"])),t.debts=r,t.totalDebt=S.sumBy(t.debts,c=>c.value),t.totalDebtPaid=S.sumBy(t.debts,c=>c.valuePaid)}))})()}getProductsAmount(){let t=0;for(const n of this.receivedNote.items)t+=1*n.amount;this.totalProductsAmount=t}isNotCordova(){return this.navCtrl.isNotCordova()}call(){this.saveLastActive("call"),Z.W.callPhone(this.receivedNote.contact.mobile)}text(){this.saveLastActive("text"),Z.W.sendSms(this.receivedNote.contact.mobile)}saveLastActive(t){return this.receivedNote.contact.lastActive=v.C.toDbString(),this.receivedNote.contact.lastAction=t,this.contactService.saveContact(this.receivedNote.contact).then(n=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.receivedNote.contact),n))}contactImageOrPlaceholder(){return Z.W.contactImageOrPlaceholder(this.receivedNote.contact.avatarUrl)}dateFormat(t){return v.C.toUiLocalDateTimeString(t)}actionIcon(t){return Z.W.actionIcon(t)}dateTimeFormat(t){return v.C.toUiString(t)}edit(){this.navCtrl.push("/received-note/add",{id:this.receivedNote.id})}presentActionSheet(){var t=this;return(0,d.Z)(function*(){yield(yield t.actionSheetCtrl.create({header:t.translateService.instant("action.action"),buttons:[{text:t.translateService.instant("received-note.delete-received-note"),role:"destructive",handler:()=>{t.delete()}},{text:t.translateService.instant("received-note-detail.share"),handler:()=>{t.share()}},{text:t.translateService.instant("received-note-detail.print"),handler:()=>{t.print()}},{text:t.translateService.instant("received-note-detail.export"),handler:()=>{t.export()}},{text:t.translateService.instant("received-note-detail.add-debt"),handler:()=>{t.addDebt()}},{text:t.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}delete(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("received-note.delete-alert"),buttons:[{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(){yield t.deleteRelated(),t.receivedNoteService.delete(t.receivedNote).then((0,d.Z)(function*(){t.analyticsService.logEvent("received-note-detail-delete-success"),t.navCtrl.publish("reloadReceivedNoteList"),t.navCtrl.publish("reloadContact",t.receivedNote.contact),t.navCtrl.pop()}))}),function(){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}deleteRelated(){var t=this;return(0,d.Z)(function*(){const n=[],o=yield t.tradeService.getTradesByReceivedNote(t.receivedNote.id);for(const c of o)c.debtId||n.push(t.tradeService.deleteTrade(c));const r=yield t.productService.getNotesByReceivedNote(t.receivedNote.id);for(const c of r)n.push(t.productService.deleteProductNote(c));yield Promise.all(n)})()}productName(t,n){return Z.W.productName(t,n)}share(){this.navCtrl.push("/received-note/detail-share",{receivedNote:this.receivedNote})}print(){this.navCtrl.push("/received-note/detail-print",{receivedNote:this.receivedNote})}export(){var t=this;return(0,d.Z)(function*(){const n=yield t.navCtrl.loading(),o="received-detail-"+t.receivedNote.id+".xlsx";t.excelService.createReceivedNoteFile(o,t.receivedNote.id).then(function(){var r=(0,d.Z)(function*(c){yield n.dismiss(),t.analyticsService.logEvent("received-note-export-downloaded"),t.navCtrl.isNotCordova()||(yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("report.file-save-alert")+c,buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{}}]})).present(),t.userService.shareFileUrl(o,o,c))});return function(c){return r.apply(this,arguments)}}()).catch((0,d.Z)(function*(){yield n.dismiss()}))})()}addDebt(){this.navCtrl.push("/debt/add",{receivedNote:this.receivedNote.id})}changeStatus(){var t=this;this.isDisabled=!0,this.receivedNoteService.save(this.receivedNote).then((0,d.Z)(function*(){t.isDisabled=!1,t.navCtrl.publish("reloadReceivedNoteList"),t.debts&&t.debts.length||(yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("received-note-detail.done-alert"),buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{t.createTransactions()}},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present())}))}selectDebt(t){this.navCtrl.push("/debt/detail",{id:t})}createTransactions(){if(this.receivedNote.items&&this.receivedNote.items.length>0){const t=[];for(const n of this.receivedNote.items){const o=new J.h;o.contactId=this.receivedNote.contactId,o.productId=n.productId,o.isPurchase=!0,o.isReceived=!0,o.productCount=n.quantity,o.value=n.amount,o.moneyAccountId=this.receivedNote.moneyAccountId,o.note="#"+this.receivedNote.id,t.push(this.tradeService.saveTrade(o))}this.isDisabled=!0,Promise.all(t).then(()=>{this.isDisabled=!1})}}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.G),e.Y36(a.IN),e.Y36(b.sK),e.Y36(L.r),e.Y36(I.X),e.Y36(te.y),e.Y36(ue.E),e.Y36(G.K),e.Y36(a.BX),e.Y36(re.x),e.Y36(a.Br),e.Y36(W.y),e.Y36(ne.M))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-detail"]],decls:17,vars:7,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"click"],["name","create"],["name","print"],["name","ellipsis-vertical"],[4,"ngIf"],["class","ion-padding",4,"ngIf"],["lines","none"],["color","primary"],[3,"ngModel","ngModelChange"],["value","info"],["value","debt"],["color","light",4,"ngIf"],[3,"hidden"],[4,"ngFor","ngForOf"],[1,"ion-text-wrap",2,"padding-top","8px","padding-bottom","8px"],["slot","end",1,"ion-text-wrap","ion-text-right"],[3,"src"],["side","end"],["name","send"],["color","secondary",3,"click"],["name","call"],["color","light"],[1,"ion-text-wrap"],["style","font-size: 0.75em",4,"ngIf"],[2,"font-size","0.7em"],[2,"font-size","0.75em"],["color","secondary"],["color","danger"],["slot","end",4,"ngIf"],["fill","clear","color","secondary",3,"click"],["name","funnel"],["fill","clear","color","primary",3,"click"],["name","add"],[3,"showContact","debt","currency","onClick",4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],[3,"showContact","debt","currency","onClick"],[3,"innerHTML"],[1,"ion-padding"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"ion-buttons",2)(8,"ion-button",3),e.NdJ("click",function(){return n.edit()}),e._UZ(9,"ion-icon",4),e.qZA(),e.TgZ(10,"ion-button",3),e.NdJ("click",function(){return n.print()}),e._UZ(11,"ion-icon",5),e.qZA(),e.TgZ(12,"ion-button",3),e.NdJ("click",function(){return n.presentActionSheet()}),e._UZ(13,"ion-icon",6),e.qZA()()()(),e.TgZ(14,"ion-content"),e.YNc(15,Ke,37,37,"div",7),e.YNc(16,He,3,3,"div",8),e.qZA()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,5,"received-note-detail.title")),e.xp6(9),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(1),e.Q6J("ngIf",n.receivedNote),e.xp6(1),e.Q6J("ngIf",!n.receivedNote))},dependencies:[_.sg,_.O5,N.JJ,N.On,a.BJ,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.rH,a.u8,a.IK,a.td,a.Q$,a.q_,a.cJ,a.GO,a.yW,a.wd,a.sr,a.QI,a.cs,Ce.A,_.H9,b.X$],encapsulation:2}),i})();var pe=m(5439);class ce{constructor(){this.id=0,this.receiptId=0,this.productId=0,this.productCode="",this.barcode="",this.productName="",this.quantity=0,this.unit="",this.basicUnit=null,this.unitExchange=null,this.unitPrice=0,this.costPrice=null,this.foreignCurrency="",this.amount=0,this.note="",this.isExpand=!1,this.onlineId=0,this.discount=0,this.discountPercent=0,this.discountType=0,this.receivedDate=null,this.price=null}}var Be=m(8947),ae=m(7613);function ze(i,l){1&i&&(e.TgZ(0,"ion-col",21)(1,"ion-text",22)(2,"i"),e._uU(3),e.ALo(4,"translate"),e.qZA()()()),2&i&&(e.xp6(3),e.Oqu(e.lcZ(4,1,"received-note-add.adding-new-product-alert")))}function We(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",7),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-input",19),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.product.barcode=o)}),e.ALo(6,"translate"),e.qZA()(),e.YNc(7,ze,5,3,"ion-col",20),e.qZA()}if(2&i){const t=e.oxw();e.xp6(3),e.hij("",e.lcZ(4,5,"order-add.enter-barcode")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(6,7,"order-add.enter-barcode-placeholder")),e.Q6J("disabled",!0)("ngModel",t.product.barcode),e.xp6(2),e.Q6J("ngIf",!t.product.productId)}}function Xe(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij("",t.product.productCode,"-")}}function et(i,l){if(1&i&&(e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label")(3,"strong"),e.YNc(4,Xe,2,1,"span",6),e._uU(5),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(4),e.Q6J("ngIf",t.product.productCode),e.xp6(1),e.hij("",t.product.productName," ")}}function tt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",7),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-input",23),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.product.productCode=o)}),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"ion-col")(8,"ion-label",7),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"ion-input",23),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.product.productName=o)}),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"ion-col")(14,"ion-label",7),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"ion-input",23),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.product.unit=o)}),e.ALo(18,"translate"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(3),e.hij("",e.lcZ(4,9,"received-note-add.product-code")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(6,11,"received-note-add.enter-product-code")),e.Q6J("ngModel",t.product.productCode),e.xp6(4),e.hij("",e.lcZ(10,13,"received-note-add.product-name")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(12,15,"received-note-add.enter-product-name")),e.Q6J("ngModel",t.product.productName),e.xp6(4),e.hij("",e.lcZ(16,17,"received-note-add.product-unit")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(18,19,"received-note-add.enter-product-unit")),e.Q6J("ngModel",t.product.unit)}}const _e=function(i,l,t){return[i,l,!0,"1.0-2",t]};function nt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.AsE("(",e.G7q(2,2,e.kEZ(8,_e,t.product.costPrice,t.currency.code,t.translateService.currentLang)),"/",t.product.unit,")")}}function ot(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.AsE("(",e.G7q(2,2,e.kEZ(8,_e,t.product.price,t.currency.code,t.translateService.currentLang)),"/",t.product.unit,")")}}function it(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij("(",t.foreignCurrency,")")}}function rt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij("(",t.foreignCurrency,")")}}let me=(()=>{class i{constructor(t,n,o,r,c){this.viewCtrl=t,this.analyticsService=n,this.translateService=o,this.alertCtrl=r,this.navCtrl=c,this.reload=()=>{this.reCalc()}}ionViewWillEnter(){var t=this;return(0,d.Z)(function*(){yield t.analyticsService.setCurrentScreen("received-note-product-edit")})()}ngOnInit(){this.reload()}reCalc(){const t=this.product.quantity*this.product.costPrice,n=0===this.product.discountType?0===this.product.discountPercent?1*this.product.discount:t*this.product.discountPercent/100:t*this.product.discount/100;this.product.discount=n,this.product.amount=t-n,this.product.unitPriceForeign&&this.product.quantity&&(this.product.amountForeign=this.product.quantity*this.product.unitPriceForeign)}dismiss(){this.viewCtrl.dismiss()}validate(){return this.product.quantity?null==this.product.discount?(alert(this.translateService.instant("received-note.no-discount-alert")),!1):this.product.productId||this.product.productCode?this.product.productName?this.product.costPrice?!!this.product.unitPrice||(alert(this.translateService.instant("received-note.no-price-alert")),!1):(alert(this.translateService.instant("received-note.no-cost-price-alert")),!1):(alert(this.translateService.instant("received-note.no-name-alert")),!1):(alert(this.translateService.instant("received-note.no-code-alert")),!1):(alert(this.translateService.instant("received-note.no-quantity-alert")),!1)}ok(){!this.validate()||this.viewCtrl.dismiss(this.product)}increase(){this.product.quantity++,this.reCalc()}decrease(){this.product.quantity--,this.reCalc()}selectAll(t){Z.W.selectAll(t)}openProductDiscountPercent(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({message:t.translateService.instant("received-note-add.discount-percent-message"),inputs:[{name:"discountPercent",placeholder:t.translateService.instant("received-note-add.enter-discount-percent"),type:"number",min:0,max:100,value:t.product.discountPercent}],buttons:[{text:t.translateService.instant("received-note-add.remove-percent"),handler:()=>{t.product.discountPercent=0,t.product.discount=0,t.reCalc()}},{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(r){if(!r)return;const c=+r.discountPercent;c<0||c>100?alert(t.translateService.instant("received-note-add.discount-percent-not-valid")):(t.analyticsService.logEvent("received-note-add-change-discount-percent"),c&&(t.product.discountPercent=c,t.reCalc()))}),function(c){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.IN),e.Y36(W.y),e.Y36(b.sK),e.Y36(a.Br),e.Y36(h.G))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-product-edit"]],inputs:{product:"product",currency:"currency",foreignCurrency:"foreignCurrency"},decls:95,vars:91,consts:[["slot","start"],[3,"click"],["name","close"],["slot","end"],["color","primary",3,"click"],["name","checkmark"],[4,"ngIf"],["position","stacked","color","primary"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus"],["expand","block","fill","solid",3,"click"],["slot","icon-only","name","chevron-down-circle"],["slot","icon-only","name","chevron-up-circle"],[1,"ion-text-nowrap",2,"margin-left","3px","margin-top","3px","font-size","0.7em","background-color","#3880ff","color","white","padding","3px","border-radius","5px","font-weight","bold",3,"click"],[2,"font-size","0.8em"],["position","\n                ","color","primary"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange","focus"],["expand","full","color","primary",3,"click"],["expand","full","color","secondary",3,"click"],["clearInput","","type","text",3,"disabled","placeholder","ngModel","ngModelChange"],["class","ion-text-wrap",4,"ngIf"],[1,"ion-text-wrap"],["color","warning",2,"font-size","0.8em"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.NdJ("click",function(){return n.dismiss()}),e._UZ(4,"ion-icon",2),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"ion-buttons",3)(9,"ion-button",4),e.NdJ("click",function(){return n.ok()}),e._UZ(10,"ion-icon",5),e._uU(11),e.ALo(12,"translate"),e.qZA()()()(),e.TgZ(13,"ion-content")(14,"ion-grid"),e.YNc(15,We,8,9,"ion-row",6),e.YNc(16,et,6,2,"ion-row",6),e.YNc(17,tt,19,21,"ion-row",6),e.TgZ(18,"ion-row")(19,"ion-col")(20,"ion-label",7),e._uU(21),e.ALo(22,"translate"),e.YNc(23,nt,3,12,"span",6),e.qZA(),e.TgZ(24,"money-input",8),e.NdJ("moneyValueChange",function(r){return n.product.costPrice=r})("moneyValueChange",function(){return n.reCalc()}),e.ALo(25,"translate"),e.qZA()(),e.TgZ(26,"ion-col")(27,"ion-label",7),e._uU(28),e.ALo(29,"translate"),e.YNc(30,ot,3,12,"span",6),e.qZA(),e.TgZ(31,"ion-input",9),e.NdJ("ngModelChange",function(r){return n.product.quantity=r})("ngModelChange",function(){return n.reCalc()})("focus",function(r){return n.selectAll(r)}),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"ion-buttons")(34,"ion-button",10),e.NdJ("click",function(){return n.decrease()}),e._UZ(35,"ion-icon",11),e.qZA(),e.TgZ(36,"ion-button",10),e.NdJ("click",function(){return n.increase()}),e._UZ(37,"ion-icon",12),e.qZA()()(),e.TgZ(38,"ion-col")(39,"ion-label",7),e._uU(40),e.ALo(41,"translate"),e.qZA(),e.TgZ(42,"money-input",8),e.NdJ("moneyValueChange",function(r){return n.product.discount=r})("moneyValueChange",function(){return n.reCalc()}),e.ALo(43,"translate"),e.qZA(),e.TgZ(44,"ion-text",13),e.NdJ("click",function(){return n.openProductDiscountPercent()}),e._uU(45),e.qZA()()(),e.TgZ(46,"ion-row")(47,"ion-col")(48,"ion-label",7),e._uU(49),e.ALo(50,"translate"),e.qZA(),e.TgZ(51,"money-input",8),e.NdJ("moneyValueChange",function(r){return n.product.amount=r}),e.ALo(52,"translate"),e.qZA()(),e.TgZ(53,"ion-col")(54,"ion-label",7),e._uU(55),e.ALo(56,"translate"),e.YNc(57,it,2,1,"span",6),e.qZA(),e.TgZ(58,"money-input",8),e.NdJ("moneyValueChange",function(r){return n.product.unitPriceForeign=r})("moneyValueChange",function(){return n.reCalc()}),e.ALo(59,"translate"),e.qZA()(),e.TgZ(60,"ion-col")(61,"ion-label",7),e._uU(62),e.ALo(63,"translate"),e.YNc(64,rt,2,1,"span",6),e.qZA(),e.TgZ(65,"money-input",8),e.NdJ("moneyValueChange",function(r){return n.product.amountForeign=r}),e.ALo(66,"translate"),e.qZA()()(),e.TgZ(67,"ion-row")(68,"ion-col")(69,"ion-label",7),e._uU(70),e.ALo(71,"translate"),e.qZA(),e.TgZ(72,"p",14)(73,"i"),e._uU(74),e.ALo(75,"translate"),e.qZA()(),e.TgZ(76,"money-input",8),e.NdJ("moneyValueChange",function(r){return n.product.unitPrice=r}),e.ALo(77,"translate"),e.qZA()()(),e.TgZ(78,"ion-row")(79,"ion-col")(80,"ion-label",15),e._uU(81),e.ALo(82,"translate"),e.qZA(),e.TgZ(83,"ion-input",16),e.NdJ("ngModelChange",function(r){return n.product.note=r})("focus",function(r){return n.selectAll(r)}),e.ALo(84,"translate"),e.qZA()()()(),e.TgZ(85,"ion-grid")(86,"ion-row")(87,"ion-col")(88,"ion-button",17),e.NdJ("click",function(){return n.ok()}),e._uU(89),e.ALo(90,"translate"),e.qZA()(),e.TgZ(91,"ion-col")(92,"ion-button",18),e.NdJ("click",function(){return n.dismiss()}),e._uU(93),e.ALo(94,"translate"),e.qZA()()()()()),2&t&&(e.xp6(6),e.hij(" ",e.lcZ(7,49,"received-note-add.product-edit")," "),e.xp6(5),e.hij(" \xa0",e.lcZ(12,51,"action.save")," "),e.xp6(2),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(2),e.Q6J("ngIf",n.product.barcode),e.xp6(1),e.Q6J("ngIf",n.product.productId),e.xp6(1),e.Q6J("ngIf",!n.product.productId),e.xp6(4),e.hij("",e.lcZ(22,53,"received-note-add.product-unit-price")," "),e.xp6(2),e.Q6J("ngIf",n.product.unit),e.xp6(1),e.s9C("placeholder",e.lcZ(25,55,"received-note-add.enter-product-unit-price")),e.Q6J("clear",!0)("moneyValue",n.product.costPrice),e.xp6(4),e.hij("",e.lcZ(29,57,"received-note-add.product-count")," "),e.xp6(2),e.Q6J("ngIf",n.product.unit),e.xp6(1),e.s9C("placeholder",e.lcZ(32,59,"received-note-add.enter-product-count")),e.Q6J("ngModel",n.product.quantity),e.xp6(9),e.AsE("",e.lcZ(41,61,"received-note-add.product-discount")," (",n.currency?n.currency.code:"",")"),e.xp6(2),e.s9C("placeholder",e.lcZ(43,63,"received-note-add.enter-product-discount")),e.Q6J("clear",!0)("moneyValue",n.product.discount),e.xp6(2),e.Udp("background-color",n.product.discountPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",n.product.discountPercent?n.product.discountPercent.toFixed(0)+"%":"%"," "),e.xp6(4),e.AsE("",e.lcZ(50,65,"received-note-add.product-total")," (",n.currency.code,") "),e.xp6(2),e.s9C("placeholder",e.lcZ(52,67,"received-note-add.enter-product-total")),e.Q6J("clear",!0)("moneyValue",n.product.amount),e.xp6(4),e.hij(" ",e.lcZ(56,69,"received-note-add.product-foreign-unit-price")," "),e.xp6(2),e.Q6J("ngIf",n.foreignCurrency),e.xp6(1),e.s9C("placeholder",e.lcZ(59,71,"received-note-add.enter-product-foreign-unit-price")),e.Q6J("clear",!0)("moneyValue",n.product.unitPriceForeign),e.xp6(4),e.hij(" ",e.lcZ(63,73,"received-note-add.product-total-foreign")," "),e.xp6(2),e.Q6J("ngIf",n.foreignCurrency),e.xp6(1),e.s9C("placeholder",e.lcZ(66,75,"received-note-add.enter-product-total-foreign")),e.Q6J("clear",!0)("moneyValue",n.product.amountForeign),e.xp6(5),e.Oqu(e.lcZ(71,77,"received-note-add.sale-price")),e.xp6(4),e.Oqu(e.lcZ(75,79,"received-note-add.sale-price-description")),e.xp6(2),e.s9C("placeholder",e.lcZ(77,81,"received-note-add.enter-product-sale-price")),e.Q6J("clear",!0)("moneyValue",n.product.unitPrice),e.xp6(5),e.hij("",e.lcZ(82,83,"received-note-add.product-note")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(84,85,"received-note-add.enter-product-note")),e.Q6J("ngModel",n.product.note),e.xp6(6),e.hij("",e.lcZ(90,87,"order-add.product-edit-ok")," "),e.xp6(4),e.hij(" ",e.lcZ(94,89,"order-add.product-edit-cancel"),""))},dependencies:[_.O5,N.JJ,N.On,a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Q$,a.Nd,a.yW,a.wd,a.sr,a.as,a.j9,ae.F,_.H9,b.X$],encapsulation:2}),i})();var ge=m(6026),he=m(1454),fe=m(9645),oe=m(667),ct=m(212),X=m(3876),at=m(360),lt=m(8851),ie=m(2216);const st=["barcodeInput"];function dt(i,l){if(1&i&&(e.TgZ(0,"ion-col")(1,"ion-label",20),e._uU(2),e.ALo(3,"translate"),e.TgZ(4,"p")(5,"ion-text"),e._uU(6),e.qZA()()()()),2&i){const t=e.oxw();e.xp6(2),e.hij("",e.lcZ(3,2,"received-note-detail.code"),": "),e.xp6(4),e.hij("#",t.note.id,"")}}function ut(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("",t.productCode,"-")}}const le=function(i,l,t){return[i,l,"symbol","1.0-2",t]};function pt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"currency"),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(1),e.hij(" - ",e.G7q(2,1,e.kEZ(7,le,t.discount,n.currency.code,n.translateService.currentLang)),"")}}function _t(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.hij("(",t.note.foreignCurrency,")")}}function mt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,_t,2,1,"span",7),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(1),e.hij(" -",t.amountForeign,"\xa0"),e.xp6(1),e.Q6J("ngIf",n.note.foreignCurrency)}}function gt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",8),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-input",54),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.productCode=o)}),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"ion-col")(8,"ion-label",8),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"ion-input",54),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.productName=o)}),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"ion-col")(14,"ion-label",8),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"ion-input",54),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.unit=o)}),e.ALo(18,"translate"),e.qZA()()()}if(2&i){const t=e.oxw().$implicit;e.xp6(3),e.hij(" ",e.lcZ(4,9,"received-note-add.product-code")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(6,11,"received-note-add.enter-product-code")),e.Q6J("ngModel",t.productCode),e.xp6(4),e.hij(" ",e.lcZ(10,13,"received-note-add.product-name")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(12,15,"received-note-add.enter-product-name")),e.Q6J("ngModel",t.productName),e.xp6(4),e.hij(" ",e.lcZ(16,17,"received-note-add.product-unit")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(18,19,"received-note-add.enter-product-unit")),e.Q6J("ngModel",t.unit)}}function ht(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij("(",t.note.foreignCurrency,")")}}function ft(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij("(",t.note.foreignCurrency,")")}}function vt(i,l){if(1&i){const t=e.EpF();e.ynx(0,10),e.TgZ(1,"ion-item",39)(2,"ion-buttons")(3,"ion-button",12),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.expand(r))}),e._UZ(4,"fa-icon",40),e.qZA()(),e.TgZ(5,"ion-text",41),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.expand(r))}),e.YNc(6,ut,2,1,"span",7),e._uU(7),e.qZA(),e.TgZ(8,"ion-buttons",2)(9,"ion-button",42),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.decrease(r))}),e._UZ(10,"ion-icon",43),e.qZA(),e.TgZ(11,"ion-button",44),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._UZ(12,"ion-icon",45),e.qZA(),e.TgZ(13,"ion-button",12),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.removeProduct(r))}),e._UZ(14,"ion-icon",46),e.qZA()()(),e.TgZ(15,"ion-item",47)(16,"ion-text",48),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.expand(r))}),e._uU(17),e.ALo(18,"currency"),e.YNc(19,pt,3,11,"span",7),e._uU(20),e.ALo(21,"currency"),e.YNc(22,mt,3,2,"span",7),e.qZA()(),e.TgZ(23,"ion-grid",49),e.YNc(24,gt,19,21,"ion-row",7),e.TgZ(25,"ion-row")(26,"ion-col")(27,"ion-label",8),e._uU(28),e.ALo(29,"translate"),e.qZA(),e.TgZ(30,"money-input",35),e.NdJ("moneyValueChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.costPrice=o)})("moneyValueChange",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.reCalc(r))}),e.ALo(31,"translate"),e.qZA()(),e.TgZ(32,"ion-col")(33,"ion-label",8),e._uU(34),e.ALo(35,"translate"),e.qZA(),e.TgZ(36,"ion-input",50),e.NdJ("ngModelChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.quantity=o)})("ngModelChange",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.reCalc(r))})("focus",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectAll(o))}),e.ALo(37,"translate"),e.qZA(),e.TgZ(38,"ion-buttons")(39,"ion-button",51),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.decrease(r))}),e._UZ(40,"ion-icon",52),e.qZA(),e.TgZ(41,"ion-button",51),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._UZ(42,"ion-icon",53),e.qZA()()(),e.TgZ(43,"ion-col")(44,"ion-label",8),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"money-input",35),e.NdJ("moneyValueChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.discount=o)})("moneyValueChange",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.reCalc(r))}),e.ALo(48,"translate"),e.qZA(),e.TgZ(49,"ion-text",33),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.openProductDiscountPercent(r))}),e._uU(50),e.qZA()()(),e.TgZ(51,"ion-row")(52,"ion-col")(53,"ion-label",8),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.TgZ(56,"money-input",35),e.NdJ("moneyValueChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.amount=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.applyItemTotal())}),e.ALo(57,"translate"),e.qZA()(),e.TgZ(58,"ion-col")(59,"ion-label",8),e._uU(60),e.ALo(61,"translate"),e.YNc(62,ht,2,1,"span",7),e.qZA(),e.TgZ(63,"money-input",35),e.NdJ("moneyValueChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.unitPriceForeign=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.applyItemTotal())}),e.ALo(64,"translate"),e.qZA()(),e.TgZ(65,"ion-col")(66,"ion-label",8),e._uU(67),e.ALo(68,"translate"),e.YNc(69,ft,2,1,"span",7),e.qZA(),e.TgZ(70,"money-input",35),e.NdJ("moneyValueChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.amountForeign=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.applyItemTotal())}),e.ALo(71,"translate"),e.qZA()()(),e.TgZ(72,"ion-row")(73,"ion-col")(74,"ion-label",8),e._uU(75),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"ion-input",24),e.NdJ("ngModelChange",function(o){const c=e.CHM(t).$implicit;return e.KtG(c.note=o)})("focus",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.selectAll(o))}),e.ALo(78,"translate"),e.qZA()()()(),e.BQk()}if(2&i){const t=l.$implicit,n=e.oxw();e.xp6(4),e.s9C("icon",t.isExpand?"compress-arrows-alt":"edit"),e.xp6(2),e.Q6J("ngIf",t.productCode),e.xp6(1),e.hij("",t.productName," "),e.xp6(9),e.Udp("font-weight",t.isExpand?"bold":"normal"),e.xp6(1),e.lnq(" ",t.quantity," ",t.unit," \xd7 ",e.G7q(18,44,e.kEZ(84,le,t.costPrice,n.currency.code,n.translateService.currentLang)),""),e.xp6(2),e.Q6J("ngIf",t.discount),e.xp6(1),e.hij(" | ",e.G7q(21,50,e.kEZ(88,le,t.amount,n.currency.code,n.translateService.currentLang))," "),e.xp6(2),e.Q6J("ngIf",t.amountForeign),e.xp6(1),e.Q6J("hidden",!t.isExpand),e.xp6(1),e.Q6J("ngIf",!t.productId),e.xp6(4),e.hij(" ",e.lcZ(29,56,"received-note-add.product-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(31,58,"received-note-add.enter-product-unit-price")),e.Q6J("clear",!0)("moneyValue",t.costPrice),e.xp6(4),e.hij(" ",e.lcZ(35,60,"received-note-add.product-count")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(37,62,"received-note-add.enter-product-count")),e.Q6J("ngModel",t.quantity),e.xp6(9),e.hij(" ",e.lcZ(46,64,"received-note-add.product-discount")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(48,66,"received-note-add.enter-product-discount")),e.Q6J("clear",!0)("moneyValue",t.discount),e.xp6(2),e.Udp("background-color",t.discountPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",t.discountPercent?t.discountPercent.toFixed(0)+"%":"%"," "),e.xp6(4),e.hij(" ",e.lcZ(55,68,"received-note-add.product-total")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(57,70,"received-note-add.enter-product-total")),e.Q6J("clear",!0)("moneyValue",t.amount),e.xp6(4),e.hij(" ",e.lcZ(61,72,"received-note-add.product-foreign-unit-price")," "),e.xp6(2),e.Q6J("ngIf",n.note.foreignCurrency),e.xp6(1),e.s9C("placeholder",e.lcZ(64,74,"received-note-add.enter-product-foreign-unit-price")),e.Q6J("clear",!0)("moneyValue",t.unitPriceForeign),e.xp6(4),e.hij(" ",e.lcZ(68,76,"received-note-add.product-total-foreign")," "),e.xp6(2),e.Q6J("ngIf",n.note.foreignCurrency),e.xp6(1),e.s9C("placeholder",e.lcZ(71,78,"received-note-add.enter-product-total-foreign")),e.Q6J("clear",!0)("moneyValue",t.amountForeign),e.xp6(5),e.hij(" ",e.lcZ(76,80,"received-note-add.product-note")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(78,82,"received-note-add.enter-product-note")),e.Q6J("ngModel",t.note)}}function Zt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-text",55),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.showSearchContact())}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw();e.xp6(1),e.hij(" ",t.contactSelected.fullName," ")}}function xt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-text",56),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.showSearchContact())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"received-note-add.select-provider")," "))}function Ct(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",57),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.removeContact())}),e._UZ(1,"ion-icon",58),e.qZA()}}function At(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"ion-label",8),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"ion-input",59),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.note.contactName=o)}),e.qZA()(),e.TgZ(7,"ion-col")(8,"ion-label",8),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"ion-input",60),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.note.contactPhone=o)}),e.qZA()()()()}if(2&i){const t=e.oxw();e.xp6(4),e.hij("",e.lcZ(5,4,"contact-add.full-name")," "),e.xp6(2),e.Q6J("ngModel",t.note.contactName),e.xp6(3),e.hij("",e.lcZ(10,6,"contact-add.phone")," "),e.xp6(2),e.Q6J("ngModel",t.note.contactPhone)}}function yt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",63),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.showSearchMoneyAccount())}),e._uU(1),e.qZA()}if(2&i){const t=e.oxw(2);e.xp6(1),e.hij(" ",t.moneyAccountSelected.accountName," ")}}function Nt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",64),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.showSearchMoneyAccount())}),e._uU(1),e.ALo(2,"translate"),e.qZA()}2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"trade-add.select-money-account")," "))}function Tt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-button",64),e.NdJ("click",function(){e.CHM(t);const o=e.oxw(2);return e.KtG(o.removeMoneyAccount())}),e._UZ(1,"ion-icon",46),e.qZA()}}function bt(i,l){if(1&i&&(e.TgZ(0,"ion-col",25)(1,"ion-label",8),e._uU(2),e.ALo(3,"translate"),e.qZA(),e._UZ(4,"br"),e.YNc(5,yt,2,1,"ion-button",61),e.YNc(6,Nt,3,3,"ion-button",62),e.YNc(7,Tt,2,0,"ion-button",62),e.qZA()),2&i){const t=e.oxw();e.xp6(2),e.hij("",e.lcZ(3,4,"trade-add.money-account")," "),e.xp6(3),e.Q6J("ngIf",t.moneyAccountSelected&&t.moneyAccountSelected.id>0),e.xp6(1),e.Q6J("ngIf",!t.moneyAccountSelected||0==t.moneyAccountSelected.id),e.xp6(1),e.Q6J("ngIf",t.moneyAccountSelected&&t.moneyAccountSelected.id>0)}}function St(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij("(",t.note.foreignCurrency,")")}}let Pt=(()=>{class i{constructor(t,n,o,r,c,p,x,A,y,R,q,s,D,f,V){this.navCtrl=t,this.barcodeScanner=n,this.modalCtrl=o,this.contactService=r,this.productService=c,this.staffService=p,this.moneyAccountService=x,this.receivedNoteService=A,this.translateService=y,this.userService=R,this.debtService=q,this.toastCtrl=s,this.storeService=D,this.alertCtrl=f,this.analyticsService=V,this.params=null,this.taxPercent=0,this.discountOnTotalPercent=0,this.totalProductAmount=0,this.note=new w.Y,this.oldNote=null,this.currency={code:"vnd"},this.isNew=!0,this.oldBarcode="",this.barcode="",this.saveDisabled=!1,this.onKeyPress=U=>{!U.target||"body"!==U.target.localName||("s"===U.key||"S"===U.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var t=this;return(0,d.Z)(function*(){yield t.analyticsService.setCurrentScreen("received-note-add")})()}ngOnInit(){var t=this;return(0,d.Z)(function*(){t.userService.getAttr("current-currency").then(p=>{t.currency=Z.W.getCurrencyByCode(p)}),t.note=new w.Y,t.note.createdAt=pe(new Date).format(v.C.getDateTimeDbFormat()),t.store=yield t.storeService.getCurrentStore();const n=t.params?t.params:t.navCtrl.getParams();t.params=n;let o=0,r=0,c=0;if(n&&(n&&n.id?(o=n.id,t.isNew=!1):n&&n.contact?r=+n.contact:n&&n.product&&(c=+n.product)),o&&o>0){const p=yield t.navCtrl.loading();t.receivedNoteService.get(o).then(function(){var x=(0,d.Z)(function*(A){if(yield p.dismiss(),t.contactSelected=A.contact&&0!==A.contact.id?A.contact:null,t.moneyAccountSelected=A.moneyAccount&&0!==A.moneyAccount.id?A.moneyAccount:null,!t.moneyAccountSelected&&!t.staffService.isStaff())if(t.store&&t.store.moneyAccount)t.moneyAccountSelected=t.store.moneyAccount,t.note.moneyAccountId=t.moneyAccountSelected.id;else{const y=yield t.moneyAccountService.getDefault();y&&(t.moneyAccountSelected=y,t.note.moneyAccountId=y.id)}t.note=A,t.oldNote=JSON.parse(JSON.stringify(A)),t.note.items=JSON.parse(t.note.itemsJson),t.getProductsAmount()});return function(A){return x.apply(this,arguments)}}())}else{if(!t.staffService.isStaff()){if(t.store&&t.store.moneyAccount)t.moneyAccountSelected=t.store.moneyAccount,t.note.moneyAccountId=t.moneyAccountSelected.id;else{const p=yield t.moneyAccountService.getDefault();p&&(t.moneyAccountSelected=p,t.note.moneyAccountId=p.id)}t.barcodeFocus()}r&&r>0?t.contactService.get(r).then(p=>{t.contactSelected=p,t.note.contactId=p.id}):c&&c>0&&t.productService.get(c,t.store?t.store.id:0).then(p=>{t.addProduct(p)})}t.barcodeFocus()})()}showSearchContact(){var t=this;return(0,d.Z)(function*(){t.navCtrl.push("/contact",{callback:o=>{const r=o;r&&(t.contactSelected=r,t.note.contactId=r.id)},searchMode:!0})})()}ionViewLoaded(){this.barcodeFocus()}barcodeFocus(){setTimeout(()=>{this.barcodeInput&&this.barcodeInput.setFocus()},500)}validate(){return!(!this.note.items||!this.note.items.length)||(alert(this.translateService.instant("received-note-add.no-items-alert")),!1)}save(){var t=this;return(0,d.Z)(function*(){if(!t.validate())return;t.saveDisabled=!0;const n=yield t.navCtrl.loading();t.staffService.isStaff()&&(t.note.staffId=t.staffService.selectedStaff.id),yield t.addProducts(),t.note.itemsJson=JSON.stringify(t.note.items),t.note.storeId=t.store?t.store.id:t.note.storeId,t.note.saveProductNotes=!0,t.note.lang=yield t.userService.getAttr("current-language"),t.receivedNoteService.save(t.note).then((0,d.Z)(function*(){t.analyticsService.logEvent("received-note-add-save-success");const o=[];if(t.contactSelected){const r=t.saveLastActive();o.push(r)}Promise.all(o).then((0,d.Z)(function*(){yield n.dismiss(),null!==t.note.paid&&t.note.paid<t.note.total?t.confirmToCreateDebt():t.exitPage()}))}))})()}confirmToCreateDebt(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("received-note-add.paid-is-smaller-than-total-warning"),buttons:[{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(){const r=new Be.T;r.receivedNoteId=t.note.id,r.value=t.note.total-t.note.paid,r.note=t.translateService.instant("received-note-add.paid-is-smaller-note"),r.contactId=t.note.contactId,r.debtType=2,yield t.debtService.saveDebt(r),t.exitPage()}),function(){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{t.exitPage()}}]})).present()})()}saveLastActive(){return this.contactSelected.lastActive=v.C.toDbString(),this.contactSelected.lastAction="trade",this.contactService.saveContact(this.contactSelected).then(n=>(this.navCtrl.publish("reloadContactList"),this.navCtrl.publish("reloadContact",this.contactSelected),n))}showSearchMoneyAccount(){var t=this;return(0,d.Z)(function*(){t.navCtrl.push("/money-account",{callback:o=>{const r=o;r&&(t.moneyAccountSelected=r,t.note.moneyAccountId=r.id)},searchMode:!0})})()}exitPage(){var t=this;return(0,d.Z)(function*(){yield t.navCtrl.popOnly(),t.navCtrl.publish("reloadReceivedNoteList"),t.navCtrl.publish("reloadReceivedNote",t.note),t.isNew&&(yield t.navCtrl.push("/received-note/detail",{id:t.note.id}))})()}removeContact(){this.contactSelected=null,this.note.contactId=0}showDatePopup(){this.note.createdAt=pe().format(v.C.getDateDbFormat())}dateFormat(t){return v.C.toUiLocalDateString(t)}productName(t,n){return Z.W.productName(t,n)}selectAll(t){Z.W.selectAll(t)}showSearchProduct(){var t=this;return(0,d.Z)(function*(){const n=function(){var o=(0,d.Z)(function*(r){if(r&&r.length){for(const c of t.note.items)c.isExpand=!1;for(const c of r)yield t.addProductFromArr(c)}});return function(c){return o.apply(this,arguments)}}();t.navCtrl.push("/received-note/note-product-selector",{callback:n})})()}addProductFromArr(t){var n=this;return(0,d.Z)(function*(){if(!t)return;const o=new ce;o.unitPrice=t.price?t.price:t.costPrice,o.costPrice=t.costPrice?t.costPrice:t.price,o.productId=t.id,o.productCode=t.code,o.productName=t.title,o.note=t.note,o.unitPriceForeign=t.unitPriceForeign,o.amountForeign=t.amountForeign,o.unit=t.unit,o.unitExchange=t.unitExchange,o.basicUnit=t.basicUnit,o.discount=t.discount?t.discount:0,o.discountPercent=t.discountPercent?t.discountPercent:0,o.discountType=t.discountType?t.discountType:0,o.quantity=t.quantity,o.isExpand=!1,n.note.items.unshift(o),n.reCalc(o);const r=n.translateService.instant("receive-note-add.added-product",{product:Z.W.productName(t.code,t.title)});n.presentToast(r)})()}addProduct(t){var n=this;return(0,d.Z)(function*(){if(t){for(const q of n.note.items)q.isExpand=!1;const o=n.note.items.findIndex(q=>q.productId===t.id&&(!t.fromUnit||q.unit===t.fromUnit));if(o>=0){const q=n.note.items[o];q.isExpand=!0,q.quantity=1*q.quantity+1,n.reCalc(q);const s=n.translateService.instant("order-add.qty-product",{product:q.productName,count:q.quantity+""});return void n.presentToast(s)}let r=null;if(t.fromUnit){const q=t.unitsJson?JSON.parse(t.unitsJson):null;if(q&&q.length)for(const s of q)if(s&&s.unit===t.fromUnit){r=s;break}}const c=new ce,p=t.price?t.price:t.costPrice;c.unitPrice=r?r.price:p;const x=t.costPrice?t.costPrice:t.price;c.costPrice=r?null:x,c.productId=t.id,c.productName=t.title,c.barcode=t.barcode,c.discount=0,c.productCode=t.code?t.code.toUpperCase():"",c.unit=r?r.unit:t.unit,c.basicUnit=r?t.unit:null,c.unitExchange=r?r.exchange:null,c.quantity=1,c.isExpand=!1;const A=yield n.modalCtrl.create({component:me,componentProps:{product:c,currency:n.currency,foreignCurrency:n.note.foreignCurrency}});yield A.present();const{data:y}=yield A.onDidDismiss();if(!y)return;n.note.items.unshift(c),n.reCalc(c);const R=n.translateService.instant("received-note-add.added-product",{product:c.productName});n.presentToast(R),n.barcodeFocus()}})()}addNewProduct(t){var n=this;return(0,d.Z)(function*(){const o=new he.x;o.barcode=t;for(const y of n.note.items)y.isExpand=!1;const r=n.note.items.findIndex(y=>y.barcode===o.barcode);if(r>=0){const y=n.note.items[r];y.isExpand=!0,y.quantity=1*y.quantity+1,n.reCalc(y);const R=n.translateService.instant("order-add.qty-product",{product:y.productName,count:y.quantity+""});return void n.presentToast(R)}const c=new ce;c.costPrice=o.costPrice?o.costPrice:o.price,c.unitPrice=o.price,c.productId=o.id,c.discount=0,c.productName=o.title,c.barcode=o.barcode,c.productCode=o.code?o.code.toUpperCase():"",c.unit=o.unit,c.quantity=1,c.isExpand=!1;const p=yield n.modalCtrl.create({component:me,componentProps:{product:c,currency:n.currency,foreignCurrency:n.note.foreignCurrency}});yield p.present();const{data:x}=yield p.onDidDismiss();if(!x)return;n.note.items.unshift(c),n.reCalc(c);const A=n.translateService.instant("received-note-add.added-product",{product:c.productName});n.presentToast(A),n.barcodeFocus()})()}barcodeChanged(){if(!this.barcode||this.barcode.length<5)return void(this.oldBarcode=this.barcode);let t=!1;!this.oldBarcode&&this.barcode&&(t=!0);const n=this.barcode;this.oldBarcode=n,t&&setTimeout(()=>{this.barcode="",this.oldBarcode=""},200),this.productService.searchByBarcode(n).then(o=>{o?(this.addProduct(o),this.barcode="",this.oldBarcode="",this.barcodeFocus()):t&&(this.barcode="",this.oldBarcode="",this.addNewProduct(n),this.barcodeFocus())})}presentToast(t){var n=this;return(0,d.Z)(function*(){yield(yield n.toastCtrl.create({message:t,duration:3e3,position:"bottom"})).present()})()}removeProduct(t){const n=this.note.items.findIndex(o=>o.productId===t.productId&&o.unit===t.unit);n>=0&&this.note.items.splice(n,1),this.applyItemTotal()}reCalc(t){const n=t.quantity*t.costPrice,o=0===t.discountType?0===t.discountPercent?1*t.discount:n*t.discountPercent/100:n*t.discount/100;t.discount=o,t.amount=n-o,t.unitPriceForeign&&t.quantity&&(t.amountForeign=t.quantity*t.unitPriceForeign),this.applyItemTotal()}getProductsAmount(){let t=0;for(const n of this.note.items)t+=1*n.amount;this.totalProductAmount=t}applyItemTotal(){let t=0,n=0;for(const o of this.note.items)t+=1*o.amount,n+=o.amountForeign?1*o.amountForeign:0;this.totalProductAmount=t,this.discountOnTotalPercent&&(this.note.discountOnTotal=t*this.discountOnTotalPercent/100),this.note.discount+=this.note.discountOnTotal,t-=this.note.discountOnTotal,this.taxPercent&&(this.note.tax=t*this.taxPercent/100),this.note.netValue=1*t,this.note.totalForeign=1*n,this.reCalcTotal()}expand(t){const n=!t.isExpand;for(const o of this.note.items)o.isExpand=!1;t.isExpand=n}reCalcTotal(){this.note.total=1*this.note.netValue+1*this.note.tax+1*this.note.shippingFee,this.note.paid=this.note.total}scan(){var t=this;return(0,d.Z)(function*(){if(t.navCtrl.isNotCordova()){const n=yield t.modalCtrl.create({component:ge.k});yield n.present();const{data:o}=yield n.onDidDismiss();o&&o.barcode&&t.productService.searchByBarcode(o.barcode).then(r=>{r?t.addProduct(r):t.addNewProduct(o.barcode)})}else t.barcodeScanner.scan().then(n=>{!n||!n.text||t.productService.searchByBarcode(n.text).then(o=>{o?t.addProduct(o):t.addNewProduct(n.text)})})})()}removeMoneyAccount(){this.moneyAccountSelected=null,this.note.moneyAccountId=0}addProducts(){var t=this;return(0,d.Z)(function*(){for(const n of t.note.items)if(!n.productId){const o=new he.x;o.code=n.productCode,o.title=n.productName,o.count=0,o.foreignCurrency=n.foreignCurrency,o.costPrice=n.costPrice,o.price=n.unitPrice?n.unitPrice:n.costPrice,o.unit=n.unit,o.costPriceForeign=n.unitPriceForeign,o.originalPrice=o.price,o.barcode=n.barcode;const r=yield t.productService.saveProduct(o);n.productId=r}})()}increase(t){t.quantity++,this.reCalc(t)}decrease(t){t.quantity--,this.reCalc(t)}openProductDiscountPercent(t){var n=this;return(0,d.Z)(function*(){var r;yield(yield n.alertCtrl.create({message:n.translateService.instant("received-note-add.discount-percent-message"),inputs:[{name:"discountPercent",placeholder:n.translateService.instant("received-note-add.enter-discount-percent"),type:"number",min:0,max:100,value:t.discountPercent}],buttons:[{text:n.translateService.instant("received-note-add.remove-percent"),handler:()=>{t.discountPercent=0,t.discount=0,n.reCalc(t)}},{text:n.translateService.instant("common.agree"),handler:(r=(0,d.Z)(function*(c){if(!c)return;const p=+c.discountPercent;p<0||p>100?alert(n.translateService.instant("received-note-add.discount-percent-not-valid")):(n.analyticsService.logEvent("received-note-add-change-discount-percent"),p&&(t.discountPercent=p,n.reCalc(t)))}),function(p){return r.apply(this,arguments)})},{text:n.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}openTaxPercent(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({message:t.translateService.instant("received-note-add.tax-percent-message"),inputs:[{name:"taxPercent",placeholder:t.translateService.instant("received-note-add.enter-tax-percent"),type:"number",min:0,max:100,value:t.taxPercent}],buttons:[{text:t.translateService.instant("received-note-add.remove-percent"),handler:()=>{t.taxPercent=0,t.applyItemTotal()}},{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(r){if(!r)return;const c=+r.taxPercent;c<0||c>100?alert(t.translateService.instant("received-note-add.tax-percent-not-valid")):(t.analyticsService.logEvent("received-note-add-change-tax-percent"),c&&(t.taxPercent=c,t.applyItemTotal()))}),function(c){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}openDiscountOnTotalPercent(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({message:t.translateService.instant("received-note-add.discount-on-total-percent-message"),inputs:[{name:"discountOnTotalPercent",placeholder:t.translateService.instant("received-note-add.enter-discount-on-total-percent"),type:"number",min:0,max:100,value:t.discountOnTotalPercent}],buttons:[{text:t.translateService.instant("received-note-add.remove-percent"),handler:()=>{t.discountOnTotalPercent=0,t.applyItemTotal()}},{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(r){if(!r)return;const c=+r.discountOnTotalPercent;c<0||c>100?alert(t.translateService.instant("received-note-add.discount-on-total-percent-not-valid")):(t.analyticsService.logEvent("received-note-add-change-discount-on-total-percent"),c&&(t.discountOnTotalPercent=c,t.applyItemTotal()))}),function(c){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}changeDiscountOnTotal(){this.applyItemTotal()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.G),e.Y36(fe.m),e.Y36(a.IN),e.Y36(te.y),e.Y36(ne.M),e.Y36(oe.x),e.Y36(ct.U),e.Y36(L.r),e.Y36(b.sK),e.Y36(G.K),e.Y36(ue.E),e.Y36(a.yF),e.Y36(X.d),e.Y36(a.Br),e.Y36(W.y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-add"]],viewQuery:function(t,n){if(1&t&&e.Gf(st,7),2&t){let o;e.iGM(o=e.CRH())&&(n.barcodeInput=o.first)}},decls:147,vars:137,consts:[["slot","start"],["defaultHref","/home"],["slot","end"],["color","primary",3,"disabled","click"],["name","checkmark"],[2,"padding","0 !important","margin","0 !important"],["size","12","size-sm",""],[4,"ngIf"],["position","stacked","color","primary"],["type","datetime-local","pickerId","noteAddPicker","min","2015-01-01","max","2025-12-31",3,"date","dateChange"],["color","light"],["color","primary",1,"ion-text-wrap"],["fill","clear","color","primary",3,"click"],["name","add"],["name","barcode"],["clearInput","","autofocus","true","type","text",3,"placeholder","ngModel","ngModelChange"],["barcodeInput",""],["color","light",4,"ngFor","ngForOf"],[1,"ion-text-wrap",3,"hidden"],[3,"innerHTML"],["color","primary"],["color","dark","slot","end",3,"click",4,"ngIf"],["slot","end",3,"click",4,"ngIf"],["fill","outline","slot","end",3,"click",4,"ngIf"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange","focus"],["size","4"],["size","4",4,"ngIf"],["position","stacked","color","dark",2,"font-weight","bold","font-size","0.8em"],[3,"moneyValue","disabled","moneyValueChange"],[1,"ion-no-padding"],["size","9",1,"ion-no-padding"],[3,"placeholder","moneyValue","moneyValueChange"],["size","3",1,"ion-no-padding"],[1,"ion-text-nowrap",2,"margin-left","3px","margin-top","3px","font-size","0.7em","background-color","#3880ff","color","white","padding","3px","border-radius","5px","font-weight","bold",3,"click"],["position","stacked","color","secondary"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["position","stacked","color","danger",2,"font-weight","bold"],["position","stacked","color","primary",2,"font-size","0.65em"],[1,"ion-padding",2,"padding-top","0 !important"],["color","light","lines","none"],["size","xs",3,"icon"],[3,"click"],["fill","clear","size","large",2,"padding","0","margin","0",3,"click"],["slot","icon-only","size","large","name","remove"],["fill","clear","size","large",3,"click"],["slot","icon-only","size","large","name","add"],["name","close"],["text-wrap","","color","light",2,"--min-height","0"],[2,"padding","0","margin","0",3,"click"],[3,"hidden"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange","focus"],["expand","block","fill","solid",3,"click"],["slot","icon-only","name","remove"],["slot","icon-only","name","add"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["color","dark","slot","end",3,"click"],["slot","end",3,"click"],["fill","outline","slot","end",3,"click"],["slot","icon-only","name","close"],["clearInput","","type","text","placeholder","Vd: John London",3,"ngModel","ngModelChange"],["clearInput","","type","tel","placeholder","Vd: 09123456789",3,"ngModel","ngModelChange"],["color","dark","size","small",3,"click",4,"ngIf"],["size","small",3,"click",4,"ngIf"],["color","dark","size","small",3,"click"],["size","small",3,"click"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.ALo(6,"translate"),e.qZA(),e.TgZ(7,"ion-buttons",2)(8,"ion-button",3),e.NdJ("click",function(){return n.save()}),e._UZ(9,"ion-icon",4),e._uU(10),e.ALo(11,"translate"),e.qZA()()()(),e.TgZ(12,"ion-content")(13,"ion-grid",5)(14,"ion-row")(15,"ion-col",6)(16,"ion-grid")(17,"ion-row"),e.YNc(18,dt,7,4,"ion-col",7),e.TgZ(19,"ion-col")(20,"ion-label",8),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"div")(24,"date-picker",9),e.NdJ("dateChange",function(r){return n.note.createdAt=r}),e.qZA()()()()(),e.TgZ(25,"ion-list")(26,"ion-item-divider",10),e._uU(27),e.ALo(28,"translate"),e.qZA(),e.TgZ(29,"ion-item",10)(30,"ion-text",11),e._uU(31),e.ALo(32,"translate"),e.ALo(33,"translate"),e.qZA(),e.TgZ(34,"ion-buttons")(35,"ion-button",12),e.NdJ("click",function(){return n.showSearchProduct()}),e._UZ(36,"ion-icon",13),e._uU(37),e.ALo(38,"translate"),e.qZA(),e.TgZ(39,"ion-button",12),e.NdJ("click",function(){return n.scan()}),e._UZ(40,"ion-icon",14),e._uU(41),e.ALo(42,"translate"),e.qZA()()(),e.TgZ(43,"ion-item",10)(44,"ion-input",15,16),e.NdJ("ngModelChange",function(r){return n.barcode=r})("ngModelChange",function(){return n.barcodeChanged()}),e.ALo(46,"translate"),e.qZA()()(),e.YNc(47,vt,79,92,"ng-container",17),e.TgZ(48,"ion-item",18),e._UZ(49,"div",19),e.ALo(50,"translate"),e.qZA(),e.TgZ(51,"ion-list")(52,"ion-item")(53,"ion-text",20),e._uU(54),e.ALo(55,"translate"),e.qZA(),e.YNc(56,Zt,2,1,"ion-text",21),e.YNc(57,xt,3,3,"ion-text",22),e.YNc(58,Ct,2,0,"ion-button",23),e.qZA(),e.YNc(59,At,12,8,"ion-grid",7),e.qZA()(),e.TgZ(60,"ion-col",6)(61,"ion-list")(62,"ion-item")(63,"ion-label",8),e._uU(64),e.ALo(65,"translate"),e.qZA(),e.TgZ(66,"ion-input",24),e.NdJ("ngModelChange",function(r){return n.note.foreignCurrency=r})("focus",function(r){return n.selectAll(r)}),e.ALo(67,"translate"),e.qZA()(),e.TgZ(68,"ion-item-divider",10),e._uU(69),e.ALo(70,"translate"),e.qZA(),e.TgZ(71,"ion-grid")(72,"ion-row")(73,"ion-col",25)(74,"ion-label",8),e._uU(75),e.ALo(76,"translate"),e.qZA(),e.TgZ(77,"ion-input",24),e.NdJ("ngModelChange",function(r){return n.note.deliveryPerson=r})("focus",function(r){return n.selectAll(r)}),e.ALo(78,"translate"),e.qZA()(),e.TgZ(79,"ion-col",25)(80,"ion-label",8),e._uU(81),e.ALo(82,"translate"),e.qZA(),e.TgZ(83,"ion-input",24),e.NdJ("ngModelChange",function(r){return n.note.receiver=r})("focus",function(r){return n.selectAll(r)}),e.ALo(84,"translate"),e.qZA()(),e.YNc(85,bt,8,6,"ion-col",26),e.qZA(),e.TgZ(86,"ion-row")(87,"ion-col",25)(88,"ion-label",27),e._uU(89),e.ALo(90,"translate"),e.qZA(),e.TgZ(91,"money-input",28),e.NdJ("moneyValueChange",function(r){return n.totalProductAmount=r}),e.qZA()(),e.TgZ(92,"ion-col")(93,"ion-label",8),e._uU(94),e.ALo(95,"translate"),e.qZA(),e.TgZ(96,"ion-grid",29)(97,"ion-row")(98,"ion-col",30)(99,"money-input",31),e.NdJ("moneyValueChange",function(r){return n.note.discountOnTotal=r})("moneyValueChange",function(){return n.changeDiscountOnTotal()}),e.ALo(100,"translate"),e.qZA()(),e.TgZ(101,"ion-col",32)(102,"ion-text",33),e.NdJ("click",function(){return n.openDiscountOnTotalPercent()}),e._uU(103),e.qZA()()()()()(),e.TgZ(104,"ion-row")(105,"ion-col",25)(106,"ion-label",34),e._uU(107),e.ALo(108,"translate"),e.qZA(),e.TgZ(109,"money-input",35),e.NdJ("moneyValueChange",function(r){return n.note.netValue=r})("moneyValueChange",function(){return n.reCalcTotal()}),e.ALo(110,"translate"),e.qZA()(),e.TgZ(111,"ion-col",25)(112,"ion-label",8),e._uU(113),e.ALo(114,"translate"),e.qZA(),e.TgZ(115,"money-input",35),e.NdJ("moneyValueChange",function(r){return n.note.shippingFee=r})("moneyValueChange",function(){return n.reCalcTotal()}),e.ALo(116,"translate"),e.qZA()(),e.TgZ(117,"ion-col",25)(118,"ion-label",8),e._uU(119),e.ALo(120,"translate"),e.qZA(),e.TgZ(121,"money-input",35),e.NdJ("moneyValueChange",function(r){return n.note.tax=r})("moneyValueChange",function(){return n.reCalcTotal()}),e.ALo(122,"translate"),e.qZA(),e.TgZ(123,"ion-text",33),e.NdJ("click",function(){return n.openTaxPercent()}),e._uU(124),e.qZA()()(),e.TgZ(125,"ion-row")(126,"ion-col")(127,"ion-label",36),e._uU(128),e.ALo(129,"translate"),e.qZA(),e.TgZ(130,"money-input",35),e.NdJ("moneyValueChange",function(r){return n.note.total=r}),e.ALo(131,"translate"),e.qZA()(),e.TgZ(132,"ion-col")(133,"ion-label",8),e._uU(134),e.ALo(135,"translate"),e.qZA(),e.TgZ(136,"money-input",35),e.NdJ("moneyValueChange",function(r){return n.note.paid=r}),e.ALo(137,"translate"),e.qZA()(),e.TgZ(138,"ion-col")(139,"ion-label",37),e._uU(140),e.ALo(141,"translate"),e.YNc(142,St,2,1,"span",7),e.qZA(),e.TgZ(143,"money-input",35),e.NdJ("moneyValueChange",function(r){return n.note.totalForeign=r}),e.ALo(144,"translate"),e.qZA()()()()()()()(),e.TgZ(145,"div",38),e._UZ(146,"support"),e.qZA()()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,71,"received-note-add.title")),e.xp6(3),e.Q6J("disabled",n.saveDisabled),e.xp6(2),e.hij(" \xa0",e.lcZ(11,73,"action.save")," "),e.xp6(2),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(6),e.Q6J("ngIf",n.note&&n.note.id),e.xp6(3),e.hij("",e.lcZ(22,75,"received-note-add.created-at")," "),e.xp6(3),e.Q6J("date",n.note.createdAt),e.xp6(3),e.hij(" ",e.lcZ(28,77,"received-note-add.product")," "),e.xp6(4),e.AsE(" ",e.lcZ(32,79,"received-note-add.enter-barcode")," ",e.lcZ(33,81,"order-add.or"),"..."),e.xp6(6),e.hij(" \xa0",e.lcZ(38,83,"order-add.add-manual")," "),e.xp6(4),e.hij(" \xa0",e.lcZ(42,85,"order-add.mobile-scan")," "),e.xp6(3),e.s9C("placeholder",e.lcZ(46,87,"received-note-add.enter-barcode-placeholder")),e.Q6J("ngModel",n.barcode),e.xp6(3),e.Q6J("ngForOf",n.note.items),e.xp6(1),e.Q6J("hidden",n.note.items&&n.note.items.length>0),e.xp6(1),e.Q6J("innerHTML",e.lcZ(50,89,"received-note-add.no-product"),e.oJD),e.xp6(5),e.Oqu(e.lcZ(55,91,"received-note-add.contact-info")),e.xp6(2),e.Q6J("ngIf",n.contactSelected&&n.contactSelected.id>0),e.xp6(1),e.Q6J("ngIf",!n.contactSelected||0==n.contactSelected.id),e.xp6(1),e.Q6J("ngIf",n.contactSelected&&n.contactSelected.id>0),e.xp6(1),e.Q6J("ngIf",!n.contactSelected),e.xp6(5),e.hij(" ",e.lcZ(65,93,"received-note-add.product-foreign-currency")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(67,95,"received-note-add.enter-product-foreign-currency")),e.Q6J("ngModel",n.note.foreignCurrency),e.xp6(3),e.hij(" ",e.lcZ(70,97,"received-note-add.payment")," "),e.xp6(6),e.hij(" ",e.lcZ(76,99,"received-note-add.delivery-person")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(78,101,"received-note-add.delivery-person")),e.Q6J("ngModel",n.note.deliveryPerson),e.xp6(4),e.hij(" ",e.lcZ(82,103,"received-note-add.receiver")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(84,105,"received-note-add.receiver")),e.Q6J("ngModel",n.note.receiver),e.xp6(2),e.Q6J("ngIf",!n.staffService.isStaff()),e.xp6(4),e.hij("",e.lcZ(90,107,"order-add.total-product-amount")," "),e.xp6(2),e.Q6J("moneyValue",n.totalProductAmount)("disabled",!0),e.xp6(3),e.hij(" ",e.lcZ(95,109,"received-note-add.discount")," "),e.xp6(5),e.s9C("placeholder",e.lcZ(100,111,"received-note-add.enter-discount")),e.Q6J("moneyValue",n.note.discountOnTotal),e.xp6(3),e.Udp("background-color",n.discountOnTotalPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",n.discountOnTotalPercent?n.discountOnTotalPercent.toFixed(0)+"%":"%"," "),e.xp6(4),e.hij(" ",e.lcZ(108,113,"received-note-add.net-value"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(110,115,"received-note-add.enter-net-value")),e.Q6J("clear",!0)("moneyValue",n.note.netValue),e.xp6(4),e.hij(" ",e.lcZ(114,117,"received-note-add.shipping-fee"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(116,119,"received-note-add.enter-shipping-fee")),e.Q6J("clear",!0)("moneyValue",n.note.shippingFee),e.xp6(4),e.Oqu(e.lcZ(120,121,"received-note-add.tax")),e.xp6(2),e.s9C("placeholder",e.lcZ(122,123,"received-note-add.enter-tax")),e.Q6J("clear",!0)("moneyValue",n.note.tax),e.xp6(2),e.Udp("background-color",n.taxPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",n.taxPercent?n.taxPercent.toFixed(0)+"%":"%"," "),e.xp6(4),e.hij(" ",e.lcZ(129,125,"received-note-add.total"),""),e.xp6(2),e.s9C("placeholder",e.lcZ(131,127,"received-note-add.enter-total")),e.Q6J("clear",!0)("moneyValue",n.note.total),e.xp6(4),e.Oqu(e.lcZ(135,129,"received-note-add.paid")),e.xp6(2),e.s9C("placeholder",e.lcZ(137,131,"received-note-add.enter-paid")),e.Q6J("clear",!0)("moneyValue",n.note.paid),e.xp6(4),e.hij(" ",e.lcZ(141,133,"received-note-add.total-foreign")," "),e.xp6(2),e.Q6J("ngIf",n.note.foreignCurrency),e.xp6(1),e.s9C("placeholder",e.lcZ(144,135,"received-note-add.total-foreign")),e.Q6J("clear",!0)("moneyValue",n.note.totalForeign))},dependencies:[_.sg,_.O5,N.JJ,N.On,a.oU,a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Ie,a.rH,a.Q$,a.q_,a.Nd,a.yW,a.wd,a.sr,a.as,a.j9,a.cs,at.Y,ae.F,lt.L,ie.BN,_.H9,b.X$],encapsulation:2}),i})();var qt=m(9921),ve=m(3142);function Ut(i,l){if(1&i&&(e.TgZ(0,"td",16),e._UZ(1,"img",17),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("src",t.shop.iconUrl,e.LSH)}}function wt(i,l){if(1&i&&(e.TgZ(0,"span")(1,"b"),e._uU(2),e.qZA(),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(t.shop.name)}}function Jt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.phone"),": ",t.shop.phone,"")}}function Lt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.email"),": ",t.shop.email,"")}}function It(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.facebook"),": ",t.shop.facebook,"")}}function Mt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.address"),": ",t.shop.address,"")}}function kt(i,l){if(1&i&&(e.TgZ(0,"table",12)(1,"tr",13),e.YNc(2,Ut,2,1,"td",14),e.TgZ(3,"td",15),e.YNc(4,wt,4,1,"span",11),e.YNc(5,Jt,4,4,"span",11),e.YNc(6,Lt,4,4,"span",11),e.YNc(7,It,4,4,"span",11),e.YNc(8,Mt,4,4,"span",11),e.qZA()()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.shop.iconUrl),e.xp6(2),e.Q6J("ngIf",t.shop&&t.shop.name),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.phone),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.email),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.facebook),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.address)}}const Q=function(i,l,t){return[i,l,"symbol","1.0-2",t]};function Rt(i,l){if(1&i&&(e.TgZ(0,"tr")(1,"td",7),e._uU(2),e.qZA(),e.TgZ(3,"td",7),e._uU(4),e.qZA(),e.TgZ(5,"td",8),e._uU(6),e.ALo(7,"currency"),e.qZA(),e.TgZ(8,"td",8),e._uU(9),e.qZA(),e.TgZ(10,"td",8),e._uU(11),e.ALo(12,"currency"),e.qZA(),e.TgZ(13,"td",8),e._uU(14),e.ALo(15,"currency"),e.qZA(),e.TgZ(16,"td",8),e._uU(17),e.qZA()()),2&i){const t=l.$implicit,n=l.index,o=e.oxw();e.xp6(2),e.lnq("",n+1,". ",t.productCode?t.productCode.toUpperCase()+"-":"","",t.productName,""),e.xp6(2),e.Oqu(t.unit),e.xp6(2),e.Oqu(e.G7q(7,9,e.kEZ(27,Q,t.costPrice,o.currency,o.translateService.currentLang))),e.xp6(3),e.Oqu(t.quantity),e.xp6(2),e.Oqu(e.G7q(12,15,e.kEZ(31,Q,t.discount,o.currency,o.translateService.currentLang))),e.xp6(3),e.Oqu(e.G7q(15,21,e.kEZ(35,Q,t.amount,o.currency,o.translateService.currentLang))),e.xp6(3),e.Oqu(t.note)}}function Et(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij("(",t.receivedNote.foreignCurrency,")")}}let Ot=(()=>{class i{constructor(t,n,o,r,c,p){this.navCtrl=t,this.printer=n,this.translateService=o,this.dataService=r,this.storeService=c,this.userService=p,this.params=null,this.receivedNote=new w.Y,this.totalProductsAmount=0}ngOnInit(){this.reload()}getProductsAmount(){let t=0;for(const n of this.receivedNote.items)t+=1*n.amount;this.totalProductsAmount=t}reload(){var t=this;return(0,d.Z)(function*(){t.userService.getAttr("current-currency").then(o=>{t.currency=o});const n=yield t.storeService.getCurrentStore();if(t.shop=n||(yield t.dataService.getFirstObject("shop")),t.receivedNote=new w.Y,t.params=t.navCtrl.getParams(t.params),t.params&&t.params.receivedNote){t.receivedNote=t.params.receivedNote,t.getProductsAmount();let o="",r="";0!=t.receivedNote.contactId&&t.receivedNote.contact&&t.receivedNote.contact.fullName&&(o=t.receivedNote.contact.fullName),0!=t.receivedNote.contactId&&t.receivedNote.contact&&t.receivedNote.contact.mobile&&(r=t.receivedNote.contact.mobile),0==t.receivedNote.contactId&&t.receivedNote.contactName&&(o=t.receivedNote.contactName),0==t.receivedNote.contactId&&t.receivedNote.contactPhone&&(r=t.receivedNote.contactPhone),t.noteCustomer=(o||"...")+" | "+(r||"..."),setTimeout((0,d.Z)(function*(){const p=document.getElementById("print-page").innerHTML;if(t.navCtrl.isNotCordova())return Z.W.webPrint(p,500),void t.navCtrl.pop();yield t.printer.print(p,{orientation:"landscape"}),t.navCtrl.pop()}),1e3)}})()}dateFormat(t){return v.C.toUiDateString(t)}dateTimeFormat(t){return v.C.toUiString(t)}productName(t,n){return Z.W.productName(t,n)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.G),e.Y36(qt.F),e.Y36(b.sK),e.Y36(ve.D),e.Y36(X.d),e.Y36(G.K))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-detail-print"]],decls:97,vars:141,consts:[["id","print-page",2,"padding","5px"],["style","width: 100%; border: 0px;",4,"ngIf"],[2,"text-align","center"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"hr"],[2,"width","100%"],["nowrap",""],[2,"text-align","right"],[4,"ngFor","ngForOf"],["colspan","5",2,"text-align","right"],[4,"ngIf"],[2,"width","100%","border","0px"],[2,"border-bottom","1px solid #ccc"],["style","padding: 10px;",4,"ngIf"],[2,"padding","10px","text-align","center","vertical-align","text-top"],[2,"padding","10px"],[2,"max-width","100px",3,"src"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,kt,9,6,"table",1),e.TgZ(2,"div",2)(3,"h2",3),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"b",4),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e._UZ(13,"br"),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._UZ(17,"hr",5),e.TgZ(18,"table",6)(19,"thead")(20,"td",7)(21,"b"),e._uU(22),e.ALo(23,"translate"),e.qZA()(),e.TgZ(24,"td",7)(25,"b"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"td",8)(29,"b"),e._uU(30),e.ALo(31,"translate"),e.qZA()(),e.TgZ(32,"td",8)(33,"b"),e._uU(34),e.ALo(35,"translate"),e.qZA()(),e.TgZ(36,"td",8)(37,"b"),e._uU(38),e.ALo(39,"translate"),e.qZA()(),e.TgZ(40,"td",8)(41,"b"),e._uU(42),e.ALo(43,"translate"),e.qZA()(),e.TgZ(44,"td",8)(45,"b"),e._uU(46),e.ALo(47,"translate"),e.qZA()()(),e.TgZ(48,"tbody"),e.YNc(49,Rt,18,39,"tr",9),e._UZ(50,"tr"),e.TgZ(51,"tr")(52,"td",7)(53,"b"),e._uU(54),e.ALo(55,"translate"),e.qZA()(),e.TgZ(56,"td",10),e._uU(57),e.ALo(58,"currency"),e.qZA(),e.TgZ(59,"td",8),e._uU(60,"\xa0"),e.qZA()(),e._UZ(61,"tr"),e.qZA()(),e._UZ(62,"hr",5),e.TgZ(63,"span"),e._uU(64),e.ALo(65,"translate"),e.ALo(66,"currency"),e.qZA(),e._UZ(67,"br"),e.TgZ(68,"span"),e._uU(69),e.ALo(70,"translate"),e.ALo(71,"currency"),e.qZA(),e._UZ(72,"br"),e.TgZ(73,"span"),e._uU(74),e.ALo(75,"translate"),e.ALo(76,"currency"),e.qZA(),e._UZ(77,"br"),e.TgZ(78,"span"),e._uU(79),e.ALo(80,"translate"),e.ALo(81,"currency"),e.qZA(),e._UZ(82,"br"),e.TgZ(83,"b"),e._uU(84),e.ALo(85,"translate"),e.ALo(86,"currency"),e.qZA(),e._UZ(87,"hr",5),e.TgZ(88,"span"),e._uU(89),e.ALo(90,"translate"),e.ALo(91,"currency"),e.qZA(),e._UZ(92,"br"),e.TgZ(93,"span"),e._uU(94),e.ALo(95,"translate"),e.YNc(96,Et,2,1,"span",11),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.shop),e.xp6(3),e.Oqu(e.lcZ(5,33,"received-note-detail.received-note-print-title")),e.xp6(3),e.AsE("",e.lcZ(8,35,"received-note-detail.code"),": #",n.receivedNote.id,""),e.xp6(4),e.AsE("",e.lcZ(12,37,"order-print.date"),": ",n.dateFormat(n.receivedNote.createdAt),""),e.xp6(4),e.AsE("",e.lcZ(16,39,"received-note-detail.contact-info"),": ",n.noteCustomer,""),e.xp6(7),e.Oqu(e.lcZ(23,41,"received-note-print.product-name")),e.xp6(4),e.Oqu(e.lcZ(27,43,"received-note-print.product-unit")),e.xp6(4),e.Oqu(e.lcZ(31,45,"received-note-print.product-unit-price")),e.xp6(4),e.Oqu(e.lcZ(35,47,"received-note-print.product-count")),e.xp6(4),e.Oqu(e.lcZ(39,49,"received-note-print.product-discount")),e.xp6(4),e.Oqu(e.lcZ(43,51,"received-note-print.product-total")),e.xp6(4),e.Oqu(e.lcZ(47,53,"received-note-print.product-note")),e.xp6(3),e.Q6J("ngForOf",n.receivedNote.items),e.xp6(5),e.Oqu(e.lcZ(55,55,"order-detail.total-amount")),e.xp6(3),e.Oqu(e.G7q(58,57,e.kEZ(113,Q,n.totalProductsAmount,n.currency,n.translateService.currentLang))),e.xp6(7),e.AsE("",e.lcZ(65,63,"received-note-add.discount"),": -",e.G7q(66,65,e.kEZ(117,Q,n.receivedNote.discountOnTotal,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(70,71,"received-note-add.net-value"),": ",e.G7q(71,73,e.kEZ(121,Q,n.receivedNote.netValue,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(75,79,"received-note-add.tax"),": +",e.G7q(76,81,e.kEZ(125,Q,n.receivedNote.tax,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(80,87,"received-note-add.shipping-fee"),": +",e.G7q(81,89,e.kEZ(129,Q,n.receivedNote.shippingFee,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(85,95,"received-note-add.total"),": ",e.G7q(86,97,e.kEZ(133,Q,n.receivedNote.total,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(90,103,"received-note-add.paid"),": ",e.G7q(91,105,e.kEZ(137,Q,n.receivedNote.paid,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(95,111,"received-note-add.total-foreign"),": ",n.receivedNote.totalForeign,"\xa0"),e.xp6(2),e.Q6J("ngIf",n.receivedNote.foreignCurrency))},dependencies:[_.sg,_.O5,_.H9,b.X$],encapsulation:2}),i})();const Ft=["fileUploadInput"];function Qt(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",13)(1,"ion-label",14),e._uU(2),e.qZA(),e.TgZ(3,"ion-buttons")(4,"ion-button",15),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.exitStore())}),e._UZ(5,"ion-icon",16),e._uU(6),e.ALo(7,"translate"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.checkStore),e.xp6(4),e.hij(" ",e.lcZ(7,2,"store.exit-store")," ")}}function Yt(i,l){1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Oqu(e.lcZ(2,1,"received-note-import.upload-received-note")))}function Dt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.fileToUpload.name)}}let Gt=(()=>{class i{constructor(t,n,o,r,c,p,x,A,y){this.userService=t,this.excelService=n,this.navCtrl=o,this.platform=r,this.alertCtrl=c,this.translateService=p,this.storeService=x,this.staffService=A,this.analyticsService=y,this.uploadDisabled=!1,this.receivedNotesImported=[],this.isMobile=!0}ionViewWillEnter(){var t=this;return(0,d.Z)(function*(){yield t.analyticsService.setCurrentScreen("received-note-import")})()}ngOnInit(){var t=this;return(0,d.Z)(function*(){t.isMobile=t.platform.width()<720,t.platform.resize.subscribe(()=>{t.isMobile=t.platform.width()<720}),yield t.reload()})()}reload(){var t=this;return(0,d.Z)(function*(){t.store=yield t.storeService.getCurrentStore(),t.checkStore=t.store?t.translateService.instant("store.check-store",{shop:t.store.name}):null,t.selectedStaff=t.staffService.selectedStaff})()}downloadTemplate(){var t=this;return(0,d.Z)(function*(){t.analyticsService.logEvent("received-note-import-download");const n="received-note-template.xlsx";t.excelService.downloadReceivedNoteTemplate(n).then(function(){var o=(0,d.Z)(function*(r){t.navCtrl.isNotCordova()||(yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("report.file-save-alert")+r,buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{}}]})).present(),t.userService.shareFileUrl(n,n,r))});return function(r){return o.apply(this,arguments)}}())})()}rememberFile(t){this.fileToUpload=t.target.files[0],this.uploadNote()}uploadNote(){var t=this;return(0,d.Z)(function*(){t.analyticsService.logEvent("received-note-import-upload"),t.uploadDisabled=!0;const n=yield t.navCtrl.loading(6e4);t.excelService.uploadReceivedNoteFile(t.fileToUpload,t.store?t.store.id:null).then(function(){var o=(0,d.Z)(function*(r){if(yield n.dismiss(),r&&r.id)return t.analyticsService.logEvent("received-note-import-uploaded-success"),t.navCtrl.pop(),t.navCtrl.publish("reloadReceivedNoteList",null),void setTimeout(()=>{t.navCtrl.push("/received-note/detail",{id:r.id})},100);if(r&&r.error){t.analyticsService.logEvent("received-note-import-error");let c=r.error+"";c=c.replace("{","").replace("}","");const p=c.split(":");c="",c=p.length>=2?t.translateService.instant("received-note-import."+p[0])+p[1]:t.translateService.instant("received-note-import."+p[0]),alert(c)}else alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later).");t.uploadDisabled=!1,t.fileToUpload=null,t.fileUploadInput.nativeElement.value=null});return function(r){return o.apply(this,arguments)}}()).catch((0,d.Z)(function*(){yield n.dismiss(),alert("C\xf3 v\u1ea5n \u0111\u1ec1 x\u1ea3y ra, h\xe3y th\u1eed l\u1ea1i sau. (English: Something wrong, please try again later)."),t.uploadDisabled=!1,t.fileToUpload=null,t.fileUploadInput.nativeElement.value=null}))})()}exitStore(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("store.exit-store-alert",{shop:t.store.name}),buttons:[{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(){yield t.storeService.exitStore(),yield t.reload()}),function(){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(G.K),e.Y36(re.x),e.Y36(h.G),e.Y36(a.t4),e.Y36(a.Br),e.Y36(b.sK),e.Y36(X.d),e.Y36(oe.x),e.Y36(W.y))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-import"]],viewQuery:function(t,n){if(1&t&&e.Gf(Ft,5),2&t){let o;e.iGM(o=e.CRH())&&(n.fileUploadInput=o.first)}},decls:27,vars:17,consts:[["slot","start"],["defaultHref","/home"],["lines","none","color","success",4,"ngIf"],[1,"ion-padding"],["expand","block","fill","outline","color","secondary",3,"click"],["slot","start","name","download"],[3,"innerHTML"],["color","primary","for","files",2,"border-radius","10px","display","block","border","1px solid #387ef5","text-transform","uppercase","text-align","center"],[2,"color","#387ef5","height","45px","display","flex","align-items","center","justify-content","center"],["name","cloud-upload","color","primary",2,"zoom","1.5"],[4,"ngIf"],["type","file","accept",".csv, application/vnd.openxmlformats-officedocument.spreadsheetml.sheet, application/vnd.ms-excel","id","files",2,"width","0","height","0","font-size","0",3,"change"],["fileUploadInput",""],["lines","none","color","success"],[1,"ion-text-wrap"],["size","small",3,"click"],["name","exit","slot","start","size","small"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-back-button",1),e.qZA(),e.TgZ(4,"ion-title"),e._uU(5),e.ALo(6,"translate"),e.qZA()(),e.YNc(7,Qt,8,4,"ion-item",2),e.qZA(),e.TgZ(8,"ion-content")(9,"div",3)(10,"p"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e.TgZ(13,"ion-button",4),e.NdJ("click",function(){return n.downloadTemplate()}),e._UZ(14,"ion-icon",5),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._UZ(17,"p",6),e.ALo(18,"translate"),e.TgZ(19,"label",7)(20,"div",8),e._UZ(21,"ion-icon",9),e._uU(22," \xa0 "),e.YNc(23,Yt,3,3,"span",10),e.YNc(24,Dt,2,1,"span",10),e.qZA()(),e.TgZ(25,"input",11,12),e.NdJ("change",function(r){return n.rememberFile(r)}),e.qZA()()()),2&t&&(e.xp6(5),e.Oqu(e.lcZ(6,9,"received-note-import.title")),e.xp6(2),e.Q6J("ngIf",n.checkStore&&(null==n.selectedStaff||n.selectedStaff.hasFullAccess&&!n.selectedStaff.storeId)),e.xp6(1),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(3),e.Oqu(e.lcZ(12,11,"received-note-import.template-note")),e.xp6(4),e.hij("\xa0 ",e.lcZ(16,13,"received-note-import.download-template")," "),e.xp6(2),e.Q6J("innerHTML",e.lcZ(18,15,"received-note-import.note"),e.oJD),e.xp6(6),e.Q6J("ngIf",!n.fileToUpload),e.xp6(1),e.Q6J("ngIf",n.fileToUpload))},dependencies:[_.O5,a.oU,a.YG,a.Sm,a.W2,a.Gu,a.gu,a.Ie,a.Q$,a.wd,a.sr,a.cs,b.X$],encapsulation:2}),i})();var Vt=m(4433),jt=m(3064);function Kt(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.note.contact.fullName)}}function Ht(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.note.contactName)}}function $t(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Oqu(t.note.contactPhone)}}function Bt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("",t.productCode,"-")}}function zt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(3);e.xp6(1),e.hij("(",t.note.foreignCurrency,")")}}function Wt(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,zt,2,1,"span",3),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(1),e.hij(" | ",t.amountForeign,"\xa0"),e.xp6(1),e.Q6J("ngIf",n.note.foreignCurrency)}}const Ze=function(i,l,t){return[i,l,"symbol","1.0-2",t]};function Xt(i,l){if(1&i&&(e.TgZ(0,"span")(1,"ion-text",6),e._uU(2),e.YNc(3,Bt,2,1,"span",3),e._uU(4),e.ALo(5,"currency"),e.YNc(6,Wt,3,2,"span",3),e.qZA(),e._UZ(7,"br"),e.qZA()),2&i){const t=l.$implicit,n=l.index,o=e.oxw();e.xp6(2),e.hij(" ",n+1,"."),e.xp6(1),e.Q6J("ngIf",t.productCode),e.xp6(1),e.HOy("",t.productName," | ",t.quantity," ",t.unit," | ",e.G7q(5,7,e.kEZ(13,Ze,t.amount,o.currency,o.translateService.currentLang))," "),e.xp6(2),e.Q6J("ngIf",t.amountForeign)}}function en(i,l){1&i&&(e.TgZ(0,"span")(1,"ion-text",6),e._uU(2,"..."),e.qZA()())}function tn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.hij(" - ",t.note.store.name,"")}}function nn(i,l){if(1&i&&(e.TgZ(0,"p")(1,"i",7),e._uU(2),e.ALo(3,"translate"),e.YNc(4,tn,2,1,"span",3),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.AsE("",e.lcZ(3,3,"store.created-by")," ",t.note.staff.name,""),e.xp6(2),e.Q6J("ngIf",t.note.store)}}function on(i,l){if(1&i&&(e.TgZ(0,"p")(1,"i",7),e._uU(2),e.ALo(3,"translate"),e.qZA()()),2&i){const t=e.oxw();e.xp6(2),e.AsE("",e.lcZ(3,2,"store.created-by")," ",t.note.store.name,"")}}function rn(i,l){if(1&i&&(e.TgZ(0,"ion-avatar",8),e._UZ(1,"img",9),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("src",t.contactImageOrPlaceholder(t.note.contact),e.LSH)}}let cn=(()=>{class i{constructor(t){this.translateService=t,this.showContact=!0,this.isStaff=!1,this.onPress=new e.vpe,this.onClick=new e.vpe}dateFormat(t){return v.C.toUiLocalDateTimeString(t)}contactImageOrPlaceholder(t){return Z.W.contactImageOrPlaceholder(t.avatarUrl)}limitText(t,n=200){return Z.W.limitText(t,n)}press(){this.onPress.emit()}click(){this.onClick.emit()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(b.sK))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-list-item"]],inputs:{currency:"currency",showContact:"showContact",note:"note",isStaff:"isStaff"},outputs:{onPress:"onPress",onClick:"onClick"},decls:21,vars:25,consts:[[3,"press","click"],[1,"ion-text-wrap"],["color","secondary"],[4,"ngIf"],[4,"ngFor","ngForOf"],["slot","end",4,"ngIf"],[2,"font-size","12px"],[2,"font-size","11px"],["slot","end"],[3,"src"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-item",0),e.NdJ("press",function(){return n.press()})("click",function(){return n.click()}),e.TgZ(1,"ion-label",1)(2,"span"),e._uU(3),e.qZA(),e._uU(4," - "),e.TgZ(5,"span",2),e._uU(6),e.ALo(7,"currency"),e.qZA(),e._UZ(8,"br"),e.YNc(9,Kt,2,1,"p",3),e.YNc(10,Ht,2,1,"p",3),e.YNc(11,$t,2,1,"p",3),e.TgZ(12,"p"),e._uU(13),e.qZA(),e.TgZ(14,"p"),e.YNc(15,Xt,8,17,"span",4),e.ALo(16,"slice"),e.YNc(17,en,3,0,"span",3),e.qZA(),e.YNc(18,nn,5,5,"p",3),e.YNc(19,on,4,4,"p",3),e.qZA(),e.YNc(20,rn,2,1,"ion-avatar",5),e.qZA()),2&t&&(e.xp6(3),e.hij("#",n.note.id,""),e.xp6(3),e.Oqu(e.G7q(7,11,e.kEZ(21,Ze,n.note.total,n.currency,n.translateService.currentLang))),e.xp6(3),e.Q6J("ngIf",n.note.contactId&&0!=n.note.contactId&&n.note.contact&&n.showContact),e.xp6(1),e.Q6J("ngIf",0==n.note.contactId&&n.showContact&&n.note.contactName),e.xp6(1),e.Q6J("ngIf",0==n.note.contactId&&n.showContact&&n.note.contactPhone),e.xp6(2),e.hij(" ",n.dateFormat(n.note.createdAt)," "),e.xp6(2),e.Q6J("ngForOf",e.Dn7(16,17,n.note.items,0,2)),e.xp6(2),e.Q6J("ngIf",n.note.items.length>=3),e.xp6(1),e.Q6J("ngIf",n.note.staffId&&0!=n.note.staffId&&n.note.staff&&!n.isStaff),e.xp6(1),e.Q6J("ngIf",!(n.note.staffId&&0!=n.note.staffId&&n.note.staff&&!n.isStaff)&&n.note.store),e.xp6(1),e.Q6J("ngIf",n.note.contactId&&0!=n.note.contactId&&n.note.contact&&n.showContact))},dependencies:[_.sg,_.O5,a.BJ,a.Ie,a.Q$,a.yW,_.OU,_.H9,b.X$],encapsulation:2}),i})();function an(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",20)(1,"ion-label",14),e._uU(2),e.qZA(),e.TgZ(3,"ion-buttons")(4,"ion-button",21),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.exitStore())}),e._UZ(5,"ion-icon",22),e._uU(6),e.ALo(7,"translate"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.checkStore),e.xp6(4),e.hij(" ",e.lcZ(7,2,"store.exit-store")," ")}}function ln(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"received-note-list-item",24),e.NdJ("onPress",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.presentActionSheet(r))})("onClick",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.select(r.id))}),e.qZA()}if(2&i){const t=l.$implicit,n=e.oxw(2);e.Q6J("note",t)("currency",n.currency)("showContact",!0)}}function sn(i,l){if(1&i&&(e.ynx(0),e.YNc(1,ln,1,3,"received-note-list-item",23),e.BQk()),2&i){const t=e.oxw();e.xp6(1),e.Q6J("ngForOf",t.notes)}}function dn(i,l){if(1&i&&(e.TgZ(0,"ion-avatar",4),e._UZ(1,"img",29),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw(2);e.xp6(1),e.Q6J("src",n.contactImageOrPlaceholder(t.contact),e.LSH)}}function un(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.contact.fullName,"")}}function pn(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.contactName)}}function _n(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Oqu(t.contactPhone)}}function mn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij("",t.productCode,"-")}}function gn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(3).$implicit;e.xp6(1),e.hij("(",t.foreignCurrency,")")}}function hn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.YNc(2,gn,2,1,"span",16),e.qZA()),2&i){const t=e.oxw().$implicit,n=e.oxw().$implicit;e.xp6(1),e.hij(" | ",t.amountForeign,"\xa0"),e.xp6(1),e.Q6J("ngIf",n.foreignCurrency)}}const se=function(i,l,t){return[i,l,"symbol","1.0-2",t]};function fn(i,l){if(1&i&&(e.TgZ(0,"span")(1,"ion-text",30),e._uU(2),e.YNc(3,mn,2,1,"span",16),e._uU(4),e.ALo(5,"currency"),e.YNc(6,hn,3,2,"span",16),e.qZA(),e._UZ(7,"br"),e.qZA()),2&i){const t=l.$implicit,n=l.index,o=e.oxw(3);e.xp6(2),e.hij(" ",n+1,"."),e.xp6(1),e.Q6J("ngIf",t.productCode),e.xp6(1),e.HOy("",t.productName," | ",t.quantity," ",t.unit," | ",e.G7q(5,7,e.kEZ(13,se,t.amount,o.currency,o.translateService.currentLang))," "),e.xp6(2),e.Q6J("ngIf",t.amountForeign)}}function vn(i,l){1&i&&(e.TgZ(0,"span")(1,"ion-text",30),e._uU(2,"..."),e.qZA()())}function Zn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.hij(" - ",t.store.name,"")}}function xn(i,l){if(1&i&&(e.TgZ(0,"p"),e._uU(1),e.YNc(2,Zn,2,1,"span",16),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" ",t.staff.name,""),e.xp6(1),e.Q6J("ngIf",t.store)}}function Cn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw(2).$implicit;e.xp6(1),e.Oqu(t.store.name)}}function An(i,l){if(1&i&&(e.TgZ(0,"p"),e.YNc(1,Cn,2,1,"span",16),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("ngIf",t.store)}}function yn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row",26),e.NdJ("press",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.presentActionSheet(r))})("click",function(){const r=e.CHM(t).$implicit,c=e.oxw(2);return e.KtG(c.select(r.id))}),e.TgZ(1,"ion-col"),e._uU(2),e.qZA(),e.TgZ(3,"ion-col"),e._uU(4),e.ALo(5,"currency"),e.qZA(),e.TgZ(6,"ion-col"),e.YNc(7,dn,2,1,"ion-avatar",27),e.TgZ(8,"ion-label"),e.YNc(9,un,2,1,"p",16),e.YNc(10,pn,2,1,"p",16),e.YNc(11,_n,2,1,"p",16),e.qZA()(),e.TgZ(12,"ion-col"),e.YNc(13,fn,8,17,"span",28),e.ALo(14,"slice"),e.YNc(15,vn,3,0,"span",16),e.qZA(),e.TgZ(16,"ion-col",14),e.YNc(17,xn,3,2,"p",16),e.YNc(18,An,2,1,"p",16),e.qZA(),e.TgZ(19,"ion-col"),e._uU(20),e.qZA()()}if(2&i){const t=l.$implicit,n=e.oxw(2);e.Udp("cursor","pointer"),e.xp6(2),e.hij("#",t.id,""),e.xp6(2),e.Oqu(e.G7q(5,13,e.kEZ(23,se,t.total,n.currency,n.translateService.currentLang))),e.xp6(3),e.Q6J("ngIf",t.contactId&&0!=t.contactId&&t.contact),e.xp6(2),e.Q6J("ngIf",t.contactId&&0!=t.contactId&&t.contact),e.xp6(1),e.Q6J("ngIf",0==t.contactId&&t.contactName),e.xp6(1),e.Q6J("ngIf",0==t.contactId&&t.contactPhone),e.xp6(2),e.Q6J("ngForOf",e.Dn7(14,19,t.items,0,2)),e.xp6(2),e.Q6J("ngIf",t.items.length>=3),e.xp6(2),e.Q6J("ngIf",t.staffId&&0!=t.staffId&&t.staff&&!n.staffService.isStaff()),e.xp6(1),e.Q6J("ngIf",!(t.staffId&&0!=t.staffId&&t.staff&&!n.staffService.isStaff())&&t.store),e.xp6(2),e.Oqu(n.dateFormat(t.createdAt))}}function Nn(i,l){if(1&i&&(e.TgZ(0,"ion-grid")(1,"ion-row")(2,"ion-col")(3,"strong"),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"ion-col")(7,"strong"),e._uU(8),e.ALo(9,"translate"),e.qZA()(),e.TgZ(10,"ion-col")(11,"strong"),e._uU(12),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"ion-col")(15,"strong"),e._uU(16),e.ALo(17,"translate"),e.qZA()(),e.TgZ(18,"ion-col")(19,"strong"),e._uU(20),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"ion-col")(23,"strong"),e._uU(24),e.ALo(25,"translate"),e.qZA()()(),e.YNc(26,yn,21,27,"ion-row",25),e.qZA()),2&i){const t=e.oxw();e.xp6(4),e.Oqu(e.lcZ(5,7,"received-note-add.code")),e.xp6(4),e.Oqu(e.lcZ(9,9,"received-note-add.total")),e.xp6(4),e.Oqu(e.lcZ(13,11,"received-note.provider")),e.xp6(4),e.Oqu(e.lcZ(17,13,"received-note-add.product")),e.xp6(4),e.Oqu(e.lcZ(21,15,"received-note.staff")),e.xp6(4),e.Oqu(e.lcZ(25,17,"received-note.created-at")),e.xp6(2),e.Q6J("ngForOf",t.notes)}}function Tn(i,l){1&i&&(e.TgZ(0,"ion-item",14),e._UZ(1,"div",31),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,1,"received-note.no-received-note"),e.oJD))}let bn=(()=>{class i{constructor(t,n,o,r,c,p,x,A,y,R,q,s,D,f,V,U){var g=this;this.platform=t,this.receivedNoteService=n,this.translateService=o,this.userService=r,this.productService=c,this.navCtrl=p,this.modalCtrl=x,this.file=A,this.barcodeScanner=y,this.excelService=R,this.actionSheetCtrl=q,this.storeService=s,this.alertCtrl=D,this.analyticsService=f,this.staffService=V,this.tradeService=U,this.searchKey="",this.params=null,this.noteFilter="frequency",this.total=0,this.dateFrom="",this.dateTo="",this.isMobile=!0,this.reload=(0,d.Z)(function*(){g.isMobile=g.platform.width()<720,g.currency=yield g.userService.getAttr("current-currency"),g.params=g.navCtrl.getParams(g.params),g.stores=yield g.storeService.getStores(),g.store=yield g.storeService.getCurrentStore(),g.checkStore=g.store?g.translateService.instant("store.check-store",{shop:g.store.name}):null,g.selectedStaff=g.staffService.selectedStaff,g.dateFrom=g.params&&g.params.dateFrom?g.params.dateFrom:g.dateFrom?g.dateFrom:v.C.GetFirstDateOfMonth(),g.dateTo=g.params&&g.params.dateTo?g.params.dateTo:g.dateTo?g.dateTo:v.C.GetEndDateOfMonth();const F=yield g.navCtrl.loading();g.receivedNoteService.getNotes(g.dateFrom,g.dateTo,g.store?g.store.id:0).then(function(){var T=(0,d.Z)(function*(M){yield F.dismiss();const u=[];if(M&&M.length)for(const C of M)C.items=JSON.parse(C.itemsJson),C.store=!g.checkStore&&C.storeId&&g.stores&&g.stores.length?g.stores.find(P=>P.id===C.storeId):null,u.push(C);g.originalNotes=JSON.parse(JSON.stringify(u)),g.notes=u,g.total=S.sumBy(g.notes,C=>C.total),g.filter()});return function(M){return T.apply(this,arguments)}}())}),this.doEnteredBarcode=F=>{!F||this.productService.searchByBarcode(F).then(T=>{T&&this.navCtrl.push("/received-note/add",{product:T.id})})},this.navCtrl.unsubscribe("reloadReceivedNoteList",this.reload),this.navCtrl.subscribe("reloadReceivedNoteList",this.reload)}ionViewWillEnter(){var t=this;return(0,d.Z)(function*(){yield t.analyticsService.setCurrentScreen("received-note")})()}ngOnInit(){this.platform.resize.subscribe(()=>{this.isMobile=this.platform.width()<720}),this.reload()}onPeriodChanged(t){var n=this;return(0,d.Z)(function*(){if(t){const o=yield n.navCtrl.loading();n.dateFrom=""!=t.dateFrom?v.C.toDbString(t.dateFrom,v.C.getDbFormat()):"",n.dateTo=""!=t.dateTo?v.C.toDbString(t.dateTo,v.C.getDbFormat()):"",n.receivedNoteService.getNotes(n.dateFrom,n.dateTo,n.store?n.store.id:0).then(function(){var r=(0,d.Z)(function*(c){const p=[];if(c&&c.length)for(const x of c)x.items=JSON.parse(x.itemsJson),x.store=!n.checkStore&&x.storeId&&n.stores&&n.stores.length?n.stores.find(A=>A.id==x.storeId):null,p.push(x);n.originalNotes=JSON.parse(JSON.stringify(p)),n.notes=p,n.total=S.sumBy(n.notes,x=>x.total),n.filter(),yield o.dismiss()});return function(c){return r.apply(this,arguments)}}())}})()}openAdd(){this.navCtrl.push("/received-note/add")}search(){var t=this;return(0,d.Z)(function*(){t.analyticsService.logEvent("received-note-search");let n=JSON.parse(JSON.stringify(t.originalNotes));if(null!==t.searchKey&&""!==t.searchKey){const o=t.searchKey.toLowerCase();n=n.filter(r=>r.contact&&r.contact.fullName&&-1!==r.contact.fullName.toLowerCase().indexOf(o)||r.id&&-1!==r.id.toString().toLowerCase().indexOf(o)||"#"+r.id.toString()===o||r.contact&&r.contact.mobile&&-1!==r.contact.mobile.toLowerCase().indexOf(o)||r.staff&&r.staff.name&&-1!==r.staff.name.toLowerCase().indexOf(o)||r.staff&&r.staff.userName&&-1!==r.staff.userName.toLowerCase().indexOf(o)||r.store&&r.store.name&&-1!==r.store.name.toLowerCase().indexOf(o)||r.contactName&&-1!==r.contactName.toLowerCase().indexOf(o)||r.contactPhone&&-1!==r.contactPhone.toLowerCase().indexOf(o)||r.deliveryPerson&&-1!==r.deliveryPerson.toLowerCase().indexOf(o)||r.receiver&&-1!==r.receiver.toLowerCase().indexOf(o)||r.items&&r.items.length&&r.items.filter(c=>c.productCode&&-1!==c.productCode.toLowerCase().indexOf(o)||c.productName&&-1!==c.productName.toLowerCase().indexOf(o)||c.note&&-1!==c.note.toLowerCase().indexOf(o)).length>0)}t.notes=n,t.total=S.sumBy(t.notes,o=>o.total)})()}clearSearch(){this.searchKey=null,this.reload()}filter(){let t=JSON.parse(JSON.stringify(this.originalNotes));t=this.sortByModifiedAt(t),this.notes=t}sortByModifiedAt(t){return t?S.orderBy(t,["createdAt"],["desc"]):null}dateOnlyFormat(t){return v.C.toUiDateString(t)}select(t){this.navCtrl.push("/received-note/detail",{id:t})}deleteNote(t){var n=this;return(0,d.Z)(function*(){var r;yield(yield n.alertCtrl.create({header:n.translateService.instant("common.confirm"),message:n.translateService.instant("received-note.delete-alert"),buttons:[{text:n.translateService.instant("common.agree"),handler:(r=(0,d.Z)(function*(){yield n.deleteRelated(t),n.receivedNoteService.delete(t).then((0,d.Z)(function*(){n.analyticsService.logEvent("received-note-delete-success");let c=n.notes.findIndex(p=>p.id===t.id);c>=0&&(n.notes.splice(c,1),n.total=S.sumBy(n.notes,p=>p.total)),c=n.originalNotes.findIndex(p=>p.id===t.id),c>=0&&n.originalNotes.splice(c,1)}))}),function(){return r.apply(this,arguments)})},{text:n.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}deleteRelated(t){var n=this;return(0,d.Z)(function*(){const o=[],r=yield n.tradeService.getTradesByReceivedNote(t.id);for(const p of r)p.debtId||o.push(n.tradeService.deleteTrade(p));const c=yield n.productService.getNotesByReceivedNote(t.id);for(const p of c)o.push(n.productService.deleteProductNote(p));yield Promise.all(o)})()}presentOtherActionSheet(){var t=this;return(0,d.Z)(function*(){yield(yield t.actionSheetCtrl.create({header:t.translateService.instant("action.action"),buttons:[{text:t.translateService.instant("export.export-to-excel"),handler:()=>{t.exportExcel()}},{text:t.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}exportExcel(){var t=this;const n=[];if(n.push([this.translateService.instant("export.received-note-report")]),this.dateFrom&&this.dateTo){const c=this.translateService.instant("common.from"),p=this.translateService.instant("common.to"),x=c+" "+this.dateFormat(this.dateFrom)+" "+p+" "+this.dateFormat(this.dateTo);n.push([x])}n.push([this.translateService.instant("common.total")+": "+this.total+" "+this.currency]),n.push([this.translateService.instant("export.receipt-code"),this.translateService.instant("export.contact"),this.translateService.instant("export.money"),this.translateService.instant("export.unit"),this.translateService.instant("export.date")]);for(const c of this.notes)n.push([c.id,0!==c.contactId&&c.contact?c.contact.fullName:"",c.total,this.currency,this.dateFormat(c.createdAt)]);const o=this.excelService.createSheetData(n),r="received-note-report-"+Z.W.getCurrentDate()+".xlsx";this.excelService.exportExcel(o,r).then(function(){var c=(0,d.Z)(function*(p){t.navCtrl.isNotCordova()||(yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("report.file-save-alert")+t.file.externalDataDirectory+r,buttons:[{text:t.translateService.instant("common.agree"),handler:()=>{}}]})).present(),t.userService.shareFile(null,p))});return function(p){return c.apply(this,arguments)}}())}dateFormat(t){return v.C.toUiLocalDateTimeString(t)}presentActionSheet(t){var n=this;return(0,d.Z)(function*(){yield(yield n.actionSheetCtrl.create({header:n.translateService.instant("action.action"),buttons:[{text:n.translateService.instant("received-note.delete"),role:"destructive",handler:()=>{n.deleteNote(t)}},{text:n.translateService.instant("received-note.edit"),handler:()=>{n.select(t.id)}},{text:n.translateService.instant("common.cancel"),role:"cancel",handler:()=>{}}]})).present()})()}importNote(){this.navCtrl.push("/received-note/import")}scan(){var t=this;return(0,d.Z)(function*(){if(t.navCtrl.isNotCordova()){const n=yield t.modalCtrl.create({component:ge.k});yield n.present();const{data:o}=yield n.onDidDismiss();o&&o.barcode&&t.doEnteredBarcode(o.barcode)}else t.barcodeScanner.scan().then(n=>{!n||!n.text||t.doEnteredBarcode(n.text)})})()}exportProductNotesReport(t){this.navCtrl.push("/product/export",{reportType:t})}exitStore(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("store.exit-store-alert",{shop:t.store.name}),buttons:[{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(){yield t.storeService.exitStore(),yield t.reload()}),function(){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}contactImageOrPlaceholder(t){return Z.W.contactImageOrPlaceholder(t.avatarUrl)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(a.t4),e.Y36(L.r),e.Y36(b.sK),e.Y36(G.K),e.Y36(ne.M),e.Y36(h.G),e.Y36(a.IN),e.Y36(Vt.$),e.Y36(fe.m),e.Y36(re.x),e.Y36(a.BX),e.Y36(X.d),e.Y36(a.Br),e.Y36(W.y),e.Y36(oe.x),e.Y36(I.X))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note"]],decls:48,vars:40,consts:[["slot","start"],["menu","first"],["color","primary",3,"click"],["name","home"],["slot","end"],[3,"click"],["name","add-circle"],["lines","none","color","success",4,"ngIf"],["expand","block","fill","outline",3,"click"],["icon","file-excel","size","lg"],["slot","start","name","document"],["slot","start","name","newspaper"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[3,"onPeriodChanged"],[1,"ion-text-wrap"],[3,"color"],[4,"ngIf"],["class","ion-text-wrap",4,"ngIf"],["vertical","bottom","horizontal","end","slot","fixed"],["name","add"],["lines","none","color","success"],["size","small",3,"click"],["name","exit","slot","start","size","small"],[3,"note","currency","showContact","onPress","onClick",4,"ngFor","ngForOf"],[3,"note","currency","showContact","onPress","onClick"],["style","border-bottom: 1px solid #ccc;",3,"cursor","press","click",4,"ngFor","ngForOf"],[2,"border-bottom","1px solid #ccc",3,"press","click"],["slot","end",4,"ngIf"],[4,"ngFor","ngForOf"],[3,"src"],[2,"font-size","0.8em"],[3,"innerHTML"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),e._UZ(3,"ion-menu-button",1),e.TgZ(4,"ion-button",2),e.NdJ("click",function(){return n.navCtrl.home()}),e._UZ(5,"ion-icon",3),e.qZA()(),e.TgZ(6,"ion-title"),e._uU(7),e.ALo(8,"translate"),e.qZA(),e.TgZ(9,"ion-buttons",4)(10,"ion-button",5),e.NdJ("click",function(){return n.openAdd()}),e._UZ(11,"ion-icon",6),e.qZA()()(),e.YNc(12,an,8,4,"ion-item",7),e.qZA(),e.TgZ(13,"ion-content")(14,"ion-grid")(15,"ion-row")(16,"ion-col")(17,"ion-button",8),e.NdJ("click",function(){return n.importNote()}),e._UZ(18,"fa-icon",9),e._uU(19),e.ALo(20,"translate"),e.qZA()(),e.TgZ(21,"ion-col")(22,"ion-button",8),e.NdJ("click",function(){return n.exportProductNotesReport(0)}),e._UZ(23,"ion-icon",10),e._uU(24),e.ALo(25,"translate"),e.qZA()(),e.TgZ(26,"ion-col")(27,"ion-button",8),e.NdJ("click",function(){return n.exportProductNotesReport(1)}),e._UZ(28,"ion-icon",11),e._uU(29),e.ALo(30,"translate"),e.qZA()()()(),e.TgZ(31,"ion-searchbar",12),e.NdJ("ionClear",function(){return n.clearSearch()})("ionChange",function(){return n.search()})("ngModelChange",function(r){return n.searchKey=r}),e.ALo(32,"translate"),e.qZA(),e.TgZ(33,"period-range",13),e.NdJ("onPeriodChanged",function(r){return n.onPeriodChanged(r)}),e.qZA(),e.TgZ(34,"ion-list")(35,"ion-item")(36,"ion-label",14),e._uU(37),e.ALo(38,"translate"),e.TgZ(39,"ion-text",15),e._uU(40),e.ALo(41,"currency"),e.qZA()()(),e.YNc(42,sn,2,1,"ng-container",16),e.YNc(43,Nn,27,19,"ion-grid",16),e.YNc(44,Tn,3,3,"ion-item",17),e.qZA(),e.TgZ(45,"ion-fab",18)(46,"ion-fab-button",5),e.NdJ("click",function(){return n.openAdd()}),e._UZ(47,"ion-icon",19),e.qZA()()()),2&t&&(e.xp6(7),e.Oqu(e.lcZ(8,18,"received-note.title")),e.xp6(5),e.Q6J("ngIf",n.checkStore&&(null==n.selectedStaff||n.selectedStaff.hasFullAccess&&!n.selectedStaff.storeId)),e.xp6(1),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(6),e.hij("\xa0 ",e.lcZ(20,20,"received-note.import-note-from-excel")," "),e.xp6(5),e.hij("\xa0 ",e.lcZ(25,22,"product-note-export.report-type-summary")," "),e.xp6(5),e.hij("\xa0 ",e.lcZ(30,24,"product-note-export.report-type-detail")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(32,26,"received-note.search")),e.Q6J("ngModel",n.searchKey),e.xp6(6),e.hij(" ",e.lcZ(38,28,"common.total"),":\xa0 "),e.xp6(2),e.s9C("color",n.total>=0?"secondary":"danger"),e.xp6(1),e.AsE("",n.total>=0?"+":""," ",e.G7q(41,30,e.kEZ(36,se,n.total,n.currency,n.translateService.currentLang)),"."),e.xp6(2),e.Q6J("ngIf",n.isMobile),e.xp6(1),e.Q6J("ngIf",!n.isMobile&&n.notes&&n.notes.length),e.xp6(1),e.Q6J("ngIf",!n.originalNotes||0===n.originalNotes.length),e.xp6(1),e.Akn(n.navCtrl.hasAds()?"margin-bottom: 60px":""))},dependencies:[_.sg,_.O5,N.JJ,N.On,a.BJ,a.YG,a.Sm,a.wI,a.W2,a.IJ,a.W4,a.jY,a.Gu,a.gu,a.Ie,a.Q$,a.q_,a.fG,a.Nd,a.VI,a.yW,a.wd,a.sr,a.j9,jt.M,cn,ie.BN,_.OU,_.H9,b.X$],encapsulation:2}),i})();function Sn(i,l){if(1&i&&(e.TgZ(0,"td",15),e._UZ(1,"img",16),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.Q6J("src",t.shop.iconUrl,e.LSH)}}function Pn(i,l){if(1&i&&(e.TgZ(0,"span")(1,"b"),e._uU(2),e.qZA(),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(2),e.Oqu(t.shop.name)}}function qn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.phone"),": ",t.shop.phone,"")}}function Un(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.email"),": ",t.shop.email,"")}}function wn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.facebook"),": ",t.shop.facebook,"")}}function Jn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.ALo(2,"translate"),e._UZ(3,"br"),e.qZA()),2&i){const t=e.oxw(2);e.xp6(1),e.AsE("",e.lcZ(2,2,"shop-add.address"),": ",t.shop.address,"")}}function Ln(i,l){if(1&i&&(e.TgZ(0,"table",11)(1,"tr",12),e.YNc(2,Sn,2,1,"td",13),e.TgZ(3,"td",14),e.YNc(4,Pn,4,1,"span",10),e.YNc(5,qn,4,4,"span",10),e.YNc(6,Un,4,4,"span",10),e.YNc(7,wn,4,4,"span",10),e.YNc(8,Jn,4,4,"span",10),e.qZA()()()),2&i){const t=e.oxw();e.xp6(2),e.Q6J("ngIf",t.shop.iconUrl),e.xp6(2),e.Q6J("ngIf",t.shop&&t.shop.name),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.phone),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.email),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.facebook),e.xp6(1),e.Q6J("ngIf",t.shop&&t.shop.address)}}const Y=function(i,l,t){return[i,l,"symbol","1.0-2",t]};function In(i,l){if(1&i&&(e.TgZ(0,"tr")(1,"td",7),e._uU(2),e.qZA(),e.TgZ(3,"td",7),e._uU(4),e.qZA(),e.TgZ(5,"td",7),e._uU(6),e.qZA(),e.TgZ(7,"td",8),e._uU(8),e.ALo(9,"currency"),e.qZA(),e.TgZ(10,"td",8),e._uU(11),e.qZA(),e.TgZ(12,"td",8),e._uU(13),e.ALo(14,"currency"),e.qZA(),e.TgZ(15,"td",8),e._uU(16),e.ALo(17,"currency"),e.qZA(),e.TgZ(18,"td",8),e._uU(19),e.qZA()()),2&i){const t=l.$implicit,n=e.oxw();e.xp6(2),e.Oqu(t.productCode),e.xp6(2),e.Oqu(t.productName),e.xp6(2),e.Oqu(t.unit),e.xp6(2),e.Oqu(e.G7q(9,8,e.kEZ(26,Y,t.unitPrice,n.currency,n.translateService.currentLang))),e.xp6(3),e.Oqu(t.quantity),e.xp6(2),e.Oqu(e.G7q(14,14,e.kEZ(30,Y,t.discount,n.currency,n.translateService.currentLang))),e.xp6(3),e.Oqu(e.G7q(17,20,e.kEZ(34,Y,t.amount,n.currency,n.translateService.currentLang))),e.xp6(3),e.Oqu(t.note)}}function Mn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw();e.xp6(1),e.hij("(",t.receivedNote.foreignCurrency,")")}}let kn=(()=>{class i{constructor(t,n,o,r,c,p){this.navCtrl=t,this.dataService=n,this.currencyPipe=o,this.storeService=r,this.translateService=c,this.userService=p,this.params=null,this.receivedNote=new w.Y}ngOnInit(){this.reload()}reload(){var t=this;return(0,d.Z)(function*(){t.userService.getAttr("current-currency").then(o=>{t.currency=o});const n=yield t.storeService.getCurrentStore();if(t.shop=n||(yield t.dataService.getFirstObject("shop")),t.receivedNote=new w.Y,t.params=t.navCtrl.getParams(t.params),t.params&&t.params.receivedNote){t.receivedNote=t.params.receivedNote;let o="",r="";0!=t.receivedNote.contactId&&t.receivedNote.contact&&t.receivedNote.contact.fullName&&(o=t.receivedNote.contact.fullName),0!=t.receivedNote.contactId&&t.receivedNote.contact&&t.receivedNote.contact.mobile&&(r=t.receivedNote.contact.mobile),0==t.receivedNote.contactId&&t.receivedNote.contactName&&(o=t.receivedNote.contactName),0==t.receivedNote.contactId&&t.receivedNote.contactPhone&&(r=t.receivedNote.contactPhone),t.noteCustomer=(o||"...")+" | "+(r||"..."),setTimeout((0,d.Z)(function*(){yield t.shareNote(),t.navCtrl.back()}),1e3)}})()}shareNote(){var t=this;return(0,d.Z)(function*(){if(t.navCtrl.isNotCordova())return void alert(t.translateService.instant("common.feature-only-on-app"));const n=t.currencyPipe.transform(t.receivedNote.total,t.currency,!0,"1.0-2"),o=t.currencyPipe.transform(t.receivedNote.shippingFee,t.currency,!0,"1.0-2"),r=t.currencyPipe.transform(t.receivedNote.tax,t.currency,!0,"1.0-2"),c=[t.translateService.instant("received-note-add.code")+": #"+t.receivedNote.id,t.translateService.instant("received-note-add.total")+": "+n];0!=t.receivedNote.shippingFee&&c.push(t.translateService.instant("received-note-add.shipping-fee")+": "+o),0!=t.receivedNote.tax&&c.push(t.translateService.instant("received-note-add.tax")+": "+r);let p="",x="";0!=t.receivedNote.contactId&&t.receivedNote.contact&&t.receivedNote.contact.fullName&&(p=t.receivedNote.contact.fullName),0!=t.receivedNote.contactId&&t.receivedNote.contact&&t.receivedNote.contact.mobile&&(x=t.receivedNote.contact.mobile),0==t.receivedNote.contactId&&t.receivedNote.contactName&&(p=t.receivedNote.contactName),0==t.receivedNote.contactId&&t.receivedNote.contactPhone&&(x=t.receivedNote.contactPhone);const A=[];p&&A.push(p),x&&A.push(x);const y=A&&A.length>0?A.join(" - "):"";y&&c.push(y);const R=c.join(" - ");yield t.userService.shareScreenshot(R)})()}dateFormat(t){return v.C.toUiDateString(t)}dateTimeFormat(t){return v.C.toUiString(t)}productName(t,n){return Z.W.productName(t,n)}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.G),e.Y36(ve.D),e.Y36(_.H9),e.Y36(X.d),e.Y36(b.sK),e.Y36(G.K))},i.\u0275cmp=e.Xpm({type:i,selectors:[["received-note-detail-share"]],decls:85,vars:116,consts:[["id","print-page",2,"padding","5px"],["style","width: 100%; border: 0px;",4,"ngIf"],[2,"text-align","center"],[2,"font-size","18px"],[2,"font-size","16px"],[1,"hr"],[2,"width","100%"],["nowrap",""],[2,"text-align","right"],[4,"ngFor","ngForOf"],[4,"ngIf"],[2,"width","100%","border","0px"],[2,"border-bottom","1px solid #ccc"],["style","padding: 10px;",4,"ngIf"],[2,"padding","10px","text-align","center","vertical-align","text-top"],[2,"padding","10px"],[2,"max-width","100px",3,"src"]],template:function(t,n){1&t&&(e.TgZ(0,"div",0),e.YNc(1,Ln,9,6,"table",1),e.TgZ(2,"div",2)(3,"h2",3),e._uU(4),e.ALo(5,"translate"),e.qZA()(),e.TgZ(6,"b",4),e._uU(7),e.ALo(8,"translate"),e.qZA(),e._UZ(9,"br"),e.TgZ(10,"span"),e._uU(11),e.ALo(12,"translate"),e.qZA(),e._UZ(13,"br"),e.TgZ(14,"span"),e._uU(15),e.ALo(16,"translate"),e.qZA(),e._UZ(17,"hr",5),e.TgZ(18,"table",6)(19,"thead")(20,"td",7)(21,"b"),e._uU(22),e.ALo(23,"translate"),e.qZA()(),e.TgZ(24,"td",7)(25,"b"),e._uU(26),e.ALo(27,"translate"),e.qZA()(),e.TgZ(28,"td",7)(29,"b"),e._uU(30),e.ALo(31,"translate"),e.qZA()(),e.TgZ(32,"td",8)(33,"b"),e._uU(34),e.ALo(35,"translate"),e.qZA()(),e.TgZ(36,"td",8)(37,"b"),e._uU(38),e.ALo(39,"translate"),e.qZA()(),e.TgZ(40,"td",8)(41,"b"),e._uU(42),e.ALo(43,"translate"),e.qZA()(),e.TgZ(44,"td",8)(45,"b"),e._uU(46),e.ALo(47,"translate"),e.qZA()(),e.TgZ(48,"td",8)(49,"b"),e._uU(50),e.ALo(51,"translate"),e.qZA()()(),e.TgZ(52,"tbody"),e.YNc(53,In,20,38,"tr",9),e._UZ(54,"tr"),e.qZA()(),e._UZ(55,"hr",5),e.TgZ(56,"b"),e._uU(57),e.ALo(58,"translate"),e.ALo(59,"currency"),e.qZA(),e._UZ(60,"hr",5),e.TgZ(61,"span"),e._uU(62),e.ALo(63,"translate"),e.ALo(64,"currency"),e.qZA(),e._UZ(65,"br"),e.TgZ(66,"span"),e._uU(67),e.ALo(68,"translate"),e.ALo(69,"currency"),e.qZA(),e._UZ(70,"br"),e.TgZ(71,"span"),e._uU(72),e.ALo(73,"translate"),e.ALo(74,"currency"),e.qZA(),e._UZ(75,"br"),e.TgZ(76,"span"),e._uU(77),e.ALo(78,"translate"),e.ALo(79,"currency"),e.qZA(),e._UZ(80,"br"),e.TgZ(81,"span"),e._uU(82),e.ALo(83,"translate"),e.YNc(84,Mn,2,1,"span",10),e.qZA()()),2&t&&(e.xp6(1),e.Q6J("ngIf",n.shop),e.xp6(3),e.Oqu(e.lcZ(5,30,"received-note-detail.received-note-print-title")),e.xp6(3),e.AsE("",e.lcZ(8,32,"received-note-detail.code"),": #",n.receivedNote.id,""),e.xp6(4),e.AsE("",e.lcZ(12,34,"order-print.date"),": ",n.dateFormat(n.receivedNote.createdAt),""),e.xp6(4),e.AsE("",e.lcZ(16,36,"received-note-detail.contact-info"),": ",n.noteCustomer,""),e.xp6(7),e.Oqu(e.lcZ(23,38,"received-note-print.product-code")),e.xp6(4),e.Oqu(e.lcZ(27,40,"received-note-print.product-name")),e.xp6(4),e.Oqu(e.lcZ(31,42,"received-note-print.product-unit")),e.xp6(4),e.Oqu(e.lcZ(35,44,"received-note-print.product-unit-price")),e.xp6(4),e.Oqu(e.lcZ(39,46,"received-note-print.product-count")),e.xp6(4),e.Oqu(e.lcZ(43,48,"received-note-print.product-discount")),e.xp6(4),e.Oqu(e.lcZ(47,50,"received-note-print.product-total")),e.xp6(4),e.Oqu(e.lcZ(51,52,"received-note-print.product-note")),e.xp6(3),e.Q6J("ngForOf",n.receivedNote.items),e.xp6(4),e.AsE("",e.lcZ(58,54,"received-note-add.total"),": ",e.G7q(59,56,e.kEZ(96,Y,n.receivedNote.total,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(63,62,"received-note-add.net-value"),": ",e.G7q(64,64,e.kEZ(100,Y,n.receivedNote.netValue,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(68,70,"received-note-add.tax"),": ",e.G7q(69,72,e.kEZ(104,Y,n.receivedNote.tax,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(73,78,"received-note-add.shipping-fee"),": ",e.G7q(74,80,e.kEZ(108,Y,n.receivedNote.shippingFee,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(78,86,"received-note-add.paid"),": ",e.G7q(79,88,e.kEZ(112,Y,n.receivedNote.paid,n.currency,n.translateService.currentLang)),""),e.xp6(5),e.AsE("",e.lcZ(83,94,"received-note-add.total-foreign"),": ",n.receivedNote.totalForeign,"\xa0"),e.xp6(2),e.Q6J("ngIf",n.receivedNote.foreignCurrency))},dependencies:[_.sg,_.O5,_.H9,b.X$],encapsulation:2}),i})();var Rn=m(6861);const En=["barcodeInput"],On=["class","component"];function Fn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",25)(1,"ion-label",26),e._uU(2),e.qZA(),e.TgZ(3,"ion-buttons")(4,"ion-button",27),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.exitStore())}),e._UZ(5,"ion-icon",28),e._uU(6),e.ALo(7,"translate"),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.Oqu(t.checkStore),e.xp6(4),e.hij(" ",e.lcZ(7,2,"store.exit-store")," ")}}function Qn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-searchbar",29,30),e.NdJ("ionClear",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.clearSearch())})("ionChange",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.search())})("ngModelChange",function(o){e.CHM(t);const r=e.oxw();return e.KtG(r.searchKey=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.barcodeChanged())}),e.ALo(2,"translate"),e.qZA()}if(2&i){const t=e.oxw();e.s9C("placeholder",e.lcZ(2,2,"product-selector.filter-by-words")),e.Q6J("ngModel",t.searchKey)}}function Yn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-buttons")(1,"ion-button",38),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.expand(o))}),e._UZ(2,"fa-icon",39),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.s9C("icon",t.isExpand?"compress-arrows-alt":"expand-arrows-alt")}}function Dn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" (",t.unit,")")}}function Gn(i,l){if(1&i&&(e.TgZ(0,"ion-avatar",3),e._UZ(1,"img",40),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("src",t.avatarUrl,e.LSH)}}function Vn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",47),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-input",48),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.note=o)}),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"ion-col")(8,"ion-label",42),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.unitPriceForeign=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw(2).$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"ion-col")(14,"ion-label",42),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.amountForeign=o)}),e.ALo(18,"translate"),e.qZA()()()}if(2&i){const t=e.oxw(2).$implicit;e.xp6(3),e.hij("",e.lcZ(4,11,"received-note-add.product-note")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(6,13,"received-note-add.enter-product-note")),e.Q6J("ngModel",t.note),e.xp6(4),e.hij(" ",e.lcZ(10,15,"received-note-add.product-foreign-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(12,17,"received-note-add.enter-product-foreign-unit-price")),e.Q6J("clear",!0)("moneyValue",t.unitPriceForeign),e.xp6(4),e.hij(" ",e.lcZ(16,19,"received-note-add.product-total-foreign")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(18,21,"received-note-add.enter-product-total-foreign")),e.Q6J("clear",!0)("moneyValue",t.amountForeign)}}function jn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-grid",41)(1,"ion-row")(2,"ion-col")(3,"ion-label",42),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"money-input",43),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.costPrice=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"ion-col")(9,"ion-label",42),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"ion-input",44),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.quantity=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"ion-col")(15,"ion-label",42),e._uU(16),e.ALo(17,"translate"),e.TgZ(18,"ion-text",45),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.openProductDiscountPercent(o))}),e._uU(19),e.qZA()(),e.TgZ(20,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.discount=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"ion-col")(23,"ion-label",42),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"money-input",43),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.amount=o)}),e.ALo(27,"translate"),e.qZA()()(),e.YNc(28,Vn,19,23,"ion-row",23),e.qZA()}if(2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,21,"received-note-add.product-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(7,23,"order-add.enter-product-price")),e.Q6J("disabled",n.canViewProductCostPrice&&!n.canUpdateProductCostPrice)("clear",!0)("moneyValue",t.costPrice),e.xp6(4),e.hij(" ",e.lcZ(11,25,"received-note-add.product-count")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(13,27,"order-add.enter-product-count")),e.Q6J("ngModel",t.quantity),e.xp6(4),e.hij(" ",e.lcZ(17,29,"received-note-add.product-discount")," "),e.xp6(2),e.Udp("background-color",t.discountPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",t.discountPercent?t.discountPercent.toFixed(0)+"%":"%"," "),e.xp6(1),e.s9C("placeholder",e.lcZ(21,31,"order-add.enter-product-discount")),e.Q6J("clear",!0)("moneyValue",t.discount),e.xp6(4),e.hij(" ",e.lcZ(25,33,"received-note-add.product-total")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(27,35,"order-add.enter-product-total")),e.Q6J("disabled",n.canViewProductCostPrice&&!n.canUpdateProductCostPrice)("clear",!0)("moneyValue",t.amount),e.xp6(2),e.Q6J("ngIf",t.isExpand)}}function Kn(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-item",31),e.YNc(2,Yn,3,1,"ion-buttons",23),e.TgZ(3,"ion-label",26)(4,"ion-text",32),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._uU(5),e.YNc(6,Dn,2,1,"span",23),e.qZA()(),e.YNc(7,Gn,2,1,"ion-avatar",33),e.TgZ(8,"ion-buttons",3)(9,"ion-button",34),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.decrease(r))}),e._UZ(10,"ion-icon",35),e.qZA(),e.TgZ(11,"ion-button",34),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._UZ(12,"ion-icon",36),e.qZA()()(),e.YNc(13,jn,29,37,"ion-grid",37),e.BQk()}if(2&i){const t=l.$implicit,n=e.oxw();e.xp6(2),e.Q6J("ngIf",t.quantity>0),e.xp6(2),e.Udp("font-weight",t.quantity>0?"bold":"normal"),e.Q6J("color",t.quantity>0?"primary":"normal"),e.xp6(1),e.hij(" ",n.productName(t.code,t.title),""),e.xp6(1),e.Q6J("ngIf",t.unitsJson),e.xp6(1),e.Q6J("ngIf",t.avatarUrl),e.xp6(6),e.Q6J("ngIf",t.quantity)}}function Hn(i,l){1&i&&(e.TgZ(0,"ion-select-option",49),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"product.list-option-customer-price"),""))}function $n(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",17)(1,"ion-label",50),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-buttons",3)(5,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.previousPage())}),e._UZ(6,"ion-icon",52),e.qZA(),e.TgZ(7,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.nextPage())}),e._UZ(8,"ion-icon",53),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.AsE("",e.lcZ(3,2,"common.page")," ",t.currentPage+1," ")}}function Bn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-buttons")(1,"ion-button",38),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.expand(o))}),e._UZ(2,"fa-icon",39),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.s9C("icon",t.isExpand?"compress-arrows-alt":"expand-arrows-alt")}}function zn(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" (",t.unit,")")}}function Wn(i,l){if(1&i&&(e.TgZ(0,"ion-avatar",3),e._UZ(1,"img",40),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("src",t.avatarUrl,e.LSH)}}function Xn(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",47),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-input",48),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.note=o)}),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"ion-col")(8,"ion-label",42),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.unitPriceForeign=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw(2).$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"ion-col")(14,"ion-label",42),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.amountForeign=o)}),e.ALo(18,"translate"),e.qZA()()()}if(2&i){const t=e.oxw(2).$implicit;e.xp6(3),e.hij("",e.lcZ(4,11,"received-note-add.product-note")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(6,13,"received-note-add.enter-product-note")),e.Q6J("ngModel",t.note),e.xp6(4),e.hij(" ",e.lcZ(10,15,"received-note-add.product-foreign-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(12,17,"received-note-add.enter-product-foreign-unit-price")),e.Q6J("clear",!0)("moneyValue",t.unitPriceForeign),e.xp6(4),e.hij(" ",e.lcZ(16,19,"received-note-add.product-total-foreign")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(18,21,"received-note-add.enter-product-total-foreign")),e.Q6J("clear",!0)("moneyValue",t.amountForeign)}}function eo(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-grid",56)(1,"ion-row")(2,"ion-col")(3,"ion-label",42),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"money-input",43),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.costPrice=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"ion-col")(9,"ion-label",42),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"ion-input",44),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.quantity=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"ion-col")(15,"ion-label",42),e._uU(16),e.ALo(17,"translate"),e.TgZ(18,"ion-text",45),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.openProductDiscountPercent(o))}),e._uU(19),e.qZA()(),e.TgZ(20,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.discount=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"ion-col")(23,"ion-label",42),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"money-input",43),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.amount=o)}),e.ALo(27,"translate"),e.qZA()()(),e.YNc(28,Xn,19,23,"ion-row",23),e.qZA()}if(2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,21,"received-note-add.product-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(7,23,"order-add.enter-product-price")),e.Q6J("disabled",n.canViewProductCostPrice&&!n.canUpdateProductCostPrice)("clear",!0)("moneyValue",t.costPrice),e.xp6(4),e.hij(" ",e.lcZ(11,25,"received-note-add.product-count")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(13,27,"order-add.enter-product-count")),e.Q6J("ngModel",t.quantity),e.xp6(4),e.hij(" ",e.lcZ(17,29,"received-note-add.product-discount")," "),e.xp6(2),e.Udp("background-color",t.discountPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",t.discountPercent?t.discountPercent.toFixed(0)+"%":"%"," "),e.xp6(1),e.s9C("placeholder",e.lcZ(21,31,"order-add.enter-product-discount")),e.Q6J("clear",!0)("moneyValue",t.discount),e.xp6(4),e.hij(" ",e.lcZ(25,33,"received-note-add.product-total")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(27,35,"received-note-add.product-total")),e.Q6J("disabled",n.canViewProductCostPrice&&!n.canUpdateProductCostPrice)("clear",!0)("moneyValue",t.amount),e.xp6(2),e.Q6J("ngIf",t.isExpand)}}function to(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-item",54),e.YNc(2,Bn,3,1,"ion-buttons",23),e.TgZ(3,"ion-label",26)(4,"ion-text",32),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._uU(5),e.YNc(6,zn,2,1,"span",23),e.qZA()(),e.YNc(7,Wn,2,1,"ion-avatar",33),e.TgZ(8,"ion-buttons",3)(9,"ion-button",34),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.decrease(r))}),e._UZ(10,"ion-icon",35),e.qZA(),e.TgZ(11,"ion-button",34),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._UZ(12,"ion-icon",36),e.qZA()()(),e.YNc(13,eo,29,37,"ion-grid",55),e.BQk()}if(2&i){const t=l.$implicit,n=e.oxw();e.xp6(2),e.Q6J("ngIf",t.quantity>0),e.xp6(2),e.Udp("font-weight",t.quantity>0?"bold":"normal"),e.Q6J("color",t.quantity>0?"primary":"normal"),e.xp6(1),e.hij(" ",n.productName(t.code,t.title),""),e.xp6(1),e.Q6J("ngIf",t.unitsJson),e.xp6(1),e.Q6J("ngIf",t.avatarUrl),e.xp6(6),e.Q6J("ngIf",t.quantity)}}function no(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label",50),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-buttons",3)(5,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.previousPage())}),e._UZ(6,"ion-icon",52),e.qZA(),e.TgZ(7,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.nextPage())}),e._UZ(8,"ion-icon",53),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.AsE("",e.lcZ(3,2,"common.page")," ",t.currentPage+1," ")}}function oo(i,l){1&i&&(e.TgZ(0,"ion-item",57),e._UZ(1,"div",58),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,1,"product-selector.no-product"),e.oJD))}function io(i,l){1&i&&(e.TgZ(0,"ion-select-option",49),e._uU(1),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.hij(" ",e.lcZ(2,1,"product.list-option-customer-price"),""))}function ro(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item",17)(1,"ion-label",50),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-buttons",3)(5,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.previousPageMaterials())}),e._UZ(6,"ion-icon",52),e.qZA(),e.TgZ(7,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.nextPageMaterials())}),e._UZ(8,"ion-icon",53),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.AsE("",e.lcZ(3,2,"common.page")," ",t.currentPageMaterial+1," ")}}function co(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-buttons")(1,"ion-button",38),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.expand(o))}),e._UZ(2,"fa-icon",39),e.qZA()()}if(2&i){const t=e.oxw().$implicit;e.xp6(2),e.s9C("icon",t.isExpand?"compress-arrows-alt":"expand-arrows-alt")}}function ao(i,l){if(1&i&&(e.TgZ(0,"span"),e._uU(1),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.hij(" (",t.unit,")")}}function lo(i,l){if(1&i&&(e.TgZ(0,"ion-avatar",3),e._UZ(1,"img",40),e.qZA()),2&i){const t=e.oxw().$implicit;e.xp6(1),e.Q6J("src",t.avatarUrl,e.LSH)}}function so(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-row")(1,"ion-col")(2,"ion-label",47),e._uU(3),e.ALo(4,"translate"),e.qZA(),e.TgZ(5,"ion-input",48),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.note=o)}),e.ALo(6,"translate"),e.qZA()(),e.TgZ(7,"ion-col")(8,"ion-label",42),e._uU(9),e.ALo(10,"translate"),e.qZA(),e.TgZ(11,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.unitPriceForeign=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw(2).$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(12,"translate"),e.qZA()(),e.TgZ(13,"ion-col")(14,"ion-label",42),e._uU(15),e.ALo(16,"translate"),e.qZA(),e.TgZ(17,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw(2).$implicit;return e.KtG(r.amountForeign=o)}),e.ALo(18,"translate"),e.qZA()()()}if(2&i){const t=e.oxw(2).$implicit;e.xp6(3),e.hij("",e.lcZ(4,11,"received-note-add.product-note")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(6,13,"received-note-add.enter-product-note")),e.Q6J("ngModel",t.note),e.xp6(4),e.hij(" ",e.lcZ(10,15,"received-note-add.product-foreign-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(12,17,"received-note-add.enter-product-foreign-unit-price")),e.Q6J("clear",!0)("moneyValue",t.unitPriceForeign),e.xp6(4),e.hij(" ",e.lcZ(16,19,"received-note-add.product-total-foreign")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(18,21,"received-note-add.enter-product-total-foreign")),e.Q6J("clear",!0)("moneyValue",t.amountForeign)}}function uo(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-grid",56)(1,"ion-row")(2,"ion-col")(3,"ion-label",42),e._uU(4),e.ALo(5,"translate"),e.qZA(),e.TgZ(6,"money-input",43),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.costPrice=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(7,"translate"),e.qZA()(),e.TgZ(8,"ion-col")(9,"ion-label",42),e._uU(10),e.ALo(11,"translate"),e.qZA(),e.TgZ(12,"ion-input",44),e.NdJ("ngModelChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.quantity=o)})("ngModelChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(13,"translate"),e.qZA()(),e.TgZ(14,"ion-col")(15,"ion-label",42),e._uU(16),e.ALo(17,"translate"),e.TgZ(18,"ion-text",45),e.NdJ("click",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.openProductDiscountPercent(o))}),e._uU(19),e.qZA()(),e.TgZ(20,"money-input",46),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.discount=o)})("moneyValueChange",function(){e.CHM(t);const o=e.oxw().$implicit,r=e.oxw();return e.KtG(r.reCalc(o))}),e.ALo(21,"translate"),e.qZA()(),e.TgZ(22,"ion-col")(23,"ion-label",42),e._uU(24),e.ALo(25,"translate"),e.qZA(),e.TgZ(26,"money-input",43),e.NdJ("moneyValueChange",function(o){e.CHM(t);const r=e.oxw().$implicit;return e.KtG(r.amount=o)}),e.ALo(27,"translate"),e.qZA()()(),e.YNc(28,so,19,23,"ion-row",23),e.qZA()}if(2&i){const t=e.oxw().$implicit,n=e.oxw();e.xp6(4),e.hij(" ",e.lcZ(5,21,"received-note-add.product-unit-price")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(7,23,"order-add.enter-product-price")),e.Q6J("disabled",n.canViewProductCostPrice&&!n.canUpdateProductCostPrice)("clear",!0)("moneyValue",t.costPrice),e.xp6(4),e.hij(" ",e.lcZ(11,25,"received-note-add.product-count")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(13,27,"order-add.enter-product-count")),e.Q6J("ngModel",t.quantity),e.xp6(4),e.hij(" ",e.lcZ(17,29,"received-note-add.product-discount")," "),e.xp6(2),e.Udp("background-color",t.discountPercent?"#3880ff":"#ccc"),e.xp6(1),e.hij(" ",t.discountPercent?t.discountPercent.toFixed(0)+"%":"%"," "),e.xp6(1),e.s9C("placeholder",e.lcZ(21,31,"order-add.enter-product-discount")),e.Q6J("clear",!0)("moneyValue",t.discount),e.xp6(4),e.hij(" ",e.lcZ(25,33,"received-note-add.product-total")," "),e.xp6(2),e.s9C("placeholder",e.lcZ(27,35,"received-note-add.product-total")),e.Q6J("disabled",n.canViewProductCostPrice&&!n.canUpdateProductCostPrice)("clear",!0)("moneyValue",t.amount),e.xp6(2),e.Q6J("ngIf",t.isExpand)}}function po(i,l){if(1&i){const t=e.EpF();e.ynx(0),e.TgZ(1,"ion-item",54),e.YNc(2,co,3,1,"ion-buttons",23),e.TgZ(3,"ion-label",26)(4,"ion-text",32),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._uU(5),e.YNc(6,ao,2,1,"span",23),e.qZA()(),e.YNc(7,lo,2,1,"ion-avatar",33),e.TgZ(8,"ion-buttons",3)(9,"ion-button",34),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.decrease(r))}),e._UZ(10,"ion-icon",35),e.qZA(),e.TgZ(11,"ion-button",34),e.NdJ("click",function(){const r=e.CHM(t).$implicit,c=e.oxw();return e.KtG(c.increase(r))}),e._UZ(12,"ion-icon",36),e.qZA()()(),e.YNc(13,uo,29,37,"ion-grid",55),e.BQk()}if(2&i){const t=l.$implicit,n=e.oxw();e.xp6(2),e.Q6J("ngIf",t.quantity>0),e.xp6(2),e.Udp("font-weight",t.quantity>0?"bold":"normal"),e.Q6J("color",t.quantity>0?"primary":"normal"),e.xp6(1),e.hij(" ",n.productName(t.code,t.title),""),e.xp6(1),e.Q6J("ngIf",t.unitsJson),e.xp6(1),e.Q6J("ngIf",t.avatarUrl),e.xp6(6),e.Q6J("ngIf",t.quantity)}}function _o(i,l){if(1&i){const t=e.EpF();e.TgZ(0,"ion-item")(1,"ion-label",50),e._uU(2),e.ALo(3,"translate"),e.qZA(),e.TgZ(4,"ion-buttons",3)(5,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.previousPageMaterials())}),e._UZ(6,"ion-icon",52),e.qZA(),e.TgZ(7,"ion-button",51),e.NdJ("click",function(){e.CHM(t);const o=e.oxw();return e.KtG(o.nextPageMaterials())}),e._UZ(8,"ion-icon",53),e.qZA()()()}if(2&i){const t=e.oxw();e.xp6(2),e.AsE("",e.lcZ(3,2,"common.page")," ",t.currentPageMaterial+1," ")}}function mo(i,l){1&i&&(e.TgZ(0,"ion-item",57),e._UZ(1,"div",58),e.ALo(2,"translate"),e.qZA()),2&i&&(e.xp6(1),e.Q6J("innerHTML",e.lcZ(2,1,"product-selector.no-product"),e.oJD))}const go=[{path:"",component:bn},{path:"detail",component:$e},{path:"add",component:Pt},{path:"detail-print",component:Ot},{path:"detail-share",component:kn},{path:"note-product-selector",component:(()=>{class i{constructor(t,n,o,r,c,p,x,A,y,R,q){var s=this;this.navCtrl=t,this.userService=n,this.staffService=o,this.translateService=r,this.productService=c,this.contactService=p,this.analyticsService=x,this.alertCtrl=A,this.planService=y,this.storeService=R,this.modalCtrl=q,this.selectedProducts=[],this.originalProducts=[],this.products=[],this.originalMaterials=[],this.materials=[],this.searchKey="",this.tab="all",this.start=0,this.end=19,this.pageSize=20,this.currentPage=0,this.startMaterial=0,this.endMaterial=19,this.pageSizeMaterial=20,this.currentPageMaterial=0,this.outStock=!1,this.listOption="all",this.listOptionMaterials="all",this.customerPrices=[],this.collaboratorPrices=[],this.staffPrices=[],this.checkProduct=0,this.currentPlan=null,this.reloadProducts=(0,d.Z)(function*(){s.currentPlan=yield s.planService.getCurrentPlan(),s.canViewProductCostPrice=!s.staffService.selectedStaff||s.staffService.selectedStaff.hasFullAccess||s.staffService.selectedStaff.canViewProductCostPrice,s.canUpdateProductCostPrice=!s.staffService.selectedStaff||s.staffService.selectedStaff.hasFullAccess||s.staffService.selectedStaff.canUpdateProductCostPrice,s.currentPlan||(s.checkProduct=yield s.planService.checkProduct(),s.checkProduct>=30&&(s.isOnTrial=yield s.planService.isOnTrial(s.currentPlan))),s.params=s.navCtrl.getParams(s.params),s.params&&s.params.callback&&(s.callback=s.params.callback),s.params&&s.params.contactId&&(s.contactId=s.params.contactId),s.params&&s.params.staffId&&(s.staffId=s.params.staffId);const D=yield s.navCtrl.loading();s.currency=yield s.userService.getAttr("current-currency"),s.outStock=yield s.userService.getAttr("out-stock"),s.staffPrices=yield s.getProductsWithStaffPrice(),s.customerPrices=yield s.getProductsWithCustomerPrice(),s.collaboratorPrices=yield s.getProductsWithCollaboratorPrice(),s.selectedStaff=s.staffService.selectedStaff,s.store=yield s.storeService.getCurrentStore(),s.checkStore=s.store?s.translateService.instant("store.check-store",{shop:s.store.name}):null;const f=s.store?s.store.id:0;("all"===s.listOption?s.productService.getProducts(f,0):"expiry"===s.listOption?s.productService.getProductsExpiry(f,0):"quantity"===s.listOption?s.productService.getProductsQuantity(f,0):Promise.resolve(s.customerPrices)).then(function(){var g=(0,d.Z)(function*(F){let T=JSON.parse(JSON.stringify(F));const M=[];for(const u of T){if(M.push(u),u.units=u.unitsJson?JSON.parse(u.unitsJson):[],u.units&&u.units.length)for(const C of u.units){const P=JSON.parse(JSON.stringify(u));P.unit=C.unit,P.basicUnit=u.unit,P.unitExchange=C.exchange,P.price=C.price,P.costPrice=C.costPrice?C.costPrice:C.price,P.count=Math.floor(u.count/C.exchange),M.push(P)}else u.unitsJson=null;u.units=null}if(T=M,T&&T.length)for(const u of T){const C=s.staffPrices&&s.staffPrices.length?s.staffPrices.filter(E=>E.id===u.id):[],P=C&&C.length?C[0]:null,j=s.customerPrices&&s.customerPrices.length?s.customerPrices.filter(E=>E.id===u.id):[],K=j&&j.length?j[0]:null,H=s.collaboratorPrices&&s.collaboratorPrices.length?s.collaboratorPrices.filter(E=>E&&u&&E.id===u.id):[],$=H&&H.length?H[0]:null;u.amount=0,u.discount=0,u.discountPercent=0,u.discountType=0,u.actualQuantity=s.store?u.storeQuantity?u.storeQuantity:0:u.count,u.quantity=0,u.isStaffPrice=!1,u.isCustomerPrice=!1,u.isCollaboratorPrice=!1,K&&K.costPrice?(u.costPrice=K.costPrice,u.isCustomerPrice=!0):P&&P.costPrice?(u.costPrice=P.costPrice,u.isStaffPrice=!0):$&&$.costPrice?(u.costPrice=$.costPrice,u.isCollaboratorPrice=!0):s.canViewProductCostPrice?s.canUpdateProductCostPrice||(u.costPrice=u.costPrice):u.costPrice=null}s.originalProducts=T,s.products=T,yield D.dismiss(),s.barcodeFocus()});return function(F){return g.apply(this,arguments)}}()),("all"===s.listOptionMaterials?s.productService.getProducts(f,!0):"expiry"===s.listOptionMaterials?s.productService.getProductsExpiry(f,!0):"quantity"===s.listOptionMaterials?s.productService.getProductsQuantity(f,!0):Promise.resolve(s.customerPrices)).then(function(){var g=(0,d.Z)(function*(F){let T=JSON.parse(JSON.stringify(F));const M=[];for(const u of T){if(M.push(u),u.units=u.unitsJson?JSON.parse(u.unitsJson):[],u.units&&u.units.length)for(const C of u.units){const P=JSON.parse(JSON.stringify(u));P.unit=C.unit,P.basicUnit=u.unit,P.unitExchange=C.exchange,P.price=C.price,P.count=Math.floor(u.count/C.exchange),M.push(P)}else u.unitsJson=null;u.units=null}if(T=M,T&&T.length)for(const u of T){const C=s.staffPrices&&s.staffPrices.length?s.staffPrices.filter(E=>E.id===u.id):[],P=C&&C.length?C[0]:null,j=s.customerPrices&&s.customerPrices.length?s.customerPrices.filter(E=>E.id===u.id):[],K=j&&j.length?j[0]:null,H=s.collaboratorPrices&&s.collaboratorPrices.length?s.collaboratorPrices.filter(E=>E&&u&&E.id===u.id):[],$=H&&H.length?H[0]:null;u.amount=0,u.discount=0,u.discountPercent=0,u.discountType=0,u.actualQuantity=s.store?u.storeQuantity?u.storeQuantity:0:u.count,u.quantity=0,u.isStaffPrice=!1,u.isCustomerPrice=!1,u.isCollaboratorPrice=!1,K&&K.costPrice?(u.costPrice=K.costPrice,u.isCustomerPrice=!0):P&&P.costPrice?(u.costPrice=P.costPrice,u.isStaffPrice=!0):$&&$.costPrice?(u.costPrice=$.costPrice,u.isCollaboratorPrice=!0):s.canViewProductCostPrice?s.canUpdateProductCostPrice||(u.costPrice=u.costPrice):u.costPrice=null}s.originalMaterials=T,s.materials=T,yield D.dismiss(),s.barcodeFocus()});return function(F){return g.apply(this,arguments)}}())}),this.navCtrl.removeEventListener("reloadNoteProductSelector",this.reloadProducts),this.navCtrl.addEventListener("reloadNoteProductSelector",this.reloadProducts)}ionViewWillEnter(){var t=this;return(0,d.Z)(function*(){yield t.analyticsService.setCurrentScreen("note-product-selector")})()}tabChanged(){this.barcodeFocus()}barcodeChanged(){var t=this;return(0,d.Z)(function*(){!t.searchKey||t.searchKey.length<5||(t.analyticsService.logEvent("note-product-selector-barcode-entered"),t.productService.searchByBarcode(t.searchKey).then(n=>{if(!n)return;t.analyticsService.logEvent("note-product-selector-barcode-entered-ok");let o=t.originalProducts;if(o=o.filter(r=>r.id===n.id),o&&o.length)for(const r of o)t.increase(r);t.products=o}))})()}getProductsWithCustomerPrice(){var t=this;return(0,d.Z)(function*(){if(!t.contactId)return null;const n=yield t.contactService.getCustomerPricesByContact(t.contactId);if(!n||!n.length)return[];for(const o of n)o.product&&(o.product.costPrice=o.costPrice);return n.map(o=>o.product)})()}getProductsWithStaffPrice(){var t=this;return(0,d.Z)(function*(){if(!t.staffService.isStaff()&&!t.staffId)return null;const n=t.staffService.isStaff()?t.staffService.selectedStaff.id:t.staffId,o=yield t.contactService.getCustomerPricesByStaff(n);if(!o||!o.length)return[];for(const r of o)r.product&&(r.product.costPrice=r.costPrice);return o.map(r=>r.product)})()}getProductsWithCollaboratorPrice(){var t=this;return(0,d.Z)(function*(){if(!t.staffService.isStaff())return null;const n=yield t.contactService.getCollaboratorPrices();if(!n||!n.length)return[];for(const o of n)o.product&&(o.product.costPrice=o.costPrice);return n.map(o=>o.product)})()}openProductDiscountPercent(t){var n=this;return(0,d.Z)(function*(){var r;yield(yield n.alertCtrl.create({message:n.translateService.instant("order-add.discount-percent-message"),inputs:[{name:"discountPercent",placeholder:n.translateService.instant("order-add.enter-discount-percent"),type:"number",min:0,max:100,value:t.discountPercent}],buttons:[{text:n.translateService.instant("order-add.remove-percent"),handler:()=>{t.discountPercent=0,t.discount=0,n.reCalc(t)}},{text:n.translateService.instant("common.agree"),handler:(r=(0,d.Z)(function*(c){if(!c)return;const p=+c.discountPercent;p<0||p>100?alert(n.translateService.instant("order-add.discount-percent-not-valid")):(n.analyticsService.logEvent("order-add-change-discount-percent"),p&&(t.discountPercent=p,t.discount=t.costPrice*t.quantity*p/100,n.reCalc(t)))}),function(p){return r.apply(this,arguments)})},{text:n.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}barcodeFocus(){!this.navCtrl.isNotCordova()||"all"===this.tab&&setTimeout(()=>{typeof this.barcodeInput<"u"&&this.barcodeInput.setFocus()},600)}reCalc(t){const n=t.quantity*t.costPrice,o=t.discountType?n*t.discount/100:t.discountPercent?n*t.discountPercent/100:1*t.discount;t.discount=o,t.amount=n-o,t.unitPriceForeign&&t.quantity&&(t.amountForeign=t.quantity*t.unitPriceForeign)}toFixQuantity(t){return Z.W.toFixQuantity(t)}increase(t){var n=this;return(0,d.Z)(function*(){n.selectedProducts.find(r=>r.id===t.id&&r.unit===t.unit)||n.selectedProducts.push(t),t.quantity++,t.quantity>=2&&n.analyticsService.logEvent("note-product-selector-increase-2"),n.reCalc(t),n.barcodeFocus()})()}decrease(t){var n=this;return(0,d.Z)(function*(){if(t&&t.quantity&&!(t.quantity<=0)){if(n.analyticsService.logEvent("note-product-selector-decrease"),t.quantity--,0===t.quantity){const o=n.selectedProducts.findIndex(r=>r.id===t.id&&r.unit===t.unit);o>=0&&n.selectedProducts.splice(o,1),(!n.selectedProducts||!n.selectedProducts.length)&&"all"!==n.tab&&(n.tab="all",n.tabChanged())}n.reCalc(t),n.barcodeFocus()}})()}ngOnInit(){this.reloadProducts()}dateFormat(t){return v.C.toUiString(t)}search(){var t=this;return(0,d.Z)(function*(){t.analyticsService.logEvent("note-product-selector-search");let n=t.originalProducts;if(null!==t.searchKey&&""!==t.searchKey){t.start=0,t.end=19,t.currentPage=0;const o=t.searchKey.toLowerCase();n=n.filter(r=>r.title&&-1!==r.title.toLowerCase().indexOf(o)||r.code&&-1!==r.code.toLowerCase().indexOf(o))}t.products=n})()}clearSearch(){var t=this;return(0,d.Z)(function*(){t.start=0,t.end=19,t.currentPage=0,t.analyticsService.logEvent("note-product-selector-clear-search"),t.searchKey=null,t.products=t.originalProducts,t.barcodeFocus()})()}dismiss(){var t=this;return(0,d.Z)(function*(){if(t.callback)return t.callback(null),void(yield t.navCtrl.back());t.modalCtrl.dismiss()})()}ok(){var t=this;return(0,d.Z)(function*(){if(t.analyticsService.logEvent("note-product-selector-ok"),t.callback)return t.callback(t.selectedProducts),void(yield t.navCtrl.back());t.modalCtrl.dismiss(t.selectedProducts)})()}productName(t,n){let r=Z.W.productName(t,n);return!r||r.length<=100||(r=r.substr(0,100),r=r.substr(0,Math.min(r.length,r.lastIndexOf(" ")))+"..."),r}showTypes(t){var n=this;return(0,d.Z)(function*(){n.analyticsService.logEvent("note-product-selector-show-types");const r=JSON.parse(JSON.stringify(t));r.costPrice=t.initPrice?t.initPrice:t.costPrice,r.changedPrice=0,yield n.navCtrl.push("/product/type-selector",{callback:c=>{c&&(t.types=c.types,t.typeOptions=n.getTypeOptions(c.types),t.typeAttributes=n.getTypeAttributesString(t),t.initPrice=c.initPrice,t.costPrice=c.costPrice?c.costPrice:t.initPrice,t.quantity<=0&&(t.quantity=1,n.selectedProducts.find(x=>t.id===x.id)||n.selectedProducts.push(t)),n.reCalc(t))},mainProduct:r})})()}getTypeAttributesString(t){return Z.W.getTypeAttributesString(t)}get isShowPaging(){return!!(this.products&&this.products.length>this.pageSize)}get isShowPagingMaterials(){return!!(this.materials&&this.materials.length>this.pageSize)}previousPage(){this.currentPage<=0?this.currentPage=0:(this.currentPage--,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1)}previousPageMaterials(){this.currentPageMaterial<=0?this.currentPageMaterial=0:(this.currentPageMaterial--,this.startMaterial=this.currentPageMaterial*this.pageSizeMaterial,this.endMaterial=this.startMaterial+this.pageSizeMaterial-1)}getTypeOptions(t){return Z.W.getTypeOptions(t)}nextPage(){(this.currentPage+1)*this.pageSize>=this.products.length||(this.currentPage++,this.start=this.currentPage*this.pageSize,this.end=this.start+this.pageSize-1)}nextPageMaterials(){(this.currentPageMaterial+1)*this.pageSizeMaterial>=this.materials.length||(this.currentPageMaterial++,this.startMaterial=this.currentPageMaterial*this.pageSizeMaterial,this.endMaterial=this.startMaterial+this.pageSizeMaterial-1)}expand(t){var n=this;return(0,d.Z)(function*(){const o=!t.isExpand;for(const r of n.products)r.isExpand=!1;t.isExpand=o,o&&n.analyticsService.logEvent("note-product-selector-expand")})()}changeListOption(){this.start=0,this.end=19,this.currentPage=0,this.reloadProducts()}changeListOptionMaterials(){this.startMaterial=0,this.endMaterial=19,this.currentPageMaterial=0,this.reloadProducts()}add(){if(!this.currentPlan&&this.checkProduct>=30&&!this.isOnTrial)return this.analyticsService.logEvent("check-product-alert"),void alert(this.translateService.instant("product.check-product-alert",{total:this.checkProduct}));this.navCtrl.push("/product/quick-add",{fromSearch:!0})}exitStore(){var t=this;return(0,d.Z)(function*(){var o;yield(yield t.alertCtrl.create({header:t.translateService.instant("common.confirm"),message:t.translateService.instant("store.exit-store-alert",{shop:t.store.name}),buttons:[{text:t.translateService.instant("common.agree"),handler:(o=(0,d.Z)(function*(){yield t.storeService.exitStore(),yield t.reloadProducts()}),function(){return o.apply(this,arguments)})},{text:t.translateService.instant("common.cancel"),handler:()=>{}}]})).present()})()}}return i.\u0275fac=function(t){return new(t||i)(e.Y36(h.G),e.Y36(G.K),e.Y36(oe.x),e.Y36(b.sK),e.Y36(ne.M),e.Y36(te.y),e.Y36(W.y),e.Y36(a.Br),e.Y36(Rn.D),e.Y36(X.d),e.Y36(a.IN))},i.\u0275cmp=e.Xpm({type:i,selectors:[["note-product-selector",8,"component"]],viewQuery:function(t,n){if(1&t&&e.Gf(En,5),2&t){let o;e.iGM(o=e.CRH())&&(n.barcodeInput=o.first)}},attrs:On,decls:83,vars:74,consts:[["slot","start"],[3,"click"],["name","close"],["slot","end"],["name","add"],["name","checkmark"],["lines","none","color","success",4,"ngIf"],["color","primary",3,"ngModel","ngModelChange"],["value","all"],["value","materials"],["value","selected"],["color","danger"],["autofocus","true","debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange",4,"ngIf"],[1,"ion-padding",2,"padding-top","5px","padding-bottom","0","margin-top","0","margin-bottom","0","font-size","0.8em"],[3,"hidden"],[4,"ngFor","ngForOf"],["size","6",1,"ion-no-padding"],["lines","none",1,"ion-no-padding"],[2,"max-width","100% !important",3,"placeholder","ngModel","ngModelChange"],["value","expiry"],["value","quantity"],["value","customer-price",4,"ngIf"],["lines","none","class","ion-no-padding",4,"ngIf"],[4,"ngIf"],["text-wrap","",4,"ngIf"],["lines","none","color","success"],[1,"ion-text-wrap"],["size","small",3,"click"],["name","exit","slot","start","size","small"],["autofocus","true","debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],["barcodeInput",""],["text-wrap","",2,"--min-height","0"],[2,"padding","0",3,"color","click"],["slot","end",4,"ngIf"],["fill","clear","size","large",3,"click"],["slot","icon-only","size","large","name","remove"],["slot","icon-only","size","large","name","add"],["style","padding-left: 15px; padding-right: 15px; margin: 0;","color","light",4,"ngIf"],["fill","clear","color","medium",3,"click"],[3,"icon"],[3,"src"],["color","light",2,"padding-left","15px","padding-right","15px","margin","0"],["position","stacked","color","primary"],[3,"disabled","clear","placeholder","moneyValue","moneyValueChange"],["clearInput","","type","number",3,"placeholder","ngModel","ngModelChange"],[1,"ion-text-nowrap",2,"margin-left","3px","margin-top","3px","font-size","0.7em","background-color","#3880ff","color","white","padding","3px","border-radius","5px","font-weight","bold",3,"click"],[3,"clear","placeholder","moneyValue","moneyValueChange"],["position","\n                        ","color","primary"],["clearInput","","type","text",3,"placeholder","ngModel","ngModelChange"],["value","customer-price"],[1,"ion-text-wrap","ion-text-right"],["fill","solid",3,"click"],["slot","icon-only","name","arrow-back-circle"],["slot","icon-only","name","arrow-forward-circle"],["text-wrap","","lines","none",2,"--min-height","0"],["style","padding-left: 15px; padding-right: 15px; margin: 0;","color","light","class","ion-no-padding",4,"ngIf"],["color","light",1,"ion-no-padding",2,"padding-left","15px","padding-right","15px","margin","0"],["text-wrap",""],[3,"innerHTML"]],template:function(t,n){1&t&&(e.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),e.NdJ("click",function(){return n.dismiss()}),e._UZ(4,"ion-icon",2),e.qZA()(),e.TgZ(5,"ion-title"),e._uU(6),e.ALo(7,"translate"),e.qZA(),e.TgZ(8,"ion-buttons",3)(9,"ion-button",1),e.NdJ("click",function(){return n.add()}),e._UZ(10,"ion-icon",4),e.qZA(),e.TgZ(11,"ion-button",1),e.NdJ("click",function(){return n.ok()}),e._UZ(12,"ion-icon",5),e._uU(13),e.ALo(14,"translate"),e.qZA()()(),e.YNc(15,Fn,8,4,"ion-item",6),e.TgZ(16,"ion-segment",7),e.NdJ("ngModelChange",function(r){return n.tab=r})("ngModelChange",function(){return n.tabChanged()}),e.TgZ(17,"ion-segment-button",8),e._uU(18),e.ALo(19,"translate"),e.qZA(),e.TgZ(20,"ion-segment-button",9),e._uU(21),e.ALo(22,"translate"),e.qZA(),e.TgZ(23,"ion-segment-button",10)(24,"ion-text"),e._uU(25),e.ALo(26,"translate"),e.TgZ(27,"ion-text",11),e._uU(28),e.qZA()()()(),e.YNc(29,Qn,3,4,"ion-searchbar",12),e.qZA(),e.TgZ(30,"ion-content")(31,"p",13)(32,"i"),e._uU(33),e.ALo(34,"translate"),e.qZA()(),e.TgZ(35,"ion-list",14),e.YNc(36,Kn,14,8,"ng-container",15),e.qZA(),e.TgZ(37,"ion-list",14)(38,"ion-grid")(39,"ion-row")(40,"ion-col",16)(41,"ion-item",17)(42,"ion-select",18),e.NdJ("ngModelChange",function(r){return n.listOption=r})("ngModelChange",function(){return n.changeListOption()}),e.ALo(43,"translate"),e.TgZ(44,"ion-select-option",8),e._uU(45),e.ALo(46,"translate"),e.qZA(),e.TgZ(47,"ion-select-option",19),e._uU(48),e.ALo(49,"translate"),e.qZA(),e.TgZ(50,"ion-select-option",20),e._uU(51),e.ALo(52,"translate"),e.qZA(),e.YNc(53,Hn,3,3,"ion-select-option",21),e.qZA()()(),e.TgZ(54,"ion-col",16),e.YNc(55,$n,9,4,"ion-item",22),e.qZA()()(),e.YNc(56,to,14,8,"ng-container",15),e.ALo(57,"slice"),e.YNc(58,no,9,4,"ion-item",23),e.YNc(59,oo,3,3,"ion-item",24),e.qZA(),e.TgZ(60,"ion-list",14)(61,"ion-grid")(62,"ion-row")(63,"ion-col",16)(64,"ion-item",17)(65,"ion-select",18),e.NdJ("ngModelChange",function(r){return n.listOptionMaterials=r})("ngModelChange",function(){return n.changeListOptionMaterials()}),e.ALo(66,"translate"),e.TgZ(67,"ion-select-option",8),e._uU(68),e.ALo(69,"translate"),e.qZA(),e.TgZ(70,"ion-select-option",19),e._uU(71),e.ALo(72,"translate"),e.qZA(),e.TgZ(73,"ion-select-option",20),e._uU(74),e.ALo(75,"translate"),e.qZA(),e.YNc(76,io,3,3,"ion-select-option",21),e.qZA()()(),e.TgZ(77,"ion-col",16),e.YNc(78,ro,9,4,"ion-item",22),e.qZA()()(),e.YNc(79,po,14,8,"ng-container",15),e.ALo(80,"slice"),e.YNc(81,_o,9,4,"ion-item",23),e.YNc(82,mo,3,3,"ion-item",24),e.qZA()()),2&t&&(e.xp6(6),e.hij(" ",e.lcZ(7,38,"product-selector.title")," "),e.xp6(7),e.hij("\xa0",e.lcZ(14,40,"action.save")," "),e.xp6(2),e.Q6J("ngIf",n.checkStore&&(null==n.selectedStaff||n.selectedStaff.hasFullAccess&&!n.selectedStaff.storeId)),e.xp6(1),e.Q6J("ngModel",n.tab),e.xp6(2),e.hij(" ",e.lcZ(19,42,"product-selector.filter-all")," "),e.xp6(3),e.hij(" ",e.lcZ(22,44,"product-selector.filter-materials")," "),e.xp6(3),e.Udp("font-weight",n.selectedProducts&&n.selectedProducts.length?"bold":"normal"),e.xp6(1),e.hij(" ",e.lcZ(26,46,"product-selector.filter-selected")," "),e.xp6(3),e.hij(" (",n.selectedProducts?n.selectedProducts.length:0,")"),e.xp6(1),e.Q6J("ngIf","all"==n.tab),e.xp6(1),e.Akn(n.navCtrl.hasAds()?"--padding-bottom: 60px":""),e.xp6(3),e.Oqu(e.lcZ(34,48,"product-selector.enter-note-description")),e.xp6(2),e.Q6J("hidden","all"==n.tab||"materials"==n.tab),e.xp6(1),e.Q6J("ngForOf",n.selectedProducts),e.xp6(1),e.Q6J("hidden","selected"==n.tab||"materials"==n.tab),e.xp6(5),e.s9C("placeholder",e.lcZ(43,50,"product.select-option")),e.Q6J("ngModel",n.listOption),e.xp6(3),e.Oqu(e.lcZ(46,52,"product.list-option-all")),e.xp6(3),e.Oqu(e.lcZ(49,54,"product.list-option-expiry")),e.xp6(3),e.Oqu(e.lcZ(52,56,"product.list-option-quantiy")),e.xp6(2),e.Q6J("ngIf",n.contactId),e.xp6(2),e.Q6J("ngIf",n.isShowPaging&&n.products&&n.products.length),e.xp6(1),e.Q6J("ngForOf",e.Dn7(57,58,n.products,n.start,n.end+1)),e.xp6(2),e.Q6J("ngIf",n.isShowPaging&&n.products&&n.products.length),e.xp6(1),e.Q6J("ngIf",!n.originalProducts||0===n.originalProducts.length),e.xp6(1),e.Q6J("hidden","selected"==n.tab||"all"==n.tab),e.xp6(5),e.s9C("placeholder",e.lcZ(66,62,"product.select-option")),e.Q6J("ngModel",n.listOptionMaterials),e.xp6(3),e.Oqu(e.lcZ(69,64,"product.list-option-all")),e.xp6(3),e.Oqu(e.lcZ(72,66,"product.list-option-expiry")),e.xp6(3),e.Oqu(e.lcZ(75,68,"product.list-option-quantiy")),e.xp6(2),e.Q6J("ngIf",n.contactId),e.xp6(2),e.Q6J("ngIf",n.isShowPagingMaterials&&n.materials&&n.materials.length),e.xp6(1),e.Q6J("ngForOf",e.Dn7(80,70,n.materials,n.startMaterial,n.endMaterial+1)),e.xp6(2),e.Q6J("ngIf",n.isShowPagingMaterials&&n.materials&&n.materials.length),e.xp6(1),e.Q6J("ngIf",!n.originalMaterials||0===n.originalMaterials.length))},dependencies:[_.sg,_.O5,N.JJ,N.On,a.BJ,a.YG,a.Sm,a.wI,a.W2,a.jY,a.Gu,a.gu,a.pK,a.Ie,a.Q$,a.q_,a.Nd,a.VI,a.cJ,a.GO,a.t9,a.n0,a.yW,a.wd,a.sr,a.as,a.QI,a.j9,ie.BN,ae.F,_.OU,b.X$],encapsulation:2}),i})()},{path:"import",component:Gt}];let ho=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[z.Bz.forChild(go),z.Bz]}),i})();var xe=m(3093);let fo=(()=>{class i{}return i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=e.oAB({type:i}),i.\u0275inj=e.cJS({imports:[_.ez,N.u5,a.Pc,ho,xe.m,ie.uH,b.aw.forChild({loader:{provide:b.Zw,useFactory:xe.x,deps:[ee.eN]}})]}),i})()},6026:(de,B,m)=>{m.d(B,{k:()=>d});var _=m(6738),N=m(191),a=m(6961),b=m(4006),ee=m(3306);const z=["barcodeInput"];let d=(()=>{class w{constructor(J,S){this.viewCtrl=J,this.productService=S}ngOnInit(){this.barcodeFocus()}ionViewLoaded(){this.barcodeFocus()}barcodeFocus(){setTimeout(()=>{this.barcodeInput.setFocus()},600)}barcodeChanged(){!this.barcode||this.barcode.length<5||this.productService.searchByBarcode(this.barcode).then(J=>{!J||this.ok()})}dismiss(){this.viewCtrl.dismiss()}ok(){this.viewCtrl.dismiss({barcode:this.barcode})}}return w.\u0275fac=function(J){return new(J||w)(_.Y36(N.IN),_.Y36(a.M))},w.\u0275cmp=_.Xpm({type:w,selectors:[["barcode-input"]],viewQuery:function(J,S){if(1&J&&_.Gf(z,7),2&J){let v;_.iGM(v=_.CRH())&&(S.barcodeInput=v.first)}},decls:22,vars:13,consts:[["slot","start"],[3,"click"],["name","close"],[1,"ion-padding"],["clearInput","","autofocus","true","type","text",3,"placeholder","ngModel","ngModelChange"],["barcodeInput",""],["color","primary","expand","block",3,"click"],["color","secondary","expand","block",3,"click"]],template:function(J,S){1&J&&(_.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),_.NdJ("click",function(){return S.dismiss()}),_._UZ(4,"ion-icon",2),_.qZA()(),_.TgZ(5,"ion-title"),_._uU(6),_.ALo(7,"translate"),_.qZA()()(),_.TgZ(8,"ion-content",3)(9,"ion-input",4,5),_.NdJ("ngModelChange",function(Z){return S.barcode=Z})("ngModelChange",function(){return S.barcodeChanged()}),_.ALo(11,"translate"),_.qZA(),_.TgZ(12,"ion-grid")(13,"ion-row")(14,"ion-col")(15,"ion-button",6),_.NdJ("click",function(){return S.ok()}),_._uU(16),_.ALo(17,"translate"),_.qZA()(),_.TgZ(18,"ion-col")(19,"ion-button",7),_.NdJ("click",function(){return S.dismiss()}),_._uU(20),_.ALo(21,"translate"),_.qZA()()()()()),2&J&&(_.xp6(6),_.hij(" ",_.lcZ(7,5,"order-add.enter-barcode")," "),_.xp6(3),_.s9C("placeholder",_.lcZ(11,7,"order-add.enter-barcode-placeholder")),_.Q6J("ngModel",S.barcode),_.xp6(7),_.Oqu(_.lcZ(17,9,"common.agree")),_.xp6(4),_.hij("",_.lcZ(21,11,"common.cancel")," "))},dependencies:[b.JJ,b.On,N.YG,N.Sm,N.wI,N.W2,N.jY,N.Gu,N.gu,N.pK,N.Nd,N.wd,N.sr,N.j9,ee.X$],encapsulation:2}),w})()},360:(de,B,m)=>{m.d(B,{Y:()=>v});var _=m(5861),N=m(6723),a=m(6738),b=m(5851),ee=m(323),z=m(7852),d=m(3306),w=m(6895),k=m(191);function J(Z,e){if(1&Z){const h=a.EpF();a.TgZ(0,"ion-button",13),a.NdJ("click",function(){a.CHM(h);const I=a.oxw(2);return a.KtG(I.hideSupport())}),a._UZ(1,"ion-icon",14),a.qZA()}}function S(Z,e){if(1&Z){const h=a.EpF();a.TgZ(0,"div",1)(1,"ion-item",2),a.NdJ("click",function(){a.CHM(h);const I=a.oxw();return a.KtG(I.callPhone("+84869366606"))}),a.TgZ(2,"ion-label",3)(3,"h2")(4,"strong"),a._uU(5),a.ALo(6,"translate"),a.qZA()()(),a.YNc(7,J,2,0,"ion-button",4),a.qZA(),a.TgZ(8,"p")(9,"i"),a._uU(10),a.ALo(11,"translate"),a.qZA()(),a.TgZ(12,"ion-button",5),a.NdJ("click",function(){a.CHM(h);const I=a.oxw();return a.KtG(I.sendTicket())}),a._UZ(13,"ion-icon",6),a._uU(14),a.ALo(15,"translate"),a.qZA(),a.TgZ(16,"ion-grid")(17,"ion-row")(18,"ion-col",7)(19,"ion-item",8),a.NdJ("click",function(){a.CHM(h);const I=a.oxw();return a.KtG(I.callPhone("+84869366606"))}),a._UZ(20,"ion-icon",9),a.TgZ(21,"ion-label",10),a._uU(22),a.ALo(23,"translate"),a.qZA()()(),a.TgZ(24,"ion-col",7)(25,"ion-item",8),a.NdJ("click",function(){a.CHM(h);const I=a.oxw();return a.KtG(I.sendEmail("dlv.isale.app@gmail.com"))}),a._UZ(26,"ion-icon",11),a.TgZ(27,"ion-label",12),a._uU(28),a.ALo(29,"translate"),a.qZA()()()()()()}if(2&Z){const h=a.oxw();a.xp6(5),a.hij("",a.lcZ(6,6,"common.contact"),":"),a.xp6(2),a.Q6J("ngIf",!h.neverHide),a.xp6(3),a.Oqu(a.lcZ(11,8,"ticket-add.send-ticket-note")),a.xp6(4),a.hij("\xa0 ",a.lcZ(15,10,"ticket-add.title")," "),a.xp6(8),a.hij(" ",a.lcZ(23,12,"common.hotline"),": (+84) 0383.838.394 "),a.xp6(6),a.hij(" ",a.lcZ(29,14,"common.email"),": dlv.isale.app@gmail.com ")}}let v=(()=>{class Z{constructor(h,L,I,te){this.navCtrl=h,this.analyticsService=L,this.storage=I,this.translate=te,this.neverHide=!1,this.isHide=!1}ngOnInit(){var h=this;return(0,_.Z)(function*(){h.isHide=!!(yield h.storage.get("hide-support"))})()}callPhone(h){!h||(this.analyticsService.logEvent("support-call-hotline"),N.W.callPhone(h))}sendEmail(h){!h||(this.analyticsService.logEvent("support-email"),N.W.sendEmail(h))}sendTicket(){this.navCtrl.push("/ticket/add",null)}hideSupport(){var h=this;return(0,_.Z)(function*(){h.analyticsService.logEvent("support-hide"),h.isHide=!0,alert(h.translate.instant("support.alert")),yield h.storage.set("hide-support","1")})()}}return Z.\u0275fac=function(h){return new(h||Z)(a.Y36(b.G),a.Y36(ee.y),a.Y36(z.V),a.Y36(d.sK))},Z.\u0275cmp=a.Xpm({type:Z,selectors:[["support"]],inputs:{neverHide:"neverHide"},decls:1,vars:1,consts:[["style","padding: 5px; border: 1px solid #D3679D; border-radius: 10px; margin-top: 10px;",4,"ngIf"],[2,"padding","5px","border","1px solid #D3679D","border-radius","10px","margin-top","10px"],["lines","none",1,"ion-no-padding",2,"padding-top","10px !important","min-height","0 !important","--min-height","0 !important",3,"click"],[2,"margin","0 !important","padding","0 !important"],["slot","end","size","small","fill","clear",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","mail"],[2,"padding","0 !important","margin","0 !important"],[1,"ion-no-padding",2,"padding-top","0px !important","cursor","pointer",3,"click"],["name","call","slot","start","color","tertiary"],[1,"ion-text-wrap"],["name","mail","slot","start","color","danger"],["color","danger",1,"ion-text-wrap"],["slot","end","size","small","fill","clear",3,"click"],["name","close","slot","icon-only"]],template:function(h,L){1&h&&a.YNc(0,S,30,16,"div",0),2&h&&a.Q6J("ngIf",!L.isHide||L.neverHide)},dependencies:[w.O5,k.YG,k.wI,k.jY,k.gu,k.Ie,k.Q$,k.Nd,d.X$],encapsulation:2}),Z})()}}]);