"use strict";(self.webpackChunkapp=self.webpackChunkapp||[]).push([[5420],{5420:(Zt,v,s)=>{s.r(v),s.d(v,{PointModule:()=>Ct});var p=s(6895),f=s(4006),c=s(191),J=s(2216),N=s(529),u=s(3306),Z=s(3093),y=s(3196),d=s(5861),A=s(6723),t=s(6738),T=s(5851),P=s(7720),S=s(7488),b=s(323);function I(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",16),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.delete())}),t._UZ(1,"ion-icon",17),t.qZA()}}const M=function(e,a,n){return[e,a,"symbol","1.0-2",n]};function F(e,a){if(1&e&&(t.TgZ(0,"p",18),t._uU(1),t.ALo(2,"currency"),t.ALo(3,"translate"),t.qZA()),2&e){const n=t.oxw();t.xp6(1),t.AsE(" ",t.G7q(2,2,t.kEZ(10,M,n.config.exchange,n.currency,n.translateService.currentLang))," = 1 ",t.lcZ(3,8,"point-add.point")," ")}}function H(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-text",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.showSearchContact())}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw(2);t.xp6(1),t.hij(" ",n.contactSelected.fullName," ")}}function w(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-text",20),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.showSearchContact())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"point-add.select-contact")," "))}function L(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",21),t.NdJ("click",function(){t.CHM(n);const i=t.oxw(2);return t.KtG(i.removeContact())}),t._UZ(1,"ion-icon",22),t.qZA()}}function k(e,a){if(1&e&&(t.TgZ(0,"ion-item")(1,"ion-label"),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.YNc(4,H,2,1,"ion-text",13),t.YNc(5,w,3,3,"ion-text",14),t.TgZ(6,"ion-buttons",3),t.YNc(7,L,2,0,"ion-button",15),t.qZA()()),2&e){const n=t.oxw();t.xp6(2),t.hij("",t.lcZ(3,4,"point-add.contact"),": \xa0"),t.xp6(2),t.Q6J("ngIf",n.contactSelected&&n.contactSelected.id>0),t.xp6(1),t.Q6J("ngIf",!n.contactSelected||0===n.contactSelected.id),t.xp6(2),t.Q6J("ngIf",n.contactSelected&&n.contactSelected.id>0)}}function Q(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-text",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.showSearchProduct())}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw();t.xp6(1),t.hij(" ",n.productSelected.title," ")}}function U(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-text",20),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.showSearchProduct())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"point-add.select-product")," "))}function E(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",21),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.removeProduct())}),t._UZ(1,"ion-icon",22),t.qZA()}}function q(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-text",19),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.showSearchCategory())}),t._uU(1),t.qZA()}if(2&e){const n=t.oxw();t.xp6(1),t.hij(" ",n.categorySelected.title," ")}}function Y(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-text",20),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.showSearchCategory())}),t._uU(1),t.ALo(2,"translate"),t.qZA()}2&e&&(t.xp6(1),t.hij(" ",t.lcZ(2,1,"point-add.select-category")," "))}function K(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",21),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.removeCategory())}),t._UZ(1,"ion-icon",22),t.qZA()}}let G=(()=>{class e{constructor(n,o,i,r,C,x){this.navCtrl=n,this.translateService=o,this.pointService=i,this.userService=r,this.analyticsService=C,this.alertCtrl=x,this.params=null,this.config={forAllCustomer:!0,paymentAfterBuyCount:0},this.fromSearch=!1,this.saveDisabled=!1,this.onKeyPress=m=>{!m.target||"body"!==m.target.localName||("s"===m.key||"S"===m.key)&&this.save()}}ionViewDidEnter(){this.navCtrl.addEventListener("keyup",this.onKeyPress)}ionViewWillLeave(){this.navCtrl.removeEventListener("keyup",this.onKeyPress)}ionViewWillEnter(){var n=this;return(0,d.Z)(function*(){yield n.analyticsService.setCurrentScreen("point-add")})()}ngOnInit(){var n=this;return(0,d.Z)(function*(){n.currency=yield n.userService.getAttr("current-currency"),n.config={forAllCustomer:!0,paymentAfterBuyCount:0};let o=0;n.params=n.navCtrl.getParams(n.params),n.fromSearch=n.params&&n.params.fromSearch,n.params&&n.params.id&&(o=n.params.id),o&&o>0&&n.pointService.getConfig(o).then(i=>{n.config=i,n.contactSelected=n.config.contact,n.productSelected=n.config.product,n.categorySelected=n.config.category})})()}showSearchContact(){var n=this;return(0,d.Z)(function*(){n.analyticsService.logEvent("point-add-search-contact"),n.navCtrl.push("/contact",{callback:i=>{const r=i;r&&(n.contactSelected=r,n.config.contactId=r.id)},searchMode:!0})})()}showSearchProduct(){var n=this;return(0,d.Z)(function*(){n.analyticsService.logEvent("point-add-search-product"),n.navCtrl.push("/product",{callback:i=>{const r=i;r&&(n.productSelected=r,n.config.productId=r.id)},searchMode:!0})})()}showSearchCategory(){var n=this;return(0,d.Z)(function*(){n.analyticsService.logEvent("point-add-search-category"),n.navCtrl.push("/trade-category",{callback:i=>{const r=i;r&&(n.categorySelected=r,n.config.categoryId=r.id)},searchMode:!0})})()}validate(){return this.config.exchange?!(!this.config.forAllCustomer&&!this.contactSelected&&(alert(this.translateService.instant("point-add.no-contact-alert")),1)):(alert(this.translateService.instant("point-add.no-exchange-alert")),!1)}save(){var n=this;return(0,d.Z)(function*(){if(!n.validate())return;n.saveDisabled=!0;const o=yield n.navCtrl.loading();n.pointService.saveConfig(n.config).then((0,d.Z)(function*(){n.analyticsService.logEvent("config-save-successfully"),n.saveDisabled=!1,yield o.dismiss(),n.exitPage()})).catch((0,d.Z)(function*(){n.saveDisabled=!1,yield o.dismiss()}))})()}removeContact(){this.contactSelected=null,this.config.contactId=0}removeProduct(){this.productSelected=null,this.config.productId=0}removeCategory(){this.categorySelected=null,this.config.categoryId=0}dismiss(){var n=this;return(0,d.Z)(function*(){n.fromSearch?yield n.navCtrl.pop():yield n.navCtrl.popOnly()})()}exitPage(){var n=this;return(0,d.Z)(function*(){n.fromSearch?yield n.navCtrl.pop():yield n.navCtrl.popOnly(),n.navCtrl.publish("reloadPointConfigList",null),n.navCtrl.publish("reloadPointConfig",n.config)})()}isNotCordova(){return this.navCtrl.isNotCordova()}contactImageOrPlaceholder(n){return A.W.contactImageOrPlaceholder(n.iconUrl)}delete(){var n=this;return(0,d.Z)(function*(){yield(yield n.alertCtrl.create({header:n.translateService.instant("common.confirm"),message:n.translateService.instant("point-add.delete-alert"),buttons:[{text:n.translateService.instant("common.cancel"),handler:()=>{}},{text:n.translateService.instant("common.agree"),handler:()=>{n.pointService.deleteConfig(n.config).then((0,d.Z)(function*(){n.analyticsService.logEvent("point-config-delete-success"),n.navCtrl.pop(),n.navCtrl.publish("reloadPointConfigList",null)}))}}]})).present()})()}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(T.G),t.Y36(u.sK),t.Y36(P.H),t.Y36(S.K),t.Y36(b.y),t.Y36(c.Br))},e.\u0275cmp=t.Xpm({type:e,selectors:[["point-add"]],decls:49,vars:43,consts:[["slot","start"],["ion-button","",3,"click"],["name","close"],["slot","end"],["color","danger",3,"click",4,"ngIf"],["color","primary",3,"click"],["name","checkmark"],["position","stacked","color","primary"],["clearInput","","type","number",3,"ngModel","placeholder","ngModelChange"],["style","font-size: 0.8em",4,"ngIf"],["color","primary",3,"ngModel","ngModelChange"],[4,"ngIf"],["color","primary"],["color","dark",3,"click",4,"ngIf"],[3,"click",4,"ngIf"],["fill","clear",3,"click",4,"ngIf"],["color","danger",3,"click"],["name","trash","slot","icon-only"],[2,"font-size","0.8em"],["color","dark",3,"click"],[3,"click"],["fill","clear",3,"click"],["name","close","slot","icon-only"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0)(3,"ion-button",1),t.NdJ("click",function(){return o.dismiss()}),t._UZ(4,"ion-icon",2),t._uU(5),t.ALo(6,"translate"),t.qZA()(),t.TgZ(7,"ion-title"),t._uU(8),t.ALo(9,"translate"),t.qZA(),t.TgZ(10,"ion-buttons",3),t.YNc(11,I,2,0,"ion-button",4),t.TgZ(12,"ion-button",5),t.NdJ("click",function(){return o.save()}),t._UZ(13,"ion-icon",6),t._uU(14),t.ALo(15,"translate"),t.qZA()()()(),t.TgZ(16,"ion-content")(17,"ion-list")(18,"ion-item")(19,"ion-label",7),t._uU(20),t.ALo(21,"translate"),t.qZA(),t.TgZ(22,"ion-input",8),t.NdJ("ngModelChange",function(r){return o.config.exchange=r}),t.ALo(23,"translate"),t.qZA(),t.YNc(24,F,4,14,"p",9),t.qZA(),t.TgZ(25,"ion-item")(26,"ion-label",7),t._uU(27),t.ALo(28,"translate"),t.qZA(),t.TgZ(29,"ion-toggle",10),t.NdJ("ngModelChange",function(r){return o.config.forAllCustomer=r}),t.qZA()(),t.YNc(30,k,8,6,"ion-item",11),t.TgZ(31,"ion-item")(32,"ion-label",12),t._uU(33),t.ALo(34,"translate"),t.ALo(35,"translate"),t.qZA(),t.YNc(36,Q,2,1,"ion-text",13),t.YNc(37,U,3,3,"ion-text",14),t.TgZ(38,"ion-buttons",3),t.YNc(39,E,2,0,"ion-button",15),t.qZA()(),t.TgZ(40,"ion-item")(41,"ion-label",12),t._uU(42),t.ALo(43,"translate"),t.ALo(44,"translate"),t.qZA(),t.YNc(45,q,2,1,"ion-text",13),t.YNc(46,Y,3,3,"ion-text",14),t.TgZ(47,"ion-buttons",3),t.YNc(48,K,2,0,"ion-button",15),t.qZA()()()()),2&n&&(t.xp6(5),t.hij(" \xa0",t.lcZ(6,23,"common.cancel")," "),t.xp6(3),t.Oqu(t.lcZ(9,25,"point-add.title")),t.xp6(3),t.Q6J("ngIf",o.config&&o.config.id),t.xp6(3),t.hij(" \xa0",t.lcZ(15,27,"action.save")," "),t.xp6(2),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(4),t.hij(" ",t.lcZ(21,29,"point-add.exchange")," "),t.xp6(2),t.s9C("placeholder",t.lcZ(23,31,"point-add.exchange-description")),t.Q6J("ngModel",o.config.exchange),t.xp6(2),t.Q6J("ngIf",o.config.exchange),t.xp6(3),t.Oqu(t.lcZ(28,33,"point-add.for-all-customer")),t.xp6(2),t.Q6J("ngModel",o.config.forAllCustomer),t.xp6(1),t.Q6J("ngIf",!o.config.forAllCustomer),t.xp6(3),t.AsE("",t.lcZ(34,35,"point-add.product")," (",t.lcZ(35,37,"point-add.optional"),"): \xa0"),t.xp6(3),t.Q6J("ngIf",o.productSelected&&o.productSelected.id>0),t.xp6(1),t.Q6J("ngIf",!o.productSelected||0===o.productSelected.id),t.xp6(2),t.Q6J("ngIf",o.productSelected&&o.productSelected.id>0),t.xp6(3),t.AsE("",t.lcZ(43,39,"point-add.category")," (",t.lcZ(44,41,"point-add.optional"),"): \xa0"),t.xp6(3),t.Q6J("ngIf",o.categorySelected&&o.categorySelected.id>0),t.xp6(1),t.Q6J("ngIf",!o.categorySelected||0===o.categorySelected.id),t.xp6(2),t.Q6J("ngIf",o.categorySelected&&o.categorySelected.id>0))},dependencies:[p.O5,f.JJ,f.On,c.YG,c.Sm,c.W2,c.Gu,c.gu,c.pK,c.Ie,c.Q$,c.q_,c.yW,c.wd,c.ho,c.sr,c.w,c.as,p.H9,u.X$],encapsulation:2}),e})();var h=s(7489),_=s(1914),O=s(667),D=s(6861),j=s(3064),B=s(971);function $(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.reload())}),t._UZ(1,"ion-icon",14),t.qZA()}}function z(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.addConfig())}),t._UZ(1,"ion-icon",15),t.qZA()}}function W(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-button",13),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.addLevelConfig())}),t._UZ(1,"ion-icon",15),t.qZA()}}function V(e,a){1&e&&(t.TgZ(0,"ion-segment-button",16)(1,"ion-label",8),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"point.common-config")," "))}function X(e,a){1&e&&(t.TgZ(0,"ion-segment-button",17)(1,"ion-label",8),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"point.config")," "))}function R(e,a){1&e&&(t.TgZ(0,"ion-segment-button",18)(1,"ion-label",8),t._uU(2),t.ALo(3,"translate"),t.qZA()()),2&e&&(t.xp6(2),t.hij(" ",t.lcZ(3,1,"point.level-config")," "))}function tt(e,a){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"ion-searchbar",19),t.NdJ("ionClear",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.clearSearchHistories())})("ionChange",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.searchHistories())})("ngModelChange",function(i){t.CHM(n);const r=t.oxw();return t.KtG(r.searchKeyHistories=i)}),t.ALo(2,"translate"),t.qZA(),t.TgZ(3,"div",20)(4,"period-range",21),t.NdJ("onPeriodChanged",function(i){t.CHM(n);const r=t.oxw();return t.KtG(r.onPeriodChanged(i))}),t.qZA()(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(1),t.s9C("placeholder",t.lcZ(2,3,"point.search-histories")),t.Q6J("ngModel",n.searchKeyHistories),t.xp6(3),t.Q6J("modeLink",!0)}}function nt(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"p",22),t.ALo(2,"translate"),t._UZ(3,"div",23),t.BQk()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,6,"point.level-explain"),t.oJD),t.xp6(2),t.Q6J("itemTemplate",n.itemTemplateForLevelConfig)("searchFields",n.searchFieldsForLevelConfig)("canEditItem",!0)("canDeleteItem",!0)("noDetail",!0)}}const et=function(e,a,n){return[e,a,"symbol","1.0-2",n]};function ot(e,a){if(1&e&&(t.TgZ(0,"p",31),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"currency"),t.qZA()),2&e){const n=t.oxw(3);t.xp6(1),t.AsE(" 1 ",t.lcZ(2,2,"point-add.point")," = ",t.G7q(3,4,t.kEZ(10,et,n.config.pointPaymentExchange,n.currency,n.translateService.currentLang))," ")}}function it(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",24),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",29),t.NdJ("ngModelChange",function(i){t.CHM(n);const r=t.oxw(2);return t.KtG(r.config.pointPaymentExchange=i)}),t.ALo(5,"translate"),t.qZA(),t.YNc(6,ot,4,14,"p",30),t.qZA()}if(2&e){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,4,"point-add.payment-exchange")),t.xp6(2),t.s9C("placeholder",t.lcZ(5,6,"point-add.payment-exchange-description")),t.Q6J("ngModel",n.config.pointPaymentExchange),t.xp6(2),t.Q6J("ngIf",n.config.pointPaymentExchange)}}function at(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"ion-item")(1,"ion-label",24),t._uU(2),t.ALo(3,"translate"),t.qZA(),t.TgZ(4,"ion-input",32),t.NdJ("ngModelChange",function(i){t.CHM(n);const r=t.oxw(2);return t.KtG(r.config.pointPaymentAfterBuyCount=i)}),t.qZA()()}if(2&e){const n=t.oxw(2);t.xp6(2),t.Oqu(t.lcZ(3,2,"point-add.payment-after-buy-count")),t.xp6(2),t.Q6J("ngModel",n.config.pointPaymentAfterBuyCount)}}function ct(e,a){if(1&e){const n=t.EpF();t.ynx(0),t.TgZ(1,"ion-list")(2,"ion-item")(3,"ion-label",24),t._uU(4),t.ALo(5,"translate"),t.qZA(),t.TgZ(6,"ion-toggle",25),t.NdJ("ngModelChange",function(i){t.CHM(n);const r=t.oxw();return t.KtG(r.config.allowPointPayment=i)}),t.qZA()(),t.YNc(7,it,7,8,"ion-item",12),t.YNc(8,at,5,4,"ion-item",12),t.qZA(),t.TgZ(9,"div",26)(10,"ion-button",27),t.NdJ("click",function(){t.CHM(n);const i=t.oxw();return t.KtG(i.savePointPayment())}),t._UZ(11,"ion-icon",28),t._uU(12),t.ALo(13,"translate"),t.qZA()(),t.BQk()}if(2&e){const n=t.oxw();t.xp6(4),t.Oqu(t.lcZ(5,6,"point-add.allow-payment")),t.xp6(2),t.Q6J("ngModel",n.config.allowPointPayment),t.xp6(1),t.Q6J("ngIf",n.config.allowPointPayment),t.xp6(1),t.Q6J("ngIf",n.config.allowPointPayment),t.xp6(2),t.Q6J("disabled",n.saveDisabled),t.xp6(2),t.hij(" \xa0",t.lcZ(13,8,"action.save")," ")}}function rt(e,a){if(1&e&&(t.ynx(0),t._UZ(1,"div",33),t.BQk()),2&e){const n=t.oxw();t.xp6(1),t.Q6J("itemTemplate",n.itemTemplateForConfig)("searchFields",n.searchFieldsForConfig)("canEditItem",!0)("noDetail",!0)}}function lt(e,a){if(1&e&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.AsE("",t.lcZ(2,2,"point-add.contact"),": ",n.contact.fullName,"")}}function st(e,a){if(1&e&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.ALo(3,"translate"),t.qZA()),2&e){const n=t.oxw().$implicit;t.xp6(1),t.lnq("",t.lcZ(2,3,"point.history-amount"),": ",n.amount," ",t.lcZ(3,5,"point-add.point"),"")}}function dt(e,a){if(1&e&&(t.TgZ(0,"p"),t._uU(1),t.ALo(2,"translate"),t.qZA()),2&e){const n=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.AsE(" ",t.lcZ(2,2,"point.history-created-at"),": ",o.dateFormat(n.createdAt)," ")}}function pt(e,a){if(1&e){const n=t.EpF();t.TgZ(0,"p")(1,"ion-text",42),t.NdJ("click",function(){t.CHM(n);const i=t.oxw().$implicit,r=t.oxw(2);return t.KtG(r.viewOrder(i.order.id))}),t._uU(2),t.ALo(3,"translate"),t.qZA()()}if(2&e){const n=t.oxw().$implicit;t.xp6(2),t.AsE("",t.lcZ(3,2,"point.order"),": #",n.order.orderCode,"")}}function _t(e,a){if(1&e&&(t.TgZ(0,"ion-avatar",4),t._UZ(1,"img",43),t.qZA()),2&e){const n=t.oxw().$implicit,o=t.oxw(2);t.xp6(1),t.Q6J("src",o.contactImageOrPlaceholder(n.contact),t.LSH)}}function gt(e,a){if(1&e&&(t.TgZ(0,"ion-item")(1,"ion-label",8),t.YNc(2,lt,3,4,"p",12),t.YNc(3,st,4,7,"p",12),t.YNc(4,dt,3,4,"p",12),t.YNc(5,pt,4,4,"p",12),t.qZA(),t.YNc(6,_t,2,1,"ion-avatar",41),t.qZA()),2&e){const n=a.$implicit;t.xp6(2),t.Q6J("ngIf",n.contact),t.xp6(1),t.Q6J("ngIf",n.amount),t.xp6(1),t.Q6J("ngIf",n.createdAt),t.xp6(1),t.Q6J("ngIf",n.order),t.xp6(1),t.Q6J("ngIf",n.contact)}}function ut(e,a){1&e&&(t.TgZ(0,"ion-item",8),t._UZ(1,"div",44),t.ALo(2,"translate"),t.qZA()),2&e&&(t.xp6(1),t.Q6J("innerHTML",t.lcZ(2,1,"point.no-histories"),t.oJD))}function mt(e,a){if(1&e&&(t.ynx(0),t.TgZ(1,"ion-list")(2,"ion-grid")(3,"ion-row",34)(4,"ion-col",35)(5,"ion-item",36)(6,"ion-label",37),t._uU(7),t.ALo(8,"translate"),t.ALo(9,"translate"),t.TgZ(10,"p")(11,"ion-text",38),t._uU(12),t.ALo(13,"translate"),t.qZA()()()()()()(),t.YNc(14,gt,7,5,"ion-item",39),t.YNc(15,ut,3,3,"ion-item",40),t.qZA(),t.BQk()),2&e){const n=t.oxw();t.xp6(4),t.Q6J("size",n.pointHistories&&n.pointHistories.length?8:12),t.xp6(3),t.lnq(" ",t.lcZ(8,8,"common.total"),": ",n.total," ",t.lcZ(9,10,"point-add.point")," "),t.xp6(5),t.AsE(" ",n.pointHistories&&n.pointHistories.length?n.pointHistories.length:0," ",t.lcZ(13,12,"point.history(s)")," "),t.xp6(2),t.Q6J("ngForOf",n.pointHistories),t.xp6(1),t.Q6J("ngIf",!n.pointHistories||0===n.pointHistories.length)}}const ft=[{path:"",component:(()=>{class e{constructor(n,o,i,r,C,x,m,xt){var l=this;this.navCtrl=n,this.staffService=o,this.currencyPipe=i,this.userService=r,this.pointService=C,this.translateService=x,this.planService=m,this.analyticsService=xt,this.params=null,this.dateFrom="",this.config={id:0,allowPointPayment:!1},this.dateTo="",this.pointConfigs=[],this.levelConfigs=[],this.pointHistories=[],this.originalPointHistories=[],this.saveDisabled=!1,this.segment="histories",this.noSave=!0,this.total=0,this.searchKeyHistories="",this.selectedStaff=null,this.itemTemplateForLevelConfig={h2:{field:"title"},pList:[{short:"point"},{short:"buy-count"}]},this.searchFieldsForLevelConfig=["title"],this.itemTemplateForConfig={pList:[{short:"exchange",valueFunc:g=>this.currencyPipe.transform(g.exchange,this.currency,"symbol","1.0-2",this.translateService.currentLang)+" = 1 "+this.translateService.instant("point-add.point")},{field:"forAllCustomer",valueFunc:g=>g.forAllCustomer?this.translateService.instant("point-add.for-all-customer"):""},{short:"product",titleValue:!0},{short:"category",titleValue:!0},{short:"contact",valueFunc:g=>g.contact.fullName}],thumbnail:"product.avatarUrl"},this.searchFieldsForConfig=["product.title","category.title","contact.fullName"],this.reload=(0,d.Z)(function*(){const g=yield l.navCtrl.loading();l.params=l.navCtrl.getParams(l.params),l.dateFrom=l.params&&l.params.dateFrom?l.params.dateFrom:l.dateFrom?l.dateFrom:_.C.GetFirstDateOfMonth(),l.dateTo=l.params&&l.params.dateTo?l.params.dateTo:l.dateTo?l.dateTo:_.C.GetEndDateOfMonth(),l.pointHistories=yield l.pointService.getHistories(l.dateFrom,l.dateTo),l.originalPointHistories=JSON.parse(JSON.stringify(l.pointHistories)),l.config=yield l.pointService.getPointPaymentConfig(),l.total=h.sumBy(l.pointHistories,vt=>vt.amount),yield g.dismiss()}),this.selectedStaff=this.staffService.selectedStaff}ionViewWillEnter(){var n=this;return(0,d.Z)(function*(){yield n.analyticsService.setCurrentScreen("point")})()}changeSegment(){"config"!==this.segment?this.noSave=!0:setTimeout(()=>{this.noSave=!1},2e3)}ngOnInit(){var n=this;return(0,d.Z)(function*(){n.currentPlan=yield n.planService.getCurrentPlan(),n.currency=yield n.userService.getAttr("current-currency"),n.segment="histories",yield n.reload()})()}onPeriodChanged(n){var o=this;return(0,d.Z)(function*(){if(!n)return;o.analyticsService.logEvent("point-period-changed");const i=yield o.navCtrl.loading();o.dateFrom=""!==n.dateFrom?_.C.toDbString(n.dateFrom,_.C.getDbFormat()):"",o.dateTo=""!==n.dateTo?_.C.toDbString(n.dateTo,_.C.getDbFormat()):"",o.params||(o.params={}),o.params.dateFrom=o.dateFrom,o.params.dateTo=o.dateTo,o.pointHistories=yield o.pointService.getHistories(o.dateFrom,o.dateTo),o.originalPointHistories=JSON.parse(JSON.stringify(o.pointHistories)),o.total=h.sumBy(o.pointHistories,r=>r.amount),yield i.dismiss()})()}isNotCordova(){return this.navCtrl.isNotCordova()}viewOrder(n){this.navCtrl.navigateForward("/order/detail",{id:n})}contactImageOrPlaceholder(n){return A.W.contactImageOrPlaceholder(n.avatarUrl)}dateFormat(n){return _.C.toUiDateString(n)}searchHistories(){var n=this;return(0,d.Z)(function*(){n.analyticsService.logEvent("contact-search");let o=JSON.parse(JSON.stringify(n.originalPointHistories));if(null!==n.searchKeyHistories&&""!==n.searchKeyHistories){const i=n.searchKeyHistories.toLowerCase();o=o.filter(r=>r.contact&&-1!==r.contact.fullName.toLowerCase().indexOf(i)||r.product&&-1!==r.product.title.toLowerCase().indexOf(i)||r.category&&-1!==r.category.title.toLowerCase().indexOf(i))}n.pointHistories=o,n.total=h.sumBy(n.pointHistories,i=>i.amount)})()}clearSearchHistories(){this.searchKeyHistories=null,this.reload()}savePointPayment(){var n=this;return(0,d.Z)(function*(){if(!n.validatePointPayment())return;n.saveDisabled=!0;const o=yield n.navCtrl.loading();n.pointService.savePointPaymentConfig(n.config).then((0,d.Z)(function*(){n.analyticsService.logEvent("config-save-successfully"),alert(n.translateService.instant("point-add.save-point-payment-successfully")),n.saveDisabled=!1,yield o.dismiss()})).catch((0,d.Z)(function*(){n.saveDisabled=!1,yield o.dismiss()}))})()}validatePointPayment(){return!(this.config.allowPayment&&!this.config.paymentExchange&&(alert(this.translateService.instant("point-add.no-payment-exchange-alert")),1))}}return e.\u0275fac=function(n){return new(n||e)(t.Y36(T.G),t.Y36(O.x),t.Y36(p.H9),t.Y36(S.K),t.Y36(P.H),t.Y36(u.sK),t.Y36(D.D),t.Y36(b.y))},e.\u0275cmp=t.Xpm({type:e,selectors:[["point"]],decls:27,vars:20,consts:[["slot","start"],["menu","first"],["color","primary",3,"click"],["name","home"],["slot","end"],[3,"click",4,"ngIf"],["color","primary",3,"ngModel","ngModelChange","ionChange"],["value","histories"],[1,"ion-text-wrap"],["value","common-config",4,"ngIf"],["value","config",4,"ngIf"],["value","level-config",4,"ngIf"],[4,"ngIf"],[3,"click"],["name","refresh"],["name","add"],["value","common-config"],["value","config"],["value","level-config"],["debounce","700",3,"placeholder","ngModel","ionClear","ionChange","ngModelChange"],[2,"padding-left","10px","padding-right","10px"],["page","point",3,"modeLink","onPeriodChanged"],[1,"ion-padding",2,"font-size","0.8em",3,"innerHTML"],["list-only","","table","level_config",3,"itemTemplate","searchFields","canEditItem","canDeleteItem","noDetail"],["position","stacked","color","primary"],["color","primary",3,"ngModel","ngModelChange"],[1,"ion-padding"],["color","success",3,"disabled","click"],["name","checkmark"],["clearInput","","type","number",3,"ngModel","placeholder","ngModelChange"],["style","font-size: 0.8em",4,"ngIf"],[2,"font-size","0.8em"],["clearInput","","type","number",3,"ngModel","ngModelChange"],["list-only","","table","point_config",3,"itemTemplate","searchFields","canEditItem","noDetail"],[2,"border-bottom","1px solid #ccc"],[3,"size"],["lines","none",1,"ion-text-wrap","ion-no-padding"],["color","primary"],["color","dark"],[4,"ngFor","ngForOf"],["class","ion-text-wrap",4,"ngIf"],["slot","end",4,"ngIf"],["color","secondary",3,"click"],[3,"src"],[3,"innerHTML"]],template:function(n,o){1&n&&(t.TgZ(0,"ion-header")(1,"ion-toolbar")(2,"ion-buttons",0),t._UZ(3,"ion-menu-button",1),t.TgZ(4,"ion-button",2),t.NdJ("click",function(){return o.navCtrl.home()}),t._UZ(5,"ion-icon",3),t.qZA()(),t.TgZ(6,"ion-title"),t._uU(7),t.ALo(8,"translate"),t.qZA(),t.TgZ(9,"ion-buttons",4),t.YNc(10,$,2,0,"ion-button",5),t.YNc(11,z,2,0,"ion-button",5),t.YNc(12,W,2,0,"ion-button",5),t.qZA()(),t.TgZ(13,"ion-segment",6),t.NdJ("ngModelChange",function(r){return o.segment=r})("ionChange",function(){return o.changeSegment()}),t.TgZ(14,"ion-segment-button",7)(15,"ion-label",8),t._uU(16),t.ALo(17,"translate"),t.qZA()(),t.YNc(18,V,4,3,"ion-segment-button",9),t.YNc(19,X,4,3,"ion-segment-button",10),t.YNc(20,R,4,3,"ion-segment-button",11),t.qZA(),t.YNc(21,tt,5,5,"ng-container",12),t.qZA(),t.TgZ(22,"ion-content"),t.YNc(23,nt,4,8,"ng-container",12),t.YNc(24,ct,14,10,"ng-container",12),t.YNc(25,rt,2,4,"ng-container",12),t.YNc(26,mt,16,14,"ng-container",12),t.qZA()),2&n&&(t.xp6(7),t.Oqu(t.lcZ(8,16,"point.title")),t.xp6(3),t.Q6J("ngIf","histories"===o.segment),t.xp6(1),t.Q6J("ngIf","config"===o.segment&&(!o.selectedStaff||o.selectedStaff.hasFullAccess)),t.xp6(1),t.Q6J("ngIf","level-config"===o.segment&&(!o.selectedStaff||o.selectedStaff.hasFullAccess)),t.xp6(1),t.Q6J("ngModel",o.segment),t.xp6(3),t.hij(" ",t.lcZ(17,18,"point.histories")," "),t.xp6(2),t.Q6J("ngIf",!o.selectedStaff||o.selectedStaff.hasFullAccess),t.xp6(1),t.Q6J("ngIf",!o.selectedStaff||o.selectedStaff.hasFullAccess),t.xp6(1),t.Q6J("ngIf",!o.selectedStaff||o.selectedStaff.hasFullAccess),t.xp6(1),t.Q6J("ngIf","histories"===o.segment),t.xp6(1),t.Akn(o.navCtrl.hasAds()?"--padding-bottom: 60px":""),t.xp6(1),t.Q6J("ngIf","level-config"===o.segment),t.xp6(1),t.Q6J("ngIf","common-config"===o.segment),t.xp6(1),t.Q6J("ngIf","config"===o.segment),t.xp6(1),t.Q6J("ngIf","histories"===o.segment))},dependencies:[p.sg,p.O5,f.JJ,f.On,c.BJ,c.YG,c.Sm,c.wI,c.W2,c.jY,c.Gu,c.gu,c.pK,c.Ie,c.Q$,c.q_,c.fG,c.Nd,c.VI,c.cJ,c.GO,c.yW,c.wd,c.ho,c.sr,c.w,c.as,c.QI,c.j9,j.M,B.s,p.H9,u.X$],encapsulation:2}),e})()},{path:"add",component:G}];let ht=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[y.Bz.forChild(ft),y.Bz]}),e})(),Ct=(()=>{class e{}return e.\u0275fac=function(n){return new(n||e)},e.\u0275mod=t.oAB({type:e}),e.\u0275inj=t.cJS({imports:[p.ez,f.u5,c.Pc,ht,J.uH,Z.m,u.aw.forChild({loader:{provide:u.Zw,useFactory:Z.x,deps:[N.eN]}})]}),e})()}}]);